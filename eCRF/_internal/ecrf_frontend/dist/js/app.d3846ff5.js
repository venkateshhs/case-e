(function(){"use strict";var e={4678:function(e,t){t.A={edit:"fas fa-edit",add:"fas fa-plus",copy:"fas fa-copy",delete:"fas fa-trash",toggleUp:"fas fa-angle-up",toggleDown:"fas fa-angle-down",back:"fas fa-arrow-left",prev:"fas fa-chevron-left",next:"fas fa-chevron-right",cog:"fas fa-cog",book:"fas fa-book",user:"fas fa-user",arrowLeft:"fas fa-arrow-left",share:"fas fa-share-alt",export:"fas fa-file-export",info:"fas fa-question-circle",demographicinformation:"fas fa-id-card",contactinformation:"fas fa-address-book",reproductivehealth:"fas fa-baby",presentingcomplaint:"fas fa-comment-medical",vitalsignsandmeasurements:"fas fa-heartbeat",physicalexamination:"fas fa-stethoscope",medicalhistory:"fas fa-notes-medical",familyhistory:"fas fa-dna",socialhistory:"fas fa-users",allergies:"fas fa-allergies",immunizationhistory:"fas fa-syringe",medications:"fas fa-prescription-bottle",laboratorytestshematology:"fas fa-vial",laboratorytestsbiochemistry:"fas fa-flask",laboratorytestsurinalysis:"fas fa-prescription-bottle",imaging:"fas fa-x-ray",diagnosis:"fas fa-diagnoses",treatmentplan:"fas fa-briefcase-medical",adverseevents:"fas fa-exclamation-triangle",outcomeandfollowup:"fas fa-clipboard-check",additionalinformation:"fas fa-comment-dots",clock:"fas fa-clock",paperclip:"fas fa-paperclip",link:"fas fa-link",trash:"fas fa-trash",infoCircle:"fas fa-info-circle",minus:"fas fa-minus",pen:"fas fa-pen",cogs:"fas fa-cogs",exchangeAlt:"fas fa-exchange-alt",toggleOn:"fas fa-toggle-on",toggleOff:"fas fa-toggle-off",check:"fas fa-check",times:"fas fa-times"}},6754:function(e,t,s){var a=s(3751),i=s(641);const l={id:"app"};function n(e,t,s,a,n,r){const o=(0,i.g2)("router-view");return(0,i.uX)(),(0,i.CE)("div",l,[(0,i.bF)(o)])}var r={name:"App"},o=s(6262);const d=(0,o.A)(r,[["render",n]]);var u=d,p=s(7043),m=s(33),h="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAaMAAAB4CAMAAABoxW2eAAAAmVBMVEX///8CPWsAO2oANGYAOWkAMWQANmcAL2MAKWAAJl4ANWYALWKdrb36/f7k6e1gfJitushZcY4AI12FmK1/k6kWRXAqVn15jaNFYYM2Vnvy9PcAIVwAQm+To7bR197t8vXc4+nDzdc6XYEAHVvT2+KwvcpRcI8bTnijscFuhZ5KaYq8x9IAEVYAF1hOa4u3ws4ACFQYTHdpgJqEWPfdAAAUBUlEQVR4nO1d62KiOhCWkJBgBBG8tCAK3i+7dev7P9wBAhIwYEB39bT9fpyzRSUhH5PMTGYmnU5DBGHPOR/GnyNFmX6O3/rHpjf4wd9EYO23HqFI1SBQgBIBQNt8dq9+kME97oGO1YQZDtrHszv2AwbjNCC0W+YnBjk9u28/iBFMNKoJ+InnOsV4du+uUO6R8XpdfDTCg341w12gDp/dvRLMyVYbnYP8wqo/0rbD+dM69A9wfNcrRIhNdcGzO1jEkaJIm1H1XXbBt6MpGiAUPrNXfxWzBYE1DClw8eweFhHoqcR7KScnj10A9Iuqn2a/niFFodaz+1jEJpN5OGYXlGyWVs/P7dlfQg936xmKntx9dicLMOzLwmkH8YWVnnf1yX37GzAX9BZDSnf/7F4WEeSUkGSyO+bP4L3W6/QI7G5Nc8lAzJ7dzSJM+9I1Pekax5H95TTwAbnNkAK2z+5mGejSN5pQYi6zv19Nu7kb5lSVoEjBvWd3tAwnkxvqsAuHbEm1v5g/JJSZ52J99vUswwVmFGVSM4eJ/Q30F1s574W1rOcmgzZ4dk8FmGBCCc29H+4g+pOoLyfx96HnyVGUqk4y8P/heu2ujmFBhZvPTuEX0xd8/TY7bKpTZG/p2m9fbJCeC2mKFOTI3nOH0eFv9vmboSdNkUKkPWDvUEGbv9nrb4WTXrkLUQZ8k71p4pChX0yxqoERWP5583H46Dunx3tyZzKWawq6lr3rJDG2iP+QHvY3DCVFzVq8M0yEK5+ffvpemp/dc/aBjHPY7Kdffqv2rxjHvqJj1NU0qGmIkrFTRdMua1q4BWdM0k8XRc1sDqSlKDJgJR6KtZbaw/YDAohWnqoxFA2e4xKmICL/tm9nH9vFN2VDAQNcSiipW5TeRVtWWIaGPyVaYRABon0hS2vv0uWJ4OM9ubQV8NcXdbt5JXRFNxbCutj+9wu+wzl7+OuTi18EjAQ/e7vY5NmeRYr8dhIakJkbJRWTyBrg67ccdIno3v3LpoKwy9PLjeiOuzy57ejOoa9uPlOKywDB+917w5yLSo4Ek10VR0bu8lIlOMr1KSyaGo0BEc9DAI+v5a5/EYgbHCFuWj/Kq3RN3KlB7ovG0rJXBY6jwlz7ChzNR9VOTg1dvdJtOHJhg8VIwTvBfYUYcj337o0qeGGOTLXOyQlImaQ2HPWlXN2X0ZZ2HPBLKICyv6rA63Lkwno/NECl1bgFR6EtvrcYXenogFNhkUN3znavy9H7LX1LK60OLTgaNZnp0l1OGRyKffcC2R8K8bIcOWV963o4cbGF5hz5uAlFwruKn6vkRJf3TgjxqhwFRf8MRCQypWgpuLeYvdCYo3kjihQs7TPwUemn5C5L9lU5+uDZAGTRW81d1zwNCpul3T7/k8YcDctDWQ9begP2SubvM5JelKMV70NTR7n2uhrzmpjHD1tjjraNViNN2okdXjsA70q0eFGO+lwgIjoUOnDgP+Knn6YczZqYr03mq8G1tlPyxjTDa3LkcrOQVoo/MrjXv0BGU472NwNSeQBw83FSzEXb7vJb7Nd4TY7WnFKnlp2S/PvPaw0NOTKaOOqabMD2RKrIPZl/r8kRN9UJtKm8cYVyE1BDjo7NOGKh1DKYipY5IL+Be4XX5IizLQUB8DvOuc4x2JCjCa983IS8iVOxzMnL4RVekiMz35DQBP4XbuNU5dwsDTn6bKTVyeeznMXLHJjK3uAKL8kRR4JoX8nNjSTEUdiMI0M2oC59Gll3qlsVHNFea3hJjqx81RWmNZ4UjW2pqtvWOsOqQRRDUV7rsatyXsjfooyX5KiXLziafHR1M46aqQzyG7CVhnH7ye4lOcr9XfJhoU05sppwJG+C1ojn1YaXLF6dI2lfM8+RovT8K+QfJhz1mjjr5PNZ9tXaImobx/VFOULXKHFUuW4IOZKdcY0a5mHb0OIvylEtEo7WDTjS+jcbT1E7g8KWyanfliOBc7oS8mrzom5/v+2C9G05CuS93uBTtgtBLfHyYUVFfFuOOvJ6nfxiP6zWGJT2FtL35Wgj+3V5d6hRHzreNqzh+3K0kxUkTVofO9XfUjiSEvi+HLnSGbDS+9yH+h60TUn/vhwV9uPrRlbah2PSG650PZB/Gg5fkyNArsBNQylHgVyQKpXWxq5Ctq5u1c71/SU5AqNgVkaYk5TFBUkFezcIu7oZ9SqfBVjAS3KURwQ0qVxa71N1c6m5xEBKaA1APoD4tlV8w0Ayh3uGUgRSFUdOfl0RuDDec44KYTuP4YjzpanCZdZwU/AMNuaoY922Y6n8FrcgZKvMUa1rdk6QyrAsclnFETe3outhMnKxLtZmeQxHnA4r3ONzPM9O4Hncz5pz1Nnfcto1yN6XiEyuN4ZzY6BULquKo13tVqibD2LReH4MR5xLRZQ75uY/A1yhwxYcdQ71y7y6kJ9qhSFbTTjKd0tK21VVuZZh7TDxnxbafQxHbj5riEooceEOvCutDUfGWx1JuAFFMpHJ9bFBuViAIkdcBBPir5u5pAg885xfqqhPPih2a5y7jwUzLSfjmnTMiZijjtGvSLmNoDepGCtT5aFejvLde0AL78bHZTRKDwZrQtwMLsxPL4zhgzhyuDfnutjCgWOQG+5WHMW1gsT7CV3SqPxwRchWAfU6A1eqlvKuDW6hK80qnJZyJaK9XMhKw/EgjvjZjJZ3XbhnKcSCtOSosxoLREnz+o0cN67M1rsweT5H3o3CgsRPdUVB5HcUS8Nkcv0pMfGovAlOUOGoJMbb/L0vBMq35ajTWX8WDy6A2Os33I+T2nq/YcNyOVc4L2iy5ibRUrndOfdyASXgPjGn3ORgF5/lURzxWZDaqLA3cOC8AwUJb89RpARNoE0T8wRh4r31Gjs/x3UbsJchrvcF8WKBN+mb6XAxlUAr/YJ3UQLOQt5hrjtlT0mRI0MA/tvVHLm8CwDSvKTi7JOf95fyOWL1HMWdCXvOZDJ0rFWLHQS5XKYbPlWDVzs0/WyFpyHk59ArnWNVcDlibbKerWbriVoQ6rLfnuMoWnQF0PnA6ZpcS6fQDCbn3WwVzHaLQqSuWihxdCdHd0HO5y7QUQtweEJAl1JamILBdUX1QkpqZC3iaIhx0Q155XA0bropwe/g8u26vPJSTqkWt05wcUahhT4/kSNTSoxu7vG51cf5JGN0rbqb3k2rzCuvrLc54vXKOo4kylvoxSX4iRzVRD5yuL1XXutAhKI9gJslLK8djo/jqOPcMgpxycR8HkdmtR3MQyLmpF+jwotXs7pfxG1eb/Q/kKNOv37rQC3X6X8eR3JidMs8SrCovFVVzftab5Y6vp5eH8lRPUnoypf2NI5kQ/Vkjh8zFuIhB3olwZvqYaIHwQr4UI46Q7tyDiGDq9afxtGHXCCF5H7lWZRk1lVrTCunwpsFdXHR0ody1DlCJGRJowLv5LM4CiXFSDYGzFLLogT1Ta3WPhsLzsqAZFyxhXzbbcWZVPObtTrdCblmSdMPgeC759pane7y8vu2Mb0VEOaRCyD9arhDzBkZQNXfb5bvOC1sxNMEkf1e6Xg6E60eKh9ktqDp1a5dlVNgDiHhiw1qWN+I5f64zNqwRW6oj6wt1Xto/WnpqkMNTsN0dwed4Dgjh9rTiVRExcpZ6ITGv8GU6Aunzt/oD+rBn2IavTGiqyUY4WSsR+1HILr60asc4VPWhvCFNbK2mrpL67GSDaWUj+xn3Z2tfcfpHRu8T8bquPMdf3ds4826H0YQHo+nYxg8o/FayM50r3fw77fBWTpl89WO8fs2kIj+ajfV/eBRCKoNuDLkq0j+4JFw5Y+q+LLHUr84jLH8URUveYzfN8BBzpWa4EdjeApu7AoU8OUO0/1/YNCkmM09pTp/0BLGpkmdlB8xegLcim2eCsgnMf3gUQhGjWoay5cG/8GjcMIyEY85Huto/4EEJvJnlSb4cTH8awTjZkeJNMq77viTDPv2hYxjOPvv+2b4XrN5TlGKx2jWwwBZTqyq/rmnm+4SNXk1vhLCUUMhUhRR6EUl4swuTBn0ezrqEvkDHv8anI9/f860uZH3c2coH5dRD2MKp+ac4a7N1JfgaIvues9awNzbDY77TQEaFFbuMI4estF9F0c9W29X2aiEMZQ+l/ohWPX1RocfpBQ1tF4FHJkn63gZMcPN/hPDXYUhP5hmGF4+ijkyjtY6uPzUTC0A03Szf0QakGWFXIOm1bOOho+y0zWMcG2dsnuaGS5tzvhfz+PrUYuZoRHsVEU181bjr8zzf2e/4HuSXDxZrQ6ld62F3shqzaA3DBO74iiaXuO1KY2FMHR72JlMfyexXPMz1QnR99n3Zws7+rPPRjTi6D0EBFMvCxbtL/8kwTbBnyXbJ+n9+mVNPIoJuDgTHT2O64ELkMaW92B8gabnRf3RGew0iCvc6hgTmD2i4qFgpEctsjj89S8cF27S/6xZY39Wp9ESpA0nvzGwBwx24bfveNEKvA06DqHRLZpWYzSOZ402VeYYhGd217ZV4sjU1C5RCaQsfnJua/0F1uz4sV0FxR9oOA2ttGwtGs+uCpN30yXKCEYUYYBTJ0dfY/sjAUn3snwEPkl8c5BJjaNDdfE2piCN/490WDraUmgnJIW/ElUGZmWaTx7U4gypNFLOGIGpErWIAE1Isn7HZcgwXlqsMa1PYRfGD9dD6elGELCH9ZEy0imiQPuc2FGPNEVvEqYaWANIWolQBNpYrSlztNDQ2XRnY8hSVOa2Arv47SMeQYeqk7k732gs/z0gQFu7qz5iSkokRwBZrtujwGPTbcQRk6OcIwX1TXc1hl12YW6DJK11jVM50pMk22AKk0Qv4xgj3EDWwpxG9B/DPQV2Iodx7Zu0xeTX7jH8BJplWW7amIZHTM8TcUSduRsCAPBb4JqDruDcY0MwARpm2BuMCNYaq3IZsHTJaY4jAN4TjOLnnNnwPb5sIoCMlKNx2teInPhfxq9lIih7lYX6brr2jHHEKg04KE0aFnDEanWYSLGTCyeaRnT3tWSUTRsmt7b0Zb61MsMAJj1wMCvcEUlIIskRRywA2FGzGgfvuc4Q0XA5KlbAEdsY6EVSH9/b1UTHTQ3xou/0dutjGB6P1s4fbt6n9B5+YilqTlFiH7Fo2uSUcz99ms4BJspHxNElx//c1QbxKzpnKsAWJvNIZ7b04pGK5joWEBzQ9AgzAUdpfu0bZGJj4fTIL0dNLhieoiUXuCzmOQLplvICpoG3EWmJmI2A7rIGshzYMbzUZcloiCHgiPVkFi2i6b1Fpf78pabi1HrEGKlao8PmRSBNqqRkiOVonOAzSAYLs6jtczfpdDQbXQ7gOHpKFx38lDJDYRKXDWgkR6zku0nTYg8CjlKxOacr1czrJoMbjTZJbtLHCh3tLX6SGWsk1RG2APWsGFOQFEeL5Sj5YK5nwRsFjvKEawFHTAIDPU11/NCwKFp9t7w97E0gziu5hdJ65KQTWGd/4Si3epwlghCRzxX7YdFYjtejlKP0JwKO0vzxczfdJj5oaB9NI+Pof6w3Hx7SVEoGl2D8M7pUjthGmkVc+0xXWQh/xBFjJFJsUjWlwFGeGVPHEVOANpo4byK8nf4rD+C1y58pc4QuHJGUI64CSuCMPaJBPVmWHsGRGYkEIVSj26wPK+dNpwBlje70vJUtnE7SmoiJ+v8vOOqYSgsjVQzYNn6hxFEP5av4qlPmKP5+eNCSFdrI6te4x8TiveYoY2JWyZFJQByjQT+LHsZwm2pundUS5GdmjLVSGSIRR5zOkHO0w2zeM3BjjjrGRi73+CbwuO2mXomjlddlq9oIQvb4F47c84CJmMq2pxZMQY7Mkt8xZ9ccRQORvL09VMWRj3HAd2Y2nSaSd6RMml0VcPk5ezUR4M7s8MYUi2uO3uHFX8dzFKZvSaQiNOYozqRvZ6sWAPTWp7pd2UeHLo4HYIiIzx7/wpEBUVJE1aCMox5VYzrdEUjOzL3mKNTBNHa5QFDF0Y6gdezMNdMeBMvuG/siO2M6MtaszqVWzUyH71EL85G6zOyjMkcHiPzU/cNz5OpJnJSxaD7XJd8aNzs1VgAE7ojTKnM0nyKyOI8w3aSPn8910fs07a39LUyLZGy7aDycAEiSN+Sao85WA2gwIKpSrTNAnJRAzfxLfdz9dJwNhlr8d1wxA3kxSHLnPdHwoE9hamMIOOoRBel/Uj8Dl017Rgr56GsYtOIo+j5t61VIAHP/WRsYGi2eoOkOiK7rWe2q+W+Up1/sdTUyFJCdrh7zMVERVm02Yu4Ss7nPXNK0iHygYg1R4hDCDCbfS2vr9vXfbD0aA0RVFZEuZnq8cdBVTDHVko/D3ziFzWRjoseZhlklRgNQZgrPf5HsUOmDjXFirnV8myvka2xJZOnYkyllNp1vMxUr+EWYSnIgXq2j09wIEoAlAcjiziRByy8nb5vr3fGyUE/2XN+Pm+12MckbtD62234mxLvsRj0/S0Ce+5u3fRBdYN8JfJ8tmzPfTxpYdJEfb14F/W5mBJ36i8N5l7ppdxmyLgbOx2F4cexbeYuXmWS267FGLo2lvRu8RT3NfpF9aGS/DIvfFiB8b8cSoKN2RdZfA3MvK5ZjQLWFj+Qf4yRKpr8BSKePzVf/14g4yqoTKOr/Ic3jeGi0pQc0fWw9JVP4gdhC1XINw50P1UZBGM/DaoKopE8VUtL/AkH3xyXAcTQARupjNuz/AYz1htDuLZo0bL/tHrL9/3ScgB5rkcQ7/J+exz2doY6reAIaJnTwRQhKsArjI27+f6HPwW7/aRPK7VcAqKmRpeEp/d5D63H84B4YwbHnnA/jz6miTD/Hh77jn55TTeT74D+ZKZ2pTqZgBQAAAABJRU5ErkJggg==";const y={class:"login-page"},g={class:"login-container"},f={class:"form-group"},v={class:"form-group"},k={class:"password-wrapper"},b=["type"],L={key:0,class:"error"};function w(e,t,s,l,n,r){const o=(0,i.g2)("router-link");return(0,i.uX)(),(0,i.CE)("div",y,[(0,i.Lk)("div",g,[t[9]||(t[9]=(0,i.Lk)("div",{class:"logo-container"},[(0,i.Lk)("img",{src:h,alt:"Logo",class:"logo"})],-1)),t[10]||(t[10]=(0,i.Lk)("h1",null,"Login",-1)),(0,i.Lk)("form",{onSubmit:t[3]||(t[3]=(0,a.D$)((...e)=>r.handleLogin&&r.handleLogin(...e),["prevent"])),class:"login-form"},[(0,i.Lk)("div",f,[t[4]||(t[4]=(0,i.Lk)("label",{for:"username"},"Username",-1)),(0,i.bo)((0,i.Lk)("input",{type:"text",id:"username","onUpdate:modelValue":t[0]||(t[0]=e=>n.username=e),placeholder:"Enter your username"},null,512),[[a.Jo,n.username]])]),(0,i.Lk)("div",v,[t[5]||(t[5]=(0,i.Lk)("label",{for:"password"},"Password",-1)),(0,i.Lk)("div",k,[(0,i.bo)((0,i.Lk)("input",{type:n.showPassword?"text":"password",id:"password","onUpdate:modelValue":t[1]||(t[1]=e=>n.password=e),placeholder:"Enter your password"},null,8,b),[[a.hp,n.password]]),(0,i.Lk)("button",{type:"button",class:"toggle-password",onClick:t[2]||(t[2]=(...e)=>r.togglePasswordVisibility&&r.togglePasswordVisibility(...e))},(0,m.v_)(n.showPassword?"Hide":"Show"),1)])]),t[6]||(t[6]=(0,i.Lk)("button",{type:"submit",class:"btn-login"},"Login",-1))],32),(0,i.Lk)("p",null,[t[8]||(t[8]=(0,i.eW)(" New user? ",-1)),(0,i.bF)(o,{to:"/register",class:"register-link"},{default:(0,i.k6)(()=>[...t[7]||(t[7]=[(0,i.eW)("Register here",-1)])]),_:1})]),n.error?((0,i.uX)(),(0,i.CE)("p",L,(0,m.v_)(n.error),1)):(0,i.Q3)("",!0)])])}s(4114);var C={name:"LoginComponent",data(){return{username:"",password:"",showPassword:!1,error:null}},methods:{togglePasswordVisibility(){this.showPassword=!this.showPassword},async handleLogin(){this.error=null,console.log("Attempting login with username:",this.username);try{const e=await this.$store.dispatch("login",{username:this.username,password:this.password});e?(console.log("Login successful, redirecting to dashboard..."),this.$router.push("/dashboard")):(console.log("Login failed: invalid credentials"),this.error="Invalid username or password.")}catch(e){if(console.error("Login error:",e),e.response&&e.response.status){const{status:t,data:s}=e.response;this.error=403===t?"Your account does not have permission to access this application.":400===t?"Invalid username or password.":s?.detail||"An unexpected error occurred. Please try again."}else this.error="Unable to reach server. Please try again."}}}};const S=(0,o.A)(C,[["render",w],["__scopeId","data-v-69489650"]]);var x=S;const D={class:"registration-page"},F={class:"registration-container"},A={class:"password-wrapper"},M=["type"],E={key:0,class:"success"},V={key:1,class:"error"};function I(e,t,s,l,n,r){return(0,i.uX)(),(0,i.CE)("div",D,[(0,i.Lk)("div",F,[t[17]||(t[17]=(0,i.Lk)("div",{class:"logo-container"},[(0,i.Lk)("img",{src:h,alt:"Logo",class:"logo"})],-1)),t[18]||(t[18]=(0,i.Lk)("h1",null,"Register",-1)),(0,i.Lk)("form",{onSubmit:t[7]||(t[7]=(0,a.D$)((...e)=>r.handleRegistration&&r.handleRegistration(...e),["prevent"])),class:"registration-form"},[(0,i.Lk)("div",{class:(0,m.C4)(["form-group",{"error-group":n.errors.first_name}])},[t[9]||(t[9]=(0,i.Lk)("label",{for:"first_name"},[(0,i.eW)("First Name"),(0,i.Lk)("span",{class:"mandatory"},"*")],-1)),(0,i.bo)((0,i.Lk)("input",{type:"text",id:"first_name","onUpdate:modelValue":t[0]||(t[0]=e=>n.first_name=e),placeholder:"Enter your first name"},null,512),[[a.Jo,n.first_name]])],2),(0,i.Lk)("div",{class:(0,m.C4)(["form-group",{"error-group":n.errors.last_name}])},[t[10]||(t[10]=(0,i.Lk)("label",{for:"last_name"},[(0,i.eW)("Last Name"),(0,i.Lk)("span",{class:"mandatory"},"*")],-1)),(0,i.bo)((0,i.Lk)("input",{type:"text",id:"last_name","onUpdate:modelValue":t[1]||(t[1]=e=>n.last_name=e),placeholder:"Enter your last name"},null,512),[[a.Jo,n.last_name]])],2),(0,i.Lk)("div",{class:(0,m.C4)(["form-group",{"error-group":n.errors.email}])},[t[11]||(t[11]=(0,i.Lk)("label",{for:"email"},[(0,i.eW)("Email"),(0,i.Lk)("span",{class:"mandatory"},"*")],-1)),(0,i.bo)((0,i.Lk)("input",{type:"email",id:"email","onUpdate:modelValue":t[2]||(t[2]=e=>n.email=e),placeholder:"Enter your email"},null,512),[[a.Jo,n.email]])],2),(0,i.Lk)("div",{class:(0,m.C4)(["form-group",{"error-group":n.errors.username}])},[t[12]||(t[12]=(0,i.Lk)("label",{for:"username"},[(0,i.eW)("Username"),(0,i.Lk)("span",{class:"mandatory"},"*")],-1)),(0,i.bo)((0,i.Lk)("input",{type:"text",id:"username","onUpdate:modelValue":t[3]||(t[3]=e=>n.username=e),placeholder:"Choose a username"},null,512),[[a.Jo,n.username]])],2),(0,i.Lk)("div",{class:(0,m.C4)(["form-group",{"error-group":n.errors.password}])},[t[13]||(t[13]=(0,i.Lk)("label",{for:"password"},[(0,i.eW)("Password"),(0,i.Lk)("span",{class:"mandatory"},"*")],-1)),(0,i.Lk)("div",A,[(0,i.bo)((0,i.Lk)("input",{type:n.showPassword?"text":"password",id:"password","onUpdate:modelValue":t[4]||(t[4]=e=>n.password=e),placeholder:"Create a password"},null,8,M),[[a.hp,n.password]]),(0,i.Lk)("button",{type:"button",class:"toggle-password",onClick:t[5]||(t[5]=(...e)=>r.togglePasswordVisibility&&r.togglePasswordVisibility(...e))},(0,m.v_)(n.showPassword?"Hide":"Show"),1)]),t[14]||(t[14]=(0,i.Lk)("p",{class:"password-hint"},"Password must be at least 8 characters, include a number, and a special character.",-1))],2),(0,i.Lk)("div",{class:(0,m.C4)(["form-group",{"error-group":n.errors.confirm_password}])},[t[15]||(t[15]=(0,i.Lk)("label",{for:"confirm_password"},[(0,i.eW)("Confirm Password"),(0,i.Lk)("span",{class:"mandatory"},"*")],-1)),(0,i.bo)((0,i.Lk)("input",{type:"password",id:"confirm_password","onUpdate:modelValue":t[6]||(t[6]=e=>n.confirm_password=e),placeholder:"Confirm your password"},null,512),[[a.Jo,n.confirm_password]])],2),t[16]||(t[16]=(0,i.Lk)("button",{type:"submit",class:"btn-register"},"Register",-1))],32),n.message?((0,i.uX)(),(0,i.CE)("p",E,(0,m.v_)(n.message),1)):(0,i.Q3)("",!0),n.error?((0,i.uX)(),(0,i.CE)("p",V,(0,m.v_)(n.error),1)):(0,i.Q3)("",!0),(0,i.Lk)("button",{class:"btn-login-link",onClick:t[8]||(t[8]=(...e)=>r.goToLogin&&r.goToLogin(...e))},"Already have an account? Login")])])}s(8111),s(3579);var _={name:"RegistrationComponent",data(){return{first_name:"",last_name:"",email:"",username:"",password:"",confirm_password:"",message:null,error:null,showPassword:!1,errors:{first_name:!1,last_name:!1,email:!1,username:!1,password:!1,confirm_password:!1}}},methods:{togglePasswordVisibility(){this.showPassword=!this.showPassword},validatePassword(e){const t=/^(?=.*[0-9])(?=.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{8,}$/;return t.test(e)},handleValidation(){return this.errors={first_name:!this.first_name.trim(),last_name:!this.last_name.trim(),email:!this.email.trim(),username:!this.username.trim(),password:!this.validatePassword(this.password),confirm_password:!this.confirm_password.trim()||this.password!==this.confirm_password},!Object.values(this.errors).some(e=>e)},async handleRegistration(){this.error=null,this.message=null;try{const e=await this.$store.dispatch("register",{first_name:this.first_name,last_name:this.last_name,email:this.email,username:this.username,password:this.password});e&&(this.message="Registration successful! Redirecting to login...",setTimeout(()=>{this.$router.push("/")},2e3))}catch(e){this.error=e.message||"An error occurred during registration."}},goToLogin(){this.$router.push("/")}}};const $=(0,o.A)(_,[["render",I],["__scopeId","data-v-9a81b372"]]);var X=$;const j={class:"dashboard-layout"},U={class:"dashboard-header"},T={class:"user-actions"},N={class:"user-identity"},R=["title"],P=["title"],B={key:1},O={key:1},q={key:0},K={key:0},W={key:0,class:"primary-actions-cards"},z={key:1,class:"button-container"},Q={key:1,class:"study-dashboard"},G={class:"back-header-row"},J={class:"back-button-container"},Y={class:"study-table"},H={class:"action-buttons"},Z=["onClick"],ee=["onClick"];function te(e,t,s,a,l,n){const r=(0,i.g2)("router-view");return(0,i.uX)(),(0,i.CE)("div",j,[(0,i.Lk)("header",U,[t[11]||(t[11]=(0,i.Lk)("div",{class:"logo-container"},[(0,i.Lk)("img",{src:h,alt:"Logo",class:"logo"})],-1)),(0,i.Lk)("div",T,[(0,i.Lk)("div",N,[(0,i.Lk)("div",{class:"user-name",title:n.userName},(0,m.v_)(n.userName),9,R),(0,i.Lk)("div",{class:"user-role",title:n.role||"—"},(0,m.v_)(n.role||"—"),9,P)]),(0,i.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>n.logout&&n.logout(...e)),class:"btn-minimal"},"Logout")])]),(0,i.Lk)("aside",{class:(0,m.C4)(["dashboard-sidebar",{collapsed:l.sidebarCollapsed}])},[(0,i.Lk)("button",{class:"hamburger-menu",onClick:t[1]||(t[1]=(...e)=>n.toggleSidebar&&n.toggleSidebar(...e))},[...t[12]||(t[12]=[(0,i.Lk)("span",null,null,-1),(0,i.Lk)("span",null,null,-1),(0,i.Lk)("span",null,null,-1)])]),(0,i.Lk)("nav",null,[(0,i.Lk)("ul",null,[n.isAdmin||n.isPI||n.isInvestigator?((0,i.uX)(),(0,i.CE)("li",{key:0,onClick:t[2]||(t[2]=e=>n.setActiveSection("study-management")),class:"nav-item"},[l.sidebarCollapsed?((0,i.uX)(),(0,i.CE)("i",{key:0,class:(0,m.C4)(l.icons.book)},null,2)):(0,i.Q3)("",!0),l.sidebarCollapsed?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("span",B,"Study Management"))])):(0,i.Q3)("",!0),(0,i.Lk)("li",{onClick:t[3]||(t[3]=()=>{n.setActiveSection(""),n.navigate("/dashboard/user-info")}),class:"nav-item"},[l.sidebarCollapsed?((0,i.uX)(),(0,i.CE)("i",{key:0,class:(0,m.C4)(l.icons.user)},null,2)):(0,i.Q3)("",!0),l.sidebarCollapsed?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("span",O,"User Management"))])])])],2),(0,i.Lk)("main",{class:(0,m.C4)(["dashboard-main",{expanded:l.sidebarCollapsed}])},["Dashboard"===e.$route.name&&"study-management"===l.activeSection?((0,i.uX)(),(0,i.CE)("div",q,[t[18]||(t[18]=(0,i.Lk)("div",{class:"study-management-header"},[(0,i.Lk)("h1",{class:"study-management-title"},"Study Management"),(0,i.Lk)("p",{class:"study-management-subtitle"}," Create a new study or open an existing one to manage and collect data. ")],-1)),l.showStudyOptions?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",K,["cards"===l.actionStyle?((0,i.uX)(),(0,i.CE)("div",W,[n.isAdmin||n.isPI?((0,i.uX)(),(0,i.CE)("button",{key:0,class:"action-card",onClick:t[4]||(t[4]=e=>n.navigate("/dashboard/create-study"))},[...t[13]||(t[13]=[(0,i.Lk)("span",{class:"action-card-title"},"Create Study",-1),(0,i.Lk)("span",{class:"action-card-desc"},"Start a new protocol and forms",-1)])])):(0,i.Q3)("",!0),n.isAdmin||n.isPI||n.isInvestigator?((0,i.uX)(),(0,i.CE)("button",{key:1,class:"action-card",onClick:t[5]||(t[5]=(...e)=>n.toggleStudyOptions&&n.toggleStudyOptions(...e))},[...t[14]||(t[14]=[(0,i.Lk)("span",{class:"action-card-title"},"Open Existing Study",-1),(0,i.Lk)("span",{class:"action-card-desc"},"Continue work on an existing study",-1)])])):(0,i.Q3)("",!0),n.isAdmin||n.isPI||n.isInvestigator?((0,i.uX)(),(0,i.CE)("button",{key:2,class:"action-card",onClick:t[6]||(t[6]=e=>n.navigate("/dashboard/import-study"))},[...t[15]||(t[15]=[(0,i.Lk)("span",{class:"action-card-title"},"Import Study",-1),(0,i.Lk)("span",{class:"action-card-desc"},"Ingest from CSV/Excel",-1)])])):(0,i.Q3)("",!0)])):((0,i.uX)(),(0,i.CE)("div",z,[n.isAdmin||n.isPI?((0,i.uX)(),(0,i.CE)("button",{key:0,onClick:t[7]||(t[7]=e=>n.navigate("/dashboard/create-study")),class:"btn-primary"}," Create Study ")):(0,i.Q3)("",!0),n.isAdmin||n.isPI||n.isInvestigator?((0,i.uX)(),(0,i.CE)("button",{key:1,onClick:t[8]||(t[8]=(...e)=>n.toggleStudyOptions&&n.toggleStudyOptions(...e)),class:"btn-primary"}," Open Existing Study ")):(0,i.Q3)("",!0),n.isAdmin||n.isPI||n.isInvestigator?((0,i.uX)(),(0,i.CE)("button",{key:2,onClick:t[9]||(t[9]=e=>n.navigate("/dashboard/import-study")),class:"btn-primary"}," Import Study ")):(0,i.Q3)("",!0)]))])),l.showStudyOptions?((0,i.uX)(),(0,i.CE)("div",Q,[(0,i.Lk)("div",G,[(0,i.Lk)("div",J,[(0,i.Lk)("button",{onClick:t[10]||(t[10]=(...e)=>n.toggleStudyOptions&&n.toggleStudyOptions(...e)),class:"btn-minimal"},"Back")]),t[16]||(t[16]=(0,i.Lk)("h2",{class:"existing-studies-title"},"Existing Studies",-1))]),(0,i.Lk)("table",Y,[t[17]||(t[17]=(0,i.Lk)("thead",null,[(0,i.Lk)("tr",null,[(0,i.Lk)("th",null,"Study Name"),(0,i.Lk)("th",null,"Description"),(0,i.Lk)("th",null,"Created At"),(0,i.Lk)("th",null,"Updated At"),(0,i.Lk)("th",null,"Actions")])],-1)),(0,i.Lk)("tbody",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(l.studies,e=>((0,i.uX)(),(0,i.CE)("tr",{key:e.id},[(0,i.Lk)("td",null,(0,m.v_)(e.study_name),1),(0,i.Lk)("td",null,(0,m.v_)(e.study_description),1),(0,i.Lk)("td",null,(0,m.v_)(n.formatDateTime(e.created_at)),1),(0,i.Lk)("td",null,(0,m.v_)(n.formatDateTime(e.updated_at)),1),(0,i.Lk)("td",null,[(0,i.Lk)("div",H,[n.isAdmin||n.isPI||n.isInvestigator?((0,i.uX)(),(0,i.CE)("button",{key:0,onClick:t=>n.addData(e),class:"btn-minimal btn-equal"}," Add Data ",8,Z)):(0,i.Q3)("",!0),n.isAdmin||n.isPI||n.isInvestigator?((0,i.uX)(),(0,i.CE)("button",{key:1,onClick:t=>n.viewStudy(e),class:"btn-minimal btn-equal"}," View Study ",8,ee)):(0,i.Q3)("",!0)])])]))),128))])])])):(0,i.Q3)("",!0)])):(0,i.Q3)("",!0),(0,i.bF)(r)],2)])}s(1701);var se=s(4335),ae=s(4678),ie={name:"DashboardComponent",data(){return{sidebarCollapsed:!1,activeSection:"study-management",showStudyOptions:!1,studies:[],icons:ae.A,actionStyle:"cards"}},watch:{"$route.query.openStudies"(e){"true"===e?(this.activeSection="study-management",this.showStudyOptions=!0,this.loadStudies()):(this.activeSection="study-management",this.showStudyOptions=!1)}},computed:{currentUser(){return this.$store.getters.getUser||{}},role(){return this.currentUser.profile?.role||""},userName(){const e=this.currentUser.profile||{},t=[e.first_name,e.last_name].filter(Boolean).join(" ").trim();return e.name||e.full_name||t||this.currentUser.username||this.currentUser.email||"User"},isAdmin(){return"Administrator"===this.role},isPI(){return"Principal Investigator"===this.role},isInvestigator(){return"Investigator"===this.role}},methods:{toggleSidebar(){this.sidebarCollapsed=!this.sidebarCollapsed},async setActiveSection(e){await this.$router.push({name:"Dashboard"}),this.activeSection=e,this.showStudyOptions=!1},toggleStudyOptions(){this.showStudyOptions=!this.showStudyOptions,this.showStudyOptions?(this.$router.push({name:"Dashboard",query:{openStudies:"true"}}),this.loadStudies()):this.$router.push({name:"Dashboard",query:{openStudies:"false"}})},async loadStudies(){const e=this.$store.state.token;if(!e)return alert("Please log in again."),this.$router.push("/login");try{const{data:t}=await se.A.get("/forms/studies",{headers:{Authorization:`Bearer ${e}`}});console.log("Fetched studies:",JSON.stringify(t,null,2)),this.studies=t}catch(t){console.error("Failed to load studies:",t),console.log("Error details:",t.response?.data||t.message),401===t.response?.status?(alert("Session expired."),this.$router.push("/login")):alert("Failed to load studies.")}},formatDateTime(e){return e?new Date(e).toLocaleString("en-GB",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):""},async editStudy(e){localStorage.removeItem("setStudyDetails"),localStorage.removeItem("scratchForms");const t=this.$store.state.token;if(t)try{const s=await se.A.get(`/forms/studies/${e.id}`,{headers:{Authorization:`Bearer ${t}`}});console.log("Fetched study details:",JSON.stringify(s.data,null,2));const a=s.data.content?.study_data,i=s.data.metadata||{};if(!a)return console.error("Study content is empty"),void alert("Study content is empty.");let l=Array.isArray(a.assignments)?a.assignments:[];if(!l.length&&a.selectedModels?.length){console.warn("Assignments missing in backend response, initializing empty assignments");const e=a.selectedModels.length,t=a.visits?.length||0,s=a.groups?.length||0;l=Array.from({length:e},()=>Array.from({length:t},()=>Array.from({length:s},()=>!1)))}console.log("Loaded assignments from backend:",JSON.stringify(l,null,2));const n={id:i.id,name:i.study_name,description:i.study_description,created_at:i.created_at,updated_at:i.updated_at,created_by:i.created_by};if(this.$store.commit("setStudyDetails",{study_metadata:n,study:{id:i.id,...a.study},groups:a.groups||[],visits:a.visits||[],subjectCount:a.subjectCount||0,assignmentMethod:a.assignmentMethod||"random",subjects:a.subjects||[],assignments:l,forms:a.selectedModels?[{sections:a.selectedModels.map(e=>({title:e.title,fields:e.fields,source:"template"}))}]:[]}),a.selectedModels){const e=[{sections:a.selectedModels.map(e=>({title:e.title,fields:e.fields,source:"template"}))}];localStorage.setItem("scratchForms",JSON.stringify(e))}this.activeSection="",this.$router.push({name:"CreateStudy",params:{id:e.id}})}catch(s){console.error("Failed to load study details:",s),console.log("Error details:",s.response?.data||s.message),alert("Failed to load study details.")}else alert("Please log in again.")},addData(e){this.$router.push({name:"StudyDetail",params:{id:e.id}})},viewStudy(e){this.$router.push({name:"StudyView",params:{id:e.id}})},navigate(e){this.activeSection="",this.$router.push(e)},logout(){this.$store.commit("setUser",null),this.$store.commit("setToken",null),this.$router.push("/login")}},mounted(){"/dashboard"===this.$route.path&&(this.activeSection="study-management",this.showStudyOptions=!1),"true"===this.$route.query.openStudies&&(this.activeSection="study-management",this.showStudyOptions=!0,this.loadStudies())}};const le=(0,o.A)(ie,[["render",te],["__scopeId","data-v-333e5541"]]);var ne=le;const re={class:"user-info-container"},oe={class:"tabs"},de=["onClick"],ue={class:"tab-content"},ce={key:0,class:"profile-section"},pe={class:"user-details"},me={key:1,class:"settings-section"},he={key:2,class:"password-section"},ye={class:"form-group"},ge={class:"password-wrapper"},fe=["type"],ve={class:"form-group"},ke=["type"],be={key:0,class:"message"},Le={key:1,class:"error"},we={key:3,class:"management-section"},Ce={class:"form-row"},Se={class:"form-row"},xe={class:"form-row"},De={class:"form-row"},Fe=["value"],Ae={key:0,class:"message"},Me={key:1,class:"error"},Ee={class:"user-table"},Ve=["value","onChange"],Ie=["value"],_e={key:0,class:"dialog-overlay"},$e={class:"dialog-box"},Xe={class:"dialog-actions"};function je(e,t,s,l,n,r){const o=(0,i.g2)("StudySettings");return(0,i.uX)(),(0,i.CE)("div",re,[(0,i.Lk)("div",oe,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.visibleTabs,e=>((0,i.uX)(),(0,i.CE)("button",{key:e.key,class:(0,m.C4)(["tab-button",{active:n.currentTab===e.key}]),onClick:t=>n.currentTab=e.key},(0,m.v_)(e.label),11,de))),128))]),(0,i.Lk)("div",ue,["profile"===n.currentTab?((0,i.uX)(),(0,i.CE)("section",ce,[t[18]||(t[18]=(0,i.Lk)("h2",null,"Profile",-1)),(0,i.Lk)("div",pe,[(0,i.Lk)("p",null,[t[14]||(t[14]=(0,i.Lk)("strong",null,"Username:",-1)),(0,i.eW)(" "+(0,m.v_)(n.user.username),1)]),(0,i.Lk)("p",null,[t[15]||(t[15]=(0,i.Lk)("strong",null,"First Name:",-1)),(0,i.eW)(" "+(0,m.v_)(n.user.profile.first_name),1)]),(0,i.Lk)("p",null,[t[16]||(t[16]=(0,i.Lk)("strong",null,"Last Name:",-1)),(0,i.eW)(" "+(0,m.v_)(n.user.profile.last_name),1)]),(0,i.Lk)("p",null,[t[17]||(t[17]=(0,i.Lk)("strong",null,"Email:",-1)),(0,i.eW)(" "+(0,m.v_)(n.user.email),1)])])])):"settings"===n.currentTab&&(r.isAdmin||r.isPI)?((0,i.uX)(),(0,i.CE)("section",me,[(0,i.bF)(o)])):"password"===n.currentTab?((0,i.uX)(),(0,i.CE)("section",he,[t[22]||(t[22]=(0,i.Lk)("h2",null,"Change Password",-1)),(0,i.Lk)("form",{onSubmit:t[3]||(t[3]=(0,a.D$)((...e)=>r.handleChangePassword&&r.handleChangePassword(...e),["prevent"])),class:"password-form"},[(0,i.Lk)("div",ye,[t[19]||(t[19]=(0,i.Lk)("label",{for:"new_password"},"New Password",-1)),(0,i.Lk)("div",ge,[(0,i.bo)((0,i.Lk)("input",{type:n.showPassword?"text":"password",id:"new_password","onUpdate:modelValue":t[0]||(t[0]=e=>n.newPassword=e),placeholder:"At least 8 chars, number & special",required:""},null,8,fe),[[a.hp,n.newPassword]]),(0,i.Lk)("button",{type:"button",class:"toggle-password",onClick:t[1]||(t[1]=(...e)=>r.togglePasswordVisibility&&r.togglePasswordVisibility(...e))},(0,m.v_)(n.showPassword?"Hide":"Show"),1)])]),(0,i.Lk)("div",ve,[t[20]||(t[20]=(0,i.Lk)("label",{for:"confirm_password"},"Confirm Password",-1)),(0,i.bo)((0,i.Lk)("input",{type:n.showPassword?"text":"password",id:"confirm_password","onUpdate:modelValue":t[2]||(t[2]=e=>n.confirmPassword=e),placeholder:"Retype new password",required:""},null,8,ke),[[a.hp,n.confirmPassword]])]),t[21]||(t[21]=(0,i.Lk)("button",{type:"submit",class:"btn-change-password"}," Update Password ",-1))],32),n.passwordMessage?((0,i.uX)(),(0,i.CE)("p",be,(0,m.v_)(n.passwordMessage),1)):(0,i.Q3)("",!0),n.passwordError?((0,i.uX)(),(0,i.CE)("p",Le,(0,m.v_)(n.passwordError),1)):(0,i.Q3)("",!0)])):"management"===n.currentTab&&r.isAdmin?((0,i.uX)(),(0,i.CE)("section",we,[t[26]||(t[26]=(0,i.Lk)("h2",null,"Manage Users",-1)),(0,i.Lk)("form",{onSubmit:t[11]||(t[11]=(0,a.D$)((...e)=>r.handleCreateUser&&r.handleCreateUser(...e),["prevent"])),class:"create-user-form"},[t[23]||(t[23]=(0,i.Lk)("h3",null,"Create New User",-1)),(0,i.Lk)("div",Ce,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>n.newUser.username=e),placeholder:"Username",required:""},null,512),[[a.Jo,n.newUser.username]]),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>n.newUser.email=e),placeholder:"Email",type:"email",required:""},null,512),[[a.Jo,n.newUser.email]])]),(0,i.Lk)("div",Se,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>n.newUser.first_name=e),placeholder:"First Name",required:""},null,512),[[a.Jo,n.newUser.first_name]]),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>n.newUser.last_name=e),placeholder:"Last Name",required:""},null,512),[[a.Jo,n.newUser.last_name]])]),(0,i.Lk)("div",xe,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>n.newUser.password=e),placeholder:"Password",type:"password",required:""},null,512),[[a.Jo,n.newUser.password]]),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>n.newUser.confirmPassword=e),placeholder:"Confirm Password",type:"password",required:""},null,512),[[a.Jo,n.newUser.confirmPassword]])]),(0,i.Lk)("div",De,[(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[10]||(t[10]=e=>n.newUser.role=e)},[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.roles,e=>((0,i.uX)(),(0,i.CE)("option",{key:e,value:e},(0,m.v_)(e),9,Fe))),128))],512),[[a.u1,n.newUser.role]])]),t[24]||(t[24]=(0,i.Lk)("button",{type:"submit",class:"btn-option"},"Create User",-1)),n.userMgmtMessage?((0,i.uX)(),(0,i.CE)("p",Ae,(0,m.v_)(n.userMgmtMessage),1)):(0,i.Q3)("",!0),n.userMgmtError?((0,i.uX)(),(0,i.CE)("p",Me,(0,m.v_)(n.userMgmtError),1)):(0,i.Q3)("",!0)],32),t[27]||(t[27]=(0,i.Lk)("h3",null,"Existing Users",-1)),(0,i.Lk)("table",Ee,[t[25]||(t[25]=(0,i.Lk)("thead",null,[(0,i.Lk)("tr",null,[(0,i.Lk)("th",null,"Username"),(0,i.Lk)("th",null,"Email"),(0,i.Lk)("th",null,"Name"),(0,i.Lk)("th",null,"Role")])],-1)),(0,i.Lk)("tbody",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.users,e=>((0,i.uX)(),(0,i.CE)("tr",{key:e.id},[(0,i.Lk)("td",null,(0,m.v_)(e.username),1),(0,i.Lk)("td",null,(0,m.v_)(e.email),1),(0,i.Lk)("td",null,(0,m.v_)(e.profile.first_name)+" "+(0,m.v_)(e.profile.last_name),1),(0,i.Lk)("td",null,[(0,i.Lk)("select",{value:e.profile.role,onChange:t=>r.onInitiateRoleChange(e,t.target.value)},[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.roles,e=>((0,i.uX)(),(0,i.CE)("option",{key:e,value:e},(0,m.v_)(e),9,Ie))),128))],40,Ve)])]))),128))])])])):(0,i.Q3)("",!0)]),n.showRoleDialog?((0,i.uX)(),(0,i.CE)("div",_e,[(0,i.Lk)("div",$e,[(0,i.Lk)("p",null,[t[28]||(t[28]=(0,i.eW)(" Change ",-1)),(0,i.Lk)("strong",null,(0,m.v_)(n.pendingUser.username),1),t[29]||(t[29]=(0,i.eW)("'s role to ",-1)),(0,i.Lk)("strong",null,(0,m.v_)(n.pendingRole),1),t[30]||(t[30]=(0,i.eW)("? ",-1))]),(0,i.Lk)("div",Xe,[(0,i.Lk)("button",{onClick:t[12]||(t[12]=(...e)=>r.confirmRoleChange&&r.confirmRoleChange(...e)),class:"btn-confirm"},"Yes"),(0,i.Lk)("button",{onClick:t[13]||(t[13]=(...e)=>r.cancelRoleChange&&r.cancelRoleChange(...e)),class:"btn-cancel"},"No")])])])):(0,i.Q3)("",!0)])}const Ue={class:"settings-container"},Te={class:"setting-section"},Ne={class:"form-group"},Re={class:"form-group"},Pe={class:"form-group"},Be={class:"form-group"},Oe={class:"form-group"},qe={class:"setting-section"},Ke={class:"form-group"},We={class:"setting-section"},ze={class:"form-group"},Qe=["value"],Ge={class:"form-group"},Je={class:"setting-section"},Ye={class:"form-group"},He={class:"setting-section"},Ze={class:"form-group"},et={class:"form-group"},tt={class:"form-actions"},st={key:0,class:"message"},at={key:1,class:"error"};function it(e,t,s,l,n,r){return(0,i.uX)(),(0,i.CE)("div",Ue,[t[44]||(t[44]=(0,i.Lk)("h1",null,"Study Settings",-1)),(0,i.Lk)("form",{onSubmit:t[15]||(t[15]=(0,a.D$)((...e)=>r.saveSettings&&r.saveSettings(...e),["prevent"]))},[(0,i.Lk)("section",Te,[t[26]||(t[26]=(0,i.Lk)("h2",null,"Measurement Preferences",-1)),(0,i.Lk)("div",Ne,[t[17]||(t[17]=(0,i.Lk)("label",{for:"weightFormat"},"Weight Format",-1)),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.settings.weightFormat=e),id:"weightFormat"},[...t[16]||(t[16]=[(0,i.Lk)("option",{value:"kg"},"Kilograms (kg)",-1),(0,i.Lk)("option",{value:"lbs"},"Pounds (lbs)",-1),(0,i.Lk)("option",{value:"oz"},"Ounce (oz)",-1)])],512),[[a.u1,n.settings.weightFormat]])]),(0,i.Lk)("div",Re,[t[19]||(t[19]=(0,i.Lk)("label",{for:"heightFormat"},"Height Format",-1)),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.settings.heightFormat=e),id:"heightFormat"},[...t[18]||(t[18]=[(0,i.Lk)("option",{value:"cm"},"Centimeters (cm)",-1),(0,i.Lk)("option",{value:"m"},"Meters (m)",-1),(0,i.Lk)("option",{value:"in"},"Inches (in)",-1)])],512),[[a.u1,n.settings.heightFormat]])]),(0,i.Lk)("div",Pe,[t[21]||(t[21]=(0,i.Lk)("label",{for:"temperatureFormat"},"Temperature Format",-1)),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>n.settings.temperatureFormat=e),id:"temperatureFormat"},[...t[20]||(t[20]=[(0,i.Lk)("option",{value:"celsius"},"Celsius (°C)",-1),(0,i.Lk)("option",{value:"fahrenheit"},"Fahrenheit (°F)",-1),(0,i.Lk)("option",{value:"kelvin"},"Kelvin (K)",-1)])],512),[[a.u1,n.settings.temperatureFormat]])]),(0,i.Lk)("div",Be,[t[23]||(t[23]=(0,i.Lk)("label",{for:"distanceUnit"},"Distance Unit",-1)),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>n.settings.distanceUnit=e),id:"distanceUnit"},[...t[22]||(t[22]=[(0,i.Lk)("option",{value:"km"},"Kilometers (km)",-1),(0,i.Lk)("option",{value:"miles"},"Miles",-1)])],512),[[a.u1,n.settings.distanceUnit]])]),(0,i.Lk)("div",Oe,[t[25]||(t[25]=(0,i.Lk)("label",{for:"liquidUnit"},"Liquid Unit",-1)),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>n.settings.liquidUnit=e),id:"liquidUnit"},[...t[24]||(t[24]=[(0,i.Lk)("option",{value:"litres"},"Litres (L)",-1),(0,i.Lk)("option",{value:"gallons"},"Gallons",-1)])],512),[[a.u1,n.settings.liquidUnit]])])]),(0,i.Lk)("section",qe,[t[29]||(t[29]=(0,i.Lk)("h2",null,"Date Formatting",-1)),(0,i.Lk)("div",Ke,[t[28]||(t[28]=(0,i.Lk)("label",{for:"dateFormat"},"Date Format",-1)),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>n.settings.dateFormat=e),id:"dateFormat"},[...t[27]||(t[27]=[(0,i.Fv)('<option value="DD/MM/YYYY" data-v-bc1fd5f2>DD/MM/YYYY</option><option value="MM/DD/YYYY" data-v-bc1fd5f2>MM/DD/YYYY</option><option value="YYYY-MM-DD" data-v-bc1fd5f2>YYYY-MM-DD</option><option value="DD-MM-YYYY" data-v-bc1fd5f2>DD-MM-YYYY</option><option value="MM-DD-YYYY" data-v-bc1fd5f2>MM-DD-YYYY</option><option value="YYYY/MM/DD" data-v-bc1fd5f2>YYYY/MM/DD</option><option value="DD.MM.YYYY" data-v-bc1fd5f2>DD.MM.YYYY</option>',7)])],512),[[a.u1,n.settings.dateFormat]])])]),(0,i.Lk)("section",We,[t[33]||(t[33]=(0,i.Lk)("h2",null,"Locale & Time",-1)),(0,i.Lk)("div",ze,[t[30]||(t[30]=(0,i.Lk)("label",{for:"timezone"},"Timezone",-1)),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>n.settings.timezone=e),id:"timezone"},[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.timezones,e=>((0,i.uX)(),(0,i.CE)("option",{key:e,value:e},(0,m.v_)(e),9,Qe))),128))],512),[[a.u1,n.settings.timezone]])]),(0,i.Lk)("div",Ge,[t[32]||(t[32]=(0,i.Lk)("label",{for:"locale"},"Language / Locale",-1)),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>n.settings.locale=e),id:"locale"},[...t[31]||(t[31]=[(0,i.Lk)("option",{value:"en-US"},"English",-1),(0,i.Lk)("option",{value:"de-DE"},"German",-1)])],512),[[a.u1,n.settings.locale]])])]),(0,i.Lk)("section",Je,[t[35]||(t[35]=(0,i.Lk)("h2",null,"Study Defaults & Behavior",-1)),(0,i.Lk)("div",Ye,[t[34]||(t[34]=(0,i.Lk)("label",{for:"autoSaveInterval"},"Auto-Save Interval (minutes)",-1)),(0,i.bo)((0,i.Lk)("input",{type:"number",id:"autoSaveInterval","onUpdate:modelValue":t[8]||(t[8]=e=>n.settings.autoSaveInterval=e),min:"1"},null,512),[[a.Jo,n.settings.autoSaveInterval,void 0,{number:!0}]])])]),(0,i.Lk)("section",He,[t[42]||(t[42]=(0,i.Lk)("h2",null,"Notification & UI Preferences",-1)),(0,i.Lk)("div",Ze,[t[39]||(t[39]=(0,i.Lk)("label",null,"Notifications",-1)),(0,i.Lk)("div",null,[(0,i.Lk)("label",null,[(0,i.bo)((0,i.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=e=>n.settings.notifications.email=e)},null,512),[[a.lH,n.settings.notifications.email]]),t[36]||(t[36]=(0,i.eW)(" Email Notifications ",-1))])]),(0,i.Lk)("div",null,[(0,i.Lk)("label",null,[(0,i.bo)((0,i.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[10]||(t[10]=e=>n.settings.notifications.sms=e)},null,512),[[a.lH,n.settings.notifications.sms]]),t[37]||(t[37]=(0,i.eW)(" SMS Notifications ",-1))])]),(0,i.Lk)("div",null,[(0,i.Lk)("label",null,[(0,i.bo)((0,i.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[11]||(t[11]=e=>n.settings.notifications.push=e)},null,512),[[a.lH,n.settings.notifications.push]]),t[38]||(t[38]=(0,i.eW)(" Push Notifications ",-1))])])]),(0,i.Lk)("div",et,[t[41]||(t[41]=(0,i.Lk)("label",{for:"uiTheme"},"UI Theme",-1)),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[12]||(t[12]=e=>n.settings.uiTheme=e),id:"uiTheme"},[...t[40]||(t[40]=[(0,i.Lk)("option",{value:"light"},"Light",-1),(0,i.Lk)("option",{value:"dark"},"Dark",-1)])],512),[[a.u1,n.settings.uiTheme]])])]),(0,i.Lk)("div",tt,[t[43]||(t[43]=(0,i.Lk)("button",{type:"submit",class:"btn-save-settings"},"Save Settings",-1)),(0,i.Lk)("button",{type:"button",class:"btn-restore",onClick:t[13]||(t[13]=(...e)=>r.restoreDefaults&&r.restoreDefaults(...e))},"Restore Defaults"),(0,i.Lk)("button",{type:"button",class:"btn-cancel",onClick:t[14]||(t[14]=(...e)=>r.cancelSettings&&r.cancelSettings(...e))},"Cancel")])],32),n.saveMessage?((0,i.uX)(),(0,i.CE)("p",st,(0,m.v_)(n.saveMessage),1)):(0,i.Q3)("",!0),n.saveError?((0,i.uX)(),(0,i.CE)("p",at,(0,m.v_)(n.saveError),1)):(0,i.Q3)("",!0)])}var lt={name:"StudySettings",data(){const e={weightFormat:"kg",heightFormat:"cm",temperatureFormat:"celsius",distanceUnit:"km",liquidUnit:"litres",dateFormat:"YYYY-MM-DD",timezone:"UTC",locale:"en-US",autoSaveInterval:5,notifications:{email:!1,sms:!1,push:!1},uiTheme:"light"};return{settings:{...e},defaultSettings:e,timezones:[],saveMessage:null,saveError:null}},computed:{userId(){return this.$store.state.user.id}},created(){this.fetchTimezones(),this.userId?this.fetchUserSettings():this.$watch(()=>this.userId,e=>{e&&this.fetchUserSettings()})},methods:{async fetchTimezones(){try{const e=await fetch("/api/timezones"),t=await e.json();this.timezones=t}catch(e){console.error("Failed to fetch timezones, using default UTC",e),this.timezones=["UTC"]}},async fetchUserSettings(){try{const e=await fetch(`/api/settings/${this.userId}`);if(e.ok){const t=await e.json();this.settings=t}else 404===e.status?console.log("No settings found, loading defaults."):console.error("Error fetching settings:",e.statusText)}catch(e){console.error("Error fetching user settings:",e)}},async saveSettings(){this.saveMessage=null,this.saveError=null;try{const e=await fetch(`/api/settings/${this.userId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.settings)});e.ok?this.saveMessage="Settings saved successfully.":this.saveError="Failed to save settings. Please try again."}catch(e){console.error(e),this.saveError="Failed to save settings. Please try again."}},restoreDefaults(){this.settings={...this.defaultSettings}},cancelSettings(){this.$router.push("/profile")}}};const nt=(0,o.A)(lt,[["render",it],["__scopeId","data-v-bc1fd5f2"]]);var rt=nt,ot={name:"UserInfoComponent",components:{StudySettings:rt},data(){return{currentTab:"profile",user:null,newPassword:"",confirmPassword:"",showPassword:!1,passwordMessage:null,passwordError:null,roles:["Administrator","Investigator","Principal Investigator","No Access"],newUser:{username:"",email:"",first_name:"",last_name:"",password:"",confirmPassword:"",role:"Investigator"},users:[],userMgmtError:null,userMgmtMessage:null,showRoleDialog:!1,pendingUser:null,pendingRole:null}},computed:{userFromStore(){return this.$store.getters.getUser},isAdmin(){return"Administrator"===this.user?.profile?.role},isPI(){return"Principal Investigator"===this.user?.profile?.role},visibleTabs(){const e=[{key:"profile",label:"Profile"},...this.isAdmin||this.isPI?[{key:"settings",label:"Study Settings"}]:[],{key:"password",label:"Change Password"}];return this.isAdmin&&e.push({key:"management",label:"User Management"}),e}},async created(){this.user=this.userFromStore,this.user||(await this.$store.dispatch("fetchUserData"),this.user=this.$store.getters.getUser),this.isAdmin&&this.fetchUsers()},methods:{togglePasswordVisibility(){this.showPassword=!this.showPassword},validatePassword(e){return/^(?=.*[0-9])(?=.*[!@#$%^&*]).{8,}$/.test(e)},async handleChangePassword(){if(this.passwordMessage=this.passwordError=null,this.newPassword===this.confirmPassword)if(this.validatePassword(this.newPassword))try{const e=await this.$store.dispatch("changePassword",{newPassword:this.newPassword});e?(this.passwordMessage="Password updated.",this.newPassword=this.confirmPassword=""):this.passwordError="Update failed."}catch{this.passwordError="Error updating password."}else this.passwordError="Must be ≥8 chars, include number & special.";else this.passwordError="Passwords do not match."},async fetchUsers(){this.userMgmtError=null;try{const e=await se.A.get("/users/admin/users",{headers:{Authorization:`Bearer ${this.$store.state.token}`}});this.users=e.data}catch(e){this.userMgmtError=e.response?.data?.detail||e.message}},async handleCreateUser(){this.userMgmtError=this.userMgmtMessage=null;const e=this.newUser;if(e.username&&e.email&&e.first_name&&e.last_name&&e.password&&e.confirmPassword)if(e.password===e.confirmPassword)try{await se.A.post("/users/admin/users",{username:e.username,email:e.email,first_name:e.first_name,last_name:e.last_name,password:e.password,role:e.role},{headers:{Authorization:`Bearer ${this.$store.state.token}`}}),this.userMgmtMessage="User created successfully.",this.newUser={username:"",email:"",first_name:"",last_name:"",password:"",confirmPassword:"",role:"Investigator"},this.fetchUsers()}catch(t){this.userMgmtError=t.response?.data?.detail||t.message}else this.userMgmtError="Passwords do not match.";else this.userMgmtError="All fields are required."},onInitiateRoleChange(e,t){this.pendingUser=e,this.pendingRole=t,this.showRoleDialog=!0},async confirmRoleChange(){try{await se.A.patch(`/users/admin/users/${this.pendingUser.id}/role`,{role:this.pendingRole},{headers:{Authorization:`Bearer ${this.$store.state.token}`}}),this.pendingUser.profile.role=this.pendingRole}catch(e){alert("Failed to update role: "+(e.response?.data?.detail||e.message))}finally{this.showRoleDialog=!1,this.pendingUser=this.pendingRole=null}},cancelRoleChange(){this.showRoleDialog=!1,this.pendingUser=this.pendingRole=null}}};const dt=(0,o.A)(ot,[["render",je],["__scopeId","data-v-04a332e7"]]);var ut=dt;function ct(e,t,s,a,l,n){return(0,i.uX)(),(0,i.CE)("div",null,[...t[0]||(t[0]=[(0,i.Lk)("h1",null,"Analytics",-1),(0,i.Lk)("p",null,"Show analytics and reports here.",-1)])])}var pt={name:"AnalyticsComponent"};const mt=(0,o.A)(pt,[["render",ct]]);var ht=mt;const yt={class:"create-form-container"},gt={class:"header-container"},ft={class:"scratch-form-content"},vt={key:0,class:"available-fields"},kt={class:"tabs"},bt={key:0,class:"template-fields"},Lt=["onClick"],wt={class:"template-header"},Ct={class:"template-description"},St={key:1,class:"custom-fields"},xt=["onClick"],Dt={class:"field-info"},Ft={class:"field-label"},At={key:2},Mt={class:"form-area"},Et={class:"sections-container"},Vt={key:0},It=["onClick"],_t={class:"section-header"},$t={class:"field-actions"},Xt=["onClick"],jt=["onClick"],Ut=["onClick"],Tt=["title","onClick"],Nt={key:0,class:"section-content"},Rt={class:"field-header"},Pt=["for"],Bt=["for"],Ot={class:"field-actions"},qt=["onClick"],Kt=["onClick"],Wt=["onClick"],zt=["onClick"],Qt={class:"field-box"},Gt=["onUpdate:modelValue","placeholder"],Jt=["onUpdate:modelValue","rows","placeholder"],Yt=["onUpdate:modelValue","min","max","step","onInput","onBlur"],Ht=["onUpdate:modelValue"],Zt={key:10,class:"form-button"},es=["onUpdate:modelValue","placeholder"],ts={key:12,class:"help-text"},ss={key:1},as={key:0,class:"form-actions"},is={key:0,class:"modal-overlay"},ls={class:"modal model-dialog"},ns={class:"model-prop-list"},rs={class:"prop-info"},os={key:0,class:"prop-desc"},ds={class:"prop-check"},us=["id","onUpdate:modelValue"],cs={class:"modal-actions"},ps={key:1,class:"modal-overlay"},ms={key:2,class:"modal-overlay"},hs={class:"modal preview-modal"},ys={class:"modal-actions"},gs={key:3,class:"modal-overlay"},fs={class:"modal"},vs={class:"modal-actions"},ks={key:4,class:"modal-overlay"},bs={class:"modal input-dialog-modal"},Ls={class:"modal-actions"},ws={key:5,class:"modal-overlay"},Cs={class:"modal"},Ss={class:"modal-actions"},xs={key:6,class:"modal-overlay"},Ds={class:"modal"};function Fs(e,t,s,l,n,r){const o=(0,i.g2)("ShaclComponents"),d=(0,i.g2)("FieldCheckbox"),u=(0,i.g2)("DateFormatPicker"),c=(0,i.g2)("FieldTime"),p=(0,i.g2)("FieldRadioGroup"),h=(0,i.g2)("FieldSlider"),y=(0,i.g2)("FieldLinearScale"),g=(0,i.g2)("FieldFileUpload"),f=(0,i.g2)("ProtocolMatrix"),v=(0,i.g2)("FieldConstraintsDialog"),k=(0,i.g2)("FormPreview");return(0,i.uX)(),(0,i.CE)("div",yt,[(0,i.Lk)("div",gt,[(0,i.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>r.goBack&&r.goBack(...e)),class:"btn-back",title:"Go Back"},[(0,i.Lk)("i",{class:(0,m.C4)(r.icons.back)},null,2),t[21]||(t[21]=(0,i.eW)(" Back ",-1))])]),(0,i.Lk)("div",ft,[n.showMatrix?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",vt,[t[23]||(t[23]=(0,i.Lk)("h2",null,"Available Fields",-1)),(0,i.Lk)("div",kt,[(0,i.Lk)("button",{class:(0,m.C4)({active:"template"===n.activeTab}),onClick:t[1]||(t[1]=e=>n.activeTab="template")},"Available Template",2),(0,i.Lk)("button",{class:(0,m.C4)({active:"custom"===n.activeTab}),onClick:t[2]||(t[2]=e=>n.activeTab="custom")},"Custom Fields",2),(0,i.Lk)("button",{class:(0,m.C4)({active:"shacl"===n.activeTab}),onClick:t[3]||(t[3]=e=>n.activeTab="shacl")},"SHACL Components",2)]),"template"===n.activeTab?((0,i.uX)(),(0,i.CE)("div",bt,[t[22]||(t[22]=(0,i.Lk)("p",{class:"template-instruction"}," Click a model to pick properties ",-1)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.dataModels,e=>((0,i.uX)(),(0,i.CE)("div",{key:e.title,class:"template-button",onClick:t=>r.openModelDialog(e)},[(0,i.Lk)("div",wt,[(0,i.Lk)("i",{class:(0,m.C4)(r.modelIcon(e.title))},null,2),(0,i.eW)(" "+(0,m.v_)(r.prettyModelTitle(e.title)),1)]),(0,i.Lk)("div",Ct,(0,m.v_)(e.description||"No description available."),1)],8,Lt))),128))])):(0,i.Q3)("",!0),"custom"===n.activeTab?((0,i.uX)(),(0,i.CE)("div",St,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.generalFields,e=>((0,i.uX)(),(0,i.CE)("div",{key:e.name||e.label,class:"available-field-button",onClick:t=>r.addFieldToActiveSection(e)},[(0,i.Lk)("i",{class:(0,m.C4)(e.icon||r.fieldIcon(e.label))},null,2),(0,i.Lk)("div",Dt,[(0,i.Lk)("span",Ft,(0,m.v_)(e.label),1)])],8,xt))),128))])):(0,i.Q3)("",!0),"shacl"===n.activeTab?((0,i.uX)(),(0,i.CE)("div",At,[(0,i.bF)(o,{shaclComponents:n.shaclComponents},null,8,["shaclComponents"])])):(0,i.Q3)("",!0)])),(0,i.Lk)("div",Mt,[(0,i.Lk)("div",Et,[n.showMatrix?((0,i.uX)(),(0,i.CE)("div",ss,[(0,i.bF)(f,{visits:n.visits,groups:n.groups,selectedModels:r.selectedModels,assignments:n.assignments,onAssignmentUpdated:r.onAssignmentUpdated,onEditTemplate:r.editTemplate},null,8,["visits","groups","selectedModels","assignments","onAssignmentUpdated","onEditTemplate"])])):((0,i.uX)(),(0,i.CE)("div",Vt,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.currentForm.sections,(e,s)=>((0,i.uX)(),(0,i.CE)("div",{key:s,class:(0,m.C4)(["form-section",{active:n.activeSection===s}]),onClick:e=>r.onSectionClick(s),ref_for:!0,ref:"section-"+s},[(0,i.Lk)("div",_t,[(0,i.Lk)("h3",null,(0,m.v_)(e.title),1),(0,i.Lk)("div",$t,[(0,i.Lk)("button",{class:"icon-button",title:"Edit Section Title",onClick:(0,a.D$)(t=>{r.setActiveSection(s),r.openInputDialog("Enter new section title:",e.title,e=>r.editSection(s,e))},["stop","prevent"])},[(0,i.Lk)("i",{class:(0,m.C4)(r.icons.edit)},null,2)],8,Xt),(0,i.Lk)("button",{class:"icon-button",title:"Add Section Below",onClick:(0,a.D$)(e=>{r.setActiveSection(s),r.addNewSectionBelow(s)},["stop","prevent"])},[(0,i.Lk)("i",{class:(0,m.C4)(r.icons.add)},null,2)],8,jt),(0,i.Lk)("button",{class:"icon-button",title:"Delete Section",onClick:(0,a.D$)(e=>{r.setActiveSection(s),r.confirmDeleteSection(s)},["stop","prevent"])},[(0,i.Lk)("i",{class:(0,m.C4)(r.icons.delete)},null,2)],8,Ut),(0,i.Lk)("button",{class:"icon-button",title:e.collapsed?"Expand":"Collapse",onClick:(0,a.D$)(e=>{r.setActiveSection(s),r.toggleSection(s)},["stop","prevent"])},[(0,i.Lk)("i",{class:(0,m.C4)(e.collapsed?r.icons.toggleDown:r.icons.toggleUp)},null,2)],8,Tt)])]),e.collapsed?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",Nt,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.fields,(e,l)=>((0,i.uX)(),(0,i.CE)("div",{key:l,class:"form-group"},[(0,i.Lk)("div",Rt,["button"!==e.type&&"checkbox"!==e.type?((0,i.uX)(),(0,i.CE)("label",{key:0,for:e.name},(0,m.v_)(e.label),9,Pt)):"checkbox"===e.type?((0,i.uX)(),(0,i.CE)("label",{key:1,class:"checkbox-label",for:e.name},[(0,i.eW)((0,m.v_)(e.label)+" ",1),(0,i.bF)(d,{id:e.name,modelValue:e.value,"onUpdate:modelValue":t=>e.value=t},null,8,["id","modelValue","onUpdate:modelValue"])],8,Bt)):(0,i.Q3)("",!0),(0,i.Lk)("div",Ot,[(0,i.Lk)("button",{class:"icon-button",title:"Edit Field Label",onClick:(0,a.D$)(t=>{r.setActiveSection(s),r.openInputDialog("Enter new field label:",e.label,e=>r.editField(s,l,e))},["stop","prevent"])},[(0,i.Lk)("i",{class:(0,m.C4)(r.icons.edit)},null,2)],8,qt),(0,i.Lk)("button",{class:"icon-button",title:"Add Similar Field",onClick:(0,a.D$)(e=>{r.setActiveSection(s),r.addSimilarField(s,l)},["stop","prevent"])},[(0,i.Lk)("i",{class:(0,m.C4)(r.icons.add)},null,2)],8,Kt),(0,i.Lk)("button",{class:"icon-button",title:"Delete Field",onClick:(0,a.D$)(e=>{r.setActiveSection(s,l),r.removeField(s,l)},["stop","prevent"])},[(0,i.Lk)("i",{class:(0,m.C4)(r.icons.delete)},null,2)],8,Wt),(0,i.Lk)("button",{class:"icon-button",title:"Settings",onClick:(0,a.D$)(e=>{r.setActiveSection(s),r.openConstraintsDialog(s,l)},["stop","prevent"])},[(0,i.Lk)("i",{class:(0,m.C4)(r.icons.cog)},null,2)],8,zt)])]),(0,i.Lk)("div",Qt,["text"===e.type?(0,i.bo)(((0,i.uX)(),(0,i.CE)("input",{key:0,type:"text","onUpdate:modelValue":t=>e.value=t,placeholder:e.constraints?.placeholder||e.placeholder},null,8,Gt)),[[a.Jo,e.value]]):"textarea"===e.type?(0,i.bo)(((0,i.uX)(),(0,i.CE)("textarea",{key:1,"onUpdate:modelValue":t=>e.value=t,rows:e.rows||4,placeholder:e.constraints?.placeholder||e.placeholder},null,8,Jt)),[[a.Jo,e.value]]):"number"===e.type?(0,i.bo)(((0,i.uX)(),(0,i.CE)("input",{key:2,type:"number","onUpdate:modelValue":t=>e.value=t,min:e.constraints?.min,max:e.constraints?.max,step:e.constraints?.step,onInput:e=>r.enforceNumberDigitLimits(s,l,e),onBlur:e=>r.enforceNumberDigitLimits(s,l,e,!0)},null,40,Yt)),[[a.Jo,e.value,void 0,{number:!0}]]):"date"===e.type?((0,i.uX)(),(0,i.Wv)(u,{key:3,modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,format:e.constraints?.dateFormat||"dd.MM.yyyy",placeholder:e.placeholder||e.constraints?.dateFormat||"dd.MM.yyyy","min-date":e.constraints?.minDate||null,"max-date":e.constraints?.maxDate||null},null,8,["modelValue","onUpdate:modelValue","format","placeholder","min-date","max-date"])):"time"===e.type?((0,i.uX)(),(0,i.Wv)(c,(0,i.v6)({key:4,modelValue:e.value,"onUpdate:modelValue":t=>e.value=t},{ref_for:!0},e.constraints,{hourCycle:e.constraints?.hourCycle||"24",placeholder:e.placeholder||("12"===e.constraints?.hourCycle?"hh:mm a":"HH:mm")}),null,16,["modelValue","onUpdate:modelValue","hourCycle","placeholder"])):"select"===e.type?(0,i.bo)(((0,i.uX)(),(0,i.CE)("select",{key:5,"onUpdate:modelValue":t=>e.value=t},[t[24]||(t[24]=(0,i.Lk)("option",{value:"",disabled:""},"Select…",-1)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.options,e=>((0,i.uX)(),(0,i.CE)("option",{key:e},(0,m.v_)(e),1))),128))],8,Ht)),[[a.u1,e.value]]):"radio"===e.type?((0,i.uX)(),(0,i.Wv)(p,{key:6,name:e.name,options:e.options,modelValue:e.value,"onUpdate:modelValue":t=>e.value=t},null,8,["name","options","modelValue","onUpdate:modelValue"])):"slider"===e.type&&"slider"===(e.constraints?.mode||"slider")?((0,i.uX)(),(0,i.Wv)(h,{key:7,modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,min:e.constraints?.min??1,max:e.constraints?.max??5,step:e.constraints?.step??1,readonly:!!e.constraints?.readonly,percent:!!e.constraints?.percent,marks:e.constraints?.marks||[]},null,8,["modelValue","onUpdate:modelValue","min","max","step","readonly","percent","marks"])):"slider"===e.type&&"linear"===e.constraints?.mode?((0,i.uX)(),(0,i.Wv)(y,{key:8,modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,min:e.constraints?.min??1,max:e.constraints?.max??5,"left-label":e.constraints?.leftLabel||"","right-label":e.constraints?.rightLabel||"",readonly:!!e.constraints?.readonly},null,8,["modelValue","onUpdate:modelValue","min","max","left-label","right-label","readonly"])):"file"===e.type?((0,i.uX)(),(0,i.Wv)(g,{key:9,modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,constraints:e.constraints||{},readonly:!!e.constraints?.readonly,required:!!e.constraints?.required,stage:"builder"},null,8,["modelValue","onUpdate:modelValue","constraints","readonly","required"])):"button"===e.type?((0,i.uX)(),(0,i.CE)("button",Zt,(0,m.v_)(e.label),1)):(0,i.bo)(((0,i.uX)(),(0,i.CE)("input",{key:11,type:"text","onUpdate:modelValue":t=>e.value=t,placeholder:e.constraints?.placeholder||e.placeholder},null,8,es)),[[a.Jo,e.value]]),e.constraints?.helpText?((0,i.uX)(),(0,i.CE)("small",ts,(0,m.v_)(e.constraints.helpText),1)):(0,i.Q3)("",!0)])]))),128))]))],10,It))),128))]))]),n.showMatrix?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",as,[(0,i.Lk)("button",{onClick:t[4]||(t[4]=(0,a.D$)((...e)=>r.addNewSection&&r.addNewSection(...e),["prevent"])),class:"btn-option"}," + Add Section "),(0,i.Lk)("button",{onClick:t[5]||(t[5]=(0,a.D$)((...e)=>r.confirmClearForm&&r.confirmClearForm(...e),["prevent"])),class:"btn-option"}," Clear "),(0,i.Lk)("button",{onClick:t[6]||(t[6]=(0,a.D$)((...e)=>r.saveForm&&r.saveForm(...e),["prevent"])),class:"btn-primary"}," Save Template "),(0,i.Lk)("button",{onClick:t[7]||(t[7]=(0,a.D$)((...e)=>r.downloadFormData&&r.downloadFormData(...e),["prevent"])),class:"btn-option"}," Download Template "),(0,i.Lk)("button",{onClick:t[8]||(t[8]=(0,a.D$)((...e)=>r.openUploadDialog&&r.openUploadDialog(...e),["prevent"])),class:"btn-option"}," Upload Template "),(0,i.Lk)("button",{onClick:t[9]||(t[9]=(0,a.D$)((...e)=>r.handleProtocolClick&&r.handleProtocolClick(...e),["prevent"])),class:"btn-option protocol-btn"}," Schedule of Assessment ")]))])]),n.showModelDialog?((0,i.uX)(),(0,i.CE)("div",is,[(0,i.Lk)("div",ls,[(0,i.Lk)("h3",null,"Select Properties for "+(0,m.v_)(r.prettyModelTitle(n.currentModel.title)),1),(0,i.Lk)("div",ns,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.currentModel.fields,(e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:e.name,class:"prop-row"},[(0,i.Lk)("div",rs,[(0,i.Lk)("strong",null,(0,m.v_)(e.label||r.prettyModelTitle(e.name)),1),e.description?((0,i.uX)(),(0,i.CE)("p",os,(0,m.v_)(e.description),1)):(0,i.Q3)("",!0)]),(0,i.Lk)("label",ds,[(0,i.bo)((0,i.Lk)("input",{type:"checkbox",id:"prop-check-"+t,"onUpdate:modelValue":e=>n.selectedProps[t]=e},null,8,us),[[a.lH,n.selectedProps[t]]])])]))),128))]),(0,i.Lk)("div",cs,[(0,i.Lk)("button",{onClick:t[10]||(t[10]=(...e)=>r.takeoverModel&&r.takeoverModel(...e)),class:"btn-primary"},"Takeover"),(0,i.Lk)("button",{onClick:t[11]||(t[11]=e=>n.showModelDialog=!1),class:"btn-option"}," Cancel ")])])])):(0,i.Q3)("",!0),n.showConstraintsDialog?((0,i.uX)(),(0,i.CE)("div",ps,[(0,i.bF)(v,{currentFieldType:n.currentFieldType,constraintsForm:n.constraintsForm,onUpdateConstraints:r.confirmConstraintsDialog,onCloseConstraintsDialog:r.cancelConstraintsDialog,onShowGenericDialog:r.openGenericDialog},null,8,["currentFieldType","constraintsForm","onUpdateConstraints","onCloseConstraintsDialog","onShowGenericDialog"])])):(0,i.Q3)("",!0),n.showPreviewDialog?((0,i.uX)(),(0,i.CE)("div",ms,[(0,i.Lk)("div",hs,[(0,i.bF)(k,{form:r.currentForm},null,8,["form"]),(0,i.Lk)("div",ys,[(0,i.Lk)("button",{onClick:t[12]||(t[12]=(...t)=>e.closePreviewDialog&&e.closePreviewDialog(...t)),class:"btn-primary"},"Close")])])])):(0,i.Q3)("",!0),n.showUploadDialog?((0,i.uX)(),(0,i.CE)("div",gs,[(0,i.Lk)("div",fs,[t[25]||(t[25]=(0,i.Lk)("p",null,[(0,i.eW)(" Select a JSON file containing exactly:"),(0,i.Lk)("br"),(0,i.Lk)("code",null,'{ "sections": […] }')],-1)),(0,i.Lk)("input",{type:"file",onChange:t[13]||(t[13]=(...e)=>r.handleFileChange&&r.handleFileChange(...e)),accept:".json"},null,32),(0,i.Lk)("div",vs,[(0,i.Lk)("button",{onClick:t[14]||(t[14]=(...e)=>r.closeUploadDialog&&r.closeUploadDialog(...e)),class:"btn-option"}," Cancel ")])])])):(0,i.Q3)("",!0),n.showInputDialog?((0,i.uX)(),(0,i.CE)("div",ks,[(0,i.Lk)("div",bs,[(0,i.Lk)("p",null,(0,m.v_)(n.inputDialogMessage),1),(0,i.bo)((0,i.Lk)("input",{type:"text","onUpdate:modelValue":t[15]||(t[15]=e=>n.inputDialogValue=e),class:"input-dialog-field"},null,512),[[a.Jo,n.inputDialogValue]]),(0,i.Lk)("div",Ls,[(0,i.Lk)("button",{onClick:t[16]||(t[16]=(...e)=>r.confirmInputDialog&&r.confirmInputDialog(...e)),class:"btn-primary"},"Save"),(0,i.Lk)("button",{onClick:t[17]||(t[17]=(...e)=>r.cancelInputDialog&&r.cancelInputDialog(...e)),class:"btn-option"}," Cancel ")])])])):(0,i.Q3)("",!0),n.showConfirmDialog?((0,i.uX)(),(0,i.CE)("div",ws,[(0,i.Lk)("div",Cs,[(0,i.Lk)("p",null,(0,m.v_)(n.confirmDialogMessage),1),(0,i.Lk)("div",Ss,[(0,i.Lk)("button",{onClick:t[18]||(t[18]=(...e)=>r.confirmDialogYes&&r.confirmDialogYes(...e)),class:"btn-primary"},"Yes"),(0,i.Lk)("button",{onClick:t[19]||(t[19]=(...e)=>r.closeConfirmDialog&&r.closeConfirmDialog(...e)),class:"btn-option"},"No")])])])):(0,i.Q3)("",!0),n.showGenericDialog?((0,i.uX)(),(0,i.CE)("div",xs,[(0,i.Lk)("div",Ds,[(0,i.Lk)("p",null,(0,m.v_)(n.genericDialogMessage),1),(0,i.Lk)("button",{onClick:t[20]||(t[20]=(...e)=>r.closeGenericDialog&&r.closeGenericDialog(...e)),class:"btn-primary"},"OK")])])):(0,i.Q3)("",!0)])}s(2489),s(4603),s(7566),s(8721);var As=s(7210),Ms=s.n(As);const Es={class:"shacl-components"},Vs={key:0},Is={key:1},_s={key:2},$s=["onClick"],Xs=["onClick"],js={class:"scrollable-content"},Us={class:"group-header"},Ts=["for"],Ns={class:"field-container"},Rs=["id","onUpdate:modelValue"],Ps=["id","onUpdate:modelValue"],Bs=["id","onUpdate:modelValue"],Os=["id","onUpdate:modelValue"],qs=["id","onUpdate:modelValue"],Ks=["value"],Ws=["id","onUpdate:modelValue"],zs=["id","onUpdate:modelValue"],Qs={class:"action-buttons"},Gs=["onClick"],Js=["onClick"],Ys=["onClick"],Hs=["onClick"],Zs={class:"dialog-buttons"},ea={class:"dialog-buttons"},ta={class:"dialog-buttons"};function sa(e,t,s,l,n,r){return(0,i.uX)(),(0,i.CE)("div",Es,[t[14]||(t[14]=(0,i.Lk)("h2",null,"SHACL Classes",-1)),l.loading?((0,i.uX)(),(0,i.CE)("p",Vs,"Loading SHACL components...")):l.error?((0,i.uX)(),(0,i.CE)("p",Is,"Error loading SHACL components: "+(0,m.v_)(l.error),1)):((0,i.uX)(),(0,i.CE)("ul",_s,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(l.filteredShapeIRIs,(e,t)=>((0,i.uX)(),(0,i.CE)("li",{key:t,onClick:t=>l.openDialog(e),class:"shape-item"},(0,m.v_)(l.getClassName(e)),9,$s))),128))])),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(l.dialogStack,(e,s)=>((0,i.uX)(),(0,i.CE)("div",{key:s,class:"dialog-overlay",style:(0,m.Tr)({zIndex:1e3+s}),onClick:(0,a.D$)(e=>s===l.dialogStack.length-1&&l.cancelDialog(),["self"])},[(0,i.Lk)("div",{class:"dialog",onClick:t[2]||(t[2]=(0,a.D$)(()=>{},["stop"]))},[(0,i.Lk)("h3",null,(0,m.v_)(l.getClassName(e.iri)),1),(0,i.Lk)("div",js,[(0,i.Lk)("form",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.groups,(e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t,class:"group-container"},[(0,i.Lk)("h4",Us,(0,m.v_)(l.formatGroupName(e.name)),1),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.properties,(e,n)=>((0,i.uX)(),(0,i.CE)("div",{key:n,class:"form-group"},[(0,i.Lk)("label",{for:"input-"+s+"-"+t+"-"+n},(0,m.v_)(e.name),9,Ts),(0,i.Lk)("div",Ns,["reference"!==e.datatype?((0,i.uX)(),(0,i.CE)(i.FK,{key:0},["string"===e.datatype?(0,i.bo)(((0,i.uX)(),(0,i.CE)("input",{key:0,type:"text",id:"input-"+s+"-"+t+"-"+n,"onUpdate:modelValue":t=>e.value=t,placeholder:"Enter text"},null,8,Rs)),[[a.Jo,e.value]]):"number"===e.datatype?(0,i.bo)(((0,i.uX)(),(0,i.CE)("input",{key:1,type:"number",id:"input-"+s+"-"+t+"-"+n,"onUpdate:modelValue":t=>e.value=t,placeholder:"Enter number"},null,8,Ps)),[[a.Jo,e.value]]):"date"===e.datatype?(0,i.bo)(((0,i.uX)(),(0,i.CE)("input",{key:2,type:"date",id:"input-"+s+"-"+t+"-"+n,"onUpdate:modelValue":t=>e.value=t},null,8,Bs)),[[a.Jo,e.value]]):"datetime"===e.datatype?(0,i.bo)(((0,i.uX)(),(0,i.CE)("input",{key:3,type:"date",id:"input-"+s+"-"+t+"-"+n,"onUpdate:modelValue":t=>e.value=t,placeholder:"Select date"},null,8,Os)),[[a.Jo,e.value]]):"select"===e.datatype?(0,i.bo)(((0,i.uX)(),(0,i.CE)("select",{key:4,id:"input-"+s+"-"+t+"-"+n,"onUpdate:modelValue":t=>e.value=t},[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.options,e=>((0,i.uX)(),(0,i.CE)("option",{key:e,value:e},(0,m.v_)(e),9,Ks))),128))],8,qs)),[[a.u1,e.value]]):"uri"===e.datatype?(0,i.bo)(((0,i.uX)(),(0,i.CE)("input",{key:5,type:"url",id:"input-"+s+"-"+t+"-"+n,"onUpdate:modelValue":t=>e.value=t,placeholder:"Enter URL"},null,8,Ws)),[[a.Jo,e.value]]):(0,i.bo)(((0,i.uX)(),(0,i.CE)("input",{key:6,type:"text",id:"input-"+s+"-"+t+"-"+n,"onUpdate:modelValue":t=>e.value=t,placeholder:"Enter text"},null,8,zs)),[[a.Jo,e.value]])],64)):((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[],64)),(0,i.Lk)("div",Qs,["reference"===e.datatype?((0,i.uX)(),(0,i.CE)(i.FK,{key:0},[(0,i.Lk)("button",{onClick:(0,a.D$)(e=>l.editReferenceField(t,n),["prevent"]),class:"btn"}," View Class: "+(0,m.v_)(l.getClassName(e.classRef)),9,Gs),(0,i.Lk)("button",{onClick:(0,a.D$)(e=>l.openDeleteDialog(t,n),["prevent"]),class:"btn"}," Delete ",8,Js)],64)):((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[(0,i.Lk)("button",{onClick:(0,a.D$)(e=>l.openEditFieldDialog(t,n),["prevent"]),class:"btn"}," Edit ",8,Ys),(0,i.Lk)("button",{onClick:(0,a.D$)(e=>l.openDeleteDialog(t,n),["prevent"]),class:"btn"}," Delete ",8,Hs)],64))])])]))),128))]))),128))])]),(0,i.Lk)("div",Zs,[s>0?((0,i.uX)(),(0,i.CE)("button",{key:0,onClick:t[0]||(t[0]=(...e)=>l.saveReference&&l.saveReference(...e)),class:"btn"}," Save ")):(0,i.Q3)("",!0),(0,i.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>l.cancelDialog&&l.cancelDialog(...e)),class:"btn"}," Close ")])])],12,Xs))),128)),l.editFieldDialog?((0,i.uX)(),(0,i.CE)("div",{key:3,class:"edit-dialog-overlay",onClick:t[7]||(t[7]=(0,a.D$)((...e)=>l.cancelEditFieldDialog&&l.cancelEditFieldDialog(...e),["self"]))},[(0,i.Lk)("div",{class:"edit-dialog",onClick:t[6]||(t[6]=(0,a.D$)(()=>{},["stop"]))},[t[12]||(t[12]=(0,i.Lk)("h3",null,"Edit Field Name",-1)),(0,i.bo)((0,i.Lk)("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=e=>l.editFieldDialog.newName=e)},null,512),[[a.Jo,l.editFieldDialog.newName]]),(0,i.Lk)("div",ea,[(0,i.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>l.saveEditedFieldName&&l.saveEditedFieldName(...e)),class:"btn"},"Save"),(0,i.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>l.cancelEditFieldDialog&&l.cancelEditFieldDialog(...e)),class:"btn"},"Cancel")])])])):(0,i.Q3)("",!0),l.deleteFieldDialog?((0,i.uX)(),(0,i.CE)("div",{key:4,class:"delete-dialog-overlay",onClick:t[11]||(t[11]=(0,a.D$)((...e)=>l.cancelDeleteDialog&&l.cancelDeleteDialog(...e),["self"]))},[(0,i.Lk)("div",{class:"delete-dialog",onClick:t[10]||(t[10]=(0,a.D$)(()=>{},["stop"]))},[t[13]||(t[13]=(0,i.Lk)("h3",null,"Confirm Deletion",-1)),(0,i.Lk)("p",null,'Are you sure you want to delete "'+(0,m.v_)(l.deleteFieldDialog.fieldName)+'"?',1),(0,i.Lk)("div",ta,[(0,i.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>l.confirmDelete&&l.confirmDelete(...e)),class:"btn"},"Yes"),(0,i.Lk)("button",{onClick:t[9]||(t[9]=(...e)=>l.cancelDeleteDialog&&l.cancelDeleteDialog(...e)),class:"btn"},"No")])])])):(0,i.Q3)("",!0)])}s(7588);var aa=s(953),ia=s(1184),la=s(4227);async function na(e,t={"Content-Type":"text/turtle"}){const s=e;try{console.log(s);var a=null;if(a=await(0,la.A)(s,{formats:ia.Ay,headers:t}),["text/plain","text/html"].indexOf(a.headers.get("content-type"))>=0&&(t["Content-Type"]="text/turtle",a=await(0,la.A)(s,{formats:ia.Ay,headers:t})),!a.ok){const e=a.status||"Unknown",t=new Error(`readRDF error: HTTP ${e} from ${s}`);throw t.status=e,t.url=s,t.response=a,t}if(a.headers.get("content-type").indexOf("application/json")>=0)throw new Error("readRDF error: reading json data is not supported");const e=await a.quadStream();return{success:!0,quadStream:e,url:s,message:"RDF data loaded successfully"}}catch(i){return{success:!1,error:i,url:s,message:i.message}}}var ra=s(63);const{namedNode:oa}=ra.Ay;function da(e){return new Proxy({},{get(t,s){return oa(e+s)}})}const ua=da("http://www.w3.org/ns/shacl#"),ca=da("http://www.w3.org/1999/02/22-rdf-syntax-ns#"),pa=(da("http://datashapes.org/dash#"),da("http://www.w3.org/2000/01/rdf-schema#"),da("http://www.w3.org/2001/XMLSchema#"));s(8237);function ma(e,t,s){if(!e)return null;t||console.log("no prefixes passed!!");const a=Object.values(t).sort((e,t)=>t.length-e.length);for(const i of a)if(e.indexOf(i)>=0){const a=ya(t)[i],l=e.substring(i.length);return"parts"==s?{prefix:a,property:l}:a+":"+l}return e}function ha(e,t){if(!e)return null;if(!t)return console.error("no prefixes passed!!"),null;if(e.indexOf(":")<0)return e;var s=e.split(":"),a=s[0],i=s[1];return Object.keys(t).indexOf(a)<0?e:t[a]+i}function ya(e){return Object.keys(e).reduce((t,s)=>(t[e[s]]=s,t),{})}var ga=s(268),fa=s(9058);const{namedNode:va,literal:ka}=ra.Ay;class ba{constructor(e={}){this.data=e,this.data.prefixes={},this.data.serializedGraph="",this.data.graphLoaded=!1,this.data.prefixesLoaded=!1,this.data.graph=this.createDataset(),this._eventTarget=new EventTarget}addEventListener(e,t,s){this._eventTarget.addEventListener(e,t,s)}removeEventListener(e,t,s){this._eventTarget.removeEventListener(e,t,s)}dispatchEvent(e){return this._eventTarget.dispatchEvent(e)}createDataset(){return new ga.A}async loadRDF(e,t={}){this.beforeLoadFn();const s=await na(e,t);if(!s.success)return s;const a=s.quadStream;return a.on("prefix",(e,t)=>{this.onPrefixFn(e,t)}).on("data",e=>{this.onDataFn(e)}).on("end",()=>{this.onDataEndFn(),this.onPrefixEndFn()}).on("error",e=>{console.error("Error while processing quadStream:",e)}),s}beforeLoadFn(){this.data.graphLoaded=!1}onPrefixFn(e,t){this.data.prefixes[e]=t.value,this.dispatchEvent(new CustomEvent("prefix",{detail:{prefix:e,ns:t}}))}onPrefixEndFn(){this.data.prefixesLoaded=!0,this.dispatchEvent(new CustomEvent("prefixesLoaded",{detail:this.data.prefixes}))}onDataFn(e){this.addQuad(e),this.dispatchEvent(new CustomEvent("quad",{detail:e}))}onDataEndFn(){this.data.graphLoaded=!0,this.dispatchEvent(new CustomEvent("graphLoaded",{detail:this.data.graph}))}addQuad(e){this.data.graph.addQuad(e)}async serializeGraph(){return new Promise((e,t)=>{const s=new fa.A({prefixes:this.data.prefixes});s.addQuads(this.data.graph.getQuads(null,null,null,null)),s.end((s,a)=>{s?t(s):e(a.trim())})})}isRdfList(e){let t=!1,s=!1;return this.data.graph.getQuads(e,null,null,null).forEach(e=>{e.predicate.value===ca.first.value&&(t=!0),e.predicate.value===ca.rest.value&&(s=!0)}),t&&s}rdfListToArray(e){const t=[];let s=e;while(s&&s.value!==ca.nil.value){let e=null;this.data.graph.getQuads(s,ca.first,null,null).forEach(t=>{"BlankNode"===t.object.termType?e=this.isRdfList(t.object)?this.rdfListToArray(t.object):this.resolveBlankNode(t.object):"Literal"!==t.object.termType&&"NamedNode"!==t.object.termType||(e=t.object.value)}),null!==e&&t.push(e);const a=this.data.graph.getQuads(s,ca.rest,null,null);s=a.length>0?a[0].object:null}return t}resolveBlankNode(e){let t={};return this.data.graph.getQuads(e,null,null,null).forEach(({predicate:e,object:s})=>{"BlankNode"===s.termType?this.isRdfList(s)?t[e.value]=this.rdfListToArray(s):t[e.value]=this.resolveBlankNode(s):"Literal"!==s.termType&&"NamedNode"!==s.termType||(t[e.value]=s.value)}),t}getLiteralAndNamedNodes(e,t,s){var a=ma(t,s);const i=this.data.graph.getQuads(null,e,ka(String(a),pa.anyURI),null),l=this.data.graph.getQuads(null,e,va(t),null);return i.concat(l)}getSubjectTriples(e){return this.data.graph.getQuads(e,null,null,null)}getObjectTriples(e){return this.data.graph.getQuads(null,null,e,null)}}s(1148),s(4979),s(1678);const{namedNode:La,blankNode:wa,quad:Ca}=ra.Ay;s(116);const{namedNode:Sa,literal:xa,blankNode:Da}=ra.Ay;class Fa extends ba{constructor(e={}){super(e),this.data.propertyGroups={},this.data.nodeShapes={},this.data.nodeShapeNames={},this.data.nodeShapeNamesArray=[],this.data.nodeShapeIRIs=null}onDataFn(e){this.addQuad(e);const t=e.subject.value,s=e.predicate.value,a=e.object;s===ca.type.value&&a.value===ua.NodeShape.value&&(this.data.nodeShapes[t]={properties:[]}),s===ua.property.value&&this.data.nodeShapes[t].properties.push(a),s===ca.type.value&&a.value===ua.PropertyGroup.value&&(this.data.propertyGroups[t]={}),this.dispatchEvent(new CustomEvent("quad",{detail:e}))}async onDataEndFn(){for(const[i,l]of Object.entries(this.data.nodeShapes)){this.data.graph.forEach(e=>{e.subject.value===i&&e.predicate.value!=ua.property.value&&("BlankNode"===e.object.termType?this.data.nodeShapes[i][e.predicate.value]=this.resolveBlankNode(e.object):this.data.nodeShapes[i][e.predicate.value]=e.object.value)});for(var e=0;e<l.properties.length;e++){var t=l.properties[e];if("BlankNode"===t.termType)l.properties[e]=this.resolveBlankNode(t);else{var s={};this.data.graph.forEach(e=>{e.subject.value===t.value&&(s[e.predicate.value]=e.object.value)}),l.properties[e]=s}}}for(const i of Object.keys(this.data.nodeShapes)){var a=i.split("/");this.data.nodeShapeNames[a[a.length-1]]=i}this.data.nodeShapeNamesArray=Object.keys(this.data.nodeShapeNames).sort(),this.data.nodeShapeIRIs=Object.keys(this.data.nodeShapes).sort();for(const[i,l]of Object.entries(this.data.propertyGroups))this.data.graph.forEach(e=>{e.subject.value===i&&e.predicate.value!=ca.type.value&&(this.data.propertyGroups[i][e.predicate.value]=e.object.value)});this.data.serializedGraph=await this.serializeGraph(),this.data.graphLoaded=!0,this.dispatchEvent(new CustomEvent("graphLoaded",{detail:this.data.graph}))}getPropertyNodeKind(e,t,s){var a=this.data.nodeShapes[e],i=a.properties,l=i.find(e=>e[ua.path.value]==t),n=null,r=null;if(l.hasOwnProperty(ua.nodeKind.value))if(l[ua.nodeKind.value]==ua.Literal.value)n=xa,l.hasOwnProperty(ua.datatype.value)&&(r=l[ua.datatype.value]);else if(l[ua.nodeKind.value]==ua.IRI.value)n=Sa;else if(l[ua.nodeKind.value]==ua.BlankNode.value)n=Da;else if(l[ua.nodeKind.value]==ua.BlankNodeOrIRI.value)if(l.hasOwnProperty(ua.class.value)){var o=l[ua.class.value],d=this.data.nodeShapes[ha(o,this.data.prefixes)],u=d.properties.find(e=>e[ua.path.value]==s);n=u?Sa:Da}else n=Sa;else console.error(`\t- NodeKind not supported: ${l[ua.nodeKind.value]}\n\t\tAdding triple with literal object to graphData`),n=xa;else l.hasOwnProperty(ua.in.value)?(console.log(`\t- NodeKind not found for property shape: ${t}; found 'sh:in'. Setting to default literal`),n=xa):l.hasOwnProperty(ua.or.value)&&Array.isArray(l[ua.or.value])&&l[ua.or.value].every(e=>e.hasOwnProperty(ua.class.value))?(console.log(`\t- NodeKind not found for property shape: ${t}; found 'sh:or' with every element containing 'sh:class'. Setting to namedNode`),n=Sa):(console.log(`\t- NodeKind not found for property shape: ${t}. Setting to default literal`),n=xa);return[n,r]}}var Aa={name:"ShaclComponents",emits:[],setup(){const e=(0,aa.KR)(!0),t=(0,aa.KR)(null),s=(0,aa.KR)([]),a=(0,aa.KR)({}),l=(0,aa.KR)([]),n=(0,aa.KR)(null),r=(0,aa.KR)(null),o={showOnlyClassesWithId:!0};function d(e){const t=e.split("/").pop();return console.log(`Transforming IRI: ${e} --\x3e Class Name: ${t}`),t}function u(e){const t=e.split("/").pop();if(t.includes("22-rdf-syntax-ns#")){const e=t.split("22-rdf-syntax-ns#"),s=e[1]||t;return console.log(`Extracted "${s}" from last segment "${t}"`),s}return t}function c(e){const t=e["http://www.w3.org/ns/shacl#order"];if(void 0===t||null===t||"string"===typeof t&&""===t.trim())return 1/0;const s=parseInt(t,10);return isNaN(s)?1/0:s}function p(e){return"Ungrouped"===e?"Default Properties":u(e)}const m=(0,i.EW)(()=>{if(!l.value)return console.log("No nodeShapeIRIs available, returning empty array."),[];console.log("Original nodeShapeIRIs:",l.value);let e=[];return o.showOnlyClassesWithId?(e=l.value.filter(e=>{const t=a.value[e];if(!t||!t.properties)return console.log(`Shape ${e} has no properties; excluding.`),!1;const s=t.properties.some(t=>{const s=t["http://www.w3.org/ns/shacl#path"],a="string"===typeof s&&s.toLowerCase().endsWith("/id");return console.log(`Shape ${e}: property path ${s} ${a?"matches":"does not match"} the dynamic id check.`),a});return s}),console.log("Filtered IRIs with dynamic id check:",e)):(e=l.value,console.log("showOnlyClassesWithId flag is false, returning all IRIs:",e)),e}),h={"http://www.w3.org/2001/XMLSchema#string":"string","http://www.w3.org/2001/XMLSchema#integer":"number","http://www.w3.org/2001/XMLSchema#boolean":"boolean","http://www.w3.org/2001/XMLSchema#date":"date","http://www.w3.org/2001/XMLSchema#anyURI":"uri","https://www.w3.org/TR/NOTE-datetime":"datetime"};function y(e,t=null){console.log("Opening dialog for IRI:",e);const i=a.value[e];if(i){console.log(`Processing shape record for IRI: ${e}`);const a={};i.properties.forEach(e=>{let t=e["http://www.w3.org/ns/shacl#group"];t&&""!==t.trim()||(t="Ungrouped"),a[t]||(a[t]=[]),a[t].push(e)});let l=Object.keys(a);l.sort((e,t)=>"Ungrouped"===e&&"Ungrouped"!==t?1:"Ungrouped"===t&&"Ungrouped"!==e?-1:e.localeCompare(t));const n=l.map(e=>{const t=a[e].slice().sort((e,t)=>c(e)-c(t)).map((t,s)=>{console.log(`\nProcessing property (group: ${e}) #${s}:`,JSON.stringify(t,null,2));const a=t["http://www.w3.org/ns/shacl#name"];let i="";if(a&&""!==a.trim())i=a,console.log(`Property #${s}: Found shacl#name: "${a}"`);else{const e=t["http://www.w3.org/ns/shacl#path"];e&&""!==e.trim()?(i=u(e),console.log(`Property #${s}: shacl#name is empty, using extracted label from shacl#path: "${i}"`)):(i="Unnamed",console.log(`Property #${s}: Both shacl#name and shacl#path are empty. Defaulting to "Unnamed"`))}let l="",n="";if(t["http://www.w3.org/ns/shacl#class"])l="reference",n=t["http://www.w3.org/ns/shacl#class"],console.log(`Property #${s}: Found shacl#class: "${n}". Setting type to "reference".`);else{const e=t["http://www.w3.org/ns/shacl#datatype"];l=h[e]||"string",console.log(`Property #${s}: datatype URI: "${e}" mapped to type: "${l}"`)}const r=t["http://www.w3.org/ns/shacl#in"]||[];return console.log(`Property #${s}: options:`,r),{name:i,order:c(t),datatype:l,options:r,value:null,classRef:n}});return{name:e,properties:t}}),r={iri:e,groups:n,parentInfo:t};console.log("Final dialog data JSON:",JSON.stringify(r,null,2)),s.value.push(r)}else console.warn("No record found for IRI:",e)}function g(e,t){const a=s.value[s.value.length-1],i=a.groups[e].properties[t];n.value={groupIndex:e,propertyIndex:t,newName:i.name}}function f(){if(n.value){const{groupIndex:e,propertyIndex:t,newName:a}=n.value,i=s.value[s.value.length-1];console.log(`Updating field name at group ${e}, index ${t} to "${a}"`),i.groups[e].properties[t].name=a,n.value=null}}function v(){n.value=null}function k(e,t){b(e,t)}function b(e,t){const a=s.value[s.value.length-1],i=a.groups[e].properties[t];if("reference"===i.datatype&&i.classRef){const a=s.value.length-1;console.log(`Editing reference field "${i.name}". Opening dialog for referenced class: ${i.classRef}`),y(i.classRef,{parentDialogIndex:a,fieldLocation:{groupIndex:e,propertyIndex:t}})}else g(e,t)}function L(e,t){const a=s.value[s.value.length-1],i=a.groups[e].properties[t];r.value={groupIndex:e,propertyIndex:t,fieldName:i.name}}function w(){const{groupIndex:e,propertyIndex:t}=r.value,a=s.value[s.value.length-1];console.log(`Deleting field at group ${e}, index ${t}`),a.groups[e].properties.splice(t,1),r.value=null}function C(){r.value=null}function S(e,t){L(e,t)}function x(){const e=s.value.pop();if(e.parentInfo){const{parentDialogIndex:t,fieldLocation:a}=e.parentInfo,i=s.value[t];console.log(`Saving reference. Updating parent's field at group ${a.groupIndex}, index ${a.propertyIndex} with data:`,e),i.groups[a.groupIndex].properties[a.propertyIndex].value=e}}function D(){s.value.pop()}function F(){s.value=[]}return(0,i.sV)(()=>{console.log("Fetching SHACL schema...");const s=new Fa,i="/dlschemas_shacl.ttl";s.addEventListener("graphLoaded",t=>{console.log("Shapes graph fully loaded:",t.detail),console.log("Property Groups:",s.propertyGroups),console.log("Node Shapes:",s.nodeShapes),console.log("Node Shape IRIs:",s.nodeShapeIRIs),a.value=s.nodeShapes,l.value=s.nodeShapeIRIs,e.value=!1}),s.loadRDF(i).catch(s=>{t.value=s.message,e.value=!1,console.error("Error loading SHACL schema:",s)})}),{loading:e,error:t,dialogStack:s,filteredShapeIRIs:m,getClassName:d,openDialog:y,closeDialog:F,editField:b,editReferenceField:k,deleteField:S,saveReference:x,cancelDialog:D,formatGroupName:p,editFieldDialog:n,openEditFieldDialog:g,saveEditedFieldName:f,cancelEditFieldDialog:v,deleteFieldDialog:r,openDeleteDialog:L,confirmDelete:w,cancelDeleteDialog:C}}};const Ma=(0,o.A)(Aa,[["render",sa],["__scopeId","data-v-2a561cde"]]);var Ea=Ma;const Va={class:"protocol-matrix-container"},Ia={class:"screen-header"},_a={key:0,class:"visit-nav"},$a=["disabled"],Xa={class:"visit-nav-center"},ja={class:"visit-counter"},Ua={class:"visit-name"},Ta=["disabled"],Na={class:"table-container card-surface"},Ra={class:"protocol-table"},Pa={key:0},Ba=["colspan"],Oa={class:"th-chip"},qa={class:"group-name"},Ka={key:1},Wa={class:"group-name"},za={class:"model-cell"},Qa={class:"model-title"},Ga=["title"],Ja=["checked","onChange"],Ya=["title"],Ha=["checked","onChange"],Za={key:1,class:"modal-overlay"},ei={class:"modal protocol-preview-modal"},ti={class:"preview-header"},si=["disabled"],ai={class:"preview-label"},ii={class:"th-chip"},li=["disabled"],ni=["disabled"],ri={class:"preview-label"},oi={class:"th-chip"},di=["disabled"],ui={class:"preview-content"},ci={class:"modal-actions"},pi={key:2,class:"modal-overlay"},mi={class:"modal validation-modal"},hi={class:"validation-title"},yi={class:"modal-actions"},gi={key:3,class:"modal-overlay"},fi={class:"modal validation-modal"},vi={class:"validation-title"},ki={class:"empty-visits-list"},bi={class:"visit-item-title"},Li={class:"modal-actions"},wi=["disabled"],Ci={key:4,class:"modal-overlay"},Si={class:"modal validation-modal confirm-scroll"},xi={class:"validation-title"},Di={class:"diff-scroll"},Fi={class:"modal-actions sticky-actions"},Ai={class:"matrix-actions card-surface"},Mi=["disabled"];function Ei(e,t,s,a,l,n){const r=(0,i.g2)("FormPreview"),o=(0,i.g2)("CustomDialog"),d=(0,i.g2)("TemplateDiffView");return(0,i.uX)(),(0,i.CE)("div",Va,[(0,i.Lk)("div",Ia,[t[18]||(t[18]=(0,i.Lk)("h2",{class:"screen-title"},"Schedule of Assessments",-1)),(0,i.Lk)("button",{class:"icon-btn header-info-btn",onClick:t[0]||(t[0]=e=>a.showInfo=!0),"aria-label":"What is Protocol Matrix?"},[(0,i.Lk)("i",{class:(0,m.C4)(a.icons.info)},null,2)])]),a.visitList.length>3?((0,i.uX)(),(0,i.CE)("div",_a,[(0,i.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>a.prevVisit&&a.prevVisit(...e)),disabled:0===a.currentVisitIndex,class:"nav-btn"},"<",8,$a),(0,i.Lk)("div",Xa,[(0,i.Lk)("span",ja," Visit "+(0,m.v_)(a.currentVisitIndex+1)+" / "+(0,m.v_)(a.visitList.length),1),(0,i.Lk)("span",Ua,(0,m.v_)(a.visitList[a.currentVisitIndex]?.name||"Visit"),1)]),(0,i.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>a.nextVisit&&a.nextVisit(...e)),disabled:a.currentVisitIndex===a.visitList.length-1,class:"nav-btn"},">",8,Ta)])):(0,i.Q3)("",!0),(0,i.Lk)("div",Na,[(0,i.Lk)("table",Ra,[a.visitList.length<=3?((0,i.uX)(),(0,i.CE)("thead",Pa,[(0,i.Lk)("tr",null,[t[20]||(t[20]=(0,i.Lk)("th",{rowspan:"2"},"Data Models",-1)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(a.visitList,(e,s)=>((0,i.uX)(),(0,i.CE)("th",{key:`vh-${s}`,colspan:a.groupList.length},[t[19]||(t[19]=(0,i.Lk)("span",{class:"th-title"},"Visit:",-1)),(0,i.Lk)("span",Oa,(0,m.v_)(e.name),1)],8,Ba))),128))]),(0,i.Lk)("tr",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(a.visitList,(e,t)=>((0,i.uX)(),(0,i.CE)(i.FK,{key:`vg-${t}`},[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(a.groupList,(e,s)=>((0,i.uX)(),(0,i.CE)("th",{key:`vg-${t}-${s}`},[(0,i.Lk)("span",qa,"Group/Cohort: "+(0,m.v_)(e.name),1)]))),128))],64))),128))])])):((0,i.uX)(),(0,i.CE)("thead",Ka,[(0,i.Lk)("tr",null,[t[21]||(t[21]=(0,i.Lk)("th",null,"Data Models",-1)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(a.groupList,(e,t)=>((0,i.uX)(),(0,i.CE)("th",{key:`g-${t}`},[(0,i.Lk)("span",Wa,(0,m.v_)(e.name),1)]))),128))])])),(0,i.Lk)("tbody",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(s.selectedModels,(e,t)=>((0,i.uX)(),(0,i.CE)("tr",{key:`m-${t}`},[(0,i.Lk)("td",za,[(0,i.Lk)("span",Qa,(0,m.v_)(e.title),1)]),a.visitList.length<=3?((0,i.uX)(!0),(0,i.CE)(i.FK,{key:0},(0,i.pI)(a.visitList,(l,n)=>((0,i.uX)(),(0,i.CE)(i.FK,{key:`row-${t}-v-${n}`},[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(a.groupList,(l,r)=>((0,i.uX)(),(0,i.CE)("td",{key:`cell-${t}-${n}-${r}`},[(0,i.Lk)("label",{class:"chk-wrap",title:`Toggle ${e.title} @ ${a.visitList[n]?.name} / ${a.groupList[r]?.name}`},[(0,i.Lk)("input",{type:"checkbox",checked:s.assignments[t][n][r],onChange:e=>a.onToggle(t,n,r,e.target.checked)},null,40,Ja),(0,i.Lk)("i",{class:(0,m.C4)(["fa-chk",[s.assignments[t][n][r]?"fas fa-check-square":"far fa-square"]])},null,2)],8,Ga)]))),128))],64))),128)):((0,i.uX)(!0),(0,i.CE)(i.FK,{key:1},(0,i.pI)(a.groupList,(l,n)=>((0,i.uX)(),(0,i.CE)("td",{key:`celln-${t}-${n}`},[(0,i.Lk)("label",{class:"chk-wrap",title:`Toggle ${e.title} @ ${a.visitList[a.currentVisitIndex]?.name} / ${a.groupList[n]?.name}`},[(0,i.Lk)("input",{type:"checkbox",checked:s.assignments[t][a.currentVisitIndex][n],onChange:e=>a.onToggle(t,a.currentVisitIndex,n,e.target.checked)},null,40,Ha),(0,i.Lk)("i",{class:(0,m.C4)(["fa-chk",[s.assignments[t][a.currentVisitIndex][n]?"fas fa-check-square":"far fa-square"]])},null,2)],8,Ya)]))),128))]))),128))])])]),a.showPreviewModal?((0,i.uX)(),(0,i.CE)("div",Za,[(0,i.Lk)("div",ei,[(0,i.Lk)("div",ti,[(0,i.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>a.prevPreviewVisit&&a.prevPreviewVisit(...e)),disabled:0===a.previewVisitIndex,class:"nav-btn"},"<",8,si),(0,i.Lk)("span",ai,[t[22]||(t[22]=(0,i.eW)(" Visit: ",-1)),(0,i.Lk)("span",ii,(0,m.v_)(a.visitList[a.previewVisitIndex].name),1)]),(0,i.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>a.nextPreviewVisit&&a.nextPreviewVisit(...e)),disabled:a.previewVisitIndex===a.visitList.length-1,class:"nav-btn"},">",8,li),t[24]||(t[24]=(0,i.Lk)("span",{class:"spacer"},null,-1)),(0,i.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>a.prevPreviewGroup&&a.prevPreviewGroup(...e)),disabled:0===a.previewGroupPos,class:"nav-btn"},"<",8,ni),(0,i.Lk)("span",ri,[t[23]||(t[23]=(0,i.eW)(" Group/Cohort: ",-1)),(0,i.Lk)("span",oi,(0,m.v_)(a.groupList[a.assignedGroups[a.previewGroupPos]].name),1)]),(0,i.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>a.nextPreviewGroup&&a.nextPreviewGroup(...e)),disabled:a.previewGroupPos===a.assignedGroups.length-1,class:"nav-btn"},">",8,di)]),(0,i.Lk)("div",ui,[(0,i.bF)(r,{form:a.previewForm},null,8,["form"])]),(0,i.Lk)("div",ci,[(0,i.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>a.closePreview&&a.closePreview(...e)),class:"btn-option"},[(0,i.Lk)("i",{class:(0,m.C4)([a.icons.times,"mr-6"])},null,2),t[25]||(t[25]=(0,i.eW)(" Close ",-1))])])])])):(0,i.Q3)("",!0),(0,i.bF)(o,{message:a.dialogMessage,isVisible:a.showDialog,onClose:a.closeDialog},null,8,["message","isVisible","onClose"]),a.showInfo?((0,i.uX)(),(0,i.CE)("div",pi,[(0,i.Lk)("div",mi,[(0,i.Lk)("h3",hi,[(0,i.Lk)("i",{class:(0,m.C4)([a.icons.infoCircle,"li-icon"])},null,2),t[26]||(t[26]=(0,i.eW)(" What is this screen? ",-1))]),t[28]||(t[28]=(0,i.Fv)('<p class="validation-text" data-v-5c0b0e0b> This matrix helps you decide which <strong data-v-5c0b0e0b>forms/data models</strong> are collected for each study <strong data-v-5c0b0e0b>Visit</strong> and <strong data-v-5c0b0e0b>Group/Cohort</strong>. Click a checkbox to assign a form to that visit and group. Use the arrows to move between visits when there are many. </p><ul class="empty-visits-list" data-v-5c0b0e0b><li data-v-5c0b0e0b>Checked = that form will appear for participants in that group at that visit.</li><li data-v-5c0b0e0b>Use <strong data-v-5c0b0e0b>Preview</strong> to see what participants will fill out.</li><li data-v-5c0b0e0b><strong data-v-5c0b0e0b>Save</strong> stores your setup. We’ll warn you if a visit has nothing assigned.</li></ul>',2)),(0,i.Lk)("div",yi,[(0,i.Lk)("button",{class:"btn-primary",onClick:t[8]||(t[8]=e=>a.showInfo=!1)},[(0,i.Lk)("i",{class:(0,m.C4)([a.icons.check,"mr-6"])},null,2),t[27]||(t[27]=(0,i.eW)(" Got it ",-1))])])])])):(0,i.Q3)("",!0),a.showEmptyVisitsModal?((0,i.uX)(),(0,i.CE)("div",gi,[(0,i.Lk)("div",fi,[(0,i.Lk)("h3",vi,[(0,i.Lk)("i",{class:(0,m.C4)([a.icons.infoCircle,"li-icon"])},null,2),t[29]||(t[29]=(0,i.eW)(" Some visits have no assigned models ",-1))]),t[32]||(t[32]=(0,i.Lk)("p",{class:"validation-text"}," We found visits without any model assigned. You can go fix them, or save anyway. ",-1)),(0,i.Lk)("ul",ki,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(a.emptyVisitIndices,e=>((0,i.uX)(),(0,i.CE)("li",{key:`empty-v-${e}`},[(0,i.Lk)("span",bi,"Visit "+(0,m.v_)(e+1)+" — "+(0,m.v_)(a.visitList[e]?.name||"Visit"),1)]))),128))]),(0,i.Lk)("div",Li,[(0,i.Lk)("button",{class:"btn-option",onClick:t[9]||(t[9]=(...e)=>a.goToFirstEmptyVisit&&a.goToFirstEmptyVisit(...e))},[(0,i.Lk)("i",{class:(0,m.C4)([a.icons.exchangeAlt,"mr-6"])},null,2),t[30]||(t[30]=(0,i.eW)(" Go to first empty visit ",-1))]),(0,i.Lk)("button",{class:"btn-primary",disabled:a.isSavingInProgress,onClick:t[10]||(t[10]=(...e)=>a.saveAnyway&&a.saveAnyway(...e))},[(0,i.Lk)("i",{class:(0,m.C4)([a.icons.check,"mr-6"])},null,2),(0,i.eW)(" "+(0,m.v_)(a.isSavingInProgress?"Saving…":"Save anyway"),1)],8,wi),(0,i.Lk)("button",{class:"btn-option",onClick:t[11]||(t[11]=(...e)=>a.closeEmptyVisitsModal&&a.closeEmptyVisitsModal(...e))},[(0,i.Lk)("i",{class:(0,m.C4)([a.icons.times,"mr-6"])},null,2),t[31]||(t[31]=(0,i.eW)(" Cancel ",-1))])])])])):(0,i.Q3)("",!0),a.showConfirmChanges?((0,i.uX)(),(0,i.CE)("div",Ci,[(0,i.Lk)("div",Si,[(0,i.Lk)("h3",xi,[(0,i.Lk)("i",{class:(0,m.C4)([a.icons.infoCircle,"li-icon"])},null,2),t[33]||(t[33]=(0,i.eW)(" Confirm Template Changes ",-1))]),t[36]||(t[36]=(0,i.Lk)("p",{class:"validation-text"},[(0,i.eW)(" You made structural changes. Saving will create a "),(0,i.Lk)("strong",null,"new template version"),(0,i.eW)(". Existing data remains attached to its original versions and is not lost. ")],-1)),(0,i.Lk)("div",Di,[a.snapshotFrom&&a.snapshotTo?((0,i.uX)(),(0,i.Wv)(d,{key:0,from:a.snapshotFrom,to:a.snapshotTo},null,8,["from","to"])):(0,i.Q3)("",!0)]),(0,i.Lk)("div",Fi,[(0,i.Lk)("button",{class:"btn-option",onClick:t[12]||(t[12]=(...e)=>a.cancelConfirm&&a.cancelConfirm(...e))},[(0,i.Lk)("i",{class:(0,m.C4)([a.icons.times,"mr-6"])},null,2),t[34]||(t[34]=(0,i.eW)(" Cancel ",-1))]),(0,i.Lk)("button",{class:"btn-primary",onClick:t[13]||(t[13]=(...e)=>a.confirmAndSave&&a.confirmAndSave(...e))},[(0,i.Lk)("i",{class:(0,m.C4)([a.icons.check,"mr-6"])},null,2),t[35]||(t[35]=(0,i.eW)(" Confirm & Save ",-1))])])])])):(0,i.Q3)("",!0),(0,i.Lk)("div",Ai,[(0,i.Lk)("button",{onClick:t[14]||(t[14]=t=>e.$emit("edit-template")),class:"btn-option"},"Edit Template"),(0,i.Lk)("button",{onClick:t[15]||(t[15]=(...e)=>a.saveStudy&&a.saveStudy(...e)),class:"btn-primary"},"Save"),(0,i.Lk)("button",{onClick:t[16]||(t[16]=(...e)=>a.openPreview&&a.openPreview(...e)),disabled:!a.hasAssignment(a.currentVisitIndex),class:"btn-option"},"Preview",8,Mi),(0,i.Lk)("button",{onClick:t[17]||(t[17]=(...e)=>a.goToSaved&&a.goToSaved(...e)),class:"btn-option"},"View Saved Study")])])}var Vi=s(6278);const Ii={class:"form-preview"},_i={class:"form-title"},$i={class:"section-header"},Xi={class:"section-title"},ji=["onClick"],Ui={class:"fields-container"},Ti={class:"field-label"},Ni={class:"field-value"},Ri={key:0,class:"checkbox-values"},Pi={key:1},Bi={key:2,disabled:""};function Oi(e,t,s,l,n,r){const o=(0,i.g2)("BaseTextField"),d=(0,i.g2)("BaseTextarea"),u=(0,i.g2)("BaseNumberField"),c=(0,i.g2)("BaseDateField"),p=(0,i.g2)("BaseSelectField");return(0,i.uX)(),(0,i.CE)("div",Ii,[(0,i.Lk)("h2",_i,(0,m.v_)(s.form.formName),1),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(s.form.sections,(e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t,class:"preview-section"},[(0,i.Lk)("div",$i,[(0,i.Lk)("h3",Xi,(0,m.v_)(e.title),1),(0,i.Lk)("button",{class:"toggle-section-btn",onClick:e=>r.toggleSection(t)},[(0,i.Lk)("i",{class:(0,m.C4)(n.expandedSections[t]?r.icons.toggleUp:r.icons.toggleDown)},null,2)],8,ji)]),(0,i.bo)((0,i.Lk)("div",Ui,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.fields,(e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t,class:"preview-field"},[(0,i.Lk)("label",Ti,(0,m.v_)(e.label),1),(0,i.Lk)("div",Ni,["text"===e.type?((0,i.uX)(),(0,i.Wv)(o,{key:0,modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,id:e.name,label:"",placeholder:e.placeholder,required:!1,disabled:!0,error:""},null,8,["modelValue","onUpdate:modelValue","id","placeholder"])):"textarea"===e.type?((0,i.uX)(),(0,i.Wv)(d,{key:1,modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,id:e.name,label:"",placeholder:e.placeholder,required:!1,disabled:!0,error:""},null,8,["modelValue","onUpdate:modelValue","id","placeholder"])):"number"===e.type?((0,i.uX)(),(0,i.Wv)(u,{key:2,modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,id:e.name,label:"",placeholder:e.placeholder,required:!1,disabled:!0,error:""},null,8,["modelValue","onUpdate:modelValue","id","placeholder"])):"date"===e.type?((0,i.uX)(),(0,i.Wv)(c,{key:3,modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,id:e.name,label:"",required:!1,disabled:!0,error:""},null,8,["modelValue","onUpdate:modelValue","id"])):"select"===e.type?((0,i.uX)(),(0,i.Wv)(p,{key:4,modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,id:e.name,label:"",options:e.options,placeholder:e.placeholder||"---",required:!1,disabled:!0,error:""},null,8,["modelValue","onUpdate:modelValue","id","options","placeholder"])):((0,i.uX)(),(0,i.CE)(i.FK,{key:5},["checkbox"===e.type?((0,i.uX)(),(0,i.CE)("div",Ri,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(Array.isArray(e.value)?e.value:[e.value],(e,t)=>((0,i.uX)(),(0,i.CE)("span",{key:t},(0,m.v_)(e||"---"),1))),128))])):"radio"===e.type?((0,i.uX)(),(0,i.CE)("span",Pi,(0,m.v_)(e.value||"---"),1)):"button"===e.type?((0,i.uX)(),(0,i.CE)("button",Bi,(0,m.v_)(e.label),1)):(0,i.Q3)("",!0)],64))])]))),128))],512),[[a.aG,n.expandedSections[t]]])]))),128))])}const qi={class:"form-field"},Ki=["for"],Wi={key:0,class:"required"},zi=["id","value","placeholder","pattern","maxlength","required","disabled"],Qi={key:0,class:"form-error"};function Gi(e,t,s,a,l,n){return(0,i.uX)(),(0,i.CE)("div",qi,[(0,i.Lk)("label",{for:s.id,class:"form-label"},[(0,i.eW)((0,m.v_)(s.label),1),s.required?((0,i.uX)(),(0,i.CE)("span",Wi,"*")):(0,i.Q3)("",!0)],8,Ki),(0,i.Lk)("input",{id:s.id,type:"text",class:(0,m.C4)(["form-input",{"input-error":s.error}]),value:s.modelValue,onInput:t[0]||(t[0]=t=>e.$emit("update:modelValue",t.target.value)),placeholder:s.placeholder,pattern:s.pattern,maxlength:s.maxlength,required:s.required,disabled:s.disabled},null,42,zi),s.error?((0,i.uX)(),(0,i.CE)("div",Qi,[(0,i.RG)(e.$slots,"error",{},()=>[(0,i.eW)((0,m.v_)(s.error),1)],!0)])):(0,i.Q3)("",!0)])}var Ji={name:"BaseTextField",props:{modelValue:{type:String,default:""},id:{type:String,required:!0},label:{type:String,required:!0},placeholder:{type:String,default:""},pattern:{type:String,default:null},maxlength:{type:[Number,String],default:null},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},error:{type:[String,Boolean],default:!1}}};const Yi=(0,o.A)(Ji,[["render",Gi],["__scopeId","data-v-68f0a365"]]);var Hi=Yi;const Zi={class:"form-field"},el=["for"],tl={key:0,class:"required"},sl=["id","value","placeholder","rows","maxlength","required","disabled"],al={key:0,class:"form-error"};function il(e,t,s,a,l,n){return(0,i.uX)(),(0,i.CE)("div",Zi,[(0,i.Lk)("label",{for:s.id,class:"form-label"},[(0,i.eW)((0,m.v_)(s.label),1),s.required?((0,i.uX)(),(0,i.CE)("span",tl,"*")):(0,i.Q3)("",!0)],8,el),(0,i.Lk)("textarea",{id:s.id,class:(0,m.C4)(["form-textarea",{"input-error":s.error}]),value:s.modelValue,onInput:t[0]||(t[0]=t=>e.$emit("update:modelValue",t.target.value)),placeholder:s.placeholder,rows:s.rows,maxlength:s.maxlength,required:s.required,disabled:s.disabled},null,42,sl),s.error?((0,i.uX)(),(0,i.CE)("div",al,[(0,i.RG)(e.$slots,"error",{},()=>[(0,i.eW)((0,m.v_)(s.error),1)],!0)])):(0,i.Q3)("",!0)])}var ll={name:"BaseTextarea",props:{modelValue:{type:String,default:""},id:{type:String,required:!0},label:{type:String,required:!0},placeholder:{type:String,default:""},rows:{type:Number,default:4},maxlength:{type:[Number,String],default:null},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},error:{type:[String,Boolean],default:!1}}};const nl=(0,o.A)(ll,[["render",il],["__scopeId","data-v-48a91c56"]]);var rl=nl;const ol={class:"form-field"},dl=["for"],ul={key:0,class:"required"},cl=["id","value","min","max","step","placeholder","required","disabled"],pl={key:0,class:"form-error"};function ml(e,t,s,a,l,n){return(0,i.uX)(),(0,i.CE)("div",ol,[(0,i.Lk)("label",{for:s.id,class:"form-label"},[(0,i.eW)((0,m.v_)(s.label),1),s.required?((0,i.uX)(),(0,i.CE)("span",ul,"*")):(0,i.Q3)("",!0)],8,dl),(0,i.Lk)("input",{id:s.id,type:"number",class:(0,m.C4)(["form-input",{"input-error":s.error}]),value:s.modelValue,onInput:t[0]||(t[0]=(...e)=>n.onInput&&n.onInput(...e)),min:s.min,max:s.max,step:s.step,placeholder:s.placeholder,required:s.required,disabled:s.disabled},null,42,cl),s.error?((0,i.uX)(),(0,i.CE)("div",pl,[(0,i.RG)(e.$slots,"error",{},()=>[(0,i.eW)((0,m.v_)(s.error),1)],!0)])):(0,i.Q3)("",!0)])}var hl={name:"BaseNumberField",props:{modelValue:{type:Number,default:null},id:{type:String,required:!0},label:{type:String,required:!0},placeholder:{type:String,default:""},min:{type:Number,default:null},max:{type:Number,default:null},step:{type:[Number,String],default:1},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},error:{type:[String,Boolean],default:!1}},methods:{onInput(e){const t=e.target.valueAsNumber;this.$emit("update:modelValue",isNaN(t)?null:t)}}};const yl=(0,o.A)(hl,[["render",ml],["__scopeId","data-v-bf9b0696"]]);var gl=yl;const fl={class:"form-field"},vl=["for"],kl={key:0,class:"required"},bl=["id","value","min","max","required","disabled"],Ll={key:0,class:"form-error"};function wl(e,t,s,a,l,n){return(0,i.uX)(),(0,i.CE)("div",fl,[(0,i.Lk)("label",{for:s.id,class:"form-label"},[(0,i.eW)((0,m.v_)(s.label),1),s.required?((0,i.uX)(),(0,i.CE)("span",kl,"*")):(0,i.Q3)("",!0)],8,vl),(0,i.Lk)("input",{id:s.id,type:"date",class:(0,m.C4)(["form-input",{"input-error":s.error}]),value:s.modelValue,onInput:t[0]||(t[0]=t=>e.$emit("update:modelValue",t.target.value)),min:s.min,max:s.max,required:s.required,disabled:s.disabled},null,42,bl),s.error?((0,i.uX)(),(0,i.CE)("div",Ll,[(0,i.RG)(e.$slots,"error",{},()=>[(0,i.eW)((0,m.v_)(s.error),1)],!0)])):(0,i.Q3)("",!0)])}var Cl={name:"BaseDateField",props:{modelValue:{type:String,default:""},id:{type:String,required:!0},label:{type:String,required:!0},min:String,max:String,required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},error:{type:[String,Boolean],default:!1}}};const Sl=(0,o.A)(Cl,[["render",wl],["__scopeId","data-v-36e131ee"]]);var xl=Sl;const Dl={class:"form-field"},Fl=["for"],Al={key:0,class:"required"},Ml=["id","value","required","disabled"],El={value:"",disabled:""},Vl=["value"],Il={key:0,class:"form-error"};function _l(e,t,s,a,l,n){return(0,i.uX)(),(0,i.CE)("div",Dl,[(0,i.Lk)("label",{for:s.id,class:"form-label"},[(0,i.eW)((0,m.v_)(s.label),1),s.required?((0,i.uX)(),(0,i.CE)("span",Al,"*")):(0,i.Q3)("",!0)],8,Fl),(0,i.Lk)("select",{id:s.id,class:(0,m.C4)(["form-input",{"input-error":s.error}]),value:s.modelValue,onChange:t[0]||(t[0]=t=>e.$emit("update:modelValue",t.target.value)),required:s.required,disabled:s.disabled},[(0,i.Lk)("option",El,(0,m.v_)(s.placeholder||"Select…"),1),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(s.options,e=>((0,i.uX)(),(0,i.CE)("option",{key:e.value??e,value:e.value??e},(0,m.v_)(e.label??e),9,Vl))),128))],42,Ml),s.error?((0,i.uX)(),(0,i.CE)("div",Il,[(0,i.RG)(e.$slots,"error",{},()=>[(0,i.eW)((0,m.v_)(s.error),1)],!0)])):(0,i.Q3)("",!0)])}var $l={name:"BaseSelectField",props:{modelValue:[String,Number],id:{type:String,required:!0},label:{type:String,required:!0},options:{type:Array,default:()=>[]},placeholder:String,required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},error:{type:[String,Boolean],default:!1}}};const Xl=(0,o.A)($l,[["render",_l],["__scopeId","data-v-b23f79d8"]]);var jl=Xl,Ul={name:"FormPreview",components:{BaseTextField:Hi,BaseTextarea:rl,BaseNumberField:gl,BaseDateField:xl,BaseSelectField:jl},props:{form:{type:Object,required:!0}},data(){return{expandedSections:[]}},computed:{icons(){return ae.A}},created(){this.initializeSections()},watch:{form:{handler(){this.initializeSections()},immediate:!0,deep:!0}},methods:{initializeSections(){this.expandedSections=this.form.sections.map(()=>!0)},toggleSection(e){this.expandedSections[e]=!this.expandedSections[e]}}};const Tl=(0,o.A)(Ul,[["render",Oi],["__scopeId","data-v-4e1d947d"]]);var Nl=Tl;const Rl={key:0,class:"dialog-overlay"},Pl={class:"dialog"},Bl={class:"dialog-content"},Ol={class:"dialog-actions"};function ql(e,t,s,a,l,n){return s.isVisible?((0,i.uX)(),(0,i.CE)("div",Rl,[(0,i.Lk)("div",Pl,[(0,i.Lk)("div",Bl,[(0,i.Lk)("p",null,(0,m.v_)(s.message),1)]),(0,i.Lk)("div",Ol,[(0,i.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>a.closeDialog&&a.closeDialog(...e)),class:"btn-primary"},"OK")])])])):(0,i.Q3)("",!0)}var Kl={name:"CustomDialog",props:{message:{type:String,required:!0},isVisible:{type:Boolean,default:!1}},emits:["close"],setup(e,{emit:t}){function s(){t("close")}return{closeDialog:s}}};const Wl=(0,o.A)(Kl,[["render",ql],["__scopeId","data-v-7db24b27"]]);var zl=Wl;const Ql={class:"tdiff-root"},Gl={key:0,class:"tdiff-empty"},Jl={key:1,class:"tdiff-section"},Yl={key:0,class:"tdiff-block"},Hl={class:"tdiff-list"},Zl={class:"muted"},en={class:"muted"},tn={key:1,class:"tdiff-block"},sn={class:"tdiff-list"},an={class:"tdiff-sublist"},ln={class:"muted"},nn={class:"muted"},rn={key:2,class:"tdiff-block"},on={class:"tdiff-list"},dn={class:"tdiff-sublist"},un={class:"muted"},cn={class:"muted"},pn={key:3,class:"tdiff-block"},mn={class:"tdiff-list"},hn={key:4,class:"tdiff-block"},yn={class:"muted"},gn={class:"tdiff-list"};function fn(e,t,s,a,l,n){return(0,i.uX)(),(0,i.CE)("div",Ql,[n.diff.any?((0,i.uX)(),(0,i.CE)("section",Jl,[n.diff.metadata.any?((0,i.uX)(),(0,i.CE)("div",Yl,[t[5]||(t[5]=(0,i.Lk)("h4",null,"Study",-1)),(0,i.Lk)("ul",Hl,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.diff.metadata.changes,e=>((0,i.uX)(),(0,i.CE)("li",{key:`md-${e.key}`},[t[1]||(t[1]=(0,i.Lk)("em",null,"Changed",-1)),t[2]||(t[2]=(0,i.eW)()),(0,i.Lk)("strong",null,(0,m.v_)(e.label),1),t[3]||(t[3]=(0,i.eW)(": ",-1)),(0,i.Lk)("span",Zl,(0,m.v_)(n.showAny(e.from)),1),t[4]||(t[4]=(0,i.Lk)("span",{class:"arr"},"→",-1)),(0,i.Lk)("span",en,(0,m.v_)(n.showAny(e.to)),1)]))),128))])])):(0,i.Q3)("",!0),n.diff.groups.any?((0,i.uX)(),(0,i.CE)("div",tn,[t[18]||(t[18]=(0,i.Lk)("h4",null,"Groups",-1)),(0,i.Lk)("ul",sn,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.diff.groups.added,e=>((0,i.uX)(),(0,i.CE)("li",{key:`ga-${e}`},[t[6]||(t[6]=(0,i.Lk)("em",null,"Added",-1)),t[7]||(t[7]=(0,i.eW)()),(0,i.Lk)("strong",null,(0,m.v_)(e),1)]))),128)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.diff.groups.removed,e=>((0,i.uX)(),(0,i.CE)("li",{key:`gr-${e}`},[t[8]||(t[8]=(0,i.Lk)("em",null,"Removed",-1)),t[9]||(t[9]=(0,i.eW)()),(0,i.Lk)("strong",null,(0,m.v_)(e),1)]))),128)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.diff.groups.renamed,e=>((0,i.uX)(),(0,i.CE)("li",{key:`gren-${e.from}-${e.to}`},[t[10]||(t[10]=(0,i.Lk)("em",null,"Renamed",-1)),t[11]||(t[11]=(0,i.eW)()),(0,i.Lk)("strong",null,(0,m.v_)(e.from),1),t[12]||(t[12]=(0,i.eW)()),t[13]||(t[13]=(0,i.Lk)("span",{class:"arr"},"→",-1)),t[14]||(t[14]=(0,i.eW)()),(0,i.Lk)("strong",null,(0,m.v_)(e.to),1)]))),128)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.diff.groups.changed,e=>((0,i.uX)(),(0,i.CE)("li",{key:`gchg-${e.name}`},[t[16]||(t[16]=(0,i.Lk)("em",null,"Updated",-1)),t[17]||(t[17]=(0,i.eW)()),(0,i.Lk)("strong",null,(0,m.v_)(e.name),1),(0,i.Lk)("ul",an,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.fields,s=>((0,i.uX)(),(0,i.CE)("li",{key:`gchg-${e.name}-${s.key}`},[(0,i.eW)((0,m.v_)(s.label)+": ",1),(0,i.Lk)("span",ln,(0,m.v_)(n.showAny(s.from)),1),t[15]||(t[15]=(0,i.Lk)("span",{class:"arr"},"→",-1)),(0,i.Lk)("span",nn,(0,m.v_)(n.showAny(s.to)),1)]))),128))])]))),128))])])):(0,i.Q3)("",!0),n.diff.visits.any?((0,i.uX)(),(0,i.CE)("div",rn,[t[31]||(t[31]=(0,i.Lk)("h4",null,"Visits",-1)),(0,i.Lk)("ul",on,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.diff.visits.added,e=>((0,i.uX)(),(0,i.CE)("li",{key:`va-${e}`},[t[19]||(t[19]=(0,i.Lk)("em",null,"Added",-1)),t[20]||(t[20]=(0,i.eW)()),(0,i.Lk)("strong",null,(0,m.v_)(e),1)]))),128)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.diff.visits.removed,e=>((0,i.uX)(),(0,i.CE)("li",{key:`vr-${e}`},[t[21]||(t[21]=(0,i.Lk)("em",null,"Removed",-1)),t[22]||(t[22]=(0,i.eW)()),(0,i.Lk)("strong",null,(0,m.v_)(e),1)]))),128)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.diff.visits.renamed,e=>((0,i.uX)(),(0,i.CE)("li",{key:`vren-${e.from}-${e.to}`},[t[23]||(t[23]=(0,i.Lk)("em",null,"Renamed",-1)),t[24]||(t[24]=(0,i.eW)()),(0,i.Lk)("strong",null,(0,m.v_)(e.from),1),t[25]||(t[25]=(0,i.eW)()),t[26]||(t[26]=(0,i.Lk)("span",{class:"arr"},"→",-1)),t[27]||(t[27]=(0,i.eW)()),(0,i.Lk)("strong",null,(0,m.v_)(e.to),1)]))),128)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.diff.visits.changed,e=>((0,i.uX)(),(0,i.CE)("li",{key:`vchg-${e.name}`},[t[29]||(t[29]=(0,i.Lk)("em",null,"Updated",-1)),t[30]||(t[30]=(0,i.eW)()),(0,i.Lk)("strong",null,(0,m.v_)(e.name),1),(0,i.Lk)("ul",dn,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.fields,s=>((0,i.uX)(),(0,i.CE)("li",{key:`vchg-${e.name}-${s.key}`},[(0,i.eW)((0,m.v_)(s.label)+": ",1),(0,i.Lk)("span",un,(0,m.v_)(n.showAny(s.from)),1),t[28]||(t[28]=(0,i.Lk)("span",{class:"arr"},"→",-1)),(0,i.Lk)("span",cn,(0,m.v_)(n.showAny(s.to)),1)]))),128))])]))),128))])])):(0,i.Q3)("",!0),n.diff.models.meta.any?((0,i.uX)(),(0,i.CE)("div",pn,[t[41]||(t[41]=(0,i.Lk)("h4",null,"Data Models",-1)),(0,i.Lk)("ul",mn,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.diff.models.meta.added,e=>((0,i.uX)(),(0,i.CE)("li",{key:`ma-${e}`},[t[32]||(t[32]=(0,i.Lk)("em",null,"Added",-1)),t[33]||(t[33]=(0,i.eW)()),(0,i.Lk)("strong",null,(0,m.v_)(e),1)]))),128)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.diff.models.meta.removed,e=>((0,i.uX)(),(0,i.CE)("li",{key:`mr-${e}`},[t[34]||(t[34]=(0,i.Lk)("em",null,"Removed",-1)),t[35]||(t[35]=(0,i.eW)()),(0,i.Lk)("strong",null,(0,m.v_)(e),1)]))),128)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.diff.models.meta.renamed,e=>((0,i.uX)(),(0,i.CE)("li",{key:`mren-${e.from}-${e.to}`},[t[36]||(t[36]=(0,i.Lk)("em",null,"Renamed",-1)),t[37]||(t[37]=(0,i.eW)()),(0,i.Lk)("strong",null,(0,m.v_)(e.from),1),t[38]||(t[38]=(0,i.eW)()),t[39]||(t[39]=(0,i.Lk)("span",{class:"arr"},"→",-1)),t[40]||(t[40]=(0,i.eW)()),(0,i.Lk)("strong",null,(0,m.v_)(e.to),1)]))),128))])])):(0,i.Q3)("",!0),n.diff.models.assign.any?((0,i.uX)(),(0,i.CE)("div",hn,[t[45]||(t[45]=(0,i.Lk)("h4",null,"Model Assignments",-1)),(0,i.Lk)("p",yn,[t[42]||(t[42]=(0,i.eW)(" Turned ON: ",-1)),(0,i.Lk)("strong",null,(0,m.v_)(n.diff.models.assign.turnedOn),1),t[43]||(t[43]=(0,i.eW)(", Turned OFF: ",-1)),(0,i.Lk)("strong",null,(0,m.v_)(n.diff.models.assign.turnedOff),1)]),(0,i.Lk)("details",null,[t[44]||(t[44]=(0,i.Lk)("summary",null,"Details",-1)),(0,i.Lk)("ul",gn,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.diff.models.assign.toggles,e=>((0,i.uX)(),(0,i.CE)("li",{key:e.key},[(0,i.Lk)("strong",null,(0,m.v_)(e.section),1),(0,i.eW)(" @ "+(0,m.v_)(e.visit)+" / "+(0,m.v_)(e.group)+" — ",1),(0,i.Lk)("em",null,(0,m.v_)(e.to?"Enabled":"Disabled"),1)]))),128))])])])):(0,i.Q3)("",!0)])):((0,i.uX)(),(0,i.CE)("div",Gl,[...t[0]||(t[0]=[(0,i.Lk)("em",null,"No changes detected.",-1)])]))])}s(2404),s(8004),s(3853),s(5876),s(2475),s(5024),s(1698);function vn(e){return JSON.parse(JSON.stringify(e??null))}function kn(e){return e?"string"===typeof e?e.trim():"object"===typeof e?String(e.name||e.title||"").trim():String(e).trim():""}function bn(e){const t=Array.isArray(e)?e:[];return t.map(e=>"string"===typeof e?{name:e}:e)}function Ln(e){return null==e?"":"string"===typeof e?e.trim():e}function wn(e,t){const s=Ln(e),a=Ln(t);return s===a}function Cn(e){const t=Array.isArray(e)?e:[];return t.map(e=>{if("string"===typeof e)return{id:e.trim(),group:""};if(Array.isArray(e)){const t=(e[0]??"").toString().trim(),s=(e[1]??"").toString().trim();return{id:t,group:s}}if("object"===typeof e&&e){const t=(e.id??e[0]??"").toString().trim(),s=(e.group??e[1]??e.assignment??"").toString().trim();return{id:t,group:s}}return{id:"",group:""}}).filter(e=>e.id)}function Sn(e){const t=Array.isArray(e)?e:[];return t.map(e=>"string"===typeof e?{title:e}:e)}function xn(e){const t=vn(e||{}),s=t.study&&"object"===typeof t.study?t.study:{};return t.study={...s,title:Ln(s.title??t.title),description:Ln(s.description??t.description)},t.groups=bn(t.groups),t.visits=bn(t.visits),t.selectedModels=Sn(t.selectedModels??t.models??[]),t.assignments=Array.isArray(t.assignments)?t.assignments:[],t.subjects=Cn(t.subjects),t}function Dn(e,t){e=e||"",t=t||"";const s=e.length,a=t.length,i=Array.from({length:s+1},()=>Array(a+1).fill(0));for(let l=0;l<=s;l++)i[l][0]=l;for(let l=0;l<=a;l++)i[0][l]=l;for(let l=1;l<=s;l++)for(let s=1;s<=a;s++){const a=e[l-1]===t[s-1]?0:1;i[l][s]=Math.min(i[l-1][s]+1,i[l][s-1]+1,i[l-1][s-1]+a)}return i[s][a]}function Fn(e,t){const s=Math.max((e||"").length,(t||"").length)||1;return 1-Dn((e||"").toLowerCase(),(t||"").toLowerCase())/s}function An(e,t){const s=new Map;return(e||[]).forEach((e,a)=>s.set(t(e,a),{item:e,idx:a})),s}function Mn(e,t,s){const a=(e||[]).map(s),i=(t||[]).map(s),l=new Set(a),n=new Set(i),r=i.filter(e=>!l.has(e)),o=a.filter(e=>!n.has(e)),d=[],u=[],c=[],p=new Set;o.forEach(e=>{let t={name:null,score:0,j:-1};r.forEach((s,a)=>{if(p.has(a))return;const i=Fn(e,s);i>t.score&&(t={name:s,score:i,j:a})}),t.score>=.6&&t.j>=0?(p.add(t.j),d.push({from:e,to:t.name,score:Number(t.score.toFixed(2))})):c.push(e)}),r.forEach((e,t)=>{p.has(t)||u.push(e)});const m=[],h=An(e||[],e=>s(e)),y=An(t||[],e=>s(e));return n.forEach(e=>{if(l.has(e)){const t=h.get(e)?.item||{},s=y.get(e)?.item||{},a=[],i=new Set([...Object.keys(t||{}),...Object.keys(s||{})]);i.forEach(e=>{if("name"===e||"title"===e)return;const i=t?.[e],l=s?.[e],n=null==i||"object"!==typeof i,r=null==l||"object"!==typeof l;if(n&&r&&!wn(i,l)){const t=e.replace(/[_-]+/g," ").replace(/\b\w/g,e=>e.toUpperCase());a.push({key:e,label:t,from:i??"",to:l??""})}}),a.length&&m.push({name:e,fields:a})}}),{any:!!(u.length||c.length||d.length||m.length),added:u,removed:c,renamed:d,changed:m}}function En(e,t){const s=e.study||{},a=t.study||{},i=[],l=(e,t,s,a)=>{wn(s,a)||i.push({key:e,label:t,from:s??"",to:a??""})};l("title","Title",s.title,a.title),l("description","Description",s.description,a.description);const n=new Set([...Object.keys(s||{}),...Object.keys(a||{})]);return n.forEach(e=>{if("title"===e||"description"===e||"id"===e)return;const t=s?.[e],l=a?.[e],n=null==t||"object"!==typeof t,r=null==l||"object"!==typeof l;if(n&&r&&!wn(t,l)){const s=e.replace(/[_-]+/g," ").replace(/\b\w/g,e=>e.toUpperCase());i.push({key:e,label:s,from:t??"",to:l??""})}}),{any:i.length>0,changes:i}}function Vn(e,t){const s=Cn(e),a=Cn(t),i=new Set(s.map(e=>e.id)),l=new Set(a.map(e=>e.id)),n=[...l].filter(e=>!i.has(e)),r=[...i].filter(e=>!l.has(e)),o=new Map(s.map(e=>[e.id,e])),d=new Map(a.map(e=>[e.id,e])),u=[];return[...l].forEach(e=>{if(i.has(e)){const t=o.get(e)?.group??"",s=d.get(e)?.group??"";wn(t,s)||u.push({id:e,from:t,to:s})}}),{any:!!(n.length||r.length||u.length),added:n,removed:r,reassigned:u}}function In(e,t){return Mn(e||[],t||[],e=>kn(e))}function _n(e,t,s,a,i,l,n,r){const o=An(e||[],e=>kn(e)),d=An(t||[],e=>kn(e)),u=(i||[]).map(e=>kn(e)),c=(l||[]).map(e=>kn(e)),p=(n||[]).map(e=>kn(e)),m=(r||[]).map(e=>kn(e)),h=[];let y=0,g=0;return d.forEach((e,t)=>{if(!o.has(t))return;const i=e.idx,l=o.get(t).idx,n=Math.min((s?.[l]||[]).length,(a?.[i]||[]).length),r=Math.max(0,...(s?.[l]||[]).map(e=>(e||[]).length),0),d=Math.max(0,...(a?.[i]||[]).map(e=>(e||[]).length),0),f=Math.min(r,d);for(let o=0;o<n;o++)for(let e=0;e<f;e++){const n=!!s?.[l]?.[o]?.[e],r=!!a?.[i]?.[o]?.[e];n!==r&&(r?y++:g++,h.push({key:`${t}|v${o}|g${e}`,section:t,visit:c[o]??u[o]??`Visit ${o+1}`,group:m[e]??p[e]??`Group ${e+1}`,from:n,to:r}))}}),{any:h.length>0,toggles:h,turnedOn:y,turnedOff:g}}function $n(e,t){const s=xn(e),a=xn(t),i=En(s,a),l=Mn(s.groups,a.groups,e=>kn(e)),n=Mn(s.visits,a.visits,e=>kn(e)),r=Vn(s.subjects,a.subjects),o=In(s.selectedModels,a.selectedModels),d=_n(s.selectedModels,a.selectedModels,s.assignments,a.assignments,s.visits,a.visits,s.groups,a.groups),u=(l.added?.length||0)>0||(l.removed?.length||0)>0||(l.renamed?.length||0)>0,c=(n.added?.length||0)>0||(n.removed?.length||0)>0||(n.renamed?.length||0)>0,p=(o.added?.length||0)>0||(o.removed?.length||0)>0||(o.renamed?.length||0)>0,m=!!d.any,h=u||c||p||m;return{any:i.any||l.any||n.any||r.any||o.any||d.any,anyStructural:h,metadata:i,groups:l,visits:n,subjects:r,models:{meta:o,assign:d}}}function Xn(e){if(!e||!e.any)return"No changes.";const t=[],s=(e,t)=>`${e} ${t}${1===e?"":"s"}`,a=(e,s)=>{if(!s)return;const a=[];Array.isArray(s.added)&&s.added.length&&a.push(`Added ${s.added.length}`),Array.isArray(s.removed)&&s.removed.length&&a.push(`Removed ${s.removed.length}`),Array.isArray(s.renamed)&&s.renamed.length&&a.push(`Renamed ${s.renamed.length}`),Array.isArray(s.changed)&&s.changed.length&&a.push(`Updated ${s.changed.length}`),a.length&&t.push(`${e}: ${a.join(", ")}`)};if(e.metadata?.any){const a=e.metadata.changes?.length||0;t.push(`Study: Updated ${s(a,"field")}`)}a("Groups",e.groups),a("Visits",e.visits);const i=e.subjects||{},l=[];return Array.isArray(i.added)&&i.added.length&&l.push(`Added ${i.added.length}`),Array.isArray(i.removed)&&i.removed.length&&l.push(`Removed ${i.removed.length}`),Array.isArray(i.reassigned)&&i.reassigned.length&&l.push(`Moved ${i.reassigned.length}`),l.length&&t.push(`Subjects: ${l.join(", ")}`),a("Data Models",e.models?.meta),e.models?.assign?.any&&t.push(`Assignments: Turned ON ${e.models.assign.turnedOn}, Turned OFF ${e.models.assign.turnedOff}`),t.join(" | ")}var jn={name:"TemplateDiffView",props:{from:{type:Object,required:!0},to:{type:Object,required:!0},compact:{type:Boolean,default:!1}},computed:{diff(){return $n(this.from,this.to)}},methods:{showAny(e){const t=Ln(e);return""===t?"—":"boolean"===typeof t?t?"Yes":"No":Array.isArray(t)?t.length?JSON.stringify(t):"—":"object"===typeof t?Object.keys(t).length?JSON.stringify(t):"—":String(t)}}};const Un=(0,o.A)(jn,[["render",fn],["__scopeId","data-v-e60d7480"]]);var Tn=Un,Nn={name:"ProtocolMatrix",components:{FormPreview:Nl,CustomDialog:zl,TemplateDiffView:Tn},props:{visits:{type:Array,required:!0},groups:{type:Array,required:!0},selectedModels:{type:Array,required:!0},assignments:{type:Array,required:!0}},emits:["assignment-updated","edit-template"],setup(e,{emit:t}){const s=(0,p.rd)(),a=(0,Vi.Pj)(),l=(0,i.EW)(()=>!!a.state.studyDetails?.study_metadata?.id),n=(0,aa.KR)(0),r=(0,aa.KR)(!1),o=(0,aa.KR)(0),d=(0,aa.KR)(0),u=(0,aa.KR)(!1),c=(0,aa.KR)(!1),m=(0,aa.KR)(""),h=(0,aa.KR)(!1),y=(0,aa.KR)([]),g=(0,aa.KR)(!1),f=(0,aa.KR)(!1),v=(0,aa.KR)(null),k=(0,aa.KR)(null),b=(0,aa.KR)(null),L=(0,aa.KR)(!1),w=(0,i.EW)(()=>e.visits.length?e.visits:[{name:"All Visits"}]),C=(0,i.EW)(()=>e.groups.length?e.groups:[{name:"All Groups"}]);function S(e,s,a,i){t("assignment-updated",{mIdx:e,vIdx:s,gIdx:a,checked:i})}function x(){n.value>0&&n.value--}function D(){n.value<w.value.length-1&&n.value++}function F(t){return C.value.map((e,t)=>t).filter(s=>e.selectedModels.some((a,i)=>e.assignments[i][t]?.[s]))}const A=(0,i.EW)(()=>F(o.value)),M=(0,i.EW)(()=>A.value.indexOf(d.value));function E(e){const t=F(e);d.value=t.length?t[0]:0}function V(){o.value>0&&(o.value--,E(o.value))}function I(){o.value<w.value.length-1&&(o.value++,E(o.value))}function _(){M.value>0&&(d.value=A.value[M.value-1])}function $(){M.value<A.value.length-1&&(d.value=A.value[M.value+1])}const X=(0,i.EW)(()=>{const t=w.value[o.value].name,s=C.value[d.value].name,a=e.selectedModels.filter((t,s)=>e.assignments[s][o.value]?.[d.value]).map(e=>({title:e.title,fields:e.fields}));return{formName:`Preview: ${t} / ${s}`,sections:a}});function j(t){return C.value.some((s,a)=>e.selectedModels.some((s,i)=>!0===e.assignments[i]?.[t]?.[a]))}function U(t){return e.groups.some((s,a)=>e.selectedModels.some((s,i)=>!0===e.assignments?.[i]?.[t]?.[a]))}function T(){const t=[],s=e.visits.length;for(let e=0;e<s;e++)U(e)||t.push(e);return t}function N(e){const t=e||{};return{study:t.study||{},groups:t.groups||[],visits:t.visits||[],subjects:t.subjects||[],selectedModels:t.selectedModels||[],assignments:t.assignments||[]}}function R(){const t=a.state.studyDetails||{};return{study:t.study||{},groups:vn(e.groups||[]),visits:vn(e.visits||[]),subjects:t.subjects||[],selectedModels:vn(e.selectedModels||[]),assignments:vn(e.assignments||[])}}async function P(){const e=a.state.studyDetails?.study_metadata?.id;if(e)try{const t=await se.A.get(`/forms/studies/${e}`,{headers:{Authorization:`Bearer ${a.state.token}`}}),s=t.data||{},i=s.metadata||{},l=s.content?.study_data||{};b.value={study:{id:i.id,title:(l.study?.title??i.study_name)||"",description:(l.study?.description??i.study_description)||""},groups:l.groups||[],visits:l.visits||[],subjects:l.subjects||[],selectedModels:l.selectedModels||[],assignments:l.assignments||[]}}catch(t){b.value=R()}else b.value=R()}async function B(){const e=a.state.studyDetails?.study_metadata?.id;if(e)try{const t=await se.A.get(`/forms/studies/${e}/data_entries`,{headers:{Authorization:`Bearer ${a.state.token}`}}),s=Array.isArray(t.data)?t.data:t.data?.entries||[];L.value=s.length>0}catch(t){L.value=!1}else L.value=!1}async function O(){const e=T();if(e.length>0)return y.value=e,void(h.value=!0);if(l.value){const e=N(b.value),t=R(),s=$n(e,t),a=L.value&&s.anyStructural;if(a)return v.value=e,k.value=t,void(f.value=!0)}await Y()}function q(e){m.value=e,c.value=!0}function K(){c.value=!1,m.value=""}function W(){f.value=!1}async function z(){f.value=!1,await Y()}function Q(){h.value=!1}function G(){y.value.length&&(n.value=y.value[0]),h.value=!1}async function J(){g.value=!0;try{await Y()}finally{g.value=!1,h.value=!1}}async function Y(){const t=a.state.studyDetails||{},s=a.state.user?.id,i=t.study_metadata?.id;if(!s)return void q("Please log in again.");const l=t.study_metadata||{},n=i?{created_by:l.created_by??s,study_name:t.study?.title??l.study_name??l.name??"",study_description:t.study?.description??l.study_description??l.description??""}:{created_by:s,study_name:t.study?.title??"",study_description:t.study?.description??""},r={study:{...t.study||{},title:t.study?.title??n.study_name??"",description:t.study?.description??n.study_description??""},groups:e.groups,visits:e.visits,subjects:Array.isArray(t.subjects)?t.subjects:[],selectedModels:e.selectedModels,assignments:e.assignments,subjectCount:t.subjectCount??0,assignmentMethod:t.assignmentMethod??"random"},o={study_metadata:n,study_content:{study_data:r}},d=i?`/forms/studies/${i}`:"/forms/studies/",u=i?"put":"post";try{const e={headers:{Authorization:`Bearer ${a.state.token}`}},t=await se.A[u](d,o,e),s=t.data.study_metadata||t.data.metadata||n,l=t.data.content?.study_data||r;a.commit("setStudyDetails",{study_metadata:{id:i||s?.id,study_name:s.study_name,name:s.study_name,description:s.study_description,study_description:s.study_description,created_at:s.created_at,updated_at:s.updated_at,created_by:s.created_by},study:{id:i||s?.id,...l.study||{}},groups:l.groups||[],visits:l.visits||[],subjectCount:l.subjectCount??0,assignmentMethod:l.assignmentMethod??"random",subjects:l.subjects||[],assignments:l.assignments||[],selectedModels:l.selectedModels||[]}),await Promise.all([P(),B()]),q(i?"Study successfully updated!":"Study successfully saved!")}catch(c){console.error(`Error ${i?"updating":"saving"} study:`,c),q(`Failed to ${i?"update":"save"} study. Check console for details.`)}}function H(){j(n.value)&&(o.value=n.value,E(n.value),r.value=!0)}function Z(){r.value=!1}function ee(){s.push({name:"Dashboard",query:{openStudies:"true"}})}return(0,i.sV)(async()=>{await Promise.all([P(),B()])}),{icons:ae.A,visitList:w,groupList:C,isEditing:l,currentVisitIndex:n,prevVisit:x,nextVisit:D,showPreviewModal:r,previewVisitIndex:o,previewGroupIndex:d,assignedGroups:A,previewGroupPos:M,prevPreviewVisit:V,nextPreviewVisit:I,prevPreviewGroup:_,nextPreviewGroup:$,openPreview:H,closePreview:Z,previewForm:X,onToggle:S,hasAssignment:j,showInfo:u,showDialog:c,dialogMessage:m,closeDialog:K,showEmptyVisitsModal:h,emptyVisitIndices:y,isSavingInProgress:g,closeEmptyVisitsModal:Q,goToFirstEmptyVisit:G,saveAnyway:J,showConfirmChanges:f,cancelConfirm:W,confirmAndSave:z,snapshotFrom:v,snapshotTo:k,saveStudy:O,goToSaved:ee}}};const Rn=(0,o.A)(Nn,[["render",Ei],["__scopeId","data-v-5c0b0e0b"]]);var Pn=Rn;const Bn={class:"constraints-edit-modal"},On={class:"head"},qn={class:"type-chip"},Kn={class:"group"},Wn={key:0,class:"row"},zn={class:"choice-row"},Qn={class:"chk"},Gn={class:"chk"},Jn={class:"row"},Yn={class:"chk"},Hn={class:"chk"},Zn={key:1,class:"row"},er={class:"row"},tr={key:2,class:"row"},sr={key:3,class:"row"},ar=["value"],ir={key:1,class:"chips"},lr={class:"chip-input-row"},nr={id:"radio-options"},rr=["value"],or={class:"chip-group"},dr=["onClick"],ur={key:5,class:"chk"},cr={key:7,class:"err"},pr={key:0,class:"group"},mr={class:"row two"},hr={class:"row"},yr={class:"row"},gr={key:1,class:"group"},fr={class:"row two"},vr={class:"row"},kr={class:"row"},br={class:"chk"},Lr={class:"row two"},wr={key:2,class:"group"},Cr={class:"row two"},Sr={key:3,class:"group"},xr={class:"row"},Dr=["value"],Fr={class:"row two"},Ar={class:"row"},Mr={key:0,class:"err"},Er={key:4,class:"group"},Vr={class:"row"},Ir={class:"row two"},_r={class:"row"},$r={class:"chk"},Xr={class:"row"},jr={class:"chips"},Ur={class:"chip-group"},Tr=["value"],Nr=["onClick"],Rr={class:"chip-input-row add-mod-row"},Pr={key:5,class:"group"},Br={class:"row two"},Or=["disabled"],qr=["disabled"],Kr={class:"row two"},Wr={class:"chk"},zr={class:"row"},Qr={class:"options-scroll"},Gr={class:"opt-row"},Jr=["min","max","step"],Yr={class:"opt-row"},Hr={class:"opt-index"},Zr=["value"],eo=["onClick"],to={key:6,class:"group"},so={class:"row two"},ao={class:"row two"},io={key:0,class:"row note"},lo={class:"err"},no={key:7,class:"group"},ro={class:"row"},oo={key:0,class:"chk"},uo={class:"row two"},co={class:"quick"},po=["disabled"],mo={class:"options-scroll"},ho={class:"opt-index"},yo=["onUpdate:modelValue"],go=["onClick","disabled"],fo={key:0,class:"row note"},vo={key:8,class:"group"},ko={class:"modal-actions"},bo=["disabled"];function Lo(e,t,s,l,n,r){const o=(0,i.g2)("FieldTime"),d=(0,i.g2)("DateFormatPicker");return(0,i.uX)(),(0,i.CE)("div",Bn,[(0,i.Lk)("div",On,[t[59]||(t[59]=(0,i.Lk)("h3",null,"Field Settings & Constraints",-1)),(0,i.Lk)("span",qn,(0,m.v_)(r.currentTypeLabel),1)]),(0,i.Lk)("section",Kn,[r.isSlider?((0,i.uX)(),(0,i.CE)("div",Wn,[t[62]||(t[62]=(0,i.Lk)("label",null,"Control type",-1)),(0,i.Lk)("div",zn,[(0,i.Lk)("label",Qn,[(0,i.bo)((0,i.Lk)("input",{type:"radio",value:"slider","onUpdate:modelValue":t[0]||(t[0]=e=>n.local.mode=e)},null,512),[[a.XL,n.local.mode]]),t[60]||(t[60]=(0,i.eW)(" Slider ",-1))]),(0,i.Lk)("label",Gn,[(0,i.bo)((0,i.Lk)("input",{type:"radio",value:"linear","onUpdate:modelValue":t[1]||(t[1]=e=>n.local.mode=e)},null,512),[[a.XL,n.local.mode]]),t[61]||(t[61]=(0,i.eW)(" Likert scale ",-1))])])])):(0,i.Q3)("",!0),(0,i.Lk)("div",Jn,[(0,i.Lk)("label",Yn,[(0,i.bo)((0,i.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=e=>n.local.required=e)},null,512),[[a.lH,n.local.required]]),t[63]||(t[63]=(0,i.eW)(" Required ",-1))]),(0,i.Lk)("label",Hn,[(0,i.bo)((0,i.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>n.local.readonly=e)},null,512),[[a.lH,n.local.readonly]]),t[64]||(t[64]=(0,i.eW)(" Readonly ",-1))])]),r.isCheckbox||r.isSlider&&"slider"===n.local.mode||r.isFile?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",Zn,[t[65]||(t[65]=(0,i.Lk)("label",null,"Placeholder",-1)),(0,i.bo)((0,i.Lk)("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>n.local.placeholder=e),placeholder:"Shown when empty"},null,512),[[a.Jo,n.local.placeholder]])])),(0,i.Lk)("div",er,[t[66]||(t[66]=(0,i.Lk)("label",null,"Help text",-1)),(0,i.bo)((0,i.Lk)("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=e=>n.local.helpText=e),placeholder:"Shown below the control"},null,512),[[a.Jo,n.local.helpText]])]),r.isTime?((0,i.uX)(),(0,i.CE)("div",tr,[t[68]||(t[68]=(0,i.Lk)("label",null,"Hour format",-1)),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>n.local.hourCycle=e)},[...t[67]||(t[67]=[(0,i.Lk)("option",{value:"24"},"24-hour",-1),(0,i.Lk)("option",{value:"12"},"12-hour (AM/PM)",-1)])],512),[[a.u1,n.local.hourCycle]])])):(0,i.Q3)("",!0),r.isDate||r.isSlider&&"slider"===n.local.mode||r.isFile?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",sr,[t[72]||(t[72]=(0,i.Lk)("label",null,"Default value",-1)),r.isChoice&&!n.local.allowMultiple?(0,i.bo)(((0,i.uX)(),(0,i.CE)("select",{key:0,"onUpdate:modelValue":t[7]||(t[7]=e=>n.local.defaultValue=e)},[t[69]||(t[69]=(0,i.Lk)("option",{value:""},"(none)",-1)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.localOptions,(e,t)=>((0,i.uX)(),(0,i.CE)("option",{key:t,value:e},(0,m.v_)(e),9,ar))),128))],512)),[[a.u1,n.local.defaultValue]]):r.isRadio&&n.local.allowMultiple?((0,i.uX)(),(0,i.CE)("div",ir,[(0,i.Lk)("div",lr,[(0,i.bo)((0,i.Lk)("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=e=>n.chipInput=e),placeholder:"Type option and press Enter",onKeydown:t[9]||(t[9]=(0,a.jR)((0,a.D$)((...e)=>r.addChip&&r.addChip(...e),["prevent"]),["enter"])),list:"radio-options"},null,544),[[a.Jo,n.chipInput]]),(0,i.Lk)("datalist",nr,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.localOptions,(e,t)=>((0,i.uX)(),(0,i.CE)("option",{key:t,value:e},null,8,rr))),128))])]),(0,i.Lk)("div",or,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(Array.isArray(n.local.defaultValue)?n.local.defaultValue:[],(e,t)=>((0,i.uX)(),(0,i.CE)("span",{key:t,class:"chip"},[(0,i.eW)((0,m.v_)(e)+" ",1),(0,i.Lk)("button",{class:"chip-x",onClick:(0,a.D$)(e=>r.removeChip(t),["prevent"])},"×",8,dr)]))),128))]),t[70]||(t[70]=(0,i.Lk)("small",{class:"note"},"Press Enter to add; duplicates are ignored.",-1))])):r.isTextLike?(0,i.bo)(((0,i.uX)(),(0,i.CE)("input",{key:2,type:"text","onUpdate:modelValue":t[10]||(t[10]=e=>n.local.defaultValue=e),placeholder:"Default value"},null,512)),[[a.Jo,n.local.defaultValue]]):r.isNumber?(0,i.bo)(((0,i.uX)(),(0,i.CE)("input",{key:3,type:"number","onUpdate:modelValue":t[11]||(t[11]=e=>n.local.defaultValue=e),placeholder:"Default number"},null,512)),[[a.Jo,n.local.defaultValue,void 0,{number:!0}]]):r.isTime?((0,i.uX)(),(0,i.Wv)(o,{key:4,modelValue:n.local.defaultValue,"onUpdate:modelValue":t[12]||(t[12]=e=>n.local.defaultValue=e),hourCycle:n.local.hourCycle||"24",readonly:!1,disabled:!1},null,8,["modelValue","hourCycle"])):r.isCheckbox?((0,i.uX)(),(0,i.CE)("label",ur,[(0,i.bo)((0,i.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[13]||(t[13]=e=>n.local.defaultValue=e)},null,512),[[a.lH,n.local.defaultValue]]),t[71]||(t[71]=(0,i.eW)(" Checked by default ",-1))])):(0,i.bo)(((0,i.uX)(),(0,i.CE)("input",{key:6,type:"text","onUpdate:modelValue":t[14]||(t[14]=e=>n.local.defaultValue=e),placeholder:"Default value"},null,512)),[[a.Jo,n.local.defaultValue]]),r.defaultError&&!r.isDate?((0,i.uX)(),(0,i.CE)("small",cr,(0,m.v_)(r.defaultError),1)):(0,i.Q3)("",!0)]))]),r.isTextLike?((0,i.uX)(),(0,i.CE)("section",pr,[(0,i.Lk)("div",mr,[(0,i.Lk)("div",null,[t[73]||(t[73]=(0,i.Lk)("label",null,"Min length",-1)),(0,i.bo)((0,i.Lk)("input",{type:"number","onUpdate:modelValue":t[15]||(t[15]=e=>n.local.minLength=e),min:"0"},null,512),[[a.Jo,n.local.minLength,void 0,{number:!0}]])]),(0,i.Lk)("div",null,[t[74]||(t[74]=(0,i.Lk)("label",null,"Max length",-1)),(0,i.bo)((0,i.Lk)("input",{type:"number","onUpdate:modelValue":t[16]||(t[16]=e=>n.local.maxLength=e),min:"0"},null,512),[[a.Jo,n.local.maxLength,void 0,{number:!0}]])])]),(0,i.Lk)("div",hr,[t[75]||(t[75]=(0,i.Lk)("label",null,"Regex pattern",-1)),(0,i.bo)((0,i.Lk)("input",{type:"text","onUpdate:modelValue":t[17]||(t[17]=e=>n.local.pattern=e),placeholder:"e.g. ^[A-Za-z]+$"},null,512),[[a.Jo,n.local.pattern]])]),(0,i.Lk)("div",yr,[t[77]||(t[77]=(0,i.Lk)("label",null,"Transform",-1)),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[18]||(t[18]=e=>n.local.transform=e)},[...t[76]||(t[76]=[(0,i.Lk)("option",{value:"none"},"None",-1),(0,i.Lk)("option",{value:"uppercase"},"Uppercase",-1),(0,i.Lk)("option",{value:"lowercase"},"Lowercase",-1),(0,i.Lk)("option",{value:"capitalize"},"Capitalize",-1)])],512),[[a.u1,n.local.transform]])])])):(0,i.Q3)("",!0),r.isNumber?((0,i.uX)(),(0,i.CE)("section",gr,[(0,i.Lk)("div",fr,[(0,i.Lk)("div",null,[t[78]||(t[78]=(0,i.Lk)("label",null,"Min value",-1)),(0,i.bo)((0,i.Lk)("input",{type:"number","onUpdate:modelValue":t[19]||(t[19]=e=>n.local.min=e)},null,512),[[a.Jo,n.local.min,void 0,{number:!0}]])]),(0,i.Lk)("div",null,[t[79]||(t[79]=(0,i.Lk)("label",null,"Max value",-1)),(0,i.bo)((0,i.Lk)("input",{type:"number","onUpdate:modelValue":t[20]||(t[20]=e=>n.local.max=e)},null,512),[[a.Jo,n.local.max,void 0,{number:!0}]])])]),(0,i.Lk)("div",vr,[t[80]||(t[80]=(0,i.Lk)("label",null,"Step",-1)),(0,i.bo)((0,i.Lk)("input",{type:"number","onUpdate:modelValue":t[21]||(t[21]=e=>n.local.step=e),placeholder:"Leave empty if not applicable"},null,512),[[a.Jo,n.local.step,void 0,{number:!0}]])]),(0,i.Lk)("div",kr,[(0,i.Lk)("label",br,[(0,i.bo)((0,i.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[22]||(t[22]=e=>n.local.integerOnly=e)},null,512),[[a.lH,n.local.integerOnly]]),t[81]||(t[81]=(0,i.eW)(" Integer only ",-1))])]),(0,i.Lk)("div",Lr,[(0,i.Lk)("div",null,[t[82]||(t[82]=(0,i.Lk)("label",null,"Min digits (integer part)",-1)),(0,i.bo)((0,i.Lk)("input",{type:"number","onUpdate:modelValue":t[23]||(t[23]=e=>n.local.minDigits=e),min:"0"},null,512),[[a.Jo,n.local.minDigits,void 0,{number:!0}]])]),(0,i.Lk)("div",null,[t[83]||(t[83]=(0,i.Lk)("label",null,"Max digits (integer part)",-1)),(0,i.bo)((0,i.Lk)("input",{type:"number","onUpdate:modelValue":t[24]||(t[24]=e=>n.local.maxDigits=e),min:"0"},null,512),[[a.Jo,n.local.maxDigits,void 0,{number:!0}]])])]),t[84]||(t[84]=(0,i.Lk)("div",{class:"row note"},[(0,i.Lk)("span",null,[(0,i.eW)(" Digit limits apply to the integer part. In preview we enforce these when "),(0,i.Lk)("b",null,"Integer only"),(0,i.eW)(" is checked. For values that need leading zeros, consider a "),(0,i.Lk)("b",null,"Text"),(0,i.eW)(" field with a pattern. ")])],-1))])):(0,i.Q3)("",!0),r.isTime?((0,i.uX)(),(0,i.CE)("section",wr,[(0,i.Lk)("div",Cr,[(0,i.Lk)("div",null,[t[85]||(t[85]=(0,i.Lk)("label",null,"Min time",-1)),(0,i.bF)(o,{modelValue:n.local.minTime,"onUpdate:modelValue":t[25]||(t[25]=e=>n.local.minTime=e),hourCycle:n.local.hourCycle||"24",readonly:!1,disabled:!1,placeholder:"12"===n.local.hourCycle?"hh:mm AM/PM":"HH:mm"},null,8,["modelValue","hourCycle","placeholder"])]),(0,i.Lk)("div",null,[t[86]||(t[86]=(0,i.Lk)("label",null,"Max time",-1)),(0,i.bF)(o,{modelValue:n.local.maxTime,"onUpdate:modelValue":t[26]||(t[26]=e=>n.local.maxTime=e),hourCycle:n.local.hourCycle||"24",readonly:!1,disabled:!1,placeholder:"12"===n.local.hourCycle?"hh:mm AM/PM":"HH:mm"},null,8,["modelValue","hourCycle","placeholder"])])])])):(0,i.Q3)("",!0),r.isDate?((0,i.uX)(),(0,i.CE)("section",Sr,[(0,i.Lk)("div",xr,[t[87]||(t[87]=(0,i.Lk)("label",null,"Date format",-1)),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[27]||(t[27]=e=>n.local.dateFormat=e)},[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.DATE_FORMATS,e=>((0,i.uX)(),(0,i.CE)("option",{key:e,value:e},(0,m.v_)(e),9,Dr))),128))],512),[[a.u1,n.local.dateFormat]])]),(0,i.Lk)("div",Fr,[(0,i.Lk)("div",null,[t[88]||(t[88]=(0,i.Lk)("label",null,"Min date",-1)),(0,i.bF)(d,{modelValue:n.local.minDate,"onUpdate:modelValue":t[28]||(t[28]=e=>n.local.minDate=e),format:n.local.dateFormat,placeholder:n.local.dateFormat},null,8,["modelValue","format","placeholder"])]),(0,i.Lk)("div",null,[t[89]||(t[89]=(0,i.Lk)("label",null,"Max date",-1)),(0,i.bF)(d,{modelValue:n.local.maxDate,"onUpdate:modelValue":t[29]||(t[29]=e=>n.local.maxDate=e),format:n.local.dateFormat,placeholder:n.local.dateFormat},null,8,["modelValue","format","placeholder"])])]),(0,i.Lk)("div",Ar,[t[90]||(t[90]=(0,i.Lk)("label",null,"Default date",-1)),(0,i.bF)(d,{modelValue:n.local.defaultValue,"onUpdate:modelValue":t[30]||(t[30]=e=>n.local.defaultValue=e),format:n.local.dateFormat,placeholder:n.local.dateFormat,"min-date":n.local.minDate||null,"max-date":n.local.maxDate||null},null,8,["modelValue","format","placeholder","min-date","max-date"]),r.defaultError&&r.isDate?((0,i.uX)(),(0,i.CE)("small",Mr,(0,m.v_)(r.defaultError),1)):(0,i.Q3)("",!0)])])):(0,i.Q3)("",!0),r.isFile?((0,i.uX)(),(0,i.CE)("section",Er,[(0,i.Lk)("div",Vr,[t[91]||(t[91]=(0,i.Lk)("label",null,"Allowed formats",-1)),(0,i.bo)((0,i.Lk)("input",{type:"text","onUpdate:modelValue":t[31]||(t[31]=e=>n.allowedFormatsText=e),placeholder:"Examples: .pdf, .csv, .tsv, image/*, application/zip"},null,512),[[a.Jo,n.allowedFormatsText]]),t[92]||(t[92]=(0,i.Lk)("small",{class:"note"}," Comma-separated list. Client validates on upload; re-validate server-side if needed. ",-1))]),(0,i.Lk)("div",Ir,[(0,i.Lk)("div",null,[t[93]||(t[93]=(0,i.Lk)("label",null,"Max size (MB)",-1)),(0,i.bo)((0,i.Lk)("input",{type:"number",min:"1",step:"1","onUpdate:modelValue":t[32]||(t[32]=e=>n.local.maxSizeMB=e)},null,512),[[a.Jo,n.local.maxSizeMB,void 0,{number:!0}]])]),(0,i.Lk)("div",null,[t[95]||(t[95]=(0,i.Lk)("label",null,"Storage behavior",-1)),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[33]||(t[33]=e=>n.local.storagePreference=e)},[...t[94]||(t[94]=[(0,i.Lk)("option",{value:"local"},"Local storage (upload)",-1),(0,i.Lk)("option",{value:"url"},"Link via URL",-1)])],512),[[a.u1,n.local.storagePreference]]),t[96]||(t[96]=(0,i.Lk)("small",{class:"note"},"This decides which input appears in the form.",-1))])]),(0,i.Lk)("div",_r,[(0,i.Lk)("label",$r,[(0,i.bo)((0,i.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[34]||(t[34]=e=>n.local.allowMultipleFiles=e)},null,512),[[a.lH,n.local.allowMultipleFiles]]),t[97]||(t[97]=(0,i.eW)(" Allow multiple files ",-1))])]),(0,i.Lk)("div",Xr,[t[99]||(t[99]=(0,i.Lk)("label",null,"Modalities (BIDS)",-1)),(0,i.Lk)("div",jr,[(0,i.Lk)("div",Ur,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.allModalities,e=>((0,i.uX)(),(0,i.CE)("label",{key:e,class:"chip selectable"},[(0,i.bo)((0,i.Lk)("input",{type:"checkbox",value:e,"onUpdate:modelValue":t[35]||(t[35]=e=>n.local.modalities=e)},null,8,Tr),[[a.lH,n.local.modalities]]),(0,i.eW)(" "+(0,m.v_)(e)+" ",1),r.builtInSet.has(e)?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("button",{key:0,class:"chip-x",onClick:(0,a.D$)(t=>r.removeCustomModByName(e),["prevent"]),title:"Remove custom modality"},"×",8,Nr))]))),128))]),(0,i.Lk)("div",Rr,[(0,i.bo)((0,i.Lk)("input",{type:"text","onUpdate:modelValue":t[36]||(t[36]=e=>n.customMod=e),placeholder:"Custom modality (Enter or +)",onKeydown:t[37]||(t[37]=(0,a.jR)((0,a.D$)((...e)=>r.addCustomMod&&r.addCustomMod(...e),["prevent"]),["enter"]))},null,544),[[a.Jo,n.customMod]]),(0,i.Lk)("button",{type:"button",class:"btn-option add-mod-btn",onClick:t[38]||(t[38]=(...e)=>r.addCustomMod&&r.addCustomMod(...e))},"+")]),t[98]||(t[98]=(0,i.Lk)("small",{class:"note"},"Used to help organize and name files in BIDS folders.",-1))])])])):(0,i.Q3)("",!0),r.isSlider&&"slider"===n.local.mode?((0,i.uX)(),(0,i.CE)("section",Pr,[(0,i.Lk)("div",Br,[(0,i.Lk)("div",null,[t[100]||(t[100]=(0,i.Lk)("label",null,"Min",-1)),(0,i.bo)((0,i.Lk)("input",{type:"number","onUpdate:modelValue":t[39]||(t[39]=e=>n.local.min=e),disabled:n.local.percent},null,8,Or),[[a.Jo,n.local.min,void 0,{number:!0}]])]),(0,i.Lk)("div",null,[t[101]||(t[101]=(0,i.Lk)("label",null,"Max",-1)),(0,i.bo)((0,i.Lk)("input",{type:"number","onUpdate:modelValue":t[40]||(t[40]=e=>n.local.max=e),disabled:n.local.percent},null,8,qr),[[a.Jo,n.local.max,void 0,{number:!0}]])])]),(0,i.Lk)("div",Kr,[(0,i.Lk)("div",null,[t[102]||(t[102]=(0,i.Lk)("label",null,"Step",-1)),(0,i.bo)((0,i.Lk)("input",{type:"number",min:"0.000001",step:"0.000001","onUpdate:modelValue":t[41]||(t[41]=e=>n.local.step=e)},null,512),[[a.Jo,n.local.step,void 0,{number:!0}]])]),(0,i.Lk)("div",null,[(0,i.Lk)("label",Wr,[(0,i.bo)((0,i.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[42]||(t[42]=e=>n.local.percent=e)},null,512),[[a.lH,n.local.percent]]),t[103]||(t[103]=(0,i.eW)(" Show as percentage (1–100) ",-1))])])]),t[108]||(t[108]=(0,i.Lk)("div",{class:"row note"},[(0,i.Lk)("span",null,"No default selection for sliders. Clicking the track jumps to the nearest step.")],-1)),(0,i.Lk)("div",zr,[t[106]||(t[106]=(0,i.Lk)("label",null,"Step labels",-1)),(0,i.Lk)("div",Qr,[(0,i.Lk)("div",Gr,[t[104]||(t[104]=(0,i.Lk)("span",{class:"opt-index"},"#",-1)),(0,i.bo)((0,i.Lk)("input",{type:"number","onUpdate:modelValue":t[43]||(t[43]=e=>n.markEditValue=e),min:r.useMin,max:r.useMax,step:r.useStep,placeholder:"Step value"},null,8,Jr),[[a.Jo,n.markEditValue,void 0,{number:!0}]])]),(0,i.Lk)("div",Yr,[t[105]||(t[105]=(0,i.Lk)("span",{class:"opt-index"},"↳",-1)),(0,i.bo)((0,i.Lk)("input",{type:"text","onUpdate:modelValue":t[44]||(t[44]=e=>n.markEditLabel=e),placeholder:"Label",onKeydown:t[45]||(t[45]=(0,a.jR)((0,a.D$)(e=>r.addOrUpdateMark("slider"),["prevent"]),["enter"]))},null,544),[[a.Jo,n.markEditLabel]]),(0,i.Lk)("button",{class:"icon-btn",title:"Add/Update",onClick:t[46]||(t[46]=(0,a.D$)(e=>r.addOrUpdateMark("slider"),["prevent"]))},"✓")]),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.marksSorted,(e,t)=>((0,i.uX)(),(0,i.CE)("div",{class:"opt-row",key:"s"+t},[(0,i.Lk)("span",Hr,(0,m.v_)(e.value),1),(0,i.Lk)("input",{type:"text",value:e.label,disabled:""},null,8,Zr),(0,i.Lk)("button",{class:"icon-btn",title:"Delete",onClick:(0,a.D$)(t=>r.removeMark(e.value),["prevent"])},"✕",8,eo)]))),128))]),t[107]||(t[107]=(0,i.Lk)("small",{class:"note"},"We only store labels you add; no snap behavior.",-1))])])):(0,i.Q3)("",!0),r.isSlider&&"linear"===n.local.mode?((0,i.uX)(),(0,i.CE)("section",to,[(0,i.Lk)("div",so,[(0,i.Lk)("div",null,[t[109]||(t[109]=(0,i.Lk)("label",null,"Min",-1)),(0,i.bo)((0,i.Lk)("input",{type:"number","onUpdate:modelValue":t[47]||(t[47]=e=>n.local.min=e)},null,512),[[a.Jo,n.local.min,void 0,{number:!0}]])]),(0,i.Lk)("div",null,[t[110]||(t[110]=(0,i.Lk)("label",null,"Max",-1)),(0,i.bo)((0,i.Lk)("input",{type:"number","onUpdate:modelValue":t[48]||(t[48]=e=>n.local.max=e)},null,512),[[a.Jo,n.local.max,void 0,{number:!0}]])])]),(0,i.Lk)("div",ao,[(0,i.Lk)("div",null,[t[111]||(t[111]=(0,i.Lk)("label",null,"Left label",-1)),(0,i.bo)((0,i.Lk)("input",{type:"text","onUpdate:modelValue":t[49]||(t[49]=e=>n.local.leftLabel=e),placeholder:"e.g., Not happy"},null,512),[[a.Jo,n.local.leftLabel]])]),(0,i.Lk)("div",null,[t[112]||(t[112]=(0,i.Lk)("label",null,"Right label",-1)),(0,i.bo)((0,i.Lk)("input",{type:"text","onUpdate:modelValue":t[50]||(t[50]=e=>n.local.rightLabel=e),placeholder:"e.g., Very happy"},null,512),[[a.Jo,n.local.rightLabel]])])]),r.linearCount>n.LINEAR_MAX?((0,i.uX)(),(0,i.CE)("div",io,[(0,i.Lk)("span",lo,"Too many points ("+(0,m.v_)(r.linearCount)+"). Limit is "+(0,m.v_)(n.LINEAR_MAX)+" to avoid clutter.",1)])):(0,i.Q3)("",!0),t[113]||(t[113]=(0,i.Lk)("div",{class:"row note"},[(0,i.Lk)("span",null,"Likert scale shows only endpoints (left/right). No step labels.")],-1))])):(0,i.Q3)("",!0),r.isChoice?((0,i.uX)(),(0,i.CE)("section",no,[(0,i.Lk)("div",ro,[r.isRadio?((0,i.uX)(),(0,i.CE)("label",oo,[(0,i.bo)((0,i.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[51]||(t[51]=e=>n.local.allowMultiple=e)},null,512),[[a.lH,n.local.allowMultiple]]),t[114]||(t[114]=(0,i.eW)(" Allow multiple selections ",-1))])):(0,i.Q3)("",!0)]),(0,i.Lk)("div",uo,[(0,i.Lk)("div",null,[t[115]||(t[115]=(0,i.Lk)("label",null,"Number of options",-1)),(0,i.bo)((0,i.Lk)("input",{type:"number",min:"1","onUpdate:modelValue":t[52]||(t[52]=e=>n.optionsCount=e),onInput:t[53]||(t[53]=(...e)=>r.syncOptionsCount&&r.syncOptionsCount(...e))},null,544),[[a.Jo,n.optionsCount,void 0,{number:!0}]])]),(0,i.Lk)("div",null,[t[116]||(t[116]=(0,i.Lk)("label",null,"Quick add",-1)),(0,i.Lk)("div",co,[(0,i.Lk)("button",{type:"button",class:"btn-option",onClick:t[54]||(t[54]=e=>r.addOption())},"+ Add"),(0,i.Lk)("button",{type:"button",class:"btn-option",onClick:t[55]||(t[55]=e=>r.removeLastOption()),disabled:n.localOptions.length<=1},"− Remove",8,po)])])]),(0,i.Lk)("div",mo,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.localOptions,(e,t)=>((0,i.uX)(),(0,i.CE)("div",{class:"opt-row",key:t},[(0,i.Lk)("span",ho,(0,m.v_)(t+1)+".",1),(0,i.bo)((0,i.Lk)("input",{type:"text","onUpdate:modelValue":e=>n.localOptions[t]=e,placeholder:"Option label"},null,8,yo),[[a.Jo,n.localOptions[t]]]),(0,i.Lk)("button",{class:"icon-btn",title:"Delete",onClick:(0,a.D$)(e=>r.deleteOption(t),["prevent"]),disabled:n.localOptions.length<=1},"✕",8,go)]))),128))]),r.isSelect?((0,i.uX)(),(0,i.CE)("div",fo,[...t[117]||(t[117]=[(0,i.Lk)("span",null,"Dropdowns are single-select in this builder.",-1)])])):(0,i.Q3)("",!0)])):(0,i.Q3)("",!0),r.isCheckbox?((0,i.uX)(),(0,i.CE)("section",vo,[...t[118]||(t[118]=[(0,i.Lk)("div",{class:"row note"},[(0,i.Lk)("span",null,"Checkbox has no placeholder. Use help text for guidance.")],-1)])])):(0,i.Q3)("",!0),(0,i.Lk)("div",ko,[(0,i.Lk)("button",{class:"btn-primary",onClick:t[56]||(t[56]=(...e)=>r.save&&r.save(...e)),disabled:r.isSaveDisabled},"Save",8,bo),(0,i.Lk)("button",{class:"btn-option",onClick:t[57]||(t[57]=(...e)=>r.clearToInitial&&r.clearToInitial(...e))},"Clear"),(0,i.Lk)("button",{class:"btn-option",onClick:t[58]||(t[58]=t=>e.$emit("closeConstraintsDialog"))},"Cancel")])])}function wo(e="text",t){const s=String(e||"text").toLowerCase();if(void 0!==t)switch(s){case"slider":return;case"file":return;case"checkbox":return!!t;case"number":{if(""===t||null===t)return"";const e=Number(t);return Number.isFinite(e)?e:""}case"radio":return Array.isArray(t)?t.map(e=>String(e)):"string"===typeof t?t:"";case"select":return"string"===typeof t?t:"";case"date":case"time":return"string"===typeof t?t:"";case"textarea":case"text":default:return null==t?"":String(t)}}function Co(e="text",t={}){const s={...t||{}};if(Array.isArray(s.options)&&delete s.options,["required","readonly","allowMultiple","allowMultipleFiles","integerOnly","percent","showTicks"].forEach(e=>{e in s&&(s[e]=!!s[e])}),["min","max","step","maxLength","minLength","maxLengthDigits","minDigits","maxDigits"].forEach(e=>{if(e in s&&""!==s[e]&&null!=s[e]){const t=Number(s[e]);s[e]=Number.isFinite(t)?t:void 0}}),"maxLengthDigits"in s&&null!=s.maxLengthDigits&&("maxDigits"in s||(s.maxDigits=s.maxLengthDigits),delete s.maxLengthDigits),"defaultValue"in s&&(s.defaultValue=wo(e,s.defaultValue)),"date"===e&&(["minDate","maxDate"].forEach(e=>{null==s[e]&&(s[e]="")}),s.dateFormat=s.dateFormat||"dd.MM.yyyy"),"time"===e){if("step"in s&&""!==s.step&&null!=s.step){const e=Number(s.step);s.step=Number.isFinite(e)?e:void 0}["minTime","maxTime"].forEach(e=>{e in s&&"string"!==typeof s[e]&&(s[e]="")})}if(["text","textarea"].includes(e)&&("transform"in s&&!["none","uppercase","lowercase","capitalize"].includes(s.transform)&&(s.transform="none"),s.pattern&&"string"!==typeof s.pattern&&delete s.pattern),"checkbox"===e&&delete s.placeholder,"min"in s&&"max"in s&&null!=s.min&&null!=s.max&&Number.isFinite(s.min)&&Number.isFinite(s.max)&&s.max<s.min){const e=s.min;s.min=s.max,s.max=e}if("date"===e&&s.minDate&&s.maxDate&&s.maxDate<s.minDate){const e=s.minDate;s.minDate=s.maxDate,s.maxDate=e}if("slider"===String(e).toLowerCase()){const e="linear"===String(s.mode||"slider").toLowerCase()?"linear":"slider";s.mode=e;const t=(e,t,s)=>{if(!Number.isFinite(e))return null;if(!Number.isFinite(s)||s<=0)return e;const a=Math.round((e-t)/s);return Number((t+a*s).toFixed(6))},a=(e,s,a,i)=>{let l=[];Array.isArray(e)?l=e:e&&"object"===typeof e&&(l=Object.keys(e).map(t=>({value:Number(t),label:String(e[t])}))),l=l.map(e=>({value:Number(e?.value),label:String(e?.label||"").trim()})).filter(e=>Number.isFinite(e.value)&&!!e.label).map(e=>{let l=t(e.value,s,i);return Number.isFinite(l)||(l=e.value),l<s&&(l=s),l>a&&(l=a),{value:l,label:e.label}});const n=new Map;return l.forEach(e=>{n.has(e.value)||n.set(e.value,e.label)}),[...n.entries()].map(([e,t])=>({value:e,label:t})).sort((e,t)=>e.value-t.value)};"slider"===e?(s.percent?(s.min=1,s.max=100,s.step=Math.max(1,Number.isFinite(s.step)&&s.step>0?Math.round(s.step):1)):(s.min=Number.isFinite(s.min)?s.min:1,s.max=Number.isFinite(s.max)?s.max:5,s.max<=s.min&&(s.max=s.min+1),s.step=Number.isFinite(s.step)&&s.step>0?s.step:1),"marks"in s&&(s.marks=a(s.marks,s.min,s.max,s.step)),delete s.placeholder,delete s.defaultValue):(s.min=Number.isFinite(s.min)?Math.round(s.min):1,s.max=Number.isFinite(s.max)?Math.round(s.max):5,s.max<=s.min&&(s.max=s.min+1),delete s.percent,delete s.step,delete s.marks,delete s.placeholder,delete s.defaultValue);const i=["required","readonly","helpText"],l="slider"===e?[...i,"mode","percent","min","max","step","marks","showTicks"]:[...i,"mode","min","max","leftLabel","rightLabel"],n={};for(const r of l)r in s&&void 0!==s[r]&&(n[r]=s[r]);return n}if("file"===String(e).toLowerCase()){const e=String(s.storagePreference||"local").toLowerCase();if(s.storagePreference="url"===e?"url":"local","maxSizeMB"in s&&""!==s.maxSizeMB&&null!=s.maxSizeMB){const e=Number(s.maxSizeMB);s.maxSizeMB=Number.isFinite(e)&&e>0?e:100}else s.maxSizeMB=100;let t=Array.isArray(s.allowedFormats)?s.allowedFormats:[];t=t.map(e=>String(e||"").trim().toLowerCase()).filter(Boolean),s.allowedFormats=Array.from(new Set(t));let a=Array.isArray(s.modalities)?s.modalities:[];a=a.map(e=>String(e||"").trim()).filter(Boolean),s.modalities=Array.from(new Set(a));const i=["required","readonly","helpText","placeholder","storagePreference","allowedFormats","maxSizeMB","modalities","allowMultipleFiles"],l={};for(const n of i)n in s&&void 0!==s[n]&&(l[n]=s[n]);return l}const a=["required","readonly","helpText","placeholder","defaultValue"],i=["minLength","maxLength","pattern","transform"],l=["min","max","step","integerOnly","minDigits","maxDigits"],n=["minDate","maxDate","dateFormat","defaultValue"],r=["minTime","maxTime","step"];let o=[...a];switch(String(e).toLowerCase()){case"text":case"textarea":o=[...a,...i];break;case"number":o=[...a,...l];break;case"date":o=[...a,...n];break;case"time":o=[...a,...r];break;case"select":o=[...a],delete s.allowMultiple;break;case"radio":o=[...a,"allowMultiple"];break;case"checkbox":o=["required","readonly","helpText","defaultValue"];break;default:o=[...a]}const d={};for(const u of o)u in s&&void 0!==s[u]&&(d[u]=s[u]);if("number"===String(e).toLowerCase()){if(Number.isFinite(d.minDigits)&&d.minDigits<0&&(d.minDigits=0),Number.isFinite(d.maxDigits)&&d.maxDigits<0&&(d.maxDigits=0),Number.isFinite(d.minDigits)&&Number.isFinite(d.maxDigits)&&d.maxDigits<d.minDigits){const e=d.minDigits;d.minDigits=d.maxDigits,d.maxDigits=e}d.integerOnly&&"step"in d&&null!=d.step&&!Number.isInteger(d.step)&&delete d.step}return d}const So={key:0,class:"dfp-overlay","aria-hidden":"true"};function xo(e,t,s,a,l,n){const r=(0,i.g2)("VueDatePicker");return(0,i.uX)(),(0,i.CE)("div",{class:(0,m.C4)(["dfp-wrapper",{readonly:n.isReadonly}])},[(0,i.bF)(r,(0,i.v6)({modelValue:n.innerValue,"onUpdate:modelValue":[t[0]||(t[0]=e=>n.innerValue=e),n.emitChange],"model-type":"format",format:n.resolvedFormat,placeholder:s.placeholder||n.resolvedFormat,"min-date":n.dateMinResolved,"max-date":n.dateMaxResolved,teleport:!1,"enable-time-picker":"time"===s.mode,"time-picker":"time"===s.mode,"month-picker":"date"===s.mode&&n.isMonthPicker,"year-picker":"date"===s.mode&&n.isYearPicker,"auto-apply":!0,clearable:!n.isReadonly,disabled:n.isReadonly,"input-class":"dfp-input",class:"dfp-picker"},e.$attrs),null,16,["modelValue","format","placeholder","min-date","max-date","enable-time-picker","time-picker","month-picker","year-picker","clearable","disabled","onUpdate:modelValue"]),n.isReadonly?((0,i.uX)(),(0,i.CE)("div",So)):(0,i.Q3)("",!0)],2)}var Do=s(6876),Fo={name:"DateFormatPicker",components:{VueDatePicker:Do.A},inheritAttrs:!1,props:{modelValue:{type:[String,Date,null],default:""},format:{type:String,default:"dd.MM.yyyy"},placeholder:{type:String,default:""},minDate:{type:[String,Date],default:null},maxDate:{type:[String,Date],default:null},mode:{type:String,default:"date"},readonly:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],computed:{isYearPicker(){return"date"===this.mode&&"yyyy"===this.format.toLowerCase()},isMonthPicker(){if("date"!==this.mode)return!1;const e=this.format.toLowerCase();return"mm-yyyy"===e||"yyyy-mm"===e||"mm/yyyy"===e||"yyyy/mm"===e||"mm.yyyy"===e||"yyyy.mm"===e},resolvedFormat(){return this.format.replace(/yyyy/gi,"yyyy").replace(/dd/gi,"dd").replace(/mm/gi,"MM").replace(/hh/gi,"HH")},isReadonly(){const e=e=>!0===e||"true"===e||""===e;return!!(this.readonly||this.disabled||e(this.$attrs.readonly)||e(this.$attrs.disabled)||e(this.$attrs["aria-readonly"])||e(this.$attrs["data-readonly"]))},innerValue:{get(){return this.modelValue||""},set(e){this.isReadonly||this.$emit("update:modelValue",e||"")}},dateMinResolved(){const e=this.resolveDate(this.minDate,"min");return e||void 0},dateMaxResolved(){const e=this.resolveDate(this.maxDate,"max");return e||void 0}},methods:{emitChange(e){this.isReadonly||this.$emit("update:modelValue",e||"")},resolveDate(e,t){if(!e)return null;if(e instanceof Date)return this.normalizeBoundary(e,t);const s=String(e).trim(),a=this.parseByFormat(s,this.format)||this.parseByFormat(s,this.resolvedFormat);return a?this.normalizeBoundary(a,t):null},normalizeBoundary(e,t){const s=e.getFullYear(),a=e.getMonth();return this.isYearPicker?new Date(s,"min"===t?0:11,"min"===t?1:31):this.isMonthPicker?"min"===t?new Date(s,a,1):new Date(s,a+1,0):e},parseByFormat(e,t){if(!e||!t)return null;const s=t.toLowerCase(),a=String(e).trim();if("yyyy"===s){const e=/^(\d{4})$/.exec(a);return e?new Date(+e[1],0,1):null}if("mm-yyyy"===s||"mm/yyyy"===s||"mm.yyyy"===s){const e=/^(\d{2})[-/.](\d{4})$/.exec(a);return e?new Date(+e[2],+e[1]-1,1):null}if("yyyy-mm"===s||"yyyy/mm"===s||"yyyy.mm"===s){const e=/^(\d{4})[-/.](\d{2})$/.exec(a);return e?new Date(+e[1],+e[2]-1,1):null}if("dd.mm.yyyy"===s){const e=/^(\d{2})\.(\d{2})\.(\d{4})$/.exec(a);return e?new Date(+e[3],+e[2]-1,+e[1]):null}if("dd-mm-yyyy"===s){const e=/^(\d{2})-(\d{2})-(\d{4})$/.exec(a);return e?new Date(+e[3],+e[2]-1,+e[1]):null}if("mm-dd-yyyy"===s){const e=/^(\d{2})-(\d{2})-(\d{4})$/.exec(a);return e?new Date(+e[3],+e[1]-1,+e[2]):null}if("yyyy-mm-dd"===s){const e=/^(\d{4})-(\d{2})-(\d{2})$/.exec(a);return e?new Date(+e[1],+e[2]-1,+e[3]):null}return null}}};const Ao=(0,o.A)(Fo,[["render",xo],["__scopeId","data-v-0479acb3"]]);var Mo=Ao;const Eo=["tabindex","aria-readonly"],Vo={class:"ftm-row"},Io={class:"ftm-step"},_o=["disabled"],$o=["min","max","disabled"],Xo=["disabled"],jo={class:"ftm-step"},Uo=["disabled"],To=["disabled"],No=["disabled"],Ro={key:0,class:"ftm-ap-toggle"},Po=["disabled"],Bo=["disabled"],Oo={class:"ftm-actions"},qo=["disabled"],Ko={key:1,class:"ftm-bounds"},Wo={key:1,class:"ftm-overlay","aria-hidden":"true"};function zo(e,t,s,l,n,r){return(0,i.uX)(),(0,i.CE)("div",{class:(0,m.C4)(["ftm-wrap",{readonly:r.isReadonly}])},[(0,i.Lk)("div",{class:"ftm-input",tabindex:r.isReadonly?-1:0,onClick:t[0]||(t[0]=(...e)=>r.toggleOpen&&r.toggleOpen(...e)),onKeydown:[t[1]||(t[1]=(0,a.jR)((0,a.D$)((...e)=>r.toggleOpen&&r.toggleOpen(...e),["prevent"]),["enter"])),t[2]||(t[2]=(0,a.jR)((0,a.D$)((...e)=>r.toggleOpen&&r.toggleOpen(...e),["prevent"]),["space"]))],"aria-readonly":r.isReadonly?"true":"false"},[(0,i.Lk)("i",{class:(0,m.C4)([n.icons.clock,"ftm-clock-icon"]),"aria-hidden":"true"},null,2),(0,i.Lk)("span",{class:(0,m.C4)(["ftm-text",{placeholder:!r.displayValue}])},(0,m.v_)(r.displayValue||r.placeholderText),3)],40,Eo),n.menuOpen?((0,i.uX)(),(0,i.CE)("div",{key:0,class:"ftm-pop",onMousedown:t[14]||(t[14]=(0,a.D$)(()=>{},["stop"]))},[(0,i.Lk)("div",Vo,[(0,i.Lk)("div",Io,[(0,i.Lk)("button",{class:"ftm-step-btn",onClick:t[3]||(t[3]=e=>r.stepHour(1)),disabled:r.isReadonly},[(0,i.Lk)("i",{class:(0,m.C4)(n.icons.toggleUp)},null,2)],8,_o),(0,i.bo)((0,i.Lk)("input",{class:"ftm-step-input",type:"number",min:r.is12h?1:0,max:r.is12h?12:23,"onUpdate:modelValue":t[4]||(t[4]=e=>n.uiHour=e),disabled:r.isReadonly},null,8,$o),[[a.Jo,n.uiHour,void 0,{number:!0}]]),(0,i.Lk)("button",{class:"ftm-step-btn",onClick:t[5]||(t[5]=e=>r.stepHour(-1)),disabled:r.isReadonly},[(0,i.Lk)("i",{class:(0,m.C4)(n.icons.toggleDown)},null,2)],8,Xo)]),t[15]||(t[15]=(0,i.Lk)("span",{class:"ftm-colon"},":",-1)),(0,i.Lk)("div",jo,[(0,i.Lk)("button",{class:"ftm-step-btn",onClick:t[6]||(t[6]=e=>r.stepMinute(1)),disabled:r.isReadonly},[(0,i.Lk)("i",{class:(0,m.C4)(n.icons.toggleUp)},null,2)],8,Uo),(0,i.bo)((0,i.Lk)("input",{class:"ftm-step-input",type:"number",min:"0",max:"59","onUpdate:modelValue":t[7]||(t[7]=e=>n.uiMinute=e),disabled:r.isReadonly},null,8,To),[[a.Jo,n.uiMinute,void 0,{number:!0}]]),(0,i.Lk)("button",{class:"ftm-step-btn",onClick:t[8]||(t[8]=e=>r.stepMinute(-1)),disabled:r.isReadonly},[(0,i.Lk)("i",{class:(0,m.C4)(n.icons.toggleDown)},null,2)],8,No)]),r.is12h?((0,i.uX)(),(0,i.CE)("div",Ro,[(0,i.Lk)("button",{class:(0,m.C4)(["ftm-ap-btn",{active:"AM"===n.ap}]),onClick:t[9]||(t[9]=e=>n.ap="AM"),disabled:r.isReadonly},"AM",10,Po),(0,i.Lk)("button",{class:(0,m.C4)(["ftm-ap-btn",{active:"PM"===n.ap}]),onClick:t[10]||(t[10]=e=>n.ap="PM"),disabled:r.isReadonly},"PM",10,Bo)])):(0,i.Q3)("",!0)]),(0,i.Lk)("div",Oo,[(0,i.Lk)("button",{class:"ftm-btn",onClick:t[11]||(t[11]=(...e)=>r.apply&&r.apply(...e)),disabled:r.isReadonly},"OK",8,qo),(0,i.Lk)("button",{class:"ftm-btn ghost",onClick:t[12]||(t[12]=(...e)=>r.close&&r.close(...e))},"Cancel"),r.isReadonly?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("button",{key:0,class:"ftm-btn ghost",onClick:t[13]||(t[13]=(...e)=>r.setNow&&r.setNow(...e))},"Now")),r.boundText?((0,i.uX)(),(0,i.CE)("small",Ko,(0,m.v_)(r.boundText),1)):(0,i.Q3)("",!0)])],32)):(0,i.Q3)("",!0),r.isReadonly?((0,i.uX)(),(0,i.CE)("div",Wo)):(0,i.Q3)("",!0)],2)}var Qo={name:"FieldTime",inheritAttrs:!1,props:{modelValue:{type:String,default:""},placeholder:{type:String,default:""},id:{type:String,default:null},minTime:{type:String,default:""},maxTime:{type:String,default:""},readonly:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1},defaultValue:{type:String,default:void 0},hourCycle:{type:String,default:"24"}},emits:["update:modelValue"],data(){return{menuOpen:!1,uiHour:12,uiMinute:0,ap:"AM",icons:ae.A}},computed:{isReadonly(){const e=this.$attrs,t=e=>!0===e||"true"===e||""===e;return!!(this.readonly||this.disabled||t(e.readonly)||t(e.disabled)||t(e["aria-readonly"])||t(e["data-readonly"]))},isRequired(){const e=this.$attrs,t=e=>!0===e||"true"===e||""===e;return!(!this.required&&!t(e.required))},is12h(){const e=this.hourCycle||this.$attrs.hourCycle||"24";return"12"===String(e)},displayValue(){const e=this.parseToDate(this.modelValue);return e?this.is12h?this.to12(e):this.to24(e):""},placeholderText(){return this.placeholder||(this.is12h?"hh:mm AM/PM":"HH:mm")},minDate(){return this.parseToDate(this.minTime)},maxDate(){return this.parseToDate(this.maxTime)},boundText(){const e=[];return this.minDate&&e.push(`min ${this.is12h?this.to12(this.minDate):this.to24(this.minDate)}`),this.maxDate&&e.push(`max ${this.is12h?this.to12(this.maxDate):this.to24(this.maxDate)}`),e.join(" · ")}},watch:{hourCycle(){this.syncPanelFromValue()}},mounted(){if(this.hasValue(this.modelValue)){const e=this.normalizeHHMM(this.modelValue);e!==this.modelValue&&this.$emit("update:modelValue",e)}else{const e=this.effectiveDefault();e&&this.$emit("update:modelValue",e)}this.syncPanelFromValue(),document.addEventListener("mousedown",this.onDocDown)},beforeUnmount(){document.removeEventListener("mousedown",this.onDocDown)},methods:{toggleOpen(){this.isReadonly||(this.menuOpen=!this.menuOpen,this.menuOpen&&this.syncPanelFromValue())},close(){this.menuOpen=!1},onDocDown(e){this.$el.contains(e.target)||this.close()},pad2(e){return String(e).padStart(2,"0")},hasValue(e){return"string"===typeof e&&""!==e.trim()},nowHHMM(){const e=new Date;return`${this.pad2(e.getHours())}:${this.pad2(e.getMinutes())}`},effectiveDefault(){const e=Object.prototype.hasOwnProperty.call(this.$props,"defaultValue");if(e&&this.hasValue(this.defaultValue)){const e=this.parseToDate(this.defaultValue);return e?this.to24(e):""}const t=Object.prototype.hasOwnProperty.call(this.$attrs,"defaultValue");if(t&&this.hasValue(this.$attrs.defaultValue)){const e=this.parseToDate(String(this.$attrs.defaultValue));return e?this.to24(e):""}return this.isReadonly&&this.isRequired?this.nowHHMM():""},parseToDate(e){const t=String(e||"").trim();let s=/^(\d{1,2}):(\d{2})\s*(AM|PM)$/i.exec(t);if(s){let e=+s[1],t=+s[2];if(e<1||e>12||t<0||t>59)return null;const a=s[3].toUpperCase();"PM"===a&&e<12&&(e+=12),"AM"===a&&12===e&&(e=0);const i=new Date;return i.setHours(e,t,0,0),i}if(s=/^(\d{1,2}):(\d{2})$/.exec(t),s){let e=+s[1],t=+s[2];if(e<0||e>23||t<0||t>59)return null;const a=new Date;return a.setHours(e,t,0,0),a}return null},normalizeHHMM(e){const t=this.parseToDate(e);return t?this.to24(t):""},to24(e){return`${this.pad2(e.getHours())}:${this.pad2(e.getMinutes())}`},to12(e){let t=e.getHours(),s=t>=12?"PM":"AM";return t%=12,0===t&&(t=12),`${this.pad2(t)}:${this.pad2(e.getMinutes())} ${s}`},syncPanelFromValue(){const e=this.parseToDate(this.modelValue)||this.parseToDate(this.effectiveDefault())||new Date;let t=e.getHours();this.uiMinute=e.getMinutes(),this.is12h?(this.ap=t>=12?"PM":"AM",t%=12,0===t&&(t=12),this.uiHour=t):this.uiHour=t},currentSelectionToDate(){let e=Number(this.uiHour)||0;const t=Number(this.uiMinute)||0;this.is12h&&("PM"===this.ap&&e<12&&(e+=12),"AM"===this.ap&&12===e&&(e=0));const s=new Date;return s.setHours(Math.min(23,Math.max(0,e)),Math.min(59,Math.max(0,t)),0,0),s},clampToBounds(e){const t=this.minDate,s=this.maxDate;return t&&e<t?new Date(t):s&&e>s?new Date(s):e},apply(){if(this.isReadonly)return;let e=this.currentSelectionToDate();e=this.clampToBounds(e),this.$emit("update:modelValue",this.to24(e)),this.close()},setNow(){if(this.isReadonly)return;let e=new Date;e=this.clampToBounds(e),this.$emit("update:modelValue",this.to24(e)),this.syncPanelFromValue()},stepHour(e){if(this.is12h){let t=(Number(this.uiHour)||12)+e;t>12&&(t=1),t<1&&(t=12),this.uiHour=t}else{let t=(Number(this.uiHour)||0)+e;t>23&&(t=0),t<0&&(t=23),this.uiHour=t}},stepMinute(e){let t=(Number(this.uiMinute)||0)+e;t>59&&(t=0),t<0&&(t=59),this.uiMinute=t}}};const Go=(0,o.A)(Qo,[["render",zo],["__scopeId","data-v-782774e8"]]);var Jo=Go;const Yo=["dd.MM.yyyy","MM-dd-yyyy","dd-MM-yyyy","yyyy-MM-dd","MM/yyyy","MM-yyyy","yyyy/MM","yyyy-MM","yyyy"],Ho=Object.freeze(["MRI","T1w","T2w","bold","dwi","FLAIR","PD","inplaneT2","fmap","fieldmap","epi","phasediff","magnitude","MEG","EEG","iEEG","NIRS","PET","ASL","beh","events","physio","scans","func","anat","fmap","swi"]);var Zo={name:"FieldConstraintsDialog",components:{DateFormatPicker:Mo,FieldTime:Jo},props:{currentFieldType:{type:String,default:"text"},constraintsForm:{type:Object,default:()=>({})}},created(){this._initialSnapshot={local:JSON.parse(JSON.stringify(this.local)),localOptions:JSON.parse(JSON.stringify(this.localOptions)),optionsCount:this.optionsCount,allowedFormatsText:this.allowedFormatsText}},data(){const e=this.constraintsForm||{},t=(this.currentFieldType||"text").toLowerCase(),s=(Array.isArray(e.options)?e.options:[]).filter(Boolean).map(String),a=void 0!==e.defaultValue?e.defaultValue:"checkbox"!==t&&("radio"===t&&e.allowMultiple?[]:""),i=Array.isArray(e.allowedFormats)?e.allowedFormats.map(String).map(e=>e.trim()).filter(Boolean):[],l=i.join(", ");return{DATE_FORMATS:Yo,LINEAR_MAX:10,BIDS_MODALITIES:Ho,customMod:"",allowedFormatsText:l,local:{required:!!e.required,readonly:!!e.readonly,helpText:e.helpText||"",placeholder:e.placeholder||"",defaultValue:a,minLength:isFinite(e.minLength)?Number(e.minLength):void 0,maxLength:isFinite(e.maxLength)?Number(e.maxLength):void 0,pattern:e.pattern||"",transform:e.transform||"none",min:isFinite(e.min)?Number(e.min):"slider"===t?1:void 0,max:isFinite(e.max)?Number(e.max):"slider"===t?5:void 0,step:isFinite(e.step)?Number(e.step):"slider"===t?1:void 0,integerOnly:!!e.integerOnly,minDigits:isFinite(e.minDigits)?Number(e.minDigits):void 0,maxDigits:isFinite(e.maxDigits)?Number(e.maxDigits):void 0,minTime:e.minTime||"",maxTime:e.maxTime||"",hourCycle:e.hourCycle||"24",minDate:e.minDate||"",maxDate:e.maxDate||"",dateFormat:e.dateFormat||"dd.MM.yyyy",allowMultiple:!!e.allowMultiple,mode:"linear"===e.mode?"linear":"slider",percent:!!e.percent,leftLabel:e.leftLabel||"",rightLabel:e.rightLabel||"",marks:Array.isArray(e.marks)?e.marks.map(e=>({value:Number(e?.value),label:String(e?.label??"")})).filter(e=>Number.isFinite(e.value)&&e.label):e.marks&&"object"===typeof e.marks?Object.keys(e.marks).map(t=>({value:Number(t),label:String(e.marks[t])})).filter(e=>Number.isFinite(e.value)&&e.label):[],allowedFormats:i,maxSizeMB:isFinite(e.maxSizeMB)&&Number(e.maxSizeMB)>0?Number(e.maxSizeMB):void 0,storagePreference:"url"===e.storagePreference?"url":"local",allowMultipleFiles:void 0===e.allowMultipleFiles||!!e.allowMultipleFiles,modalities:Array.isArray(e.modalities)?e.modalities.filter(Boolean).map(String):[]},localOptions:s.length?s:["Option 1"],optionsCount:Math.max(1,s.length||1),chipInput:"",markEditValue:null,markEditLabel:""}},computed:{type(){return(this.currentFieldType||"text").toLowerCase()},isTextLike(){return"text"===this.type||"textarea"===this.type},isNumber(){return"number"===this.type},isTime(){return"time"===this.type},isDate(){return"date"===this.type},isCheckbox(){return"checkbox"===this.type},isRadio(){return"radio"===this.type},isSelect(){return"select"===this.type},isChoice(){return this.isRadio||this.isSelect},isSlider(){return"slider"===this.type},isFile(){return"file"===this.type},currentTypeLabel(){return this.type.charAt(0).toUpperCase()+this.type.slice(1)},useMin(){return Number.isFinite(this.local.min)?this.local.min:1},useMax(){return Number.isFinite(this.local.max)?this.local.max:5},useStep(){return Number.isFinite(this.local.step)&&this.local.step>0?this.local.step:1},linearCount(){const e=Number.isFinite(+this.local.min)?+this.local.min:1,t=Number.isFinite(+this.local.max)?+this.local.max:5;return Math.max(0,t-e+1)},marksSorted(){return[...this.local.marks||[]].sort((e,t)=>e.value-t.value).filter((e,t,s)=>0===t||e.value!==s[t-1].value)},defaultError(){if(!this.local.required||!this.local.readonly)return"";const e=this.type,t=this.local.defaultValue;if("radio"===e){const e=this.local.allowMultiple?Array.isArray(t)&&t.length>0:"string"===typeof t&&""!==t;return e?"":"Default value is required when the field is both Required and Readonly."}if("select"===e){const e="string"===typeof t&&""!==t;return e?"":"Default value is required when the field is both Required and Readonly."}if("checkbox"===e){const e=!!t;return e?"":"Default value (Checked) is required when the field is both Required and Readonly."}if("number"===e){const e=""!==t&&null!==t&&void 0!==t&&!Number.isNaN(Number(t));return e?"":"Default value is required when the field is both Required and Readonly."}return""!==t&&null!==t&&void 0!==t?"":"Default value is required when the field is both Required and Readonly."},isSaveDisabled(){return this.isSlider&&"linear"===this.local.mode?this.linearCount<2||this.linearCount>this.LINEAR_MAX:!(this.isDate||this.isSlider&&"slider"===this.local.mode||!this.local.required||!this.local.readonly)&&!!this.defaultError},builtInSet(){return new Set(Ho)},allModalities(){const e=(this.local.modalities||[]).filter(e=>!!e&&!this.builtInSet.has(e));return[...Ho,...Array.from(new Set(e))]}},watch:{constraintsForm:{deep:!0,handler(e){const t=e||{},s=Array.isArray(t.allowedFormats)?t.allowedFormats.map(String).map(e=>e.trim()).filter(Boolean):[];if(this.allowedFormatsText=s.join(", "),this.local={...this.local,required:!!t.required,readonly:!!t.readonly,helpText:t.helpText||"",placeholder:t.placeholder||"",defaultValue:void 0!==t.defaultValue?t.defaultValue:this.local.defaultValue,minLength:isFinite(t.minLength)?Number(t.minLength):void 0,maxLength:isFinite(t.maxLength)?Number(t.maxLength):void 0,pattern:t.pattern||"",transform:t.transform||"none",min:isFinite(t.min)?Number(t.min):this.local.min??(this.isSlider?1:void 0),max:isFinite(t.max)?Number(t.max):this.local.max??(this.isSlider?5:void 0),step:isFinite(t.step)?Number(t.step):this.local.step??(this.isSlider?1:void 0),integerOnly:!!t.integerOnly,minDigits:isFinite(t.minDigits)?Number(t.minDigits):this.local.minDigits,maxDigits:isFinite(t.maxDigits)?Number(t.maxDigits):this.local.maxDigits,minTime:t.minTime||"",maxTime:t.maxTime||"",hourCycle:t.hourCycle||this.local.hourCycle,minDate:t.minDate||"",maxDate:t.maxDate||"",dateFormat:t.dateFormat||this.local.dateFormat,allowMultiple:!!t.allowMultiple,mode:"linear"===t.mode?"linear":"slider",percent:!!t.percent,leftLabel:t.leftLabel||"",rightLabel:t.rightLabel||"",marks:Array.isArray(t.marks)?t.marks.map(e=>({value:Number(e?.value),label:String(e?.label??"")})).filter(e=>Number.isFinite(e.value)&&e.label):[],allowedFormats:s,maxSizeMB:isFinite(t.maxSizeMB)&&Number(t.maxSizeMB)>0?Number(t.maxSizeMB):void 0,storagePreference:"url"===t.storagePreference?"url":"local",allowMultipleFiles:void 0===t.allowMultipleFiles||!!t.allowMultipleFiles,modalities:Array.isArray(t.modalities)?t.modalities.filter(Boolean).map(String):[]},Array.isArray(t.options)){const e=t.options.filter(Boolean).map(String);this.localOptions=e.length?e:["Option 1"],this.optionsCount=this.localOptions.length}}},"local.percent"(e){this.isSlider&&"slider"===this.local.mode&&e&&(this.local.min=1,this.local.max=100,(!Number.isFinite(this.local.step)||this.local.step<=0)&&(this.local.step=1),this.local.marks=(this.local.marks||[]).filter(e=>e.value>=1&&e.value<=100))},currentFieldType(e){const t=(e||"").toLowerCase();"checkbox"===t&&(this.local.defaultValue=!!this.local.defaultValue,this.local.placeholder="")},"local.allowMultiple"(e){this.isRadio&&(e?this.local.defaultValue=Array.isArray(this.local.defaultValue)?this.local.defaultValue.filter(e=>this.localOptions.includes(e)):this.local.defaultValue&&this.localOptions.includes(this.local.defaultValue)?[this.local.defaultValue]:[]:Array.isArray(this.local.defaultValue)&&(this.local.defaultValue=this.local.defaultValue[0]||""))},localOptions:{deep:!0,handler(){this.isChoice&&(this.isRadio&&this.local.allowMultiple?Array.isArray(this.local.defaultValue)&&(this.local.defaultValue=this.local.defaultValue.filter(e=>this.localOptions.includes(e))):this.localOptions.includes(this.local.defaultValue)||(this.local.defaultValue=""),this.optionsCount=this.localOptions.length)}}},methods:{addOrUpdateMark(e){if("slider"!==e)return;let t=Number(this.markEditValue);const s=String(this.markEditLabel||"").trim();if(!Number.isFinite(t)||!s)return;const a=this.useMin,i=this.useMax,l=this.useStep;t=Math.max(a,Math.min(i,t)),t=Math.round((t-a)/l)*l+a,t=Math.max(a,Math.min(i,t));const n=(this.local.marks||[]).findIndex(e=>e.value===t);n>=0?this.local.marks.splice(n,1,{value:t,label:s}):(this.local.marks||(this.local.marks=[])).push({value:t,label:s}),this.markEditLabel="",this.markEditValue=null},removeMark(e){const t=(this.local.marks||[]).findIndex(t=>t.value===e);t>=0&&this.local.marks.splice(t,1)},addChip(){const e=(this.chipInput||"").trim();e&&this.localOptions.includes(e)&&(Array.isArray(this.local.defaultValue)||(this.local.defaultValue=[]),this.local.defaultValue.includes(e)||this.local.defaultValue.push(e),this.chipInput="")},removeChip(e){Array.isArray(this.local.defaultValue)&&this.local.defaultValue.splice(e,1)},syncOptionsCount(){const e=Math.max(1,Number(this.optionsCount||1));if(e>this.localOptions.length){const t=e-this.localOptions.length;for(let e=0;e<t;e++)this.localOptions.push(`Option ${this.localOptions.length+1}`)}else e<this.localOptions.length&&this.localOptions.splice(e);this.optionsCount=this.localOptions.length},addOption(){this.localOptions.push(`Option ${this.localOptions.length+1}`),this.optionsCount=this.localOptions.length},removeLastOption(){if(this.localOptions.length>1){const e=this.localOptions.pop();Array.isArray(this.local.defaultValue)?this.local.defaultValue=this.local.defaultValue.filter(t=>t!==e):this.local.defaultValue===e&&(this.local.defaultValue=""),this.optionsCount=this.localOptions.length}},deleteOption(e){if(this.localOptions.length<=1)return;const t=this.localOptions.splice(e,1)[0];Array.isArray(this.local.defaultValue)?this.local.defaultValue=this.local.defaultValue.filter(e=>e!==t):this.local.defaultValue===t&&(this.local.defaultValue=""),this.optionsCount=this.localOptions.length},addCustomMod(){const e=(this.customMod||"").trim();if(!e)return;const t=(this.local.modalities||[]).some(t=>(t||"").toLowerCase()===e.toLowerCase());t||(Array.isArray(this.local.modalities)||(this.local.modalities=[]),this.local.modalities.push(e)),this.customMod=""},removeCustomModByName(e){this.local.modalities=(this.local.modalities||[]).filter(t=>t!==e)},parseAllowedFormats(e){return String(e||"").split(",").map(e=>e.trim()).filter(Boolean)},save(){if(this.isSaveDisabled)return;if(this.isFile){const e=String(this.allowedFormatsText||"").split(",").map(e=>e.trim()).filter(Boolean),t={required:!!this.local.required,readonly:!!this.local.readonly,helpText:this.local.helpText||"",allowedFormats:e,maxSizeMB:Number.isFinite(this.local.maxSizeMB)&&this.local.maxSizeMB>0?Number(this.local.maxSizeMB):void 0,storagePreference:"url"===this.local.storagePreference?"url":"local",allowMultipleFiles:!1!==this.local.allowMultipleFiles,modalities:Array.isArray(this.local.modalities)?Array.from(new Set(this.local.modalities.filter(Boolean).map(String))):[]};return void this.$emit("updateConstraints",t)}if(!this.isSlider){const e=Co(this.type,{...this.local});if(this.isChoice){const t=this.localOptions.map(e=>String(e||"").trim()).filter(Boolean),s=t.length?Array.from(new Set(t)):["Option 1"];if(this.isRadio&&this.local.allowMultiple){const t=Array.isArray(e.defaultValue)?e.defaultValue:[];e.defaultValue=t.filter(e=>s.includes(e))}else s.includes(e.defaultValue)||(e.defaultValue="");e.options=s,this.isSelect&&delete e.allowMultiple}return e.defaultValue=wo(this.isRadio&&this.local.allowMultiple?"radio":this.type,e.defaultValue),e.hourCycle=this.local.hourCycle||"24",void this.$emit("updateConstraints",e)}if("slider"===this.local.mode){const e=this.local.percent?1:this.useMin,t=this.local.percent?100:this.useMax,s=this.local.percent?1:this.useStep,a=(this.local.marks||[]).map(a=>{let i=Number(a.value);return Number.isFinite(i)?(i=Math.round((i-e)/s)*s+e,i=Math.max(e,Math.min(t,i)),{value:i,label:String(a.label||"")}):null}).filter(e=>e&&e.label).filter((e,t,s)=>s.findIndex(t=>t.value===e.value)===t).sort((e,t)=>e.value-t.value),i={mode:"slider",required:!!this.local.required,readonly:!!this.local.readonly,helpText:this.local.helpText||"",percent:!!this.local.percent,min:e,max:t,step:s,marks:a};return void this.$emit("updateConstraints",i)}const e=this.LINEAR_MAX;let t=this.useMin,s=this.useMax;s-t+1>e&&(s=t+(e-1)),s<t&&(s=t+1);const a={mode:"linear",required:!!this.local.required,readonly:!!this.local.readonly,helpText:this.local.helpText||"",min:t,max:s,leftLabel:this.local.leftLabel||"",rightLabel:this.local.rightLabel||""};this.$emit("updateConstraints",a)},clearToInitial(){const e=this._initialSnapshot;e&&(this.local=JSON.parse(JSON.stringify(e.local)),this.localOptions=JSON.parse(JSON.stringify(e.localOptions)),this.optionsCount=e.optionsCount,this.allowedFormatsText=e.allowedFormatsText,this.chipInput="",this.markEditValue=null,this.markEditLabel="",this.customMod="")}}};const ed=(0,o.A)(Zo,[["render",Lo],["__scopeId","data-v-78da675a"]]);var td=ed;const sd=["id","disabled","aria-readonly"];function ad(e,t,s,l,n,r){return(0,i.uX)(),(0,i.CE)("label",{class:(0,m.C4)(["fcx-wrapper",{readonly:r.isReadonly}])},[(0,i.bo)((0,i.Lk)("input",{type:"checkbox",id:s.id,"onUpdate:modelValue":t[0]||(t[0]=e=>r.proxy=e),disabled:r.isReadonly,"aria-readonly":r.isReadonly?"true":"false",onClick:t[1]||(t[1]=(...e)=>r.onMaybeBlock&&r.onMaybeBlock(...e)),onKeydown:t[2]||(t[2]=(0,a.D$)((...e)=>r.onMaybeBlock&&r.onMaybeBlock(...e),["exact"])),onWheel:t[3]||(t[3]=(...e)=>r.onMaybeBlock&&r.onMaybeBlock(...e))},null,40,sd),[[a.lH,r.proxy]])],2)}var id={name:"FieldCheckbox",inheritAttrs:!0,props:{modelValue:{type:Boolean,default:!1},id:{type:String,default:null},readonly:{type:Boolean,default:!1},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},defaultValue:{type:[Boolean,String,Number,null],default:void 0}},emits:["update:modelValue"],computed:{isReadonly(){const e=""===this.$attrs.readonly||"true"===this.$attrs.readonly||!0===this.$attrs.readonly,t=""===this.$attrs.disabled||"true"===this.$attrs.disabled||!0===this.$attrs.disabled;return this.readonly||this.disabled||e||t},isRequired(){const e=""===this.$attrs.required||"true"===this.$attrs.required||!0===this.$attrs.required;return this.required||e},effectiveDefault(){if(Object.prototype.hasOwnProperty.call(this.$props,"defaultValue"))return!!this.defaultValue;if(Object.prototype.hasOwnProperty.call(this.$attrs,"defaultValue")){const e=this.$attrs.defaultValue;return""===e||(!0===e||"true"===e)}return!(!this.isReadonly||!this.isRequired)},proxy:{get(){return!!this.modelValue},set(e){this.isReadonly||this.$emit("update:modelValue",!!e)}}},mounted(){this.enforceRules(!0)},watch:{isReadonly(){this.enforceRules()},isRequired(){this.enforceRules()},defaultValue(){this.enforceRules()},modelValue(){this.enforceRules()}},methods:{onMaybeBlock(e){if(this.isReadonly)return e.preventDefault?.(),e.stopPropagation?.(),!1},enforceRules(e=!1){const t=null===this.modelValue||void 0===this.modelValue||""===this.modelValue;t?this.$emit("update:modelValue",this.effectiveDefault):this.isReadonly&&this.isRequired&&!0!==this.modelValue?this.$emit("update:modelValue",!0):e&&Object.prototype.hasOwnProperty.call(this.$props,"defaultValue")&&this.modelValue!==!!this.defaultValue&&this.$emit("update:modelValue",!!this.defaultValue)}}};const ld=(0,o.A)(id,[["render",ad],["__scopeId","data-v-10393368"]]);var nd=ld;const rd={class:"frg"},od=["name","value","checked","disabled","aria-readonly","onChange"],dd=["name","value","checked","disabled","aria-readonly","onChange"];function ud(e,t,s,l,n,r){return(0,i.uX)(),(0,i.CE)("div",rd,[s.allowMultiple?((0,i.uX)(!0),(0,i.CE)(i.FK,{key:0},(0,i.pI)(r.stringOptions,(e,l)=>((0,i.uX)(),(0,i.CE)("label",{key:"m-"+l,class:"radio-label"},[(0,i.Lk)("input",{type:"checkbox",name:s.name+"[]",value:e,checked:r.proxyArray.includes(e),disabled:r.isReadonly,"aria-readonly":r.isReadonly?"true":"false",onMousedown:t[0]||(t[0]=(0,a.D$)(e=>r.isReadonly&&e.preventDefault(),["prevent"])),onChange:t=>r.onToggleMulti(e,t.target.checked)},null,40,od),(0,i.eW)(" "+(0,m.v_)(e),1)]))),128)):((0,i.uX)(!0),(0,i.CE)(i.FK,{key:1},(0,i.pI)(r.stringOptions,(e,l)=>((0,i.uX)(),(0,i.CE)("label",{key:"s-"+l,class:"radio-label"},[(0,i.Lk)("input",{type:"radio",name:s.name,value:e,checked:r.proxySingle===e,disabled:r.isReadonly,"aria-readonly":r.isReadonly?"true":"false",onMousedown:t[1]||(t[1]=(0,a.D$)(e=>r.isReadonly&&e.preventDefault(),["prevent"])),onChange:t=>r.onSelectSingle(e)},null,40,dd),(0,i.eW)(" "+(0,m.v_)(e),1)]))),128))])}var cd={name:"FieldRadioGroup",inheritAttrs:!1,props:{modelValue:{type:[String,Number,Array],default:""},options:{type:Array,default:()=>[]},name:{type:String,default:"radio"},readonly:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},defaultValue:{type:[String,Number,Array],default:""},allowMultiple:{type:Boolean,default:!1}},emits:["update:modelValue","change"],computed:{isReadonly(){const e=""===this.$attrs.readonly||!0===this.$attrs.readonly||"true"===this.$attrs.readonly;return this.readonly||e||this.disabled},stringOptions(){return this.options.map(e=>null==e?"":String(e))},proxySingle(){return null==this.modelValue?"":String(this.modelValue)},proxyArray(){const e=this.modelValue;return Array.isArray(e)?e.map(e=>null==e?"":String(e)):[]}},mounted(){this.initFromDefaults()},watch:{options(){const e=this.stringOptions;if(this.allowMultiple){const t=this.proxyArray.filter(t=>e.includes(t));this.$emit("update:modelValue",t),this.$emit("change",t)}else{const t=this.proxySingle;if(!e.includes(t)){const t=this.pickSingleDefault(),s=t&&e.includes(t)?t:"";this.$emit("update:modelValue",s),this.$emit("change",s)}}},allowMultiple(){this.initFromDefaults(!0)}},methods:{pickSingleDefault(){const e=this.stringOptions,t=this.defaultValue;if(Array.isArray(t)){const s=t.map(e=>String(e)).find(t=>e.includes(t));return s||""}const s=null==t?"":String(t);return e.includes(s)?s:""},pickMultiDefault(){const e=this.stringOptions,t=this.defaultValue;if(Array.isArray(t))return t.map(e=>String(e)).filter(t=>e.includes(t));const s=null==t?"":String(t);return e.includes(s)?[s]:[]},initFromDefaults(e=!1){const t=e=>Array.isArray(e)?e.length>0:null!==e&&""!==String(e).trim();if(this.allowMultiple){const s=this.proxyArray;if(!t(s)||e){const e=this.pickMultiDefault();this.$emit("update:modelValue",e),this.$emit("change",e)}}else{const s=this.proxySingle;if(!t(s)||e){const e=this.pickSingleDefault();this.$emit("update:modelValue",e),this.$emit("change",e)}}},onSelectSingle(e){this.isReadonly||(this.$emit("update:modelValue",e),this.$emit("change",e))},onToggleMulti(e,t){if(this.isReadonly)return;const s=new Set(this.proxyArray);t?s.add(e):s.delete(e);const a=Array.from(s);this.$emit("update:modelValue",a),this.$emit("change",a)}}};const pd=(0,o.A)(cd,[["render",ud],["__scopeId","data-v-20a97456"]]);var md=pd;const hd={class:"slider-header"},yd={key:0,class:"slider-value"},gd=["min","max","step","value","disabled"],fd={key:0,class:"marks"},vd={class:"mark-label"},kd={class:"slider-footer"},bd={class:"min-label"},Ld={class:"max-label"};function wd(e,t,s,a,l,n){return(0,i.uX)(),(0,i.CE)("div",{class:(0,m.C4)(["field-slider",{readonly:s.readonly}])},[(0,i.Lk)("div",hd,[null!==n.displayValue?((0,i.uX)(),(0,i.CE)("span",yd,(0,m.v_)(n.displayValueText),1)):(0,i.Q3)("",!0)]),(0,i.Lk)("div",{class:"slider-track-wrap",ref:"wrap",onClick:t[6]||(t[6]=(...e)=>n.onTrackClick&&n.onTrackClick(...e))},[(0,i.Lk)("input",{ref:"range",type:"range",class:"slider-range",min:n.useMin,max:n.useMax,step:n.useStep,value:n.rangeValue,disabled:s.readonly,onInput:t[0]||(t[0]=(...e)=>n.onInput&&n.onInput(...e)),onChange:t[1]||(t[1]=(...e)=>n.onChange&&n.onChange(...e)),onMousedown:t[2]||(t[2]=e=>l.dragging=!0),onMouseup:t[3]||(t[3]=e=>l.dragging=!1),onTouchstart:t[4]||(t[4]=e=>l.dragging=!0),onTouchend:t[5]||(t[5]=e=>l.dragging=!1)},null,40,gd),n.hasMarks?((0,i.uX)(),(0,i.CE)("div",fd,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.normalizedMarks,(e,s)=>((0,i.uX)(),(0,i.CE)("div",{key:s,class:"mark",style:(0,m.Tr)({left:n.markPercent(e.value)+"%"})},[t[7]||(t[7]=(0,i.Lk)("span",{class:"mark-tick"},null,-1)),(0,i.Lk)("span",vd,(0,m.v_)(e.label),1)],4))),128))])):(0,i.Q3)("",!0)],512),(0,i.Lk)("div",kd,[(0,i.Lk)("span",bd,(0,m.v_)(n.useMin),1),(0,i.Lk)("span",Ld,(0,m.v_)(n.useMax),1)])],2)}var Cd={name:"FieldSlider",props:{modelValue:{type:[Number,String,null],default:null},min:{type:Number,default:1},max:{type:Number,default:5},step:{type:Number,default:1},readonly:{type:Boolean,default:!1},percent:{type:Boolean,default:!1},marks:{type:Array,default:()=>[]}},emits:["update:modelValue"],data(){return{internalValue:this.toNumberOrNull(this.modelValue),dragging:!1}},computed:{useMin(){return this.percent?1:this.min},useMax(){return this.percent?100:this.max},useStep(){return this.percent?1:this.step>0?this.step:1},hasMarks(){return this.normalizedMarks.length>0},normalizedMarks(){const e=this.useMin,t=this.useMax,s=this.useStep,a=new Set,i=[];return(this.marks||[]).forEach(l=>{let n=Number(l?.value);const r=(l?.label??"").toString();if(!Number.isFinite(n)||!r)return;n=Math.round((n-e)/s)*s+e,n=Math.max(e,Math.min(t,n));const o=`${n}`;a.has(o)||(a.add(o),i.push({value:n,label:r}))}),i.sort((e,t)=>e.value-t.value),i},displayValue(){return null!==this.internalValue&&Number.isFinite(+this.internalValue)?Number(this.internalValue):null},displayValueText(){return null===this.displayValue?"":this.percent?`${this.displayValue}%`:this.displayValue},rangeValue(){return null===this.internalValue?this.useMin:this.internalValue}},watch:{modelValue(e){const t=this.toNumberOrNull(e);t!==this.internalValue&&(this.internalValue=t)},min(){this.snapWithinBounds()},max(){this.snapWithinBounds()},step(){this.snapWithinBounds()},percent(){this.snapWithinBounds()},marks(){console.log("[FieldSlider] marks updated:",this.marks)}},mounted(){console.log("[FieldSlider] mounted props:",{percent:this.percent,min:this.min,max:this.max,step:this.step,marks:this.marks})},methods:{toNumberOrNull(e){const t=Number(e);return Number.isFinite(t)?t:null},clampSnap(e){const t=this.useMin,s=this.useMax,a=this.useStep;if(!Number.isFinite(e))return null;let i=Math.max(t,Math.min(s,e));return i=Math.round((i-t)/a)*a+t,i=Math.max(t,Math.min(s,i)),i},snapWithinBounds(){if(null===this.internalValue)return;const e=this.clampSnap(this.internalValue);e!==this.internalValue&&(this.internalValue=e,this.$emit("update:modelValue",e))},onInput(e){const t=Number(e&&e.target?e.target.value:this.internalValue),s=this.clampSnap(t);this.internalValue=s,this.$emit("update:modelValue",s)},onChange(e){const t=Number(e&&e.target?e.target.value:this.internalValue),s=this.clampSnap(t);this.internalValue=s,this.$emit("update:modelValue",s)},onTrackClick(e){if(this.readonly)return;const t=this.$refs.wrap,s=this.$refs.range;if(!t||!s)return;const a=t.getBoundingClientRect(),i=(e.clientX??(e.touches&&e.touches[0]?.clientX))||0,l=(i-a.left)/a.width,n=this.useMin,r=this.useMax,o=n+l*(r-n),d=this.clampSnap(o);this.internalValue=d,this.$emit("update:modelValue",d),s.value=d},markPercent(e){const t=this.useMin,s=this.useMax;return s===t?0:(e-t)/(s-t)*100}}};const Sd=(0,o.A)(Cd,[["render",wd],["__scopeId","data-v-3c3ad86a"]]);var xd=Sd;const Dd={class:"fls-row"},Fd={class:"edge"},Ad=["aria-readonly"],Md=["tabindex","aria-checked","onClick","onKeydown"],Ed={class:"edge"};function Vd(e,t,s,a,l,n){return(0,i.uX)(),(0,i.CE)("div",{class:(0,m.C4)(["fls-wrap",{readonly:s.readonly}])},[(0,i.Lk)("div",Dd,[(0,i.Lk)("span",Fd,(0,m.v_)(s.leftLabel),1),(0,i.Lk)("div",{class:"fls-scale",role:"radiogroup","aria-readonly":s.readonly?"true":"false"},[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.points,e=>((0,i.uX)(),(0,i.CE)("button",{key:e,class:(0,m.C4)(["fls-point",{active:s.modelValue===e}]),type:"button",tabindex:s.readonly?-1:0,"aria-checked":s.modelValue===e?"true":"false",role:"radio",onClick:t=>n.onPick(e),onKeydown:t=>n.onKey(t,e)},(0,m.v_)(e),43,Md))),128))],8,Ad),(0,i.Lk)("span",Ed,(0,m.v_)(s.rightLabel),1)])],2)}var Id={name:"FieldLinearScale",emits:["update:modelValue"],props:{modelValue:{type:[Number,null],default:null},min:{type:Number,default:1},max:{type:Number,default:5},leftLabel:{type:String,default:""},rightLabel:{type:String,default:""},readonly:{type:Boolean,default:!1}},computed:{safeMin(){const e=Number.isFinite(this.min)?this.min:1;return Math.max(1,Math.round(e))},safeMax(){const e=Number.isFinite(this.max)?this.max:5,t=Math.min(10,Math.round(e));return Math.max(this.safeMin+1,t)},points(){const e=[];for(let t=this.safeMin;t<=this.safeMax;t++)e.push(t);return e}},methods:{onPick(e){this.readonly||this.$emit("update:modelValue",e)},onKey(e,t){if(this.readonly)return;if(" "===e.key||"Enter"===e.key)return e.preventDefault(),void this.onPick(t);let s=0;if("ArrowLeft"===e.key||"ArrowDown"===e.key?s=-1:"ArrowRight"!==e.key&&"ArrowUp"!==e.key||(s=1),0!==s){e.preventDefault();const t=Number.isFinite(this.modelValue)?this.modelValue:this.safeMin,a=Math.min(this.safeMax,Math.max(this.safeMin,t+s));this.$emit("update:modelValue",a)}}}};const _d=(0,o.A)(Id,[["render",Vd],["__scopeId","data-v-229938b0"]]);var $d=_d;const Xd={key:0,class:"uploader"},jd=["accept","disabled","multiple"],Ud=["disabled"],Td={key:0,class:"meta"},Nd={class:"file-row"},Rd=["title"],Pd={class:"size"},Bd={key:0,class:"meta-dot"},Od={key:1,class:"mime"},qd={key:0,class:"note"},Kd={key:1,class:"meta"},Wd=["title"],zd={class:"size"},Qd={key:0,class:"meta-dot"},Gd={key:1,class:"mime"},Jd=["onClick"],Yd={key:0,class:"note"},Hd={key:1,class:"url-box"},Zd={key:0},eu={class:"url-add-row"},tu=["placeholder","readonly"],su=["disabled"],au={key:0,class:"meta"},iu=["title"],lu=["onClick"],nu={key:1,class:"url-row"},ru=["placeholder","value","readonly"],ou={class:"rules"},du={key:0,class:"help"},uu={key:2,class:"error"};function cu(e,t,s,l,n,r){return(0,i.uX)(),(0,i.CE)("div",{class:(0,m.C4)(["field-file-upload",{readonly:s.readonly,invalid:!!n.error}])},["local"===r.storagePreference?((0,i.uX)(),(0,i.CE)("div",Xd,[(0,i.Lk)("input",{ref:"fileInput",type:"file",accept:r.acceptAttr,class:"hidden-file-input",disabled:s.readonly,multiple:r.isMultiple,onChange:t[0]||(t[0]=(...e)=>r.onFilePicked&&r.onFilePicked(...e))},null,40,jd),(0,i.Lk)("button",{class:"attach-btn",type:"button",disabled:s.readonly,onClick:t[1]||(t[1]=(...e)=>r.triggerPick&&r.triggerPick(...e)),title:"Choose file(s)"},[(0,i.Lk)("i",{class:(0,m.C4)(n.icons.paperclip)},null,2),(0,i.eW)(" "+(0,m.v_)(r.attachLabel),1)],8,Ud),!r.isMultiple&&r.singleLocal?((0,i.uX)(),(0,i.CE)("div",Td,[(0,i.Lk)("div",Nd,[(0,i.Lk)("span",{class:"name",title:r.singleLocal.name},(0,m.v_)(r.singleLocal.name),9,Rd),t[8]||(t[8]=(0,i.Lk)("span",{class:"meta-dot"},"•",-1)),(0,i.Lk)("span",Pd,(0,m.v_)(r.humanSize(r.singleLocal.size)),1),r.singleLocal.type?((0,i.uX)(),(0,i.CE)("span",Bd,"•")):(0,i.Q3)("",!0),r.singleLocal.type?((0,i.uX)(),(0,i.CE)("span",Od,(0,m.v_)(r.singleLocal.type),1)):(0,i.Q3)("",!0),(0,i.Lk)("button",{class:"icon-inline danger",type:"button",onClick:t[2]||(t[2]=(...e)=>r.clearValue&&r.clearValue(...e)),title:"Remove"},[(0,i.Lk)("i",{class:(0,m.C4)(n.icons.trash)},null,2)])]),r.isBuilderStage?((0,i.uX)(),(0,i.CE)("small",qd,[...t[9]||(t[9]=[(0,i.eW)(" Files are ",-1),(0,i.Lk)("b",null,"not persisted",-1),(0,i.eW)(" during study creation. This control captures metadata only. ",-1)])])):(0,i.Q3)("",!0)])):r.isMultiple&&r.localItems.length?((0,i.uX)(),(0,i.CE)("div",Kd,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.localItems,(e,s)=>((0,i.uX)(),(0,i.CE)("div",{class:"file-row",key:`${e.name}-${e.size}-${e.lastModified}-${s}`},[(0,i.Lk)("span",{class:"name",title:e.name},(0,m.v_)(e.name),9,Wd),t[10]||(t[10]=(0,i.Lk)("span",{class:"meta-dot"},"•",-1)),(0,i.Lk)("span",zd,(0,m.v_)(r.humanSize(e.size)),1),e.type?((0,i.uX)(),(0,i.CE)("span",Qd,"•")):(0,i.Q3)("",!0),e.type?((0,i.uX)(),(0,i.CE)("span",Gd,(0,m.v_)(e.type),1)):(0,i.Q3)("",!0),(0,i.Lk)("button",{class:"icon-inline danger",type:"button",onClick:e=>r.removeLocalAt(s),title:"Remove"},[(0,i.Lk)("i",{class:(0,m.C4)(n.icons.trash)},null,2)],8,Jd)]))),128)),r.isBuilderStage?((0,i.uX)(),(0,i.CE)("small",Yd,[...t[11]||(t[11]=[(0,i.eW)(" Files are ",-1),(0,i.Lk)("b",null,"not persisted",-1),(0,i.eW)(" during study creation. This control captures metadata only. ",-1)])])):(0,i.Q3)("",!0)])):(0,i.Q3)("",!0)])):"url"===r.storagePreference?((0,i.uX)(),(0,i.CE)("div",Hd,[r.isMultiple?((0,i.uX)(),(0,i.CE)("div",Zd,[(0,i.Lk)("div",eu,[(0,i.bo)((0,i.Lk)("input",{type:"url",placeholder:r.urlPlaceholder,"onUpdate:modelValue":t[3]||(t[3]=e=>n.localUrl=e),readonly:s.readonly,onKeydown:t[4]||(t[4]=(0,a.jR)((0,a.D$)((...e)=>r.addUrl&&r.addUrl(...e),["prevent"]),["enter"]))},null,40,tu),[[a.Jo,n.localUrl]]),(0,i.Lk)("button",{class:"btn-option add-url-btn",type:"button",disabled:s.readonly,onClick:t[5]||(t[5]=(...e)=>r.addUrl&&r.addUrl(...e))}," Add ",8,su)]),r.urlItems.length?((0,i.uX)(),(0,i.CE)("div",au,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.urlItems,(e,t)=>((0,i.uX)(),(0,i.CE)("div",{class:"file-row",key:`${e.url}-${t}`},[(0,i.Lk)("span",{class:"name",title:e.url},(0,m.v_)(r.truncate(e.url,60)),9,iu),(0,i.Lk)("button",{class:"icon-inline danger",type:"button",onClick:e=>r.removeUrlAt(t),title:"Remove"},[(0,i.Lk)("i",{class:(0,m.C4)(n.icons.trash)},null,2)],8,lu)]))),128))])):(0,i.Q3)("",!0),t[12]||(t[12]=(0,i.Lk)("small",{class:"note"}," Use stable, accessible URLs (institutional storage, or DOI). ",-1))])):((0,i.uX)(),(0,i.CE)("div",nu,[(0,i.Lk)("input",{type:"url",placeholder:r.urlPlaceholder,value:r.displayedUrl,onInput:t[6]||(t[6]=(...e)=>r.onUrlInput&&r.onUrlInput(...e)),onBlur:t[7]||(t[7]=(...e)=>r.onUrlBlur&&r.onUrlBlur(...e)),readonly:s.readonly},null,40,ru),t[13]||(t[13]=(0,i.Lk)("small",{class:"note"}," Use a stable, accessible URL (institutional storage, or DOI). ",-1))]))])):(0,i.Q3)("",!0),(0,i.Lk)("div",ou,[r.helpText?((0,i.uX)(),(0,i.CE)("small",du,(0,m.v_)(r.helpText),1)):(0,i.Q3)("",!0)]),n.error?((0,i.uX)(),(0,i.CE)("div",uu,(0,m.v_)(n.error),1)):(0,i.Q3)("",!0)],2)}const pu=1024,mu=1024*pu,hu=[],yu=null;var gu={name:"FieldFileUpload",props:{value:{type:[Object,Array,null],default:null},constraints:{type:Object,default:()=>({})},readonly:{type:Boolean,default:!1},required:{type:Boolean,default:!1},stage:{type:String,default:"builder"}},data(){return{icons:ae.A,localUrl:"",error:""}},computed:{isBuilderStage(){return"builder"===(this.stage||"builder")},helpText(){return this.constraints?.helpText||""},storagePreference(){const e=(this.constraints?.storagePreference||"local").toLowerCase();return"url"===e?"url":"local"},isMultiple(){const e=this.constraints?.allowMultipleFiles;return void 0===e||!!e},maxSizeMB(){const e=Number(this.constraints?.maxSizeMB);return Number.isFinite(e)&&e>0?e:null},effectiveMaxSizeMB(){return this.maxSizeMB??yu},allowedFormats(){const e=Array.isArray(this.constraints?.allowedFormats)?this.constraints.allowedFormats:[];return e.map(String).map(e=>e.trim()).filter(Boolean)},effectiveAllowedFormats(){return this.allowedFormats.length?this.allowedFormats:hu},acceptAttr(){return this.effectiveAllowedFormats.join(",")},attachLabel(){return"local"===this.storagePreference?this.isMultiple?"Attach files":this.value?"Change file":"Attach file":this.isMultiple?"Add links":"Add link"},singleLocal(){const e=this.value;return e&&!Array.isArray(e)&&"local"===e.source?e:null},localItems(){if(!this.isMultiple)return[];const e=this.value,t=Array.isArray(e)?e:[];return t.filter(e=>e&&"local"===e.source)},urlItems(){if("url"!==this.storagePreference)return[];if(!this.isMultiple)return[];const e=this.value,t=Array.isArray(e)?e:[];return t.filter(e=>e&&"url"===e.source)},urlPlaceholder(){return"https://example.org/path/to/large/file"},displayedUrl(){return this.value&&!Array.isArray(this.value)&&"url"===this.value.source?this.value.url||"":this.localUrl}},mounted(){this.value&&!Array.isArray(this.value)&&"url"===this.value.source&&(this.localUrl=this.value.url||"")},methods:{triggerPick(){this.readonly||this.$refs.fileInput&&this.$refs.fileInput.click()},onFilePicked(e){this.error="";const t=Array.from(e?.target?.files||[]);if(!t.length)return;const s=[];for(const a of t)this.effectiveMaxSizeMB&&a.size>this.effectiveMaxSizeMB*mu?this.error=`File exceeds max size (${this.effectiveMaxSizeMB} MB).`:!this.effectiveAllowedFormats.length||this.matchesAccept(a,this.effectiveAllowedFormats)?s.push(a):this.error=`Invalid type. Allowed: ${this.effectiveAllowedFormats.join(", ")}.`;if(s.length){if(this.isMultiple){const e=s.map(e=>({source:"local",name:e.name,size:e.size,type:e.type||"",lastModified:e.lastModified||null})),t=Array.isArray(this.value)?this.value.slice():[],a=e=>`${e.name}|${e.size}|${e.lastModified??""}`,i=new Set(t.map(a));for(const s of e)i.has(a(s))||(i.add(a(s)),t.push(s));this.$emit("input",t),this.$emit("file-selected",s)}else{const e=s[0],t={source:"local",name:e.name,size:e.size,type:e.type||"",lastModified:e.lastModified||null};this.$emit("input",t),this.$emit("file-selected",e)}e.target.value=""}else e.target.value=""},onUrlInput(e){this.localUrl=e.target.value},onUrlBlur(){if(this.isMultiple)return;const e=String(this.localUrl||"").trim();if(!e)return void this.$emit("input",null);let t;try{t=new URL(e)}catch{return void(this.error="Invalid URL.")}/^https?:$/.test(t.protocol)?(this.error="",this.$emit("input",{source:"url",url:e})):this.error="Only http(s) URLs are supported."},addUrl(){if(!this.isMultiple)return;const e=String(this.localUrl||"").trim();if(!e)return;let t;try{t=new URL(e)}catch{return void(this.error="Invalid URL.")}if(!/^https?:$/.test(t.protocol))return void(this.error="Only http(s) URLs are supported.");this.error="";const s=Array.isArray(this.value)?this.value.slice():[];s.some(t=>t&&"url"===t.source&&t.url===e)||(s.push({source:"url",url:e}),this.$emit("input",s)),this.localUrl=""},removeLocalAt(e){if(!this.isMultiple)return;const t=Array.isArray(this.value)?this.value.slice():[],s=t.map((e,t)=>({it:e,i:t})).filter(e=>e.it&&"local"===e.it.source).map(e=>e.i),a=s[e];void 0!==a&&(t.splice(a,1),this.$emit("input",t))},removeUrlAt(e){if(!this.isMultiple)return;const t=Array.isArray(this.value)?this.value.slice():[],s=t.map((e,t)=>({it:e,i:t})).filter(e=>e.it&&"url"===e.it.source).map(e=>e.i),a=s[e];void 0!==a&&(t.splice(a,1),this.$emit("input",t))},clearValue(){this.error="",this.localUrl="",this.$emit("input",this.isMultiple?[]:null)},humanSize(e){return Number.isFinite(e)?e>=1048576?`${(e/1048576).toFixed(2)} MB`:e>=1024?`${(e/1024).toFixed(1)} KB`:`${e} B`:""},truncate(e,t){const s=String(e||"");return s.length>t?s.slice(0,t-1)+"…":s},matchesAccept(e,t){const s=e.name?.toLowerCase()||"",a=(e.type||"").toLowerCase(),i=t.map(e=>e.trim().toLowerCase()).filter(Boolean);return!i.length||i.some(e=>{if(e.endsWith("/*")){const t=e.slice(0,-2);return a.startsWith(t+"/")}return e.startsWith(".")?s.endsWith(e):e.includes("/")?a===e:s.endsWith("."+e.replace(/^\./,""))})}}};const fu=(0,o.A)(gu,[["render",cu],["__scopeId","data-v-27286dd7"]]);var vu=fu,ku={name:"ScratchFormComponent",components:{ShaclComponents:Ea,ProtocolMatrix:Pn,FieldConstraintsDialog:td,FormPreview:Nl,DateFormatPicker:Mo,FieldCheckbox:nd,FieldRadioGroup:md,FieldTime:Jo,FieldSlider:xd,FieldLinearScale:$d,FieldFileUpload:vu},data(){return{forms:JSON.parse(localStorage.getItem("scratchForms")||"[]"),currentFormIndex:0,activeSection:0,activeTab:"template",generalFields:[],dataModels:[],shaclComponents:[],showModelDialog:!1,currentModel:null,selectedProps:[],showMatrix:!1,visits:[],groups:[],assignments:[],showConfirmDialog:!1,confirmDialogMessage:"",confirmCallback:null,showGenericDialog:!1,genericDialogMessage:"",genericCallback:null,showConstraintsDialog:!1,constraintsForm:{},currentFieldType:"",currentFieldIndices:{},showPreviewDialog:!1,showUploadDialog:!1,showInputDialog:!1,inputDialogMessage:"",inputDialogValue:"",inputDialogCallback:null}},computed:{icons(){return ae.A},studyDetails(){return this.$store.state.studyDetails||{}},currentForm(){return this.forms[this.currentFormIndex]||{sections:[]}},selectedModels(){return this.currentForm.sections.map(e=>({title:e.title,fields:e.fields}))}},watch:{visits:{handler(){this.adjustAssignments()},immediate:!0,deep:!0},groups:{handler(){this.adjustAssignments()},immediate:!0,deep:!0},selectedModels:{handler(){this.adjustAssignments()},immediate:!0,deep:!0},forms:{deep:!0,handler(e){localStorage.setItem("scratchForms",JSON.stringify(e))}}},async mounted(){if(this.studyDetails.study_metadata?.id){const e=localStorage.getItem("scratchForms");if(e)try{this.forms=JSON.parse(e)}catch{this.forms=[{sections:[]}]}else Array.isArray(this.studyDetails.forms)?(this.forms=JSON.parse(JSON.stringify(this.studyDetails.forms)),localStorage.setItem("scratchForms",JSON.stringify(this.forms))):(this.forms=[{sections:[]}],localStorage.setItem("scratchForms",JSON.stringify(this.forms)))}else localStorage.removeItem("scratchForms"),this.forms=[{sections:[]}];this.visits=Array.isArray(this.studyDetails.visits)?JSON.parse(JSON.stringify(this.studyDetails.visits)):[],this.groups=Array.isArray(this.studyDetails.groups)?JSON.parse(JSON.stringify(this.studyDetails.groups)):[],this.adjustAssignments();try{const e=await se.A.get("/forms/available-fields");this.generalFields=e.data.map((e,t)=>({...e,name:e.name||`${e.type}_${t}`,description:e.helpText||e.placeholder||"",options:"select"===e.type||"radio"===e.type?Array.isArray(e.options)&&e.options.length?e.options:["Option 1"]:e.options||[],constraints:e.constraints||{}}))}catch(e){console.error("Failed to load custom fields",e)}await this.loadDataModels()},methods:{goBack(){this.$router.back()},prettyModelTitle(e){return this.$formatLabel?this.$formatLabel(e):String(e||"")},modelIcon(e){const t=String(e||"").toLowerCase().replace(/[^a-z0-9]/g,"");return this.icons[t]||"fas fa-book"},fieldIcon(e){const t=String(e||"").toLowerCase().replace(/[^a-z0-9]/g,"");return this.icons[t]||"fas fa-dot-circle"},onSectionClick(e){this.activeSection=e;const t=this.currentForm.sections[e];t&&t.collapsed&&(t.collapsed=!1),this.focusSection(e)},openConfirmDialog(e,t){this.confirmDialogMessage=e,this.confirmCallback=t,this.showConfirmDialog=!0},confirmDialogYes(){this.showConfirmDialog=!1,this.confirmCallback&&this.confirmCallback()},closeConfirmDialog(){this.showConfirmDialog=!1},openGenericDialog(e,t){this.genericDialogMessage=e,this.genericCallback=t,this.showGenericDialog=!0},closeGenericDialog(){this.showGenericDialog=!1,this.genericCallback&&this.genericCallback()},openInputDialog(e,t,s){this.inputDialogMessage=e,this.inputDialogValue=t,this.inputDialogCallback=s,this.showInputDialog=!0},confirmInputDialog(){this.showInputDialog=!1,this.inputDialogCallback&&this.inputDialogCallback(this.inputDialogValue)},cancelInputDialog(){this.showInputDialog=!1},adjustAssignments(){const e=this.selectedModels.length,t=this.visits.length,s=this.groups.length;if(0!==e&&0!==t&&0!==s)if(this.studyDetails.study_metadata?.id&&Array.isArray(this.studyDetails.assignments)){const a=this.studyDetails.assignments,i=[];for(let l=0;l<e;l++){i[l]=[];for(let e=0;e<t;e++){i[l][e]=[];for(let t=0;t<s;t++){const s=a[l]?.[e]?.[t];i[l][e][t]="boolean"===typeof s&&s}}}this.assignments=i}else this.assignments=Array.from({length:e},()=>Array.from({length:t},()=>Array.from({length:s},()=>!1)));else this.assignments=[]},handleProtocolClick(){this.showMatrix=!0},editTemplate(){this.showMatrix=!1},onAssignmentUpdated({mIdx:e,vIdx:t,gIdx:s,checked:a}){this.assignments[e][t][s]=a,this.$store.commit("setStudyDetails",{...this.studyDetails,assignments:this.assignments})},focusSection(e){this.$nextTick(()=>{const t=this.$refs[`section-${e}`],s=Array.isArray(t)?t[0]:t;s?.scrollIntoView&&s.scrollIntoView({behavior:"smooth",block:"start"})})},openModelDialog(e){this.currentModel=e,this.selectedProps=e.fields.map(()=>!1),this.showModelDialog=!0},takeoverModel(){const e=this.currentModel.fields.filter((e,t)=>this.selectedProps[t]).map(e=>({...e,description:e.description||"",constraints:e.constraints||{}})),t=Math.min(this.activeSection+1,this.currentForm.sections.length),s={title:this.currentModel.title,fields:e,collapsed:!1,source:"template"};this.forms[this.currentFormIndex].sections.splice(t,0,s),this.activeSection=t,this.$nextTick(()=>this.focusSection(t)),this.adjustAssignments(),this.showModelDialog=!1},addNewSection(){const e={title:`Section ${this.currentForm.sections.length+1}`,fields:[],collapsed:!1,source:"manual"};this.forms[this.currentFormIndex].sections.push(e),this.activeSection=this.currentForm.sections.length-1,this.adjustAssignments(),this.focusSection(this.activeSection)},addNewSectionBelow(e){const t=this.currentForm.sections[e],s={title:`${t.title} (Copy)`,fields:t.fields.map(e=>({...e,name:`${e.name}_${Date.now()}`,constraints:e.constraints||{}})),collapsed:!1,source:t.source},a=e+1;this.forms[this.currentFormIndex].sections.splice(a,0,s),this.activeSection=a,this.adjustAssignments(),this.focusSection(a)},confirmDeleteSection(e){this.openConfirmDialog("Delete this section?",()=>{this.currentForm.sections.splice(e,1),this.activeSection=Math.max(0,this.activeSection-1),this.adjustAssignments()})},confirmClearForm(){this.openConfirmDialog("Do you want to clear all sections?",()=>{this.forms[this.currentFormIndex].sections=[],this.activeSection=0,this.adjustAssignments()})},toggleSection(e){const t=this.forms[this.currentFormIndex].sections[e];t.collapsed=!t.collapsed},setActiveSection(e){this.activeSection=e,this.focusSection(e)},addFieldToActiveSection(e){this.currentForm.sections.length||this.addNewSection();const t=this.currentForm.sections[this.activeSection];t.collapsed&&this.toggleSection(this.activeSection);const s={name:`${e.name||e.type}_${Date.now()}`,label:e.label,type:e.type,options:"select"===e.type||"radio"===e.type?Array.isArray(e.options)&&e.options.length?[...e.options]:["Option 1"]:e.options||[],placeholder:e.description||e.placeholder||"",value:"checkbox"!==e.type&&"",constraints:e.constraints||{}};if("slider"===s.type&&(s.value=null,s.constraints={...s.constraints||{},mode:s.constraints?.mode||"slider",percent:!!s.constraints?.percent,min:Number.isFinite(s.constraints?.min)?s.constraints.min:(s.constraints,1),max:Number.isFinite(s.constraints?.max)?s.constraints.max:(s.constraints,100),step:Number.isFinite(s.constraints?.step)?s.constraints.step:1,marks:Array.isArray(s.constraints?.marks)?s.constraints.marks:s.constraints?.marks||[]}),"date"===s.type&&(s.constraints={...s.constraints,dateFormat:s.constraints?.dateFormat||"dd.MM.yyyy"},s.placeholder=s.placeholder||s.constraints.dateFormat),"file"===s.type){s.value=null,s.icon=s.icon||ae.A.paperclip;const e=s.constraints||{},t=String(s.label||"").trim()||s.name;s.constraints={helpText:e.helpText||"",required:!!e.required,readonly:!!e.readonly,allowedFormats:Array.isArray(e.allowedFormats)?e.allowedFormats.map(String).map(e=>e.trim()).filter(Boolean):[],maxSizeMB:Number.isFinite(e.maxSizeMB)&&Number(e.maxSizeMB)>0?Number(e.maxSizeMB):void 0,storagePreference:"url"===e.storagePreference?"url":"local",modalities:Array.isArray(e.modalities)&&e.modalities.length?e.modalities:[t],allowMultipleFiles:void 0===e.allowMultipleFiles||!!e.allowMultipleFiles}}t.fields.push(s)},editSection(e,t){t&&(this.currentForm.sections[e].title=t)},editField(e,t,s){if(!s)return;const a=this.currentForm.sections[e].fields[t],i=a.label;if(a.label=s,"file"===a.type){const e=Array.isArray(a.constraints?.modalities)?a.constraints.modalities:[],t=String(i||"").trim();if(!e.length||1===e.length&&String(e[0]||"").trim()===t){const e=String(s||"").trim()||a.name;a.constraints={...a.constraints||{},modalities:[e]}}}},enforceNumberDigitLimits(e,t,s,a=!1){const i=this.currentForm.sections[e].fields[t],l=i.constraints||{};if(!l.integerOnly)return;const n=s?.target||null;let r=String(n?n.value??"":i.value??"");const o=r.replace(/\D+/g,"");if(Number.isFinite(l.maxDigits)&&l.maxDigits>0&&o.length>l.maxDigits){const e=o.slice(0,l.maxDigits);return i.value=""===e?"":Number(e),void(n&&(n.value=i.value))}a&&Number.isFinite(l.minDigits)&&l.minDigits>0&&o.length>0&&(o.length,l.minDigits)},addSimilarField(e,t){const s=this.currentForm.sections[e].fields[t],a={...s,name:`${s.name}_${Date.now()}`,options:s.options?[...s.options]:[],constraints:s.constraints||{},value:"radio"===s.type&&s.constraints?.allowMultiple?[]:"radio"===s.type||"select"===s.type?"":"slider"===s.type||"file"===s.type?null:s.value};this.currentForm.sections[e].fields.splice(t+1,0,a)},removeField(e,t){this.currentForm.sections[e].fields.splice(t,1)},openConstraintsDialog(e,t){const s=this.currentForm.sections[e].fields[t];this.currentFieldIndices={sectionIndex:e,fieldIndex:t},this.currentFieldType="slider"===s.type?"slider":s.type,this.constraintsForm={...s.constraints||{},type:this.currentFieldType,options:"select"===s.type||"radio"===s.type?s.options||[]:void 0,dateFormat:"date"===s.type?s.constraints?.dateFormat||"dd.MM.yyyy":void 0,..."slider"===s.type?{mode:"linear"===s.constraints?.mode?"linear":"slider",min:Number.isFinite(s.constraints?.min)?s.constraints.min:1,max:Number.isFinite(s.constraints?.max)?s.constraints.max:100,step:Number.isFinite(s.constraints?.step)?s.constraints.step:1,percent:!!s.constraints?.percent}:{}},this.showConstraintsDialog=!0},confirmConstraintsDialog(e){const{sectionIndex:t,fieldIndex:s}=this.currentFieldIndices,a=this.currentForm.sections[t].fields[s],i=a.type;if("file"===i){const t={helpText:e.helpText||"",required:!!e.required,readonly:!!e.readonly,allowedFormats:Array.isArray(e.allowedFormats)?e.allowedFormats:[],maxSizeMB:Number.isFinite(e.maxSizeMB)&&e.maxSizeMB>0?Number(e.maxSizeMB):void 0,storagePreference:"url"===e.storagePreference?"url":"local",modalities:Array.isArray(e.modalities)?e.modalities.filter(Boolean).map(String):[],allowMultipleFiles:!1!==e.allowMultipleFiles};if(!t.modalities.length){const e=String(a.label||"").trim()||a.name;t.modalities=[e],console.log("[ScratchForm] Constraints: defaulted modalities to",t.modalities,"for",e)}return a.constraints=t,void(this.showConstraintsDialog=!1)}if("slider"!==i){const t=Co(i,e);if(("select"===a.type||"radio"===a.type)&&Array.isArray(e.options)){const t=e.options.map(e=>String(e||"").trim()).filter(Boolean);a.options=t.length?t:["Option 1"]}if("radio"===a.type){if(t.allowMultiple){if(Array.isArray(a.value)||(a.value=[]),a.value=a.value.filter(e=>a.options.includes(e)),Object.prototype.hasOwnProperty.call(t,"defaultValue")){const e=Array.isArray(t.defaultValue)?t.defaultValue:[];a.value=e.filter(e=>a.options.includes(e))}}else if(Array.isArray(a.value)&&(a.value=a.value[0]||""),a.options.includes(a.value)||(a.value=""),Object.prototype.hasOwnProperty.call(t,"defaultValue")){const e="string"===typeof t.defaultValue?t.defaultValue:"";a.value=a.options.includes(e)?e:""}}else if("select"===a.type&&(Array.isArray(a.value)&&(a.value=a.value[0]||""),a.options.includes(a.value)||(a.value=""),Object.prototype.hasOwnProperty.call(t,"defaultValue"))){const e="string"===typeof t.defaultValue?t.defaultValue:"";a.value=a.options.includes(e)?e:""}if(Object.prototype.hasOwnProperty.call(t,"placeholder")&&"checkbox"!==a.type&&"file"!==a.type&&(a.placeholder=t.placeholder||""),"radio"!==a.type&&"select"!==a.type&&"slider"!==a.type&&"file"!==a.type&&Object.prototype.hasOwnProperty.call(t,"defaultValue")){const e=wo(a.type,t.defaultValue);void 0!==e&&(a.value=e)}if("date"===a.type&&(e.dateFormat||t.dateFormat)){const s=e.dateFormat||t.dateFormat;a.placeholder=s,t.dateFormat=s}if("file"===i){const s=["allowedFormats","maxSizeMB","allowLocal","allowUrl","storagePreference","modalities","allowMultipleFiles"],i={};s.forEach(t=>{Object.prototype.hasOwnProperty.call(e,t)&&(i[t]=e[t])}),a.constraints={...t,...i}}else a.constraints={...t};return""!==a.value&&void 0!==a.value&&null!==a.value||!Object.prototype.hasOwnProperty.call(a.constraints,"defaultValue")||"file"===a.type||(a.value=a.constraints.defaultValue),void(this.showConstraintsDialog=!1)}if("linear"===e.mode){let t=Number.isFinite(+e.min)?Math.round(+e.min):1,s=Number.isFinite(+e.max)?Math.round(+e.max):5;return s<=t&&(s=t+1),s-t+1>10&&(s=t+9),a.constraints={mode:"linear",required:!!e.required,readonly:!!e.readonly,helpText:e.helpText||"",min:t,max:s,leftLabel:e.leftLabel||"",rightLabel:e.rightLabel||""},a.value=null,void(this.showConstraintsDialog=!1)}let l=Number.isFinite(+e.min)?+e.min:1,n=Number.isFinite(+e.max)?+e.max:e.percent?100:5;n<=l&&(n=l+1);let r=Number.isFinite(+e.step)&&+e.step>0?+e.step:(e.percent,1);a.constraints={mode:"slider",required:!!e.required,readonly:!!e.readonly,helpText:e.helpText||"",percent:!!e.percent,min:l,max:n,step:r,marks:Array.isArray(e.marks)?e.marks:[]};const o=Number(a.value);a.value=Number.isFinite(o)&&o>=l&&o<=n?o:null,this.showConstraintsDialog=!1},cancelConstraintsDialog(){this.showConstraintsDialog=!1},saveForm(){this.openGenericDialog("Saved!")},downloadFormData(){const e={sections:this.currentForm.sections.map(e=>({title:e.title,fields:e.fields,source:e.source}))},t=JSON.stringify(e,null,2),s="sections.json",a=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(a),l=document.createElement("a");l.href=i,l.download=s,l.click(),URL.revokeObjectURL(i)},openUploadDialog(){this.showUploadDialog=!0},closeUploadDialog(){this.showUploadDialog=!1},handleFileChange(e){const t=e.target.files[0];if(!t)return this.openGenericDialog("No file selected.");const s=new FileReader;s.onload=e=>{try{const t=JSON.parse(e.target.result);if(!Array.isArray(t.sections))throw new Error("Bad format");t.sections=t.sections.map(e=>({...e,fields:e.fields.map(e=>({...e,constraints:e.constraints||{}}))})),this.currentForm.sections=t.sections,this.adjustAssignments()}catch(t){console.error(t),this.openGenericDialog('Invalid file. Expect `{ "sections": [...] }`.')}},s.readAsText(t),this.showUploadDialog=!1},async loadDataModels(){try{const e=await fetch("/template_schema.yaml"),t=Ms().load(await e.text());this.dataModels=Object.entries(t.classes).filter(([e])=>"Study"!==e).map(([e,t])=>({title:e,description:t.description||"",fields:Object.entries(t.attributes).map(([e,t])=>({name:e,label:t.label||this.prettyModelTitle(e),description:t.description||"",type:this.resolveType(t),options:t.enum||[],rows:t.ui?.rows,constraints:{required:!!t.required,...t.constraints||{}},placeholder:t.ui?.placeholder||t.description||""}))}))}catch(e){console.error("Failed to load data models:",e)}},resolveType(e){const t=e.ui||{},s=String(e.datatype||"").toLowerCase(),a=String(e.range||"").toLowerCase();return"textarea"===t.widget||"textarea"===s?"textarea":"radio"===t.widget||"radio"===s?"radio":"dropdown"===t.widget||"dropdown"===s||e.enum?"select":"date"===a||"datetime"===a?"date":["integer","decimal","number"].includes(a)?"number":"file"===t.widget||"file"===s||"file"===a?"file":"text"}}};const bu=(0,o.A)(ku,[["render",Fs],["__scopeId","data-v-157437d1"]]);var Lu=bu;const wu={key:0,class:"study-data-container"},Cu={key:0,class:"back-buttons-container"},Su={class:"study-header-container"},xu={class:"study-header"},Du={class:"study-name"},Fu={class:"study-description"},Au={class:"study-meta"},Mu={key:0,class:"shared-banner"},Eu={class:"details-panel"},Vu={class:"details-controls"},Iu={key:0,class:"details-content"},_u={class:"details-block"},$u={key:0,class:"details-block"},Xu={key:1},ju={key:0,class:"boot-message"},Uu={class:"matrix-toolbar"},Tu={class:"matrix-toolbar-left"},Nu={class:"visit-filter"},Ru=["value"],Pu={key:0,class:"version-helper",title:"All new data will be saved on the latest template version"},Bu={class:"matrix-wrap"},Ou={key:0,class:"busy-overlay"},qu=["onClick"],Ku={key:2,class:"entry-form-wrapper"},Wu={class:"bread-crumb"},zu={class:"crumb-left"},Qu={key:0,class:"version-helper"},Gu={class:"entry-form-section"},Ju={key:0},Yu=["for"],Hu={key:0,class:"required"},Zu={key:1,class:"help-inline"},ec=["onClick"],tc=["id","onUpdate:modelValue","placeholder","required","readonly","minlength","maxlength","pattern","onBlur","onInput"],sc=["id","onUpdate:modelValue","placeholder","required","readonly","minlength","maxlength","pattern","onBlur","onInput"],ac=["id","onUpdate:modelValue","placeholder","required","readonly","min","max","step","onBlur","onInput"],ic=["id","onUpdate:modelValue","placeholder","required","readonly","onBlur","onInput"],lc={key:12,class:"error-message"},nc={key:0,class:"skip-pill",title:"Required validation skipped for this field"},rc={key:13,class:"error-message"},oc={class:"form-actions"},dc=["disabled","title"],uc=["disabled"],cc={key:1,class:"no-assigned"},pc={key:3,class:"dialog-overlay"},mc={class:"dialog"},hc={class:"dialog-actions"},yc={key:0},gc=["href"],fc={key:4,class:"dialog-overlay"},vc={class:"dialog"},kc={class:"dialog-actions"},bc={class:"mini-dialog",role:"dialog","aria-modal":"true"},Lc={class:"mini-head"},wc={class:"mini-title"},Cc={class:"mini-list"},Sc={class:"mini-dialog",role:"dialog","aria-modal":"true"},xc={class:"mini-head"},Dc={class:"mini-dialog",role:"dialog","aria-modal":"true"},Fc={class:"mini-head"},Ac={key:8,class:"dialog-overlay"},Mc={class:"dialog dialog-wide"},Ec={class:"skip-list"},Vc={class:"skip-left"},Ic={class:"skip-title"},_c={class:"skip-right"},$c={class:"skip-chk"},Xc=["onUpdate:modelValue"],jc=["onClick"],Uc={class:"dialog-actions"},Tc=["disabled"],Nc={key:1,class:"loading"};function Rc(e,t,s,l,n,r){const o=(0,i.g2)("FieldCheckbox"),d=(0,i.g2)("FieldRadioGroup"),u=(0,i.g2)("DateFormatPicker"),c=(0,i.g2)("FieldTime"),p=(0,i.g2)("FieldSelect"),h=(0,i.g2)("FieldSlider"),y=(0,i.g2)("FieldLinearScale"),g=(0,i.g2)("FieldFileUpload"),f=(0,i.g2)("CustomDialog");return n.study?((0,i.uX)(),(0,i.CE)("div",wu,[r.isShared?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",Cu,[n.showSelection?((0,i.uX)(),(0,i.CE)("button",{key:0,onClick:t[0]||(t[0]=(...e)=>r.goToDashboard&&r.goToDashboard(...e)),class:"btn-back"},[(0,i.Lk)("i",{class:(0,m.C4)(n.icons.back)},null,2),t[23]||(t[23]=(0,i.eW)(" Back to Dashboard ",-1))])):(0,i.Q3)("",!0),n.showSelection?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("button",{key:1,onClick:t[1]||(t[1]=(...e)=>r.backToSelection&&r.backToSelection(...e)),class:"btn-back"},[(0,i.Lk)("i",{class:(0,m.C4)(n.icons.back)},null,2),t[24]||(t[24]=(0,i.eW)(" Back to Selection ",-1))]))])),(0,i.Lk)("div",Su,[(0,i.Lk)("div",xu,[(0,i.Lk)("h1",Du,(0,m.v_)(n.study.metadata.study_name),1),(0,i.Lk)("p",Fu,(0,m.v_)(n.study.metadata.study_description),1),(0,i.Lk)("p",Au," Subjects: "+(0,m.v_)(r.numberOfSubjects)+" | Visits: "+(0,m.v_)(r.visitList.length)+" | Groups: "+(0,m.v_)(r.groupList.length),1),r.isShared?((0,i.uX)(),(0,i.CE)("p",Mu,[t[25]||(t[25]=(0,i.eW)(" Shared link (permission: ",-1)),(0,i.Lk)("strong",null,(0,m.v_)(n.sharedPermission),1),t[26]||(t[26]=(0,i.eW)(") ",-1))])):(0,i.Q3)("",!0)]),(0,i.Lk)("div",Eu,[(0,i.Lk)("div",Vu,[(0,i.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>r.toggleDetails&&r.toggleDetails(...e)),class:"details-toggle-btn"},[(0,i.Lk)("i",{class:(0,m.C4)(n.showDetails?n.icons.toggleUp:n.icons.toggleDown)},null,2),(0,i.eW)(" "+(0,m.v_)(n.showDetails?"Hide Details":"Show Details"),1)]),n.showSelection||r.isShared?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("button",{key:0,class:"share-icon",title:"Share this form link",onClick:t[3]||(t[3]=e=>r.openShareDialog(n.currentSubjectIndex,n.currentVisitIndex,n.currentGroupIndex))},[(0,i.Lk)("i",{class:(0,m.C4)(n.icons.share)},null,2)]))]),n.showDetails?((0,i.uX)(),(0,i.CE)("div",Iu,[(0,i.Lk)("div",_u,[t[27]||(t[27]=(0,i.Lk)("strong",null,"Study Info:",-1)),(0,i.Lk)("ul",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.studyInfoEntries,([e,t])=>((0,i.uX)(),(0,i.CE)("li",{key:e},(0,m.v_)(e)+": "+(0,m.v_)(t),1))),128))])]),n.showSelection?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",$u,[t[28]||(t[28]=(0,i.Lk)("strong",null,"Visit Info:",-1)),(0,i.Lk)("ul",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(Object.entries(r.visitList[n.currentVisitIndex]||{}),([e,t])=>((0,i.uX)(),(0,i.CE)("li",{key:e},(0,m.v_)(e)+": "+(0,m.v_)(t),1))),128))])]))])):(0,i.Q3)("",!0)]),t[29]||(t[29]=(0,i.Lk)("hr",null,null,-1))]),n.showSelection&&!r.isShared?((0,i.uX)(),(0,i.CE)("div",Xu,[n.matrixReady?((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[(0,i.Lk)("div",Uu,[(0,i.Lk)("div",Tu,[(0,i.Lk)("div",Nu,[t[31]||(t[31]=(0,i.Lk)("label",null,"Visit filter",-1)),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>n.selectedVisitIndex=e),class:"visit-select"},[t[30]||(t[30]=(0,i.Lk)("option",{value:-1},"All visits",-1)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.visitList,(e,t)=>((0,i.uX)(),(0,i.CE)("option",{key:"vopt-"+t,value:t},(0,m.v_)(e.name),9,Ru))),128))],512),[[a.u1,n.selectedVisitIndex,void 0,{number:!0}]])]),n.selectedVersion?((0,i.uX)(),(0,i.CE)("div",Pu," Saving to Version "+(0,m.v_)(n.selectedVersion),1)):(0,i.Q3)("",!0)]),(0,i.Lk)("button",{type:"button",class:"legend-icon-btn",onClick:t[5]||(t[5]=(...e)=>r.openStatusLegend&&r.openStatusLegend(...e)),title:"Legend / Color meaning"},[(0,i.Lk)("i",{class:(0,m.C4)(n.icons.info)},null,2)])]),(0,i.Lk)("div",Bu,[n.visitLoading?((0,i.uX)(),(0,i.CE)("div",Ou,[...t[32]||(t[32]=[(0,i.Lk)("div",{class:"spinner"},null,-1)])])):(0,i.Q3)("",!0),(0,i.Lk)("table",{class:(0,m.C4)(["selection-matrix",{fluid:r.isFluidMatrix}])},[(0,i.Lk)("thead",null,[(0,i.Lk)("tr",null,[(0,i.Lk)("th",{class:"subject-col",style:(0,m.Tr)(r.subjectColStyle)},"Subject / Visit",4),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.displayedVisitIndices,e=>((0,i.uX)(),(0,i.CE)("th",{key:"visit-th-"+e,class:"visit-col",style:(0,m.Tr)(r.visitColStyle)},(0,m.v_)(r.visitList[e].name),5))),128))])]),(0,i.Lk)("tbody",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.sd.subjects,(e,t)=>((0,i.uX)(),(0,i.CE)("tr",{key:"sv-row-"+t},[(0,i.Lk)("td",{class:"subject-cell",style:(0,m.Tr)(r.subjectColStyle)},(0,m.v_)(e.id),5),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.displayedVisitIndices,e=>((0,i.uX)(),(0,i.CE)("td",{key:"visit-td-"+t+"-"+e,class:"visit-cell",style:(0,m.Tr)(r.visitColStyle)},[(0,i.Lk)("button",{class:(0,m.C4)(["select-btn",r.statusClassFast(t,e)]),onClick:s=>r.selectCell(t,e)}," Select ",10,qu)],4))),128))]))),128))])],2)])],64)):((0,i.uX)(),(0,i.CE)("div",ju," Preparing visit matrix… "))])):((0,i.uX)(),(0,i.CE)("div",Ku,[(0,i.Lk)("div",Wu,[(0,i.Lk)("div",zu,[t[33]||(t[33]=(0,i.Lk)("strong",null,"Study:",-1)),(0,i.eW)(" "+(0,m.v_)(n.study.metadata.study_name)+" ",1),t[34]||(t[34]=(0,i.Lk)("strong",null,"Subject:",-1)),(0,i.eW)(" "+(0,m.v_)(r.sd.subjects?.[n.currentSubjectIndex]?.id)+" ",1),t[35]||(t[35]=(0,i.Lk)("strong",null,"Visit:",-1)),(0,i.eW)(" "+(0,m.v_)(r.visitList[n.currentVisitIndex].name)+" ",1),!r.isShared&&n.selectedVersion?((0,i.uX)(),(0,i.CE)("span",Qu,"Saving to Version "+(0,m.v_)(n.selectedVersion),1)):(0,i.Q3)("",!0)]),(0,i.Lk)("button",{type:"button",class:"legend-btn",onClick:t[6]||(t[6]=(...e)=>r.openLegendDialog&&r.openLegendDialog(...e)),title:"Legend / What does * mean?"},[(0,i.Lk)("i",{class:(0,m.C4)(n.icons.help||"fas fa-question-circle")},null,2)])]),(0,i.Lk)("div",Gu,[(0,i.Lk)("h2",null," Enter Data for Subject: "+(0,m.v_)(r.sd.subjects?.[n.currentSubjectIndex]?.id)+", Visit: “"+(0,m.v_)(r.visitList[n.currentVisitIndex].name)+"” ",1),r.assignedModelIndices.length?((0,i.uX)(),(0,i.CE)("div",Ju,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.assignedModelIndices,e=>((0,i.uX)(),(0,i.CE)("div",{key:"sec-"+e,class:"section-block"},[(0,i.Lk)("h3",null,(0,m.v_)(r.selectedModels[e].title),1),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.selectedModels[e].fields,(s,l)=>((0,i.uX)(),(0,i.CE)("div",{key:"f-"+e+"-"+l,class:"form-field"},[(0,i.Lk)("label",{for:r.fieldId(e,l),class:"field-label"},[(0,i.Lk)("span",null,(0,m.v_)(s.label||s.name||s.title),1),s.constraints?.required?((0,i.uX)(),(0,i.CE)("span",Hu,"*")):(0,i.Q3)("",!0),s.constraints?.helpText?((0,i.uX)(),(0,i.CE)("em",Zu,(0,m.v_)(s.constraints.helpText),1)):(0,i.Q3)("",!0),r.hasConstraints(s)?((0,i.uX)(),(0,i.CE)("i",{key:2,class:"fas fa-question-circle helper-icon",onClick:e=>r.openConstraintDialog(s)},null,8,ec)):(0,i.Q3)("",!0)],8,Yu),"text"===s.type?(0,i.bo)(((0,i.uX)(),(0,i.CE)("input",{key:0,id:r.fieldId(e,l),type:"text","onUpdate:modelValue":t=>n.entryData[n.currentSubjectIndex][n.currentVisitIndex][n.currentGroupIndex][e][l]=t,placeholder:s.placeholder,required:!!s.constraints?.required,readonly:!!s.constraints?.readonly||!r.canEdit,minlength:s.constraints?.minLength,maxlength:s.constraints?.maxLength,pattern:s.constraints?.pattern,onBlur:t=>r.onFieldBlur(e,l),onInput:t=>r.clearError(e,l)},null,40,tc)),[[a.Jo,n.entryData[n.currentSubjectIndex][n.currentVisitIndex][n.currentGroupIndex][e][l]]]):"textarea"===s.type?(0,i.bo)(((0,i.uX)(),(0,i.CE)("textarea",{key:1,id:r.fieldId(e,l),"onUpdate:modelValue":t=>n.entryData[n.currentSubjectIndex][n.currentVisitIndex][n.currentGroupIndex][e][l]=t,placeholder:s.placeholder,required:!!s.constraints?.required,readonly:!!s.constraints?.readonly||!r.canEdit,minlength:s.constraints?.minLength,maxlength:s.constraints?.maxLength,pattern:s.constraints?.pattern,rows:"4",onBlur:t=>r.onFieldBlur(e,l),onInput:t=>r.clearError(e,l)},null,40,sc)),[[a.Jo,n.entryData[n.currentSubjectIndex][n.currentVisitIndex][n.currentGroupIndex][e][l]]]):"number"===s.type?(0,i.bo)(((0,i.uX)(),(0,i.CE)("input",{key:2,id:r.fieldId(e,l),type:"number","onUpdate:modelValue":t=>n.entryData[n.currentSubjectIndex][n.currentVisitIndex][n.currentGroupIndex][e][l]=t,placeholder:s.placeholder,required:!!s.constraints?.required,readonly:!!s.constraints?.readonly||!r.canEdit,min:s.constraints?.min,max:s.constraints?.max,step:s.constraints?.step,onBlur:t=>r.validateField(e,l),onInput:t=>r.clearError(e,l)},null,40,ac)),[[a.Jo,n.entryData[n.currentSubjectIndex][n.currentVisitIndex][n.currentGroupIndex][e][l],void 0,{number:!0}]]):"checkbox"===s.type?((0,i.uX)(),(0,i.Wv)(o,(0,i.v6)({key:3,id:r.fieldId(e,l),modelValue:n.entryData[n.currentSubjectIndex][n.currentVisitIndex][n.currentGroupIndex][e][l],"onUpdate:modelValue":t=>n.entryData[n.currentSubjectIndex][n.currentVisitIndex][n.currentGroupIndex][e][l]=t},{ref_for:!0},r.selectedModels[e].fields[l].constraints,{disabled:!r.canEdit,onChange:t=>r.validateField(e,l)}),null,16,["id","modelValue","onUpdate:modelValue","disabled","onChange"])):"radio"===s.type?((0,i.uX)(),(0,i.Wv)(d,(0,i.v6)({key:4,id:r.fieldId(e,l),name:r.fieldId(e,l),options:s.options||[],modelValue:n.entryData[n.currentSubjectIndex][n.currentVisitIndex][n.currentGroupIndex][e][l],"onUpdate:modelValue":t=>n.entryData[n.currentSubjectIndex][n.currentVisitIndex][n.currentGroupIndex][e][l]=t,"default-value":s.constraints?.defaultValue},{ref_for:!0},r.selectedModels[e].fields[l].constraints,{disabled:!r.canEdit,onChange:t=>r.validateField(e,l),"onUpdate:modelValue":()=>{r.clearError(e,l),r.validateField(e,l)}}),null,16,["id","name","options","modelValue","onUpdate:modelValue","default-value","disabled","onChange"])):"date"===s.type?((0,i.uX)(),(0,i.Wv)(u,{key:5,id:r.fieldId(e,l),modelValue:n.entryData[n.currentSubjectIndex][n.currentVisitIndex][n.currentGroupIndex][e][l],"onUpdate:modelValue":t=>n.entryData[n.currentSubjectIndex][n.currentVisitIndex][n.currentGroupIndex][e][l]=t,format:s.constraints?.dateFormat||"dd.MM.yyyy",placeholder:s.placeholder||s.constraints?.dateFormat||"dd.MM.yyyy","min-date":s.constraints?.minDate||null,"max-date":s.constraints?.maxDate||null,readonly:!!s.constraints?.readonly||!r.canEdit,onChange:t=>r.validateField(e,l),onBlur:t=>r.validateField(e,l)},null,8,["id","modelValue","onUpdate:modelValue","format","placeholder","min-date","max-date","readonly","onChange","onBlur"])):"time"===s.type?((0,i.uX)(),(0,i.Wv)(c,(0,i.v6)({key:6,id:r.fieldId(e,l),modelValue:n.entryData[n.currentSubjectIndex][n.currentVisitIndex][n.currentGroupIndex][e][l],"onUpdate:modelValue":t=>n.entryData[n.currentSubjectIndex][n.currentVisitIndex][n.currentGroupIndex][e][l]=t,placeholder:s.placeholder||s.constraints?.timeFormat||"HH:mm"},{ref_for:!0},r.selectedModels[e].fields[l].constraints,{readonly:!!s.constraints?.readonly||!r.canEdit,onChange:t=>r.validateField(e,l),onBlur:t=>r.validateField(e,l)}),null,16,["id","modelValue","onUpdate:modelValue","placeholder","readonly","onChange","onBlur"])):"select"===s.type?((0,i.uX)(),(0,i.Wv)(p,{key:7,id:r.fieldId(e,l),modelValue:n.entryData[n.currentSubjectIndex][n.currentVisitIndex][n.currentGroupIndex][e][l],"onUpdate:modelValue":[t=>n.entryData[n.currentSubjectIndex][n.currentVisitIndex][n.currentGroupIndex][e][l]=t,()=>r.validateField(e,l)],options:s.options||[],multiple:!!s.constraints?.allowMultiple,readonly:!!s.constraints?.readonly||!r.canEdit,"default-value":s.constraints?.defaultValue,placeholder:"Select…"},null,8,["id","modelValue","onUpdate:modelValue","options","multiple","readonly","default-value"])):"slider"===s.type&&"slider"===(s.constraints?.mode||"slider")?((0,i.uX)(),(0,i.Wv)(h,(0,i.v6)({key:8,id:r.fieldId(e,l),modelValue:n.entryData[n.currentSubjectIndex][n.currentVisitIndex][n.currentGroupIndex][e][l],"onUpdate:modelValue":t=>n.entryData[n.currentSubjectIndex][n.currentVisitIndex][n.currentGroupIndex][e][l]=t},{ref_for:!0},r.getSliderProps(s),{disabled:!r.canEdit,"onUpdate:modelValue":()=>{r.clearError(e,l),r.validateField(e,l)},onChange:t=>r.validateField(e,l)}),null,16,["id","modelValue","onUpdate:modelValue","disabled","onChange"])):"slider"===s.type&&"linear"===s.constraints?.mode?((0,i.uX)(),(0,i.Wv)(y,(0,i.v6)({key:9,id:r.fieldId(e,l),modelValue:n.entryData[n.currentSubjectIndex][n.currentVisitIndex][n.currentGroupIndex][e][l],"onUpdate:modelValue":t=>n.entryData[n.currentSubjectIndex][n.currentVisitIndex][n.currentGroupIndex][e][l]=t},{ref_for:!0},r.getLinearProps(s),{disabled:!r.canEdit,"onUpdate:modelValue":()=>{r.clearError(e,l),r.validateField(e,l)},onChange:t=>r.validateField(e,l)}),null,16,["id","modelValue","onUpdate:modelValue","disabled","onChange"])):"file"===s.type?((0,i.uX)(),(0,i.Wv)(g,{key:10,id:r.fieldId(e,l),value:n.entryData[n.currentSubjectIndex][n.currentVisitIndex][n.currentGroupIndex][e][l],constraints:s.constraints||{},readonly:!!s.constraints?.readonly||!r.canEdit,required:!!s.constraints?.required,stage:"runtime",onInput:t=>r.setEntryValue(e,l,t),onFileSelected:t=>r.onRawFileSelected(e,l,t)},null,8,["id","value","constraints","readonly","required","onInput","onFileSelected"])):(0,i.bo)(((0,i.uX)(),(0,i.CE)("input",{key:11,id:r.fieldId(e,l),type:"text","onUpdate:modelValue":t=>n.entryData[n.currentSubjectIndex][n.currentVisitIndex][n.currentGroupIndex][e][l]=t,placeholder:s.placeholder,required:!!s.constraints?.required,readonly:!!s.constraints?.readonly||!r.canEdit,onBlur:t=>r.onFieldBlur(e,l),onInput:t=>r.clearError(e,l)},null,40,ic)),[[a.Jo,n.entryData[n.currentSubjectIndex][n.currentVisitIndex][n.currentGroupIndex][e][l]]]),r.fieldErrors(e,l)?((0,i.uX)(),(0,i.CE)("div",lc,[(0,i.eW)((0,m.v_)(r.fieldErrors(e,l))+" ",1),r.isFieldSkipped(e,l)?((0,i.uX)(),(0,i.CE)("span",nc,"Skipped")):(0,i.Q3)("",!0)])):r.isFieldSkipped(e,l)?((0,i.uX)(),(0,i.CE)("div",rc,[...t[36]||(t[36]=[(0,i.Lk)("span",{class:"skip-pill",title:"Required validation skipped for this field"},"Skipped",-1)])])):(0,i.Q3)("",!0)]))),128))]))),128)),(0,i.Lk)("div",oc,[(0,i.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>r.submitData&&r.submitData(...e)),class:"btn-save",disabled:r.blockingErrorsPresent||!r.canEdit,title:r.canEdit?r.blockingErrorsPresent?"Fix validation errors before saving":"Save Data":"This shared link is view-only"}," Save Data ",8,dc),(0,i.Lk)("button",{type:"button",class:"btn-clear",onClick:t[8]||(t[8]=(...e)=>r.clearCurrentSection&&r.clearCurrentSection(...e)),title:"Clear all inputs",disabled:!r.canEdit}," Clear ",8,uc)])])):((0,i.uX)(),(0,i.CE)("div",cc,[...t[37]||(t[37]=[(0,i.Lk)("p",null,"No sections are assigned to this Visit for your group.",-1)])]))])])),n.showShareDialog&&!r.isShared?((0,i.uX)(),(0,i.CE)("div",pc,[(0,i.Lk)("div",mc,[t[42]||(t[42]=(0,i.Lk)("h3",null,"Generate Share Link",-1)),(0,i.Lk)("p",null," Sharing for Subject "+(0,m.v_)(null!=n.shareParams.subjectIndex?r.sd.subjects?.[n.shareParams.subjectIndex]?.id:"N/A")+", Visit "+(0,m.v_)(r.visitList[n.shareParams.visitIndex]?.name),1),(0,i.Lk)("label",null,[t[39]||(t[39]=(0,i.eW)(" Permission: ",-1)),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[9]||(t[9]=e=>n.shareConfig.permission=e)},[...t[38]||(t[38]=[(0,i.Lk)("option",{value:"view"},"View Only",-1),(0,i.Lk)("option",{value:"add"},"Allow Add",-1)])],512),[[a.u1,n.shareConfig.permission]])]),(0,i.Lk)("label",null,[t[40]||(t[40]=(0,i.eW)(" Max Uses: ",-1)),(0,i.bo)((0,i.Lk)("input",{type:"number","onUpdate:modelValue":t[10]||(t[10]=e=>n.shareConfig.maxUses=e),min:"1"},null,512),[[a.Jo,n.shareConfig.maxUses,void 0,{number:!0}]])]),(0,i.Lk)("label",null,[t[41]||(t[41]=(0,i.eW)(" Expires in (days): ",-1)),(0,i.bo)((0,i.Lk)("input",{type:"number","onUpdate:modelValue":t[11]||(t[11]=e=>n.shareConfig.expiresInDays=e),min:"1"},null,512),[[a.Jo,n.shareConfig.expiresInDays,void 0,{number:!0}]])]),(0,i.Lk)("div",hc,[(0,i.Lk)("button",{onClick:t[12]||(t[12]=(...e)=>r.createShareLink&&r.createShareLink(...e))},"Generate"),(0,i.Lk)("button",{onClick:t[13]||(t[13]=e=>n.showShareDialog=!1)},"Cancel")]),n.generatedLink?((0,i.uX)(),(0,i.CE)("p",yc,[(0,i.Lk)("a",{href:n.generatedLink,target:"_blank"},(0,m.v_)(n.generatedLink),9,gc)])):(0,i.Q3)("",!0)])])):(0,i.Q3)("",!0),n.permissionError?((0,i.uX)(),(0,i.CE)("div",fc,[(0,i.Lk)("div",vc,[t[43]||(t[43]=(0,i.Lk)("h3",null,"Permission Denied",-1)),t[44]||(t[44]=(0,i.Lk)("p",null,"You do not have permission to create a share link. Please contact your administrator.",-1)),(0,i.Lk)("div",kc,[(0,i.Lk)("button",{onClick:t[14]||(t[14]=e=>n.permissionError=!1)},"Close")])])])):(0,i.Q3)("",!0),n.showConstraintDialog?((0,i.uX)(),(0,i.CE)("div",{key:5,class:"mini-overlay",onClick:t[16]||(t[16]=(0,a.D$)((...e)=>r.closeConstraintDialog&&r.closeConstraintDialog(...e),["self"]))},[(0,i.Lk)("div",bc,[(0,i.Lk)("div",Lc,[(0,i.Lk)("h4",wc,(0,m.v_)(n.constraintDialogFieldName),1),(0,i.Lk)("button",{class:"mini-close",onClick:t[15]||(t[15]=(...e)=>r.closeConstraintDialog&&r.closeConstraintDialog(...e)),"aria-label":"Close"},"✕")]),(0,i.Lk)("ul",Cc,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.constraintDialogItems,(e,t)=>((0,i.uX)(),(0,i.CE)("li",{key:t},(0,m.v_)(e),1))),128))])])])):(0,i.Q3)("",!0),n.showLegendDialog?((0,i.uX)(),(0,i.CE)("div",{key:6,class:"mini-overlay",onClick:t[18]||(t[18]=(0,a.D$)((...e)=>r.closeLegendDialog&&r.closeLegendDialog(...e),["self"]))},[(0,i.Lk)("div",Sc,[(0,i.Lk)("div",xc,[t[45]||(t[45]=(0,i.Lk)("h4",{class:"mini-title"},"Legend",-1)),(0,i.Lk)("button",{class:"mini-close",onClick:t[17]||(t[17]=(...e)=>r.closeLegendDialog&&r.closeLegendDialog(...e)),"aria-label":"Close"},"✕")]),t[46]||(t[46]=(0,i.Fv)('<ul class="mini-list" data-v-fe50acc6><li data-v-fe50acc6><span class="legend-swatch swatch-none" data-v-fe50acc6></span> None — no data saved yet.</li><li data-v-fe50acc6><span class="legend-swatch swatch-partial" data-v-fe50acc6></span> Partial — some fields filled.</li><li data-v-fe50acc6><span class="legend-swatch swatch-complete" data-v-fe50acc6></span> Complete — all assigned fields filled.</li><li data-v-fe50acc6><span class="legend-swatch swatch-skipped" data-v-fe50acc6></span> Skipped — one or more required fields were skipped.</li></ul>',1))])])):(0,i.Q3)("",!0),n.showStatusLegend?((0,i.uX)(),(0,i.CE)("div",{key:7,class:"mini-overlay",onClick:t[20]||(t[20]=(0,a.D$)((...e)=>r.closeStatusLegend&&r.closeStatusLegend(...e),["self"]))},[(0,i.Lk)("div",Dc,[(0,i.Lk)("div",Fc,[t[47]||(t[47]=(0,i.Lk)("h4",{class:"mini-title"},"Selection Status",-1)),(0,i.Lk)("button",{class:"mini-close",onClick:t[19]||(t[19]=(...e)=>r.closeStatusLegend&&r.closeStatusLegend(...e)),"aria-label":"Close"},"✕")]),t[48]||(t[48]=(0,i.Fv)('<ul class="mini-list legend-explain" data-v-fe50acc6><li data-v-fe50acc6><span class="legend-swatch swatch-none" data-v-fe50acc6></span> None — no data saved yet.</li><li data-v-fe50acc6><span class="legend-swatch swatch-partial" data-v-fe50acc6></span> Partial — some fields filled.</li><li data-v-fe50acc6><span class="legend-swatch swatch-complete" data-v-fe50acc6></span> Complete — all assigned fields filled.</li><li data-v-fe50acc6><span class="legend-swatch swatch-skipped" data-v-fe50acc6></span> Skipped — one or more required fields were skipped.</li></ul>',1))])])):(0,i.Q3)("",!0),(0,i.bF)(f,{message:n.dialogMessage,isVisible:n.showDialog,onClose:r.closeDialog},null,8,["message","isVisible","onClose"]),n.showSkipDialog?((0,i.uX)(),(0,i.CE)("div",Ac,[(0,i.Lk)("div",Mc,[t[50]||(t[50]=(0,i.Lk)("h3",null,"Fix validation before saving",-1)),t[51]||(t[51]=(0,i.Lk)("p",null,[(0,i.eW)("The fields below are required but empty. You can fill them now or choose to "),(0,i.Lk)("em",null,"Skip for now"),(0,i.eW)(" to save the rest.")],-1)),(0,i.Lk)("div",Ec,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.skipCandidates,e=>((0,i.uX)(),(0,i.CE)("div",{class:"skip-row",key:e.key},[(0,i.Lk)("div",Vc,[(0,i.Lk)("div",Ic,[(0,i.Lk)("strong",null,(0,m.v_)(e.sectionTitle),1),(0,i.eW)(" / "+(0,m.v_)(e.fieldLabel),1)])]),(0,i.Lk)("div",_c,[(0,i.Lk)("label",$c,[(0,i.bo)((0,i.Lk)("input",{type:"checkbox","onUpdate:modelValue":t=>n.skipSelections[e.key]=t},null,8,Xc),[[a.lH,n.skipSelections[e.key]]]),t[49]||(t[49]=(0,i.eW)(" Skip for now ",-1))]),(0,i.Lk)("button",{class:"btn-jump",onClick:t=>r.jumpToField(e)},"Go to field",8,jc)])]))),128))]),(0,i.Lk)("div",Uc,[(0,i.Lk)("button",{onClick:t[21]||(t[21]=(...e)=>r.confirmSkipSelection&&r.confirmSkipSelection(...e)),class:"btn-primary",disabled:!r.canEdit},"Skip selected & Save",8,Tc),(0,i.Lk)("button",{onClick:t[22]||(t[22]=(...e)=>r.cancelSkipSelection&&r.cancelSkipSelection(...e)),class:"btn-option"},"Cancel")])])])):(0,i.Q3)("",!0)])):((0,i.uX)(),(0,i.CE)("div",Nc,[...t[52]||(t[52]=[(0,i.Lk)("p",null,"Loading study details…",-1)])]))}const Pc={class:"fsel"},Bc=["id","multiple","disabled","aria-readonly"],Oc={key:0,disabled:"",value:""},qc=["value"];function Kc(e,t,s,l,n,r){return(0,i.uX)(),(0,i.CE)("div",Pc,[(0,i.bo)((0,i.Lk)("select",(0,i.v6)({class:"fsel-input",id:s.id,"onUpdate:modelValue":t[0]||(t[0]=e=>r.proxy=e),multiple:s.multiple,disabled:r.isReadonly,"aria-readonly":r.isReadonly?"true":"false"},e.$attrs),[!s.multiple&&s.placeholder?((0,i.uX)(),(0,i.CE)("option",Oc,(0,m.v_)(s.placeholder),1)):(0,i.Q3)("",!0),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.stringOptions,(e,t)=>((0,i.uX)(),(0,i.CE)("option",{key:t,value:e},(0,m.v_)(e),9,qc))),128))],16,Bc),[[a.u1,r.proxy]]),s.multiple&&s.allowClear&&!r.isReadonly&&r.hasAnySelection?((0,i.uX)(),(0,i.CE)("button",{key:0,class:"fsel-clear",type:"button",onClick:t[1]||(t[1]=(...e)=>r.clearSelection&&r.clearSelection(...e)),title:"Clear selection"}," × ")):(0,i.Q3)("",!0)])}var Wc={name:"FieldSelect",inheritAttrs:!1,props:{modelValue:{type:[String,Array],default:""},options:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},placeholder:{type:String,default:"Select…"},id:{type:String,default:null},defaultValue:{type:[String,Array],default:""},allowClear:{type:Boolean,default:!0}},emits:["update:modelValue"],computed:{isReadonly(){const e=""===this.$attrs.readonly||!0===this.$attrs.readonly||"true"===this.$attrs.readonly;return this.readonly||e||this.disabled},stringOptions(){return this.options.map(e=>null==e?"":String(e))},optionSet(){return new Set(this.stringOptions)},hasAnySelection(){return this.multiple?this.asArray(this.modelValue).length>0:!!this.modelValue},proxy:{get(){if(this.multiple)return this.asArray(this.modelValue).map(String).filter(e=>this.optionSet.has(e));const e=null==this.modelValue?"":String(this.modelValue);return this.optionSet.has(e)?e:""},set(e){if(!this.isReadonly)if(this.multiple){const t=this.asArray(e).map(String).filter(e=>this.optionSet.has(e));this.$emit("update:modelValue",t)}else{const t=null==e?"":String(e);this.$emit("update:modelValue",this.optionSet.has(t)?t:"")}}}},mounted(){const e=this.stringOptions;if(this.multiple){const t=this.asArray(this.modelValue).map(String).filter(t=>e.includes(t));if(0===t.length){const t=this.asArray(this.defaultValue).map(String).filter(t=>e.includes(t));t.length&&this.$emit("update:modelValue",t)}}else{const t=null==this.modelValue?"":String(this.modelValue);if(!t||!e.includes(t)){const t=null==this.defaultValue?"":String(this.defaultValue);t&&e.includes(t)&&this.$emit("update:modelValue",t)}}},watch:{options(){const e=this.stringOptions;if(this.multiple){const t=this.asArray(this.modelValue).map(String).filter(t=>e.includes(t));this.$emit("update:modelValue",t)}else{const t=null==this.modelValue?"":String(this.modelValue);if(!e.includes(t)){const t=null==this.defaultValue?"":String(this.defaultValue);this.$emit("update:modelValue",t&&e.includes(t)?t:"")}}}},methods:{asArray(e){return Array.isArray(e)?e:e?[e]:[]},clearSelection(){this.$emit("update:modelValue",[])}}};const zc=(0,o.A)(Wc,[["render",Kc],["__scopeId","data-v-7d24e864"]]);var Qc=zc,Gc=s(8019),Jc=s.n(Gc);const Yc=/^(\d{2}):(\d{2})(?::(\d{2}))?$/,Hc=["dd.MM.yyyy","MM-dd-yyyy","dd-MM-yyyy","yyyy-MM-dd","MM/yyyy","MM-yyyy","yyyy/MM","yyyy-MM","yyyy"],Zc=1024,ep=1024*Zc;function tp(e,t){const s=String(e||"");let a;switch(t){case"dd.MM.yyyy":return a=/^(\d{2})\.(\d{2})\.(\d{4})$/.exec(s),a?new Date(+a[3],+a[2]-1,+a[1]):null;case"MM-dd-yyyy":return a=/^(\d{2})-(\d{2})-(\d{4})$/.exec(s),a?new Date(+a[3],+a[1]-1,+a[2]):null;case"dd-MM-yyyy":return a=/^(\d{2})-(\d{2})-(\d{4})$/.exec(s),a?new Date(+a[3],+a[2]-1,+a[1]):null;case"yyyy-MM-dd":return a=/^(\d{4})-(\d{2})-(\d{2})$/.exec(s),a?new Date(+a[1],+a[2]-1,+a[3]):null;case"MM/yyyy":return a=/^(\d{2})\/(\d{4})$/.exec(s),a?new Date(+a[2],+a[1]-1,1):null;case"MM-yyyy":return a=/^(\d{2})-(\d{4})$/.exec(s),a?new Date(+a[2],+a[1]-1,1):null;case"yyyy/MM":return a=/^(\d{4})\/(\d{2})$/.exec(s),a?new Date(+a[1],+a[2]-1,1):null;case"yyyy-MM":return a=/^(\d{4})-(\d{2})$/.exec(s),a?new Date(+a[1],+a[2]-1,1):null;case"yyyy":return a=/^(\d{4})$/.exec(s),a?new Date(+a[1],0,1):null;default:return null}}function sp(e){const t=Yc.exec(String(e||""));if(!t)return null;const s=+t[1],a=+t[2],i=t[3]?+t[3]:0;return 3600*s+60*a+i}function ap(e){if(""===e||null===e||void 0===e)return 0;const t=String(e);return t.replace(/[^0-9]/g,"").length}function ip(e,t){const s=String(e?.name||e?.filename||"").toLowerCase(),a=String(e?.type||e?.contentType||"").toLowerCase(),i=(t||[]).map(e=>String(e||"").trim().toLowerCase()).filter(Boolean);return!i.length||i.some(e=>{if(e.endsWith("/*")){const t=e.slice(0,-2);return a.startsWith(t+"/")}return e.startsWith(".")?s.endsWith(e):e.includes("/")?a===e:s.endsWith("."+e.replace(/^\./,""))})}function lp(e,t){try{const s=new URL(String(e)),a=(s.pathname||"").toLowerCase(),i=(t||[]).map(e=>String(e||"").trim().toLowerCase()).filter(Boolean);return!i.length||i.some(e=>!!e.endsWith("/*")||(e.startsWith(".")?a.endsWith(e):!!e.includes("/")||a.endsWith("."+e.replace(/^\./,""))))}catch{return!1}}function np(){const e=new(Jc())({allErrors:!0});e.addFormat("time",Yc),e.addFormat("http-url",/^(https?:\/\/).+/i),Hc.forEach(t=>{const s=`date:${t}`;let a;switch(t){case"dd.MM.yyyy":a=/^\d{2}\.\d{2}\.\d{4}$/;break;case"MM-dd-yyyy":case"dd-MM-yyyy":a=/^\d{2}-\d{2}-\d{4}$/;break;case"yyyy-MM-dd":a=/^\d{4}-\d{2}-\d{2}$/;break;case"MM/yyyy":a=/^\d{2}\/\d{4}$/;break;case"MM-yyyy":a=/^\d{2}-\d{4}$/;break;case"yyyy/MM":a=/^\d{4}\/\d{2}$/;break;case"yyyy-MM":a=/^\d{4}-\d{2}$/;break;case"yyyy":a=/^\d{4}$/;break;default:a=/.+/}e.addFormat(s,a)});const t=function(e,s){const a=ap(s),i=a<=e;return i||(t.errors=[{keyword:"maxDigits",params:{limit:e},message:`should have ≤ ${e} digits`}]),i};e.addKeyword("maxDigits",{type:"number",errors:!0,metaSchema:{type:"number",minimum:1},validate:t});const s=function(e,t){const a=ap(t),i=a>=e;return i||(s.errors=[{keyword:"minDigits",params:{limit:e},message:`should have ≥ ${e} digits`}]),i};e.addKeyword("minDigits",{type:"number",errors:!0,metaSchema:{type:"number",minimum:0},validate:s});const a=function(e,t){if(!t)return!0;const s=sp(t),i=sp(e),l=null==s||null==i||s>=i;return l||(a.errors=[{keyword:"minTime",params:{limit:e},message:`should be ≥ ${e}`}]),l};e.addKeyword("minTime",{type:"string",errors:!0,metaSchema:{type:"string",pattern:Yc.source},validate:a});const i=function(e,t){if(!t)return!0;const s=sp(t),a=sp(e),l=null==s||null==a||s<=a;return l||(i.errors=[{keyword:"maxTime",params:{limit:e},message:`should be ≤ ${e}`}]),l};e.addKeyword("maxTime",{type:"string",errors:!0,metaSchema:{type:"string",pattern:Yc.source},validate:i});const l=function(e,t){if(!t||!e)return!0;const s=sp(t),a=null==s||s%e===0;return a||(l.errors=[{keyword:"timeStep",params:{step:e},message:`should align to ${e}s steps`}]),a};e.addKeyword("timeStep",{type:"string",errors:!0,metaSchema:{type:"number",minimum:1},validate:l});const n=function(e,t){const{minDate:s,format:a}=e||{};if(!t||!s||!a)return!0;const i=tp(t,a),l=tp(s,a),r=!i||!l||i>=l;return r||(n.errors=[{keyword:"minDateByFormat",params:{limit:s},message:`should be ≥ ${s}`}]),r};e.addKeyword("minDateByFormat",{type:"string",errors:!0,metaSchema:{type:"object",properties:{minDate:{type:"string"},format:{type:"string"}},required:["minDate","format"],additionalProperties:!1},validate:n});const r=function(e,t){const{maxDate:s,format:a}=e||{};if(!t||!s||!a)return!0;const i=tp(t,a),l=tp(s,a),n=!i||!l||i<=l;return n||(r.errors=[{keyword:"maxDateByFormat",params:{limit:s},message:`should be ≤ ${s}`}]),n};e.addKeyword("maxDateByFormat",{type:"string",errors:!0,metaSchema:{type:"object",properties:{maxDate:{type:"string"},format:{type:"string"}},required:["maxDate","format"],additionalProperties:!1},validate:r});const o=function(e,t){if(null==t||""===t)return!0;const s=Number(e?.base),a=Number(e?.step);if(!Number.isFinite(a)||a<=0)return!0;const i=(Number(t)-(Number.isFinite(s)?s:0))/a,l=Math.abs(i-Math.round(i)),n=1e-9,r=l<=n;return r||(o.errors=[{keyword:"stepAlign",params:{base:s,step:a},message:`should align to step ${a}${Number.isFinite(s)?` starting at ${s}`:""}`}]),r};e.addKeyword("stepAlign",{type:"number",errors:!0,metaSchema:{type:"object",properties:{base:{type:["number","null"]},step:{type:"number",minimum:0}},required:["step"],additionalProperties:!1},validate:o});const d=function(e,t){if(!t||"object"!==typeof t)return!0;if(!Array.isArray(e))return!0;const s=t.file&&"object"===typeof t.file?t.file:t,a=ip(s,e);return a||(d.errors=[{keyword:"fileMatchesAccept",params:{},message:"type not allowed"}]),a};e.addKeyword("fileMatchesAccept",{type:"object",errors:!0,metaSchema:{type:"array",items:{type:"string"}},validate:d});const u=function(e,t){if(!t||"string"!==typeof t)return!0;if(!Array.isArray(e))return!0;const s=lp(t,e);return s||(u.errors=[{keyword:"urlMatchesAccept",params:{},message:"URL not in allowed formats"}]),s};e.addKeyword("urlMatchesAccept",{type:"string",errors:!0,metaSchema:{type:"array",items:{type:"string"}},validate:u});const c=function(e,t){if(!t||"object"!==typeof t)return!0;const s=t.file&&"object"===typeof t.file?t.file:t,a="number"===typeof s?.size?s.size:Number(s?.size);if(!Number.isFinite(a))return!0;const i=a<=e;return i||(c.errors=[{keyword:"maxFileBytes",params:{limit:e},message:`exceeds max size (${Math.round(e/ep)} MB)`}]),i};return e.addKeyword("maxFileBytes",{type:"object",errors:!0,metaSchema:{type:"number",minimum:1},validate:c}),e}function rp(e){const t=String(e?.type||"text").toLowerCase(),s=e?.constraints||{},a=e?.label||"Field",i=Array.isArray(e?.options)&&e.options.length?e.options.map(String):[""];let l={title:a};if("text"===t||"textarea"===t)l={type:"string",minLength:isFinite(s.minLength)?s.minLength:void 0,maxLength:isFinite(s.maxLength)?s.maxLength:void 0,pattern:s.pattern||void 0};else if("number"===t)l={type:s.integerOnly?"integer":"number",minimum:Number.isFinite(s.min)?s.min:void 0,maximum:Number.isFinite(s.max)?s.max:void 0,maxDigits:Number.isFinite(s.maxDigits)?s.maxDigits:Number.isFinite(s.maxLengthDigits)?s.maxLengthDigits:void 0,minDigits:Number.isFinite(s.minDigits)?s.minDigits:void 0};else if("checkbox"===t)l={type:"boolean"};else if("radio"===t||"select"===t)l=s.allowMultiple?{type:"array",items:{type:"string",enum:i},uniqueItems:!0}:{type:"string",enum:i};else if("date"===t){const e=s.dateFormat||"dd.MM.yyyy";l={type:"string",format:`date:${e}`,minDateByFormat:s.minDate?{minDate:s.minDate,format:e}:void 0,maxDateByFormat:s.maxDate?{maxDate:s.maxDate,format:e}:void 0}}else if("time"===t)l={type:"string",format:"time",minTime:s.minTime||void 0,maxTime:s.maxTime||void 0,timeStep:Number.isFinite(s.step)?s.step:void 0};else if("slider"===t){const e="linear"===String(s.mode||"slider").toLowerCase()?"linear":"slider";if("slider"===e){const e=s.percent?1:Number.isFinite(s.min)?s.min:1,t=s.percent?100:Number.isFinite(s.max)?s.max:5,a=Number.isFinite(s.step)&&s.step>0?s.step:1;l={type:"number",minimum:e,maximum:t,stepAlign:{base:e,step:a}}}else{const e=Number.isFinite(s.min)?Math.round(s.min):1,t=Number.isFinite(s.max)?Math.round(s.max):Math.max(e+1,5);l={type:"integer",minimum:e,maximum:t}}}else if("file"===t){const e=Array.isArray(s.allowedFormats)?s.allowedFormats:[],t=(Number.isFinite(s.maxSizeMB)&&s.maxSizeMB>0?s.maxSizeMB:100)*ep,a={type:"object",required:["source","url"],properties:{source:{const:"url"},url:{type:"string",format:"http-url",urlMatchesAccept:e},filename:{type:"string"},contentType:{type:"string"}},additionalProperties:!0},i={source:{const:"local"},name:{type:"string"},size:{anyOf:[{type:"number",minimum:0},{type:"string",pattern:"^[0-9]+$"}]},type:{type:"string"},lastModified:{anyOf:[{type:"number"},{type:"string",pattern:"^[0-9]+$"}]}},n={type:"object",required:["source","name","size"],properties:i,additionalProperties:!0,fileMatchesAccept:e,maxFileBytes:t},r={type:"object",required:["source","file"],properties:{source:{const:"local"},file:{type:"object",required:["name","size"],properties:i,additionalProperties:!0}},additionalProperties:!0,fileMatchesAccept:e,maxFileBytes:t},o=String(s.storagePreference||"local").toLowerCase();l="url"===o?a:"local"===o?{oneOf:[n,r]}:{oneOf:[a,n,r]}}else l={type:"string"};return Object.keys(l).forEach(e=>void 0===l[e]&&delete l[e]),l}function op(e,t,s){try{const a=rp(t),i=String(t?.type||"text").toLowerCase();if((""===s||null==s)&&!t?.constraints?.required)return{valid:!0};if("number"===i&&(""===s||null==s))return{valid:!t?.constraints?.required};if("slider"===i&&(""===s||null==s))return{valid:!t?.constraints?.required};if("file"===i&&(""===s||null==s))return{valid:!t?.constraints?.required};const l=e.compile(a),n=l(s);if(n)return{valid:!0};const r=Array.isArray(l.errors)?l.errors[0]:null;if(!r)return{valid:!1,message:"Invalid value."};switch(r.keyword){case"stepAlign":case"maxDigits":case"minDigits":case"minTime":case"maxTime":case"timeStep":case"minDateByFormat":case"maxDateByFormat":case"fileMatchesAccept":case"urlMatchesAccept":case"maxFileBytes":return{valid:!1,message:r.message||"Invalid value."};case"format":return"time"===i?{valid:!1,message:"Use HH:mm or HH:mm:ss"}:"date"===i?{valid:!1,message:`Use format ${t?.constraints?.dateFormat||"dd.MM.yyyy"}`}:"file"===i?{valid:!1,message:"Use a valid http(s) URL."}:{valid:!1,message:"Bad format."};case"enum":return{valid:!1,message:"Choose a valid option."};case"type":return{valid:!1,message:`Expected ${a.type}.`};case"minimum":return{valid:!1,message:`Must be ≥ ${a.minimum}.`};case"maximum":return{valid:!1,message:`Must be ≤ ${a.maximum}.`};case"minLength":return{valid:!1,message:`Needs ≥ ${a.minLength} characters.`};case"maxLength":return{valid:!1,message:`Allows ≤ ${a.maxLength} characters.`};case"pattern":return{valid:!1,message:"Does not match required pattern."};case"required":return{valid:!1,message:"This field is required."};default:return{valid:!1,message:r.message||"Invalid value."}}}catch(a){return{valid:!1,message:"Validation error."}}}var dp={name:"StudyDataEntryComponent",components:{CustomDialog:zl,DateFormatPicker:Mo,FieldCheckbox:nd,FieldRadioGroup:md,FieldTime:Jo,FieldSelect:Qc,FieldSlider:xd,FieldLinearScale:$d,FieldFileUpload:vu},data(){return{study:null,showSelection:!0,showDetails:!1,currentSubjectIndex:null,currentVisitIndex:null,currentGroupIndex:0,selectedVisitIndex:-999,VISIT_THRESHOLD:8,FLUID_VISIT_MAX:6,matrixReady:!1,statusMap:new Map,assignedLookup:[],subjectToGroupIdx:[],entryData:[],skipFlags:[],validationErrors:{},icons:ae.A,showShareDialog:!1,shareParams:{subjectIndex:null,visitIndex:null,groupIndex:null},shareConfig:{permission:"view",maxUses:1,expiresInDays:7},generatedLink:"",permissionError:!1,showDialog:!1,dialogMessage:"",showSkipDialog:!1,skipCandidates:[],skipSelections:{},existingEntries:[],entryIds:[],ajv:null,showConstraintDialog:!1,constraintDialogFieldName:"",constraintDialogItems:[],showLegendDialog:!1,pendingFiles:{},showStatusLegend:!1,shareToken:null,sharedPermission:"view",selectedVersion:null,studyVersions:[],templateCache:new Map,entriesIndex:new Map,hydrateCache:new Map,visitLoading:!1}},computed:{sd(){const e=this.study&&this.study.content&&this.study.content.study_data;return e||{study:{},visits:[],groups:[],subjects:[],selectedModels:[],assignments:[]}},studyInfoEntries(){const e=this.sd&&this.sd.study||{};try{return Object.entries(e)}catch{return[]}},token(){return this.$store.state.token},isShared(){return!!this.$route.params.token},canEdit(){return!this.isShared||"add"===this.sharedPermission},visitList(){return this.study?.content?.study_data?.visits||[]},groupList(){return this.study?.content?.study_data?.groups||[]},selectedModels(){return this.study?.content?.study_data?.selectedModels||[]},assignments(){return this.study?.content?.study_data?.assignments||[]},numberOfSubjects(){const e=this.study?.content?.study_data;return null!=e?.subjectCount?e.subjectCount:e?.subjects?.length||0},displayedVisitIndices(){if(!Array.isArray(this.visitList)||0===this.visitList.length)return[];if(-1===this.selectedVisitIndex)return this.visitList.map((e,t)=>t);const e=Math.min(Math.max(this.selectedVisitIndex,0),this.visitList.length-1);return[e]},isFluidMatrix(){return this.displayedVisitIndices.length<=this.FLUID_VISIT_MAX},subjectColStyle(){if(!this.isFluidMatrix)return{};const e=28;return{width:e+"%",maxWidth:"none",minWidth:"0"}},visitColStyle(){if(!this.isFluidMatrix)return{};const e=Math.max(this.displayedVisitIndices.length,1),t=(72/e).toFixed(4);return{width:t+"%",maxWidth:"none",minWidth:"0"}},assignedModelIndices(){const e=Number.isInteger(this.currentVisitIndex)?this.currentVisitIndex:0,t=Number.isInteger(this.currentGroupIndex)?this.currentGroupIndex:0;return null==e||null==t?[]:this.selectedModels.map((e,t)=>t).filter(s=>!!this.assignments?.[s]?.[e]?.[t])},blockingErrorsPresent(){const e=Object.keys(this.validationErrors||{});for(const t of e){const e=this.validationErrors[t];if(!e)continue;const s=this.parseKey(t);if(!s)continue;const{s:a,v:i,g:l,m:n,f:r}=s,o=!!this.skipFlags[a]?.[i]?.[l]?.[n]?.[r];if(!o&&!/ is required\.$/.test(e))return!0}return!1}},async created(){if(this.ajv=np(),this.isShared){const e=this.$route.params.token;await this.loadShared(e),this.matrixReady=!0}else{const e=this.$route.params.id;await this.loadStudy(e),await this.loadVersions(e),this.selectedVersion=this.studyVersions[this.studyVersions.length-1]?.version||1,await this.loadTemplateForSelectedVersion(),this.selectedVisitIndex=this.visitList.length>this.VISIT_THRESHOLD?0:-1,await this.loadExistingEntries(e),this.visitLoading=!0,this.applyVersionView(),this.prepareAssignmentsLookup(),this.prepareSubjectGroupIndexMap(),this.buildStatusCache(),this.visitLoading=!1,this.matrixReady=!0}},watch:{existingEntries:{handler(){-999!==this.selectedVisitIndex&&(this.rebuildEntriesIndex(),this.buildStatusCache())},deep:!0},study:{handler(){this.prepareAssignmentsLookup(),this.prepareSubjectGroupIndexMap(),-999!==this.selectedVisitIndex&&this.buildStatusCache()},deep:!0},async selectedVisitIndex(e){-999!==e&&(this.visitLoading=!0,await this.$nextTick(),this.applyVersionView(),this.buildStatusCache(),this.visitLoading=!1)}},methods:{safeVersionParams(e){const t=Number(e);return Number.isFinite(t)&&t>=1?{version:t}:void 0},mergeStudyDataFromTemplate(e){const t=this.study&&this.study.content&&this.study.content.study_data||{},s=e||{},a={study:s.study??t.study??{},subjects:Array.isArray(s.subjects)?s.subjects:t.subjects||[],groups:Array.isArray(s.groups)?s.groups:t.groups||[],visits:Array.isArray(s.visits)?s.visits:t.visits||[],selectedModels:Array.isArray(s.selectedModels)?s.selectedModels:t.selectedModels||[],assignments:Array.isArray(s.assignments)?s.assignments:t.assignments||[]},i=this.study&&this.study.content?this.study.content:{};this.study={...this.study,content:{...i,study_data:a}}},async loadVersions(e){try{const t=await se.A.get(`/forms/studies/${e}/versions`,{headers:{Authorization:`Bearer ${this.token}`}});this.studyVersions=Array.isArray(t.data)?t.data:[],this.studyVersions.sort((e,t)=>e.version-t.version)}catch(t){console.error("[Entry] loadVersions error",t),this.studyVersions=[{version:1,created_at:null}]}},applyTemplateSchema(e){const t=this.study&&this.study.content&&this.study.content.study_data||{},s={study:e?.study??t.study??{},subjects:Array.isArray(e?.subjects)&&e.subjects.length?e.subjects:t.subjects||[],subjectCount:Number.isFinite(e?.subjectCount)?e.subjectCount:t.subjectCount??(t.subjects?.length||0),visits:Array.isArray(e?.visits)&&e.visits.length?e.visits:t.visits||[],groups:Array.isArray(e?.groups)&&e.groups.length?e.groups:t.groups||[],selectedModels:Array.isArray(e?.selectedModels)?e.selectedModels:t.selectedModels||[],assignments:Array.isArray(e?.assignments)?e.assignments:t.assignments||[]};this.study?this.study.content?this.study.content.study_data=s:this.study.content={study_data:s}:this.study={metadata:{},content:{study_data:s}},this.initializeEntryData(),this.prepareSubjectGroupIndexMap(),this.prepareAssignmentsLookup(),this.buildStatusCache()},async loadTemplateForSelectedVersion(){const e=this.study?.metadata?.id;if(e&&this.selectedVersion){if(this.templateCache.has(this.selectedVersion)){const e=this.templateCache.get(this.selectedVersion);return void this.applyTemplateSchema(e)}try{const t=await se.A.get(`/forms/studies/${e}/template`,{headers:{Authorization:`Bearer ${this.token}`},params:{version:this.selectedVersion}}),s=t?.data?.schema||{};this.templateCache.set(this.selectedVersion,s),this.applyTemplateSchema(s)}catch(t){console.error("[Entry] loadTemplateForSelectedVersion error",t)}}},onVersionChange(){this.hydrateCache.clear(),this.loadTemplateForSelectedVersion().then(()=>{this.applyVersionView();const e=this.numberOfSubjects,t=this.visitList.length;(null==this.currentSubjectIndex||this.currentSubjectIndex>=e)&&(this.currentSubjectIndex=Math.min(0,e-1)),(null==this.currentVisitIndex||this.currentVisitIndex>=t)&&(this.currentVisitIndex=Math.min(0,t-1)),this.selectedVisitIndex=this.visitList.length>this.VISIT_THRESHOLD?0:-1})},rebuildEntriesIndex(){const e=new Map;for(const t of this.existingEntries||[]){const s=`${t.subject_index}|${t.visit_index}|${t.group_index}`,a=e.get(s)||[];a.push(t),e.set(s,a)}for(const[t,s]of e)s.sort((e,t)=>Number(t.form_version)-Number(e.form_version));this.entriesIndex=e,this.hydrateCache.clear()},getBestEntryFor(e,t,s){const a=`${e}|${t}|${s}`,i=this.entriesIndex.get(a);if(!i||!i.length)return null;const l=Number(this.selectedVersion);for(const n of i)if(Number(n.form_version)===l)return n;for(const n of i)if(Number(n.form_version)<=l)return n;return i[0]},applyVersionView(){if(this.showSelection)return;const e=this.numberOfSubjects,t=this.visitList.length,s=-1===this.selectedVisitIndex?Array.from({length:t},(e,t)=>t):[Math.min(Math.max(this.selectedVisitIndex,0),Math.max(t-1,0))];for(let a=0;a<e;a++){const e=this.subjectToGroupIdx[a]??0;for(const t of s)this.hydrateCell(a,t,e)}},sectionDictKey(e){return e?.title??""},fieldDictKey(e,t){return e?.name??e?.label??e?.key??e?.title??`f${t}`},arrayToDict(e){const t={};return(this.selectedModels||[]).forEach((s,a)=>{const i=this.sectionDictKey(s),l=s?.fields||[],n=Array.isArray(e?.[a])?e[a]:[],r={};l.forEach((e,t)=>{const s=this.fieldDictKey(e,t);r[s]=null!=n[t]?n[t]:this.defaultForField(e)}),t[i]=r}),t},flagsArrayToDict(e){const t={};return(this.selectedModels||[]).forEach((s,a)=>{const i=this.sectionDictKey(s),l=Array.isArray(e?.[a])?e[a]:[],n={};(s.fields||[]).forEach((e,t)=>{const s=this.fieldDictKey(e,t);n[s]=!!l[t]}),t[i]=n}),t},dictToArray(e){return(this.selectedModels||[]).map((t,s)=>{const a=this.sectionDictKey(t),i=e&&"object"===typeof e?e[a]:void 0;return(t.fields||[]).map((e,t)=>{const s=this.fieldDictKey(e,t),a=i?i[s]:void 0;return void 0!==a?a:this.defaultForField(e)})})},makeSectionFieldSkeleton(){return(this.selectedModels||[]).map(e=>(e.fields||[]).map(e=>this.defaultForField(e)))},makeSkipSkeleton(){return(this.selectedModels||[]).map(e=>(e.fields||[]).map(()=>!1))},ensureSlot(e,t,s){this.entryData[e]||(this.entryData[e]=[]),this.entryData[e][t]||(this.entryData[e][t]=[]),this.entryData[e][t][s]||(this.entryData[e][t][s]=this.makeSectionFieldSkeleton()),this.skipFlags[e]||(this.skipFlags[e]=[]),this.skipFlags[e][t]||(this.skipFlags[e][t]=[]),this.skipFlags[e][t][s]||(this.skipFlags[e][t][s]=this.makeSkipSkeleton()),this.entryIds[e]||(this.entryIds[e]=[]),this.entryIds[e][t]||(this.entryIds[e][t]=[]),"undefined"===typeof this.entryIds[e][t][s]&&(this.entryIds[e][t][s]=null)},hydrateCell(e,t,s){const a=`${e}|${t}|${s}|${this.selectedVersion}`,i=this.hydrateCache.get(a);if(i)return this.entryData[e]??=[],this.entryData[e][t]??=[],this.entryData[e][t][s]=i.dataArr,this.entryIds[e]??=[],this.entryIds[e][t]??=[],this.entryIds[e][t][s]=i.id,this.skipFlags[e]??=[],this.skipFlags[e][t]??=[],void(this.skipFlags[e][t][s]=i.skipFlags);const l=this.getBestEntryFor(e,t,s);if(this.ensureSlot(e,t,s),!l)return void this.hydrateCache.set(a,{dataArr:this.entryData[e][t][s],skipFlags:this.skipFlags[e][t][s],id:null});let n;n=l.data&&!Array.isArray(l.data)&&"object"===typeof l.data?this.dictToArray(l.data):Array.isArray(l.data)?l.data:this.selectedModels.map(e=>e.fields.map(e=>this.defaultForField(e))),n=(this.selectedModels||[]).map((e,t)=>{const s=Array.isArray(n[t])?n[t]:[];return(e.fields||[]).map((e,t)=>void 0!==s[t]?s[t]:this.defaultForField(e))}),this.entryData[e][t][s]=n,this.entryIds[e][t][s]=l.id;const r=l.skipped_required_flags||l.skips;this.skipFlags[e][t][s]=Array.isArray(r)?r:this.makeSkipSkeleton(),this.hydrateCache.set(a,{dataArr:this.entryData[e][t][s],skipFlags:this.skipFlags[e][t][s],id:l.id})},setDeepValue(e,t,s,a,i,l){if(this.ensureSlot(e,t,s),!Array.isArray(this.entryData[e][t][s][a])){const i=this.selectedModels[a]?.fields||[];this.entryData[e][t][s][a]=i.map(e=>this.defaultForField(e))}this.entryData[e][t][s][a][i]=l},setDeepSkip(e,t,s,a,i,l){if(this.ensureSlot(e,t,s),!Array.isArray(this.skipFlags[e][t][s][a])){const i=this.selectedModels[a]?.fields||[];this.skipFlags[e][t][s][a]=i.map(()=>!1)}this.skipFlags[e][t][s][a][i]=!!l},setEntryValue(e,t,s){const a=this.currentSubjectIndex,i=this.currentVisitIndex,l=this.currentGroupIndex;this.setDeepValue(a,i,l,e,t,s),this.clearError(e,t),this.validateField(e,t),this.hydrateCache.delete(`${a}|${i}|${l}|${this.selectedVersion}`)},errorKey(e,t){return[this.currentSubjectIndex,this.currentVisitIndex,this.currentGroupIndex,e,t].join("-")},parseKey(e){const t=String(e).split("-").map(e=>parseInt(e,10));if(5!==t.length||t.some(e=>Number.isNaN(e)))return null;const[s,a,i,l,n]=t;return{s:s,v:a,g:i,m:l,f:n}},onRawFileSelected(e,t,s){const a=this.errorKey(e,t),i=Array.isArray(s)?s:s?[s]:[],l=Array.isArray(this.pendingFiles[a])?this.pendingFiles[a]:this.pendingFiles[a]?[this.pendingFiles[a]]:[];this.pendingFiles={...this.pendingFiles,[a]:[...l,...i]}},getSliderProps(e){const t=e?.constraints||{},s=t.percent?1:Number.isFinite(+t.min)?+t.min:1,a=t.percent?100:Number.isFinite(+t.max)?+t.max:t.percent?100:5,i=Number.isFinite(+t.step)&&+t.step>0?+t.step:1,l=Array.isArray(t.marks)?t.marks:[];return{min:s,max:a,step:i,readonly:!!t.readonly||!this.canEdit,percent:!!t.percent,showTicks:!!t.showTicks,marks:l}},getLinearProps(e){const t=e?.constraints||{},s=Number.isFinite(+t.min)?Math.round(+t.min):1;let a=Number.isFinite(+t.max)?Math.round(+t.max):5;return a<=s&&(a=s+1),{min:s,max:a,leftLabel:t.leftLabel||"",rightLabel:t.rightLabel||"",readonly:!!t.readonly||!this.canEdit}},openLegendDialog(){this.showLegendDialog=!0},closeLegendDialog(){this.showLegendDialog=!1},openStatusLegend(){this.showStatusLegend=!0},closeStatusLegend(){this.showStatusLegend=!1},hasConstraints(e){const t=e?.constraints||{};return Object.keys(t).some(e=>"required"!==e&&"helpText"!==e)},buildConstraintList(e){const t=e?.constraints||{},s=[];if(!t.readonly&&this.canEdit||s.push("Read-only"),"slider"===e.type){const e=(t.mode||"slider").toLowerCase();return"slider"===e?(s.push("Slider "+(t.percent?"(1–100%)":"")),Number.isFinite(t.min)&&s.push(`Min: ${t.min}`),Number.isFinite(t.max)&&s.push(`Max: ${t.max}`),Number.isFinite(t.step)&&s.push(`Step: ${t.step}`),t.showTicks&&s.push("Show tick marks"),Array.isArray(t.marks)&&t.marks.length&&s.push(`Labels: ${t.marks.map(e=>`${e.value}="${e.label}"`).join(", ")}`)):(s.push("Linear scale"),s.push(`Range: ${t.min??1}–${t.max??5} (integers)`),t.leftLabel&&s.push(`Left: “${t.leftLabel}”`),t.rightLabel&&s.push(`Right: “${t.rightLabel}”`)),s.length?s:["No constraints."]}if(("text"===e.type||"textarea"===e.type)&&("number"===typeof t.minLength&&s.push(`Min length: ${t.minLength}`),"number"===typeof t.maxLength&&s.push(`Max length: ${t.maxLength}`),t.pattern&&s.push(`Pattern: ${t.pattern}`),t.transform&&"none"!==t.transform)){const e=t.transform.charAt(0).toUpperCase()+t.transform.slice(1).toLowerCase();s.push(`Transform on save: ${e}`)}if("number"===e.type&&("number"===typeof t.min&&s.push(`Min: ${t.min}`),"number"===typeof t.max&&s.push(`Max: ${t.max}`),"number"===typeof t.step&&s.push(`Step: ${t.step}`),"number"===typeof t.minDigits&&s.push(`Min digits: ${t.minDigits}`),"number"===typeof t.maxDigits&&s.push(`Max digits: ${t.maxDigits}`),t.integerOnly&&s.push("Integer only")),"date"===e.type&&(t.dateFormat&&s.push(`Date format: ${t.dateFormat}`),t.minDate&&s.push(`Min date: ${t.minDate}`),t.maxDate&&s.push(`Max date: ${t.maxDate}`)),"time"===e.type&&(t.minTime&&s.push(`Min time: ${t.minTime}`),t.maxTime&&s.push(`Max time: ${t.maxTime}`),"number"===typeof t.step&&s.push(`Step (sec): ${t.step}`)),"select"===e.type&&t.allowMultiple&&s.push("Multiple selection: allowed"),"file"===e.type){const e="url"===t.storagePreference?"Link via URL":"Local upload";s.push(`Storage: ${e}`);const a=Array.isArray(t.allowedFormats)?t.allowedFormats.filter(Boolean).map(String):[];a.length&&s.push(`Allowed: ${a.join(", ")}`);const i=Number(t.maxSizeMB);Number.isFinite(i)&&i>0&&s.push(`Max size: ${i} MB`),t.allowMultipleFiles&&s.push("Multiple files: allowed"),Array.isArray(t.modalities)&&t.modalities.length&&s.push(`Modalities: ${t.modalities.join(", ")}`)}return s.length?s:["No constraints."]},openConstraintDialog(e){this.constraintDialogFieldName=e?.label||e?.name||"Field",this.constraintDialogItems=this.buildConstraintList(e),this.showConstraintDialog=!0},closeConstraintDialog(){this.showConstraintDialog=!1,this.constraintDialogFieldName="",this.constraintDialogItems=[]},applyTransform(e,t){const s=null==t?"":String(t);switch(String(e||"none").toLowerCase()){case"uppercase":return s.toUpperCase();case"lowercase":return s.toLowerCase();case"capitalize":return s.replace(/\b\w+/g,e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase());default:return s}},onFieldBlur(e,t){const s=this.selectedModels[e].fields[t]||{},a=s.constraints||{};if("text"===s.type||"textarea"===s.type){const s=this.entryData[this.currentSubjectIndex][this.currentVisitIndex][this.currentGroupIndex][e][t],i=this.applyTransform(a.transform,s);i!==s&&this.setDeepValue(this.currentSubjectIndex,this.currentVisitIndex,this.currentGroupIndex,e,t,i)}this.validateField(e,t)},applyTransformsForSection(){this.assignedModelIndices.forEach(e=>{this.selectedModels[e].fields.forEach((t,s)=>{if(!t)return;const a=t.constraints||{};if("text"===t.type||"textarea"===t.type){const t=this.entryData[this.currentSubjectIndex][this.currentVisitIndex][this.currentGroupIndex][e][s],i=this.applyTransform(a.transform,t);i!==t&&this.setDeepValue(this.currentSubjectIndex,this.currentVisitIndex,this.currentGroupIndex,e,s,i)}})})},setError(e,t,s){const a=this.errorKey(e,t);this.validationErrors={...this.validationErrors,[a]:s}},clearError(e,t){const s=this.errorKey(e,t);if(s in this.validationErrors){const e={...this.validationErrors};delete e[s],this.validationErrors=e}},fieldErrors(e,t){return this.validationErrors[this.errorKey(e,t)]||""},goToDashboard(){this.$router.push({name:"Dashboard",query:{openStudies:"true"}})},async loadStudy(e){try{const t=await se.A.get(`/forms/studies/${e}`,{headers:{Authorization:`Bearer ${this.token}`}});this.study=t.data,this.initializeEntryData()}catch(t){console.error("[Entry] loadStudy error",t),this.showDialogMessage("Failed to load study details.")}},async loadShared(e){try{const t=await se.A.get(`/forms/shared-api/${e}/`),s=t.data||{};this.shareToken=e,this.sharedPermission=s.permission||"view",this.study=s.study,this.initializeEntryData(),this.prepareAssignmentsLookup(),this.prepareSubjectGroupIndexMap(),this.currentSubjectIndex=s.subject_index??0,this.currentVisitIndex=s.visit_index??0,this.currentGroupIndex=s.group_index??0,this.ensureSlot(this.currentSubjectIndex,this.currentVisitIndex,this.currentGroupIndex),this.showSelection=!1,this.validationErrors={}}catch(t){console.error("[Shared] load error",t),this.showDialogMessage("Shared link is invalid or expired.")}},async loadExistingEntries(e){try{const t=await se.A.get(`/forms/studies/${e}/data_entries`,{headers:{Authorization:`Bearer ${this.token}`}}),s=Array.isArray(t.data)?t.data:t.data?.entries||[];this.existingEntries=s,this.rebuildEntriesIndex()}catch(t){console.error("Failed to load existing entries",t)}},defaultForField(e,{ignoreDefaults:t=!1}={}){const s=e?.constraints||{},a=String(e?.type||"").toLowerCase(),i=!!s.allowMultiple;if("slider"===a)return null;if("file"===a)return s.allowMultipleFiles?[]:null;if(!t&&Object.prototype.hasOwnProperty.call(s,"defaultValue"))return s.defaultValue;if(!t&&Object.prototype.hasOwnProperty.call(e,"value"))return e.value;switch(a){case"checkbox":return!1;case"radio":case"select":return i?[]:"";case"number":return"";case"date":case"time":case"text":case"textarea":default:return""}},clearCurrentSection(){if(!this.canEdit)return;const e=this.currentSubjectIndex,t=this.currentVisitIndex,s=this.currentGroupIndex;this.ensureSlot(e,t,s),this.assignedModelIndices.forEach(a=>{const i=this.selectedModels[a];i.fields.forEach((i,l)=>{const n=i?.constraints||{};if(n.readonly)return void this.clearError(a,l);const r=this.defaultForField(i,{ignoreDefaults:!1});this.setDeepValue(e,t,s,a,l,r),this.setDeepSkip(e,t,s,a,l,!1),this.clearError(a,l)})}),this.hydrateCache.delete(`${e}|${t}|${s}|${this.selectedVersion}`)},initializeEntryData(){const e=this.numberOfSubjects,t=this.visitList.length,s=this.groupList.length;this.entryData=Array.from({length:e},()=>Array.from({length:t},()=>Array.from({length:s},()=>null))),this.skipFlags=Array.from({length:e},()=>Array.from({length:t},()=>Array.from({length:s},()=>null))),this.entryIds=Array.from({length:e},()=>Array.from({length:t},()=>Array.from({length:s},()=>null))),this.validationErrors={}},prepareAssignmentsLookup(){const e=this.visitList.length,t=this.groupList.length;this.assignedLookup=Array.from({length:e},(e,s)=>Array.from({length:t},(e,t)=>this.selectedModels.map((e,t)=>t).filter(e=>!!this.assignments[e]?.[s]?.[t])))},prepareSubjectGroupIndexMap(){const e=this.study?.content?.study_data?.subjects||[];this.subjectToGroupIdx=e.map(e=>{const t=(e.group||"").trim().toLowerCase(),s=this.groupList.findIndex(e=>(e.name||"").trim().toLowerCase()===t);return s>=0?s:0})},buildStatusCache(){this.statusMap=new Map;const e=this.numberOfSubjects,t=this.visitList.length,s=-1===this.selectedVisitIndex?Array.from({length:t},(e,t)=>t):[Math.min(Math.max(this.selectedVisitIndex,0),Math.max(t-1,0))];for(let a=0;a<e;a++){const e=this.subjectToGroupIdx[a]??0;for(const t of s){const s=this.getBestEntryFor(a,t,e),i=`${a}|${t}`;if(!s){this.statusMap.set(i,"none");continue}const l=s.skipped_required_flags,n=!(!Array.isArray(l)||!l.some(e=>Array.isArray(e)&&e.some(Boolean)));if(n){this.statusMap.set(i,"skipped");continue}const r=this.assignedLookup?.[t]?.[e]||[];let o=0,d=0;if(s.data&&!Array.isArray(s.data)&&"object"===typeof s.data)for(const e of r){const t=this.selectedModels[e]||{},a=this.sectionDictKey(t),i=s.data[a]||{};(t.fields||[]).forEach((e,t)=>{const s=this.fieldDictKey(e,t),a=i[s];o+=1,null!=a&&""!==a&&(d+=1)})}else if(Array.isArray(s.data))for(const e of r){const t=s.data[e]||[];o+=t.length,d+=t.filter(e=>null!=e&&""!==e).length}0===o||0===d?this.statusMap.set(i,"none"):d===o?this.statusMap.set(i,"complete"):this.statusMap.set(i,"partial")}}},statusClassFast(e,t){const s=this.statusMap.get(`${e}|${t}`)||"none";return"skipped"===s?"status-skipped":`status-${s}`},selectCell(e,t){const s=this.numberOfSubjects,a=this.visitList.length;this.currentSubjectIndex=Math.min(Math.max(e??0,0),Math.max(s-1,0)),this.currentVisitIndex=Math.min(Math.max(t??0,0),Math.max(a-1,0)),this.currentGroupIndex=this.subjectToGroupIdx[this.currentSubjectIndex]??0,this.ensureSlot(this.currentSubjectIndex,this.currentVisitIndex,this.currentGroupIndex),this.prepareAssignmentsLookup(),this.showSelection=!1,this.validationErrors={},this.visitLoading=!0,this.hydrateCell(this.currentSubjectIndex,this.currentVisitIndex,this.currentGroupIndex),this.visitLoading=!1},backToSelection(){this.isShared||(this.showSelection=!0,this.showDetails=!1,this.currentSubjectIndex=null,this.currentVisitIndex=null,this.currentGroupIndex=0,this.validationErrors={})},toggleDetails(){this.showDetails=!this.showDetails},fieldId(e,t){return`s${this.currentSubjectIndex}_v${this.currentVisitIndex}_g${this.currentGroupIndex}_m${e}_f${t}`},isFieldSkipped(e,t){const s=this.currentSubjectIndex,a=this.currentVisitIndex,i=this.currentGroupIndex;return!!this.skipFlags[s]?.[a]?.[i]?.[e]?.[t]},setSkipForField(e,t,s){const a=this.currentSubjectIndex,i=this.currentVisitIndex,l=this.currentGroupIndex;this.skipFlags[a]&&this.skipFlags[a][i]&&this.skipFlags[a][i][l]&&this.setDeepSkip(a,i,l,e,t,s)},validateField(e,t){const s=this.currentSubjectIndex,a=this.currentVisitIndex,i=this.currentGroupIndex;this.ensureSlot(s,a,i);const l=this.selectedModels[e].fields[t]||{},n=l.constraints||{},r=l.label||l.name||"This field",o=this.entryData[s][a][i][e][t],d=!!n.allowMultipleFiles;let u=!!this.skipFlags[s]?.[a]?.[i]?.[e]?.[t];const p=()=>{if("checkbox"===l.type)return!0!==o;if("file"===l.type){if(d){const e=Array.isArray(o)?o:[];return 0===e.length}{if(!o)return!0;const e=o.source||o.file&&o.file.source||"local";if("url"===e){const e=(o.url||"").trim();return!e}if("local"===e){const e=o.file&&"object"===typeof o.file?o.file:o,t=Number(e.size);return!e.name||!Number.isFinite(t)||t<=0}return!0}}return Array.isArray(o)?0===o.length:null==o||"string"===typeof o&&""===o.trim()};if(this.clearError(e,t),u){if(p())return!0;this.setSkipForField(e,t,!1),u=!1}if(n.required&&p())return this.setError(e,t,`${r} is required.`),!1;if("slider"===l.type){if(null==o||""===o)return!0;const s=(n.mode||"slider").toLowerCase(),a=Number(o);if(!Number.isFinite(a))return this.setError(e,t,`${r} must be a number.`),!1;if("slider"===s){const s=n.percent?1:Number.isFinite(+n.min)?+n.min:1,i=n.percent?100:Number.isFinite(+n.max)?+n.max:n.percent?100:5,l=Number.isFinite(+n.step)&&+c.step>0?+n.step:1;if(a<s||a>i)return this.setError(e,t,`${r} must be between ${s} and ${i}.`),!1;if(l>=1){const i=(a-s)/l;if(Math.abs(i-Math.round(i))>1e-9)return this.setError(e,t,`${r} must align to step ${l}.`),!1}return!0}{const s=Number.isFinite(+n.min)?Math.round(+n.min):1,i=Number.isFinite(+n.max)?Math.round(+n.max):5;return!(a<s||a>i||Math.round(a)!==a)||(this.setError(e,t,`${r} must be an integer between ${s} and ${i}.`),!1)}}if("file"!==l.type){const{valid:s,message:a}=op(this.ajv,l,o);if(!s)return this.setError(e,t,a||`${r} is invalid.`),!1}if("date"===l.type&&o){const s=(this.selectedModels[e].fields[t]||{}).constraints||{},a=s.dateFormat||"dd.MM.yyyy",i=e=>{const t={"dd.MM.yyyy":/^(\d{2})\.(\d{2})\.(\d{4})$/,"MM-dd-yyyy":/^(\d{2})-(\d{2})-(\d{4})$/,"dd-MM-yyyy":/^(\d{2})-(\d{2})-(\d{4})$/,"yyyy-MM-dd":/^(\d{4})-(\d{2})-(\d{2})$/,"MM/yyyy":/^(\d{2})\/(\d{4})$/,"MM-yyyy":/^(\d{2})-(\d{4})$/,"yyyy/MM":/^(\d{4})\/(\d{2})$/,"yyyy-MM":/^(\d{4})-(\d{2})$/,yyyy:/^(\d{4})$/},s=t[a]||t[a.replace(".","\\.")];if(!s)return null;const i=s.exec(String(e));if(!i)return null;let l,n,r;return"dd.MM.yyyy"===a?(r=+i[1],n=+i[2],l=+i[3]):"MM-dd-yyyy"===a?(n=+i[1],r=+i[2],l=+i[3]):"dd-MM-yyyy"===a?(r=+i[1],n=+i[2],l=+i[3]):"yyyy-MM-dd"===a?(l=+i[1],n=+i[2],r=+i[3]):(n=+i[1],l=+i[2],r=1),new Date(l,n-1,r)},n=i(o);if(n){if(s.minDate){const a=i(s.minDate);if(a&&n<a)return this.setError(e,t,`${l.label||l.name||"This field"} must be ≥ ${s.minDate}.`),!1}if(s.maxDate){const a=i(s.maxDate);if(a&&n>a)return this.setError(e,t,`${l.label||l.name||"This field"} must be ≤ ${s.maxDate}.`),!1}}}if("time"===l.type&&o){const s=(this.selectedModels[e].fields[t]||{}).constraints||{},a=e=>{const t=/^(\d{2}):(\d{2})(?::(\d{2}))?$/.exec(String(e));if(!t)return null;const s=+t[1],a=+t[2],i=t[3]?+t[3]:0;return 3600*s+60*a+i},i=a(o);if(null!=i){if(s.minTime){const n=a(s.minTime);if(null!=n&&i<n)return this.setError(e,t,`${l.label||l.name||"This field"} must be ≥ ${s.minTime}.`),!1}if(s.maxTime){const n=a(s.maxTime);if(null!=n&&i>n)return this.setError(e,t,`${l.label||l.name||"This field"} must be ≤ ${s.maxTime}.`),!1}}}return!0},validateCurrentSection(){this.assignedModelIndices.forEach(e=>{this.selectedModels[e].fields.forEach((t,s)=>{this.clearError(e,s)})});let e=!0;return this.assignedModelIndices.forEach(t=>{this.selectedModels[t].fields.forEach((s,a)=>{const i=this.validateField(t,a);e=e&&i})}),e},computeRequiredFailures(){const e=this.currentSubjectIndex,t=this.currentVisitIndex,s=this.currentGroupIndex;this.ensureSlot(e,t,s);const a=[];return this.assignedModelIndices.forEach(i=>{const l=this.selectedModels[i];(l.fields||[]).forEach((n,r)=>{const o=n?.constraints||{};if(!o.required)return;if(this.skipFlags[e]?.[t]?.[s]?.[i]?.[r])return;const d=this.entryData[e][t][s][i][r],u="checkbox"===n.type?!0!==d:"file"===n.type?o.allowMultipleFiles?!(Array.isArray(d)&&d.length>0):!d||("url"===d.source?!(d.url&&String(d.url).trim()):!(d.name&&Number.isFinite(Number(d.size)))):Array.isArray(d)?0===d.length:null==d||"string"===typeof d&&""===d.trim();u&&a.push({key:this.errorKey(i,r),id:this.fieldId(i,r),sectionIndex:i,fieldIndex:r,sectionTitle:l.title||`Section ${i+1}`,fieldLabel:n.label||n.name||`Field ${r+1}`})})}),a},async uploadPendingFilesForCurrentSection(){if(!this.canEdit)return;const e=this.currentSubjectIndex,t=this.currentVisitIndex,s=this.currentGroupIndex,a=this.study?.metadata?.id;for(const i of this.assignedModelIndices){const l=this.selectedModels[i];for(let n=0;n<(l.fields||[]).length;n++){const r=l.fields[n]||{};if("file"!==r.type)continue;const o=this.errorKey(i,n),d=r.constraints||{},u=!!d.allowMultipleFiles,c=this.entryData[e][t][s][i][n];if(!c&&!u)continue;const p=Array.isArray(r?.constraints?.modalities)?r.constraints.modalities:[],m=JSON.stringify(p||[]),h=Array.isArray(this.pendingFiles[o])?this.pendingFiles[o]:this.pendingFiles[o]?[this.pendingFiles[o]]:[],y=e=>h.find(t=>t&&e&&t.name===e.name&&Number(t.size)===Number(e.size)&&(!t.lastModified||t.lastModified===e.lastModified)),g=this.isShared?`/forms/shared/${this.shareToken}`:`/forms/studies/${a}`;if(u){const a=Array.isArray(c)?[...c]:[];for(let i=0;i<a.length;i++){const l=a[i];if(l&&!l.dbId)if("local"===l.source){const n=y(l);if(!n)continue;const o=new FormData;o.append("uploaded_file",n),o.append("description",r.label||r.name||""),o.append("modalities_json",m),this.isShared||(o.append("storage_option","local"),o.append("subject_index",String(e)),o.append("visit_index",String(t)),o.append("group_index",String(s)));const d=this.isShared?{"Content-Type":"multipart/form-data"}:{Authorization:`Bearer ${this.token}`,"Content-Type":"multipart/form-data"},u=await se.A.post(`${g}/files`,o,{headers:d}),c=u?.data||{};a[i]={...l,dbId:c.id,file_path:c.file_path,storage_option:c.storage_option||(this.isShared?"bids":"local"),file_name:c.file_name||l.name}}else if("url"===l.source&&l.url){const e=new FormData;e.append("url",l.url),e.append("description",r.label||r.name||""),e.append("modalities_json",m);const t=this.isShared?{}:{Authorization:`Bearer ${this.token}`},s=await se.A.post(`${g}/files/url`,e,{headers:t}),n=s?.data||{};a[i]={...l,dbId:n.id,file_path:n.file_path,storage_option:"url",file_name:n.file_name||""}}}this.setDeepValue(e,t,s,i,n,a),delete this.pendingFiles[o]}else{if(!c)continue;if("local"===c.source&&h[0]instanceof File){const a=h[0],l=new FormData;l.append("uploaded_file",a),l.append("description",r.label||r.name||""),l.append("modalities_json",m),this.isShared||(l.append("storage_option","local"),l.append("subject_index",String(e)),l.append("visit_index",String(t)),l.append("group_index",String(s)));const d=this.isShared?{"Content-Type":"multipart/form-data"}:{Authorization:`Bearer ${this.token}`,"Content-Type":"multipart/form-data"},u=await se.A.post(`${g}/files`,l,{headers:d}),p=u?.data||{};this.setDeepValue(e,t,s,i,n,{...c,dbId:p.id,file_path:p.file_path,storage_option:p.storage_option||(this.isShared?"bids":"local"),file_name:p.file_name||c.name}),delete this.pendingFiles[o]}if("url"===c.source&&c.url){const a=new FormData;a.append("url",c.url),a.append("description",r.label||r.name||""),a.append("modalities_json",m);const l=this.isShared?{}:{Authorization:`Bearer ${this.token}`},o=await se.A.post(`${g}/files/url`,a,{headers:l}),d=o?.data||{};this.setDeepValue(e,t,s,i,n,{...c,dbId:d.id,file_path:d.file_path,storage_option:"url",file_name:d.file_name||""})}}}}},async submitData(){if(!this.canEdit)return void this.showDialogMessage("This shared link is view-only.");this.applyTransformsForSection();const e=this.validateCurrentSection(),t=Object.entries(this.validationErrors).filter(([e,t])=>{if(!t)return!1;const s=this.parseKey(e);if(!s)return!0;const{s:a,v:i,g:l,m:n,f:r}=s,o=!!this.skipFlags[a]?.[i]?.[l]?.[n]?.[r];return!o&&!/ is required\.$/.test(t)});if(!e&&t.length)return void this.showDialogMessage("Please fix validation errors before saving.");const s=this.computeRequiredFailures();if(s.length)return this.skipCandidates=s,this.skipSelections=s.reduce((e,t)=>(e[t.key]=!1,e),{}),void(this.showSkipDialog=!0);try{await this.uploadPendingFilesForCurrentSection()}catch(u){return console.error("File upload/register failed:",u),void this.showDialogMessage("File upload failed. Please try again.")}const a=this.currentSubjectIndex,i=this.currentVisitIndex,l=this.currentGroupIndex;this.ensureSlot(a,i,l);const n=this.arrayToDict(this.entryData[a][i][l]),r=this.skipFlags[a][i][l],o=this.isShared?this.flagsArrayToDict(r):r,d={study_id:this.study?.metadata?.id,subject_index:a,visit_index:i,group_index:l,data:n,skipped_required_flags:o};try{if(this.isShared){const e=await se.A.post(`/forms/shared/${this.shareToken}/data`,d),t={id:e?.data?.id,study_id:d.study_id,subject_index:a,visit_index:i,group_index:l,data:n,skipped_required_flags:e?.data?.skipped_required_flags??r,form_version:e?.data?.form_version??this.selectedVersion,created_at:e?.data?.created_at??(new Date).toISOString()};return(this.existingEntries=this.existingEntries||[]).push(t),this.showDialogMessage("Data saved successfully."),this.rebuildEntriesIndex(),this.hydrateCache.delete(`${a}|${i}|${l}|${this.selectedVersion}`),this.applyVersionView(),void this.updateStatusCacheFor(a,i,l)}const e={headers:{Authorization:`Bearer ${this.token}`}},t=this.entryIds[a][i][l];if(t){const s=await se.A.put(`/forms/studies/${this.study.metadata.id}/data_entries/${t}`,d,e);this.showDialogMessage("Data updated successfully.");const a=this.existingEntries.findIndex(e=>e.id===t);a>=0&&this.existingEntries.splice(a,1,s.data)}else{const t=this.safeVersionParams(this.selectedVersion),s=await se.A.post(`/forms/studies/${this.study.metadata.id}/data`,d,t?{...e,params:t}:e),o=s?.data?.id;this.entryIds[a][i][l]=o;const u={id:o,study_id:this.study.metadata.id,subject_index:a,visit_index:i,group_index:l,data:n,skipped_required_flags:s?.data?.skipped_required_flags??r,form_version:s?.data?.form_version??this.selectedVersion,created_at:s?.data?.created_at??(new Date).toISOString()};(this.existingEntries=this.existingEntries||[]).push(u),this.showDialogMessage("Data saved successfully.")}this.rebuildEntriesIndex(),this.hydrateCache.delete(`${a}|${i}|${l}|${this.selectedVersion}`),this.applyVersionView(),this.updateStatusCacheFor(a,i,l)}catch(c){console.error(c),this.showDialogMessage("Failed to save data. Check console for details.")}},updateStatusCacheFor(e,t,s){const a=this.getBestEntryFor(e,t,s),i=`${e}|${t}`;if(!a)return void this.statusMap.set(i,"none");const l=a.skipped_required_flags,n=!(!Array.isArray(l)||!l.some(e=>Array.isArray(e)&&e.some(Boolean)));if(n)return void this.statusMap.set(i,"skipped");const r=this.assignedLookup?.[t]?.[s]||[];let o=0,d=0;if(a.data&&!Array.isArray(a.data)&&"object"===typeof a.data)for(const u of r){const e=this.selectedModels[u]||{},t=this.sectionDictKey(e),s=a.data[t]||{};(e.fields||[]).forEach((e,t)=>{const a=this.fieldDictKey(e,t),i=s[a];o+=1,null!=i&&""!==i&&(d+=1)})}else if(Array.isArray(a.data))for(const u of r){const e=a.data[u]||[];o+=e.length,d+=e.filter(e=>null!=e&&""!==e).length}0===o||0===d?this.statusMap.set(i,"none"):d===o?this.statusMap.set(i,"complete"):this.statusMap.set(i,"partial")},confirmSkipSelection(){const e=this.currentSubjectIndex,t=this.currentVisitIndex,s=this.currentGroupIndex;this.skipCandidates.forEach(a=>{const i=!!this.skipSelections[a.key];this.setDeepSkip(e,t,s,a.sectionIndex,a.fieldIndex,i),i&&this.clearError(a.sectionIndex,a.fieldIndex)}),this.showSkipDialog=!1,this.submitData()},cancelSkipSelection(){this.showSkipDialog=!1},jumpToField(e){this.showSkipDialog=!1,this.$nextTick(()=>{const t=document.getElementById(e.id);t&&"function"===typeof t.focus&&t.focus()})},openShareDialog(e,t,s){this.shareParams={subjectIndex:e,visitIndex:t,groupIndex:s},this.generatedLink="",this.showShareDialog=!0},async createShareLink(){const{subjectIndex:e,visitIndex:t,groupIndex:s}=this.shareParams,a={study_id:this.study.metadata.id,subject_index:e,visit_index:t,group_index:s,permission:this.shareConfig.permission,max_uses:this.shareConfig.maxUses,expires_in_days:this.shareConfig.expiresInDays};try{const e=await se.A.post("/forms/share-link/",a,{headers:{Authorization:`Bearer ${this.token}`}});this.generatedLink=e.data.link}catch(i){403===i.response?.status&&(this.permissionError=!0)}},showDialogMessage(e){this.dialogMessage=e,this.showDialog=!0},closeDialog(){this.showDialog=!1,this.dialogMessage=""}}};const up=(0,o.A)(dp,[["render",Rc],["__scopeId","data-v-fe50acc6"]]);var cp=up;const pp={class:"study-creation-container"},mp={key:0,class:"new-study-form"},hp={class:"form-actions"},yp={key:1,class:"new-study-form"},gp={class:"form-actions"},fp={key:2,class:"new-study-form"},vp={class:"form-actions"},kp={key:3,class:"new-study-form"},bp={class:"form-actions"},Lp={key:4,class:"new-study-form"},wp={class:"form-actions"},Cp={key:0,class:"dialog-backdrop"},Sp={class:"dialog-box"};function xp(e,t,s,a,l,n){const r=(0,i.g2)("BaseTextarea"),o=(0,i.g2)("BaseSelectField"),d=(0,i.g2)("BaseNumberField"),u=(0,i.g2)("BaseDateField"),c=(0,i.g2)("BaseTextField"),p=(0,i.g2)("GroupForm"),h=(0,i.g2)("SubjectForm"),y=(0,i.g2)("SubjectAssignmentForm"),g=(0,i.g2)("VisitForm");return(0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.Lk)("div",pp,[1===a.step?((0,i.uX)(),(0,i.CE)("div",mp,[t[16]||(t[16]=(0,i.Lk)("h2",null,"Step 1: Create a New Study",-1)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(a.studySchema.filter(e=>e.display),(e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t,class:"schema-field-row"},["textarea"===e.type?((0,i.uX)(),(0,i.Wv)(r,{key:0,modelValue:a.studyData[e.field],"onUpdate:modelValue":t=>a.studyData[e.field]=t,id:e.field,label:e.label,placeholder:e.placeholder,required:e.required,disabled:e.disabled,error:a.fieldError(e,a.studyData[e.field])},null,8,["modelValue","onUpdate:modelValue","id","label","placeholder","required","disabled","error"])):"select"===e.type?((0,i.uX)(),(0,i.Wv)(o,{key:1,modelValue:a.studyData[e.field],"onUpdate:modelValue":t=>a.studyData[e.field]=t,id:e.field,label:e.label,options:e.options,placeholder:e.placeholder,required:e.required,disabled:e.disabled,error:a.fieldError(e,a.studyData[e.field])},null,8,["modelValue","onUpdate:modelValue","id","label","options","placeholder","required","disabled","error"])):"number"===e.type?((0,i.uX)(),(0,i.Wv)(d,{key:2,modelValue:a.studyData[e.field],"onUpdate:modelValue":t=>a.studyData[e.field]=t,id:e.field,label:e.label,placeholder:e.placeholder,required:e.required,disabled:e.disabled,error:a.fieldError(e,a.studyData[e.field])},null,8,["modelValue","onUpdate:modelValue","id","label","placeholder","required","disabled","error"])):"date"===e.type?((0,i.uX)(),(0,i.Wv)(u,{key:3,modelValue:a.studyData[e.field],"onUpdate:modelValue":t=>a.studyData[e.field]=t,id:e.field,label:e.label,required:e.required,disabled:e.disabled,error:a.fieldError(e,a.studyData[e.field]),min:e.min,max:e.max},null,8,["modelValue","onUpdate:modelValue","id","label","required","disabled","error","min","max"])):((0,i.uX)(),(0,i.Wv)(c,{key:4,modelValue:a.studyData[e.field],"onUpdate:modelValue":t=>a.studyData[e.field]=t,id:e.field,label:e.label,placeholder:e.placeholder,required:e.required,disabled:e.disabled,error:a.fieldError(e,a.studyData[e.field])},null,8,["modelValue","onUpdate:modelValue","id","label","placeholder","required","disabled","error"]))]))),128)),(0,i.Lk)("div",hp,[(0,i.Lk)("button",{type:"button",onClick:t[0]||(t[0]=(...e)=>a.goToStudyManagement&&a.goToStudyManagement(...e)),class:"btn-option"}," Back "),(0,i.Lk)("button",{type:"button",onClick:t[1]||(t[1]=(...e)=>a.validateStudy&&a.validateStudy(...e)),class:"btn-option"}," Next ")])])):(0,i.Q3)("",!0),2===a.step?((0,i.uX)(),(0,i.CE)("div",yp,[(0,i.bF)(p,{schema:a.groupSchema,modelValue:a.groupData,"onUpdate:modelValue":t[2]||(t[2]=e=>a.groupData=e)},null,8,["schema","modelValue"]),(0,i.Lk)("div",gp,[(0,i.Lk)("button",{onClick:t[3]||(t[3]=e=>a.step=1),class:"btn-option"},"Back"),(0,i.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>a.checkGroups&&a.checkGroups(...e)),class:"btn-option"},"Next")])])):(0,i.Q3)("",!0),3===a.step?((0,i.uX)(),(0,i.CE)("div",fp,[t[17]||(t[17]=(0,i.Lk)("h2",null,"Step 3: Subject Setup",-1)),(0,i.bF)(h,{subjectCount:a.subjectCount,"onUpdate:subjectCount":t[5]||(t[5]=e=>a.subjectCount=e),assignmentMethod:a.assignmentMethod,"onUpdate:assignmentMethod":t[6]||(t[6]=e=>a.assignmentMethod=e)},null,8,["subjectCount","assignmentMethod"]),(0,i.Lk)("div",vp,[(0,i.Lk)("button",{onClick:t[7]||(t[7]=e=>a.step=2),class:"btn-option"},"Back"),(0,i.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>a.checkSubjectsSetup&&a.checkSubjectsSetup(...e)),class:"btn-option"},"Next")])])):(0,i.Q3)("",!0),4===a.step&&"Skip"!==a.assignmentMethod?((0,i.uX)(),(0,i.CE)("div",kp,[(0,i.bF)(y,{subjects:a.subjectData,groupData:a.groupData,"onUpdate:subjects":t[9]||(t[9]=e=>a.subjectData=e)},null,8,["subjects","groupData"]),(0,i.Lk)("div",bp,[(0,i.Lk)("button",{onClick:t[10]||(t[10]=e=>a.step=3),class:"btn-option"},"Back"),(0,i.Lk)("button",{onClick:t[11]||(t[11]=(...e)=>a.checkSubjectsAssigned&&a.checkSubjectsAssigned(...e)),class:"btn-option"},"Next")])])):(0,i.Q3)("",!0),5===a.step?((0,i.uX)(),(0,i.CE)("div",Lp,[(0,i.bF)(g,{schema:a.visitSchema,modelValue:a.visitData,"onUpdate:modelValue":t[12]||(t[12]=e=>a.visitData=e)},null,8,["schema","modelValue"]),(0,i.Lk)("div",wp,[(0,i.Lk)("button",{onClick:t[13]||(t[13]=e=>a.step="Skip"===a.assignmentMethod?3:4),class:"btn-option"}," Back "),(0,i.Lk)("button",{onClick:t[14]||(t[14]=(...e)=>a.checkVisits&&a.checkVisits(...e)),class:"btn-option"},"Finish")])])):(0,i.Q3)("",!0)]),a.showDialog?((0,i.uX)(),(0,i.CE)("div",Cp,[(0,i.Lk)("div",Sp,[(0,i.Lk)("p",null,(0,m.v_)(a.dialogMessage),1),(0,i.Lk)("button",{onClick:t[15]||(t[15]=e=>a.showDialog=!1),class:"btn-option"},"OK")])])):(0,i.Q3)("",!0)],64)}const Dp=["onClick"],Fp={key:0,class:"error-badge"},Ap={class:"toggle-icon"},Mp={class:"panel-body"};function Ep(e,t,s,l,n,r){const o=(0,i.g2)("BaseNumberField");return(0,i.uX)(),(0,i.CE)("div",null,[t[1]||(t[1]=(0,i.Lk)("h2",null,"Step 2: Define Groups/Cohorts",-1)),(0,i.bF)(o,{modelValue:l.count,"onUpdate:modelValue":t[0]||(t[0]=e=>l.count=e),id:"numGroups",label:"Number of Groups",min:1,error:l.errors.count},null,8,["modelValue","error"]),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(l.groups,(e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t,class:"panel"},[(0,i.Lk)("div",{class:"panel-header",onClick:e=>l.togglePanel(t)},[(0,i.Lk)("span",null,"Group "+(0,m.v_)(t+1),1),l.panelErrors[t]?((0,i.uX)(),(0,i.CE)("span",Fp,(0,m.v_)(l.panelErrors[t])+" error(s) ",1)):(0,i.Q3)("",!0),(0,i.Lk)("span",Ap,(0,m.v_)(l.activePanels.includes(t)?"▼":"▶"),1)],8,Dp),(0,i.bo)((0,i.Lk)("div",Mp,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(s.schema,s=>((0,i.uX)(),(0,i.CE)("div",{key:s.field,class:"schema-field-row"},[((0,i.uX)(),(0,i.Wv)((0,i.$y)(l.fieldComponent(s)),{modelValue:e[s.field],"onUpdate:modelValue":t=>e[s.field]=t,id:`group-${t}-${s.field}`,label:s.label,placeholder:s.placeholder,required:s.required,options:s.options,error:l.fieldError(s,e[s.field])},null,8,["modelValue","onUpdate:modelValue","id","label","placeholder","required","options","error"]))]))),128))],512),[[a.aG,l.activePanels.includes(t)]])]))),128))])}var Vp={name:"GroupForm",components:{BaseTextarea:rl,BaseSelectField:jl,BaseNumberField:gl,BaseDateField:xl,BaseTextField:Hi},props:{schema:{type:Array,default:()=>[]},modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue","validate"],setup(e,{emit:t}){const s=(0,aa.KR)(e.modelValue.length||1),a=(0,aa.KR)([]),l=(0,aa.KR)([...e.modelValue]);function n(){const i=Math.max(1,s.value),n=Array.from({length:i},(t,s)=>null!=l.value[s]?l.value[s]:Object.fromEntries(e.schema.map(e=>[e.field,""])));l.value=n,t("update:modelValue",n),a.value=n.map((e,t)=>t),t("validate")}function r(e){const t=a.value.indexOf(e);t>=0?a.value.splice(t,1):a.value.push(e)}(0,i.wB)(()=>e.modelValue,e=>{l.value=[...e],s.value=e.length},{deep:!0}),(0,i.wB)(s,()=>n(),{immediate:!0});const o=(0,i.EW)(()=>l.value.map(t=>e.schema.reduce((e,s)=>e+(s.required&&!t[s.field]?1:0),0))),d=(0,i.EW)(()=>({count:s.value<1?"Must have at least one group.":""}));function u(e){switch(e.type){case"textarea":return rl;case"select":return jl;case"number":return gl;case"date":return xl;default:return Hi}}function c(e,t){return e.required&&!t?`${e.label} is required.`:""}return{count:s,groups:l,activePanels:a,panelErrors:o,errors:d,togglePanel:r,fieldComponent:u,fieldError:c}}};const Ip=(0,o.A)(Vp,[["render",Ep],["__scopeId","data-v-252f5d9d"]]);var _p=Ip;const $p=["onClick"],Xp={key:0,class:"error-badge"},jp={class:"toggle-icon"},Up={class:"panel-body"};function Tp(e,t,s,l,n,r){const o=(0,i.g2)("BaseNumberField");return(0,i.uX)(),(0,i.CE)("div",null,[t[1]||(t[1]=(0,i.Lk)("h2",null,"Step 5: Define Visits",-1)),(0,i.bF)(o,{modelValue:l.count,"onUpdate:modelValue":t[0]||(t[0]=e=>l.count=e),id:"numVisits",label:"Number of Visits",min:1,error:l.errors.count},null,8,["modelValue","error"]),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(l.visits,(e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t,class:"panel"},[(0,i.Lk)("div",{class:"panel-header",onClick:e=>l.togglePanel(t)},[(0,i.Lk)("span",null,"Visit "+(0,m.v_)(t+1),1),l.panelErrors[t]?((0,i.uX)(),(0,i.CE)("span",Xp,(0,m.v_)(l.panelErrors[t])+" error(s) ",1)):(0,i.Q3)("",!0),(0,i.Lk)("span",jp,(0,m.v_)(l.activePanels.includes(t)?"▼":"▶"),1)],8,$p),(0,i.bo)((0,i.Lk)("div",Up,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(s.schema,s=>((0,i.uX)(),(0,i.CE)("div",{key:s.field,class:"schema-field-row"},[((0,i.uX)(),(0,i.Wv)((0,i.$y)(l.fieldComponent(s)),{modelValue:e[s.field],"onUpdate:modelValue":t=>e[s.field]=t,id:`visit-${t}-${s.field}`,label:s.label,placeholder:s.placeholder,required:s.required,options:s.options,error:l.fieldError(s,e[s.field])},null,8,["modelValue","onUpdate:modelValue","id","label","placeholder","required","options","error"]))]))),128))],512),[[a.aG,l.activePanels.includes(t)]])]))),128))])}var Np={name:"VisitForm",components:{BaseTextarea:rl,BaseSelectField:jl,BaseNumberField:gl,BaseDateField:xl,BaseTextField:Hi},props:{schema:{type:Array,default:()=>[]},modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue","validate"],setup(e,{emit:t}){const s=(0,aa.KR)(e.modelValue.length||1),a=(0,aa.KR)([]),l=(0,aa.KR)([...e.modelValue]);function n(){const i=Math.max(1,s.value),n=Array.from({length:i},(t,s)=>null!=l.value[s]?l.value[s]:Object.fromEntries(e.schema.map(e=>[e.field,""])));l.value=n,t("update:modelValue",n),a.value=n.map((e,t)=>t),t("validate")}function r(e){const t=a.value.indexOf(e);t>=0?a.value.splice(t,1):a.value.push(e)}(0,i.wB)(()=>e.modelValue,e=>{l.value=[...e],s.value=e.length},{deep:!0}),(0,i.wB)(s,()=>n(),{immediate:!0});const o=(0,i.EW)(()=>l.value.map(t=>e.schema.reduce((e,s)=>e+(s.required&&!t[s.field]?1:0),0))),d=(0,i.EW)(()=>({count:s.value<1?"Must have at least one visit.":""}));function u(e){switch(e.type){case"textarea":return rl;case"select":return jl;case"number":return gl;case"date":return xl;default:return Hi}}function c(e,t){return e.required&&!t?`${e.label} is required.`:""}return{count:s,visits:l,activePanels:a,panelErrors:o,errors:d,togglePanel:r,fieldComponent:u,fieldError:c}}};const Rp=(0,o.A)(Np,[["render",Tp],["__scopeId","data-v-190b64e1"]]);var Pp=Rp;function Bp(e,t,s,a,l,n){const r=(0,i.g2)("BaseNumberField"),o=(0,i.g2)("BaseSelectField");return(0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.bF)(r,{modelValue:s.subjectCount,"onUpdate:modelValue":a.updateCount,id:"subject-count",label:"Number of Subjects",placeholder:"e.g. 20",required:!0},null,8,["modelValue","onUpdate:modelValue"]),(0,i.bF)(o,{modelValue:s.assignmentMethod,"onUpdate:modelValue":a.updateMethod,id:"assignment-method",label:"Assignment Method",options:["Random","Manual","Skip"],placeholder:"Select assignment method",required:!0},null,8,["modelValue","onUpdate:modelValue"])],64)}var Op={name:"SubjectForm",components:{BaseNumberField:gl,BaseSelectField:jl},props:{subjectCount:Number,assignmentMethod:String},emits:["update:subjectCount","update:assignmentMethod"],setup(e,{emit:t}){(0,i.wB)(()=>e.subjectCount,e=>{null==e&&t("update:subjectCount",1)},{immediate:!0}),(0,i.wB)(()=>e.assignmentMethod,e=>{e||t("update:assignmentMethod","random")},{immediate:!0});const s=e=>t("update:subjectCount",e),a=e=>t("update:assignmentMethod",e);return{updateCount:s,updateMethod:a}}};const qp=(0,o.A)(Op,[["render",Bp],["__scopeId","data-v-c9b14630"]]);var Kp=qp;const Wp={class:"new-study-form"},zp={class:"assignment-table"},Qp=["name","value","onUpdate:modelValue"];function Gp(e,t,s,l,n,r){return(0,i.uX)(),(0,i.CE)("div",Wp,[t[2]||(t[2]=(0,i.Lk)("h2",null,"Step 4: Assign Subjects",-1)),(0,i.Lk)("table",zp,[(0,i.Lk)("thead",null,[(0,i.Lk)("tr",null,[t[1]||(t[1]=(0,i.Lk)("th",null,"Subject ID",-1)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(l.groupNames,e=>((0,i.uX)(),(0,i.CE)("th",{key:e},(0,m.v_)(e),1))),128))])]),(0,i.Lk)("tbody",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(s.subjects,(e,s)=>((0,i.uX)(),(0,i.CE)("tr",{key:e.id},[(0,i.Lk)("td",null,(0,m.v_)(e.id),1),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(l.groupNames,(n,r)=>((0,i.uX)(),(0,i.CE)("td",{key:r},[(0,i.bo)((0,i.Lk)("input",{type:"radio",name:"group-"+s,value:n,"onUpdate:modelValue":t=>e.group=t,onChange:t[0]||(t[0]=(...e)=>l.emitSubjects&&l.emitSubjects(...e))},null,40,Qp),[[a.XL,e.group]])]))),128))]))),128))])])])}var Jp={name:"SubjectAssignmentForm",props:{subjects:{type:Array,required:!0},groupData:{type:Array,required:!0}},emits:["update:subjects"],setup(e,{emit:t}){const s=(0,i.EW)(()=>e.groupData.map(e=>e.name||e.label||"Unnamed")),a=()=>{t("update:subjects",e.subjects)};return{groupNames:s,emitSubjects:a}}};const Yp=(0,o.A)(Jp,[["render",Gp],["__scopeId","data-v-001947b6"]]);var Hp=Yp,Zp={name:"StudyCreationComponent",components:{BaseTextField:Hi,BaseTextarea:rl,BaseNumberField:gl,BaseDateField:xl,BaseSelectField:jl,GroupForm:_p,VisitForm:Pp,SubjectForm:Kp,SubjectAssignmentForm:Hp},props:{id:{type:[String,Number],required:!1}},setup(e){const t=(0,p.rd)(),s=(0,p.lq)(),a=(0,Vi.Pj)(),l=(0,i.WQ)("formatLabel"),n=(0,aa.KR)(1),r=(0,aa.KR)({}),o=(0,aa.KR)([]),d=(0,aa.KR)([]),u=(0,aa.KR)([]),c=(0,aa.KR)(1),m=(0,aa.KR)("Random"),h=(0,aa.KR)([]),y=(0,aa.KR)([]),g=(0,aa.KR)([]),f=(0,aa.KR)([]),v=(0,aa.KR)(!1),k=(0,aa.KR)(!1),b=(0,aa.KR)("");function L(e,t){return e.required&&v.value&&!t?`${e.label} is required.`:""}async function w(e,t){const s=await fetch(e),a=Ms().load(await s.text()),i=Object.keys(a.classes)[0],n=a.classes[i].attributes;t.value=Object.entries(n).map(([e,t])=>{let s="textarea"===t.widget?"textarea":"text";const a=(t.range||"").toLowerCase();return"date"!==a&&"datetime"!==a||(s="date"),"integer"!==a&&"decimal"!==a||(s="number"),t.enum&&(s="select"),{field:e,label:l(e),placeholder:t.description||l(e),type:s,required:!!t.required,disabled:!!t.disabled,display:!1!==t.display,options:t.enum||[],skip:t.skip||{}}})}function C(e,t,s){return Array(e.length).fill().map(()=>Array(t.length).fill().map(()=>Array(s.length).fill(!1)))}function S(){v.value=!0;const e=y.value.some(e=>e.required&&!r.value[e.field]);if(e)return;v.value=!1;const s=y.value.find(e=>"type"===e.field),i=s?.skip||{},l=r.value.type,o=i[l]||[],d={study:r.value,groups:[],visits:[],assignments:h.value};o.includes("groups")&&o.includes("visits")?(a.commit("setStudyDetails",d),t.push({name:"CreateFormScratch",params:{assignments:h.value}})):(a.commit("setStudyDetails",d),n.value=2)}function x(){const e=o.value.some(e=>g.value.some(t=>t.required&&!e[t.field]));e||(h.value.length>0&&h.value[0]?.[0]?.length!==o.value.length&&(h.value=C(r.value.selectedModels||[],u.value,o.value)),a.commit("setStudyDetails",{study:r.value,groups:o.value,visits:[],assignments:h.value}),n.value=3)}function D(){if(!c.value||!m.value)return b.value="Please provide subject count and assignment method.",void(k.value=!0);const t=e.id||s.params.id,a=c.value,i=(r.value.title||"ST").replace(/[^A-Za-z\s]/g,"").trim().split(/\s+/).map(e=>e[0]?.toUpperCase()||"").join("")||"ST",l=o.value.map(e=>e.name||e.label||"Unnamed");if(t&&d.value.length>0){const e=d.value.length;if(a===e)return void(n.value="Skip"===m.value?5:4);if(a>e){const t=Array(a-e).fill().map((t,s)=>({id:`SUBJ-${i}-${String(e+s+1).padStart(3,"0")}`,group:"Random"===m.value&&l.length>0?l[Math.floor(Math.random()*l.length)]:""}));d.value=[...d.value,...t]}else d.value=d.value.slice(0,a)}else{let e=[];if("Random"===m.value&&l.length>0){const t=l.length,s=Math.floor(a/t),i=a%t,n=Array.from({length:t},(e,t)=>t);for(let e=t-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[n[e],n[t]]=[n[t],n[e]]}const r=new Set(n.slice(0,i));for(let a=0;a<t;a++){const t=s+(r.has(a)?1:0);for(let s=0;s<t;s++)e.push(l[a])}for(let a=e.length-1;a>0;a--){const t=Math.floor(Math.random()*(a+1));[e[a],e[t]]=[e[t],e[a]]}}else e=Array(a).fill("");d.value=e.map((e,t)=>({id:`SUBJ-${i}-${String(t+1).padStart(3,"0")}`,group:e}))}console.log("subjects",d.value),n.value="Skip"===m.value?5:4}function F(){if(d.value.some(e=>!e.group))return b.value="All subjects must have a group.",void(k.value=!0);n.value=5}function A(){const e=u.value.some(e=>f.value.some(t=>t.required&&!e[t.field]));e||(a.commit("setStudyDetails",{study:r.value,groups:o.value,subjectCount:c.value,assignmentMethod:m.value,subjects:d.value,visits:u.value,assignments:h.value}),t.push({name:"CreateFormScratch",params:{assignments:h.value}}))}function M(){t.push({name:"Dashboard",query:{openStudies:"false"}})}function E({mIdx:e,vIdx:t,gIdx:s,checked:a}){h.value[e][t][s]=a}return(0,i.sV)(async()=>{const t=e.id||s.params.id;t||a.commit("resetStudyDetails"),await w("/study_schema.yaml",y),await w("/group_schema.yaml",g),await w("/visit_schema.yaml",f);const i=a.state.studyDetails;t&&i&&i.study?(r.value={...i.study},o.value=Array.isArray(i.groups)?[...i.groups]:[],c.value=i.subjectCount??c.value,m.value=i.assignmentMethod??m.value,d.value=Array.isArray(i.subjects)?[...i.subjects]:[],u.value=Array.isArray(i.visits)?[...i.visits]:[],h.value=Array.isArray(i.assignments)?JSON.parse(JSON.stringify(i.assignments)):C(i.selectedModels||[],i.visits||[],i.groups||[]),n.value=1):(y.value.forEach(e=>r.value[e.field]=""),o.value=[],d.value=[],u.value=[],h.value=[])}),{step:n,studyData:r,groupData:o,subjectData:d,visitData:u,subjectCount:c,assignmentMethod:m,assignments:h,studySchema:y,groupSchema:g,visitSchema:f,showDialog:k,dialogMessage:b,fieldError:L,validateStudy:S,checkGroups:x,checkSubjectsSetup:D,checkSubjectsAssigned:F,checkVisits:A,goToStudyManagement:M,handleAssignmentUpdated:E}}};const em=(0,o.A)(Zp,[["render",xp],["__scopeId","data-v-72ba070a"]]);var tm=em;const sm={class:"study-view-layout"},am={class:"sv-header"},im={class:"title-wrap"},lm={class:"sv-title"},nm={key:0,class:"sv-subtitle"},rm={class:"sv-content card"},om={class:"v-tabs",role:"tablist","aria-orientation":"vertical"},dm=["onClick","aria-selected"],um={class:"v-panel"},cm={key:0},pm={class:"meta-grid"},mm={key:0,class:"meta-item"},hm={class:"meta-value monospace"},ym={key:1,class:"meta-item"},gm={class:"meta-value"},fm={key:2,class:"meta-item"},vm={class:"meta-value"},km={key:3,class:"meta-item"},bm={class:"meta-value"},Lm={key:4,class:"meta-item"},wm={class:"meta-value"},Cm={key:5,class:"meta-item"},Sm={class:"meta-value"},xm={class:"subsection"},Dm={key:0,class:"kv-grid"},Fm={class:"kv-key"},Am={class:"kv-val"},Mm={key:1,class:"empty-state"},Em={class:"subsection"},Vm={key:0,class:"list-grid"},Im={class:"kv-key"},_m={class:"kv-val"},$m={key:1,class:"empty-state"},Xm={class:"subsection"},jm={key:0,class:"list-grid"},Um={class:"kv-key"},Tm={class:"kv-val"},Nm={key:1,class:"empty-state"},Rm={class:"subsection"},Pm={class:"kv-grid"},Bm={key:0,class:"kv-row"},Om={class:"kv-val"},qm={key:1,class:"kv-row"},Km={class:"kv-val"},Wm={key:2,class:"kv-row"},zm={class:"kv-val"},Qm={key:3,class:"kv-row"},Gm={class:"kv-val"},Jm={key:0,class:"per-subject-block"},Ym={key:0,class:"ps-table-wrap"},Hm={class:"ps-table","aria-label":"Per-subject group assignment"},Zm={class:"monospace"},eh={key:1,class:"empty-state"},th={class:"subsection"},sh={class:"versions-wrap"},ah={key:0,class:"muted"},ih={key:1,class:"empty-state"},lh={key:2,class:"version-list"},nh={class:"vc-head"},rh={class:"vc-title"},oh={class:"tag"},dh={class:"vc-date"},uh={key:0,class:"pill ok"},ch={key:0,class:"vc-summary"},ph={class:"muted"},mh={class:"vc-summary-line"},hh={key:1,class:"muted"},yh={key:0},gh={class:"vc-details diff-scroll"},fh={key:1,class:"muted"},vh={key:0,class:"edit-row"},kh={key:1},bh={key:0,class:"doc-list"},Lh={class:"doc-name"},wh={class:"doc-meta muted"},Ch={key:0},Sh={key:1},xh={key:2},Dh={key:0,class:"doc-desc"},Fh=["title"],Ah={class:"file-path"},Mh={key:1,class:"empty-state"},Eh={class:"subsection"},Vh={class:"attach-row"},Ih={key:0,class:"pending-list"},_h={class:"pi-head"},$h=["title"],Xh={class:"pi-size"},jh=["onClick"],Uh=["onUpdate:modelValue","disabled"],Th={class:"attach-actions"},Nh=["disabled"],Rh={key:2},Ph={class:"subsection"},Bh={class:"table-wrap"},Oh={class:"access-table","aria-label":"Study access"},qh={key:0},Kh={class:"owner-row"},Wh={class:"strong"},zh={key:0},Qh={class:"strong"},Gh={key:0},Jh=["disabled","onClick"],Yh={key:0},Hh=["colspan"],Zh={class:"modal-text"},ey={class:"strong"},ty={class:"modal-actions"},sy=["disabled"],ay={key:1,class:"subsection"},iy={class:"grant-grid"},ly={class:"field"},ny=["value"],ry={key:0,class:"help"},oy={class:"field"},dy={class:"actions"},uy=["disabled"],cy={key:3},py={key:4};function my(e,t,s,l,n,r){const o=(0,i.g2)("TemplateDiffView"),d=(0,i.g2)("FieldFileUpload"),u=(0,i.g2)("StudyAuditLogs");return(0,i.uX)(),(0,i.CE)("div",sm,[(0,i.Lk)("header",am,[(0,i.Lk)("button",{class:"btn-minimal back-btn",onClick:t[0]||(t[0]=(...e)=>r.goBackToDashboard&&r.goBackToDashboard(...e)),"aria-label":"Back to Dashboard"},"Back"),(0,i.Lk)("div",im,[(0,i.Lk)("h1",lm,(0,m.v_)(n.studyMeta.study_name||"Study"),1),n.studyMeta.study_description?((0,i.uX)(),(0,i.CE)("p",nm,(0,m.v_)(n.studyMeta.study_description),1)):(0,i.Q3)("",!0)]),t[10]||(t[10]=(0,i.Lk)("div",{class:"header-spacer","aria-hidden":"true"},null,-1))]),(0,i.Lk)("div",rm,[(0,i.Lk)("aside",om,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.tabs,e=>((0,i.uX)(),(0,i.CE)("button",{key:e.key,class:(0,m.C4)(["v-tab",{active:n.activeTab===e.key}]),onClick:t=>n.activeTab=e.key,role:"tab","aria-selected":n.activeTab===e.key},(0,m.v_)(e.label),11,dm))),128))]),(0,i.Lk)("section",um,["meta"===n.activeTab?((0,i.uX)(),(0,i.CE)("div",cm,[t[30]||(t[30]=(0,i.Lk)("h2",{class:"panel-title center"},"Meta-data",-1)),(0,i.Lk)("div",pm,[r.hasValue(n.studyMeta.id)?((0,i.uX)(),(0,i.CE)("div",mm,[t[11]||(t[11]=(0,i.Lk)("div",{class:"meta-label"},"Study ID",-1)),(0,i.Lk)("div",hm,(0,m.v_)(n.studyMeta.id),1)])):(0,i.Q3)("",!0),r.hasValue(n.studyMeta.study_name)?((0,i.uX)(),(0,i.CE)("div",ym,[t[12]||(t[12]=(0,i.Lk)("div",{class:"meta-label"},"Name",-1)),(0,i.Lk)("div",gm,(0,m.v_)(n.studyMeta.study_name),1)])):(0,i.Q3)("",!0),r.hasValue(n.studyMeta.study_description)?((0,i.uX)(),(0,i.CE)("div",fm,[t[13]||(t[13]=(0,i.Lk)("div",{class:"meta-label"},"Description",-1)),(0,i.Lk)("div",vm,(0,m.v_)(n.studyMeta.study_description),1)])):(0,i.Q3)("",!0),r.hasValue(n.studyMeta.created_by_display)?((0,i.uX)(),(0,i.CE)("div",km,[t[14]||(t[14]=(0,i.Lk)("div",{class:"meta-label"},"Created By",-1)),(0,i.Lk)("div",bm,(0,m.v_)(n.studyMeta.created_by_display),1)])):(0,i.Q3)("",!0),r.hasValue(n.studyMeta.created_at)?((0,i.uX)(),(0,i.CE)("div",Lm,[t[15]||(t[15]=(0,i.Lk)("div",{class:"meta-label"},"Created At",-1)),(0,i.Lk)("div",wm,(0,m.v_)(r.formatDateTime(n.studyMeta.created_at)),1)])):(0,i.Q3)("",!0),r.hasValue(n.studyMeta.updated_at)?((0,i.uX)(),(0,i.CE)("div",Cm,[t[16]||(t[16]=(0,i.Lk)("div",{class:"meta-label"},"Updated At",-1)),(0,i.Lk)("div",Sm,(0,m.v_)(r.formatDateTime(n.studyMeta.updated_at)),1)])):(0,i.Q3)("",!0)]),(0,i.Lk)("div",xm,[t[17]||(t[17]=(0,i.Lk)("h3",{class:"sub-title"},"Study Data",-1)),r.studyKVEntries.length?((0,i.uX)(),(0,i.CE)("div",Dm,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.studyKVEntries,e=>((0,i.uX)(),(0,i.CE)("div",{class:"kv-row",key:e[0]},[(0,i.Lk)("div",Fm,(0,m.v_)(r.prettyLabel(e[0])),1),(0,i.Lk)("div",Am,(0,m.v_)(r.formatAny(e[1])),1)]))),128))])):((0,i.uX)(),(0,i.CE)("div",Mm,"No additional study data."))]),(0,i.Lk)("div",Em,[t[18]||(t[18]=(0,i.Lk)("h3",{class:"sub-title"},"Groups",-1)),r.groups&&r.groups.length?((0,i.uX)(),(0,i.CE)("div",Vm,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.groups,(e,t)=>((0,i.uX)(),(0,i.CE)("div",{class:"list-card",key:t},[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.objectEntriesFiltered(e),e=>((0,i.uX)(),(0,i.CE)("div",{class:"kv-row",key:e[0]},[(0,i.Lk)("div",Im,(0,m.v_)(r.prettyLabel(e[0])),1),(0,i.Lk)("div",_m,(0,m.v_)(r.formatAny(e[1])),1)]))),128))]))),128))])):((0,i.uX)(),(0,i.CE)("div",$m,"No groups defined."))]),(0,i.Lk)("div",Xm,[t[19]||(t[19]=(0,i.Lk)("h3",{class:"sub-title"},"Visits",-1)),r.visits&&r.visits.length?((0,i.uX)(),(0,i.CE)("div",jm,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.visits,(e,t)=>((0,i.uX)(),(0,i.CE)("div",{class:"list-card",key:t},[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.objectEntriesFiltered(e),e=>((0,i.uX)(),(0,i.CE)("div",{class:"kv-row",key:e[0]},[(0,i.Lk)("div",Um,(0,m.v_)(r.prettyLabel(e[0])),1),(0,i.Lk)("div",Tm,(0,m.v_)(r.formatAny(e[1])),1)]))),128))]))),128))])):((0,i.uX)(),(0,i.CE)("div",Nm,"No visits defined."))]),(0,i.Lk)("div",Rm,[t[27]||(t[27]=(0,i.Lk)("h3",{class:"sub-title"},"Subject Assignment",-1)),(0,i.Lk)("div",Pm,[r.hasValue(n.studyData.assignmentMethod)?((0,i.uX)(),(0,i.CE)("div",Bm,[t[20]||(t[20]=(0,i.Lk)("div",{class:"kv-key"},"Assignment Method",-1)),(0,i.Lk)("div",Om,(0,m.v_)(n.studyData.assignmentMethod),1)])):(0,i.Q3)("",!0),r.hasValue(n.studyData.subjectCount)?((0,i.uX)(),(0,i.CE)("div",qm,[t[21]||(t[21]=(0,i.Lk)("div",{class:"kv-key"},"Subjects Planned",-1)),(0,i.Lk)("div",Km,(0,m.v_)(n.studyData.subjectCount),1)])):(0,i.Q3)("",!0),Array.isArray(r.subjects)?((0,i.uX)(),(0,i.CE)("div",Wm,[t[22]||(t[22]=(0,i.Lk)("div",{class:"kv-key"},"Subjects Enrolled",-1)),(0,i.Lk)("div",zm,(0,m.v_)(r.subjects.length),1)])):(0,i.Q3)("",!0),r.assignmentSize?((0,i.uX)(),(0,i.CE)("div",Qm,[t[24]||(t[24]=(0,i.Lk)("div",{class:"kv-key"},"Assignment Matrix",-1)),(0,i.Lk)("div",Gm,[(0,i.eW)((0,m.v_)(r.assignmentSize.m)+" × "+(0,m.v_)(r.assignmentSize.v)+" × "+(0,m.v_)(r.assignmentSize.g)+" ",1),t[23]||(t[23]=(0,i.Lk)("span",{class:"muted"},"(models × visits × groups)",-1))])])):(0,i.Q3)("",!0)]),r.isPIOrAdmin?((0,i.uX)(),(0,i.CE)("div",Jm,[t[26]||(t[26]=(0,i.Lk)("h4",{class:"per-subject-title"},"Per-Subject Group Assignment",-1)),r.subjectAssignments.length?((0,i.uX)(),(0,i.CE)("div",Ym,[(0,i.Lk)("table",Hm,[t[25]||(t[25]=(0,i.Lk)("thead",null,[(0,i.Lk)("tr",null,[(0,i.Lk)("th",{scope:"col"},"Subject ID"),(0,i.Lk)("th",{scope:"col"},"Assigned Group")])],-1)),(0,i.Lk)("tbody",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.subjectAssignments,e=>((0,i.uX)(),(0,i.CE)("tr",{key:e.subjectId},[(0,i.Lk)("td",Zm,(0,m.v_)(e.subjectId),1),(0,i.Lk)("td",null,(0,m.v_)(e.groupName||"—"),1)]))),128))])])])):((0,i.uX)(),(0,i.CE)("div",eh,"No subjects enrolled yet."))])):(0,i.Q3)("",!0)]),(0,i.Lk)("div",th,[t[29]||(t[29]=(0,i.Lk)("h3",{class:"sub-title"},"Template Versions",-1)),(0,i.Lk)("div",sh,[n.versionsLoading?((0,i.uX)(),(0,i.CE)("div",ah,"Loading versions…")):n.versions.length?((0,i.uX)(),(0,i.CE)("div",lh,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.versions,(e,s)=>((0,i.uX)(),(0,i.CE)("div",{class:"version-card",key:`ver-${e.version}`},[(0,i.Lk)("div",nh,[(0,i.Lk)("div",rh,[(0,i.Lk)("span",oh,"v"+(0,m.v_)(e.version),1),(0,i.Lk)("span",dh,(0,m.v_)(r.formatDateTime(e.created_at)),1),s===n.versions.length-1?((0,i.uX)(),(0,i.CE)("span",uh,"Latest")):(0,i.Q3)("",!0)]),e.version>1?((0,i.uX)(),(0,i.CE)("div",ch,[n.canShowVersionDetails&&n.versionDiffs[e.version]?((0,i.uX)(),(0,i.CE)(i.FK,{key:0},[(0,i.Lk)("span",ph,"Changes from v"+(0,m.v_)(e.version-1)+":",1),(0,i.Lk)("span",mh,(0,m.v_)(n.versionDiffs[e.version].summary),1)],64)):((0,i.uX)(),(0,i.CE)("span",hh,"Changes from previous version are hidden (insufficient permission)."))])):(0,i.Q3)("",!0)]),e.version>1&&n.canShowVersionDetails&&n.versionDiffs[e.version]?((0,i.uX)(),(0,i.CE)("details",yh,[t[28]||(t[28]=(0,i.Lk)("summary",null,"Show details",-1)),(0,i.Lk)("div",gh,[(0,i.bF)(o,{from:n.versionSchemas[e.version-1],to:n.versionSchemas[e.version],compact:""},null,8,["from","to"])])])):1===e.version?((0,i.uX)(),(0,i.CE)("div",fh,"Initial version.")):(0,i.Q3)("",!0)]))),128))])):((0,i.uX)(),(0,i.CE)("div",ih,"No template versions yet."))])]),r.canEditStudy?((0,i.uX)(),(0,i.CE)("div",vh,[(0,i.Lk)("button",{class:"btn-primary",onClick:t[1]||(t[1]=(...e)=>r.editStudy&&r.editStudy(...e))},"Edit Study")])):(0,i.Q3)("",!0)])):"docs"===n.activeTab?((0,i.uX)(),(0,i.CE)("div",kh,[t[34]||(t[34]=(0,i.Lk)("h2",{class:"panel-title center"},"Study Documents",-1)),t[35]||(t[35]=(0,i.Lk)("h3",{class:"sub-title"},"Existing Study Attachments",-1)),r.studyLevelFiles.length?((0,i.uX)(),(0,i.CE)("div",bh,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.studyLevelFiles,e=>((0,i.uX)(),(0,i.CE)("div",{key:e.id||e.file_name,class:"doc-item"},[(0,i.Lk)("div",Lh,(0,m.v_)(e.file_name||e.name||"Document"),1),(0,i.Lk)("div",wh,[(0,i.eW)((0,m.v_)(e.storage_option||"file")+" ",1),e.bytes||e.size?((0,i.uX)(),(0,i.CE)("span",Ch," • ")):(0,i.Q3)("",!0),e.bytes?((0,i.uX)(),(0,i.CE)("span",Sh,(0,m.v_)(r.prettyBytes(e.bytes)),1)):e.size?((0,i.uX)(),(0,i.CE)("span",xh,(0,m.v_)(r.prettyBytes(e.size)),1)):(0,i.Q3)("",!0)]),e.description?((0,i.uX)(),(0,i.CE)("div",Dh,(0,m.v_)(e.description),1)):(0,i.Q3)("",!0),(0,i.Lk)("div",{class:"doc-path",title:r.docPathTooltip(e)},[t[31]||(t[31]=(0,i.Lk)("span",{class:"label"},"On disk:",-1)),(0,i.Lk)("span",Ah,(0,m.v_)(r.docRelativePath(e)),1)],8,Fh)]))),128))])):((0,i.uX)(),(0,i.CE)("div",Mh,"No study-level attachments yet.")),(0,i.Lk)("div",Eh,[t[33]||(t[33]=(0,i.Lk)("h3",{class:"sub-title"},"Attach New Study Documents",-1)),(0,i.Lk)("div",Vh,[(0,i.bF)(d,{value:n.attachTempValue,constraints:{allowMultipleFiles:!0,storagePreference:"local"},readonly:n.uploading,stage:"runtime",onInput:r.onAttachTempChange,onFileSelected:r.onFilesSelected},null,8,["value","readonly","onInput","onFileSelected"])]),n.pendingFiles.length?((0,i.uX)(),(0,i.CE)("div",Ih,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.pendingFiles,(e,s)=>((0,i.uX)(),(0,i.CE)("div",{class:"pending-item",key:e.key},[(0,i.Lk)("div",_h,[(0,i.Lk)("div",{class:"pi-name",title:e.file.name},(0,m.v_)(e.file.name),9,$h),(0,i.Lk)("div",Xh,(0,m.v_)(r.prettyBytes(e.file.size)),1),(0,i.Lk)("button",{class:"icon-inline danger",type:"button",onClick:e=>r.removePending(s),title:"Remove"},"✕",8,jh)]),t[32]||(t[32]=(0,i.Lk)("label",{class:"pi-desc-label"},"Description (optional)",-1)),(0,i.bo)((0,i.Lk)("input",{class:"pi-desc-input",type:"text","onUpdate:modelValue":t=>e.description=t,placeholder:"e.g., IRB approval PDF, protocol v2, consent form…",disabled:n.uploading},null,8,Uh),[[a.Jo,e.description]])]))),128))])):(0,i.Q3)("",!0),(0,i.Lk)("div",Th,[(0,i.Lk)("button",{class:"btn-primary",disabled:!n.pendingFiles.length||n.uploading,onClick:t[2]||(t[2]=(...e)=>r.saveStudyAttachments&&r.saveStudyAttachments(...e))},(0,m.v_)(n.uploading?"Saving…":"Save Attachments"),9,Nh)])])])):"team"===n.activeTab?((0,i.uX)(),(0,i.CE)("div",Rh,[t[56]||(t[56]=(0,i.Lk)("h2",{class:"panel-title center"},"Study Access Management",-1)),(0,i.Lk)("div",Ph,[t[46]||(t[46]=(0,i.Lk)("h3",{class:"sub-title"},"Access for this Study",-1)),(0,i.Lk)("div",Bh,[(0,i.Lk)("table",Oh,[(0,i.Lk)("thead",null,[(0,i.Lk)("tr",null,[t[36]||(t[36]=(0,i.Lk)("th",null,"User",-1)),t[37]||(t[37]=(0,i.Lk)("th",null,"Email",-1)),t[38]||(t[38]=(0,i.Lk)("th",null,"Role",-1)),t[39]||(t[39]=(0,i.Lk)("th",null,"Permissions",-1)),t[40]||(t[40]=(0,i.Lk)("th",null,"Granted By",-1)),t[41]||(t[41]=(0,i.Lk)("th",null,"Granted At",-1)),r.canManageAccess?((0,i.uX)(),(0,i.CE)("th",qh,"Actions")):(0,i.Q3)("",!0)])]),(0,i.Lk)("tbody",null,[(0,i.Lk)("tr",Kh,[(0,i.Lk)("td",Wh,[(0,i.eW)((0,m.v_)(n.studyMeta.created_by_display||"Owner")+" ",1),t[42]||(t[42]=(0,i.Lk)("span",{class:"tag"},"Owner",-1))]),(0,i.Lk)("td",null,(0,m.v_)(n.studyMeta.created_by_email||"—"),1),t[43]||(t[43]=(0,i.Lk)("td",null,"PI / Admin",-1)),t[44]||(t[44]=(0,i.Lk)("td",null,[(0,i.Lk)("span",{class:"pill ok"},"View"),(0,i.Lk)("span",{class:"pill ok"},"Add data"),(0,i.Lk)("span",{class:"pill ok"},"Edit study")],-1)),t[45]||(t[45]=(0,i.Lk)("td",null,"System",-1)),(0,i.Lk)("td",null,(0,m.v_)(r.formatDateTime(n.studyMeta.created_at)||"—"),1),r.canManageAccess?((0,i.uX)(),(0,i.CE)("td",zh,"—")):(0,i.Q3)("",!0)]),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.accessList,e=>((0,i.uX)(),(0,i.CE)("tr",{key:e.user_id},[(0,i.Lk)("td",Qh,(0,m.v_)(e.display_name||e.username||e.email||"User#"+e.user_id),1),(0,i.Lk)("td",null,(0,m.v_)(e.email||"—"),1),(0,i.Lk)("td",null,(0,m.v_)(r.prettyGrantRole(e.role)),1),(0,i.Lk)("td",null,[(0,i.Lk)("span",{class:(0,m.C4)(["pill",e.permissions?.view?"ok":"muted"])},"View",2),(0,i.Lk)("span",{class:(0,m.C4)(["pill",e.permissions?.add_data?"ok":"muted"])},"Add data",2),(0,i.Lk)("span",{class:(0,m.C4)(["pill",e.permissions?.edit_study?"ok":"muted"])},"Edit study",2)]),(0,i.Lk)("td",null,(0,m.v_)(e.granted_by_display||e.granted_by||"—"),1),(0,i.Lk)("td",null,(0,m.v_)(r.formatDateTime(e.created_at)||"—"),1),r.canManageAccess?((0,i.uX)(),(0,i.CE)("td",Gh,[(0,i.Lk)("button",{class:"btn-link danger",disabled:n.revokeBusy[e.user_id],onClick:t=>r.openRevokeDialog(e),title:"Revoke access"},"Revoke",8,Jh)])):(0,i.Q3)("",!0)]))),128)),n.accessList.length?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("tr",Yh,[(0,i.Lk)("td",{colspan:r.canManageAccess?7:6,class:"muted center"},"No additional users have access.",8,Hh)]))])])])]),n.confirm.visible?((0,i.uX)(),(0,i.CE)("div",{key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true",onClick:t[6]||(t[6]=(0,a.D$)((...e)=>r.cancelRevoke&&r.cancelRevoke(...e),["self"]))},[(0,i.Lk)("div",{class:"modal",onKeydown:t[5]||(t[5]=(0,a.jR)((0,a.D$)((...e)=>r.cancelRevoke&&r.cancelRevoke(...e),["prevent"]),["esc"])),tabindex:"-1"},[t[49]||(t[49]=(0,i.Lk)("h3",{class:"modal-title"},"Revoke access?",-1)),(0,i.Lk)("p",Zh,[t[47]||(t[47]=(0,i.eW)(" This will remove access for ",-1)),(0,i.Lk)("span",ey,(0,m.v_)(n.confirm.target?.display_name||n.confirm.target?.email||"User#"+n.confirm.target?.user_id),1),t[48]||(t[48]=(0,i.eW)(". ",-1))]),(0,i.Lk)("div",ty,[(0,i.Lk)("button",{class:"btn-minimal",onClick:t[3]||(t[3]=(...e)=>r.cancelRevoke&&r.cancelRevoke(...e))},"Cancel"),(0,i.Lk)("button",{class:"btn-primary danger",disabled:n.revokeBusy[n.confirm.target?.user_id],onClick:t[4]||(t[4]=(...e)=>r.confirmRevoke&&r.confirmRevoke(...e))},(0,m.v_)(n.revokeBusy[n.confirm.target?.user_id]?"Revoking…":"Revoke"),9,sy)])],32)])):(0,i.Q3)("",!0),r.canManageAccess?((0,i.uX)(),(0,i.CE)("div",ay,[t[55]||(t[55]=(0,i.Lk)("h3",{class:"sub-title"},"Grant Access",-1)),(0,i.Lk)("div",iy,[(0,i.Lk)("div",ly,[t[51]||(t[51]=(0,i.Lk)("label",{class:"label"},"Select User",-1)),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>n.selectedUserId=e),class:"input input-select"},[t[50]||(t[50]=(0,i.Lk)("option",{value:"",disabled:""},"Select a user…",-1)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.grantableUsers,e=>((0,i.uX)(),(0,i.CE)("option",{key:e.id,value:e.id},(0,m.v_)(r.userDisplay(e)),9,ny))),128))],512),[[a.u1,n.selectedUserId]]),n.allUsers.length?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",ry,"No users found to grant."))]),(0,i.Lk)("div",oy,[t[53]||(t[53]=(0,i.Lk)("label",{class:"label"},"Permission",-1)),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>n.permissionPreset=e),class:"input input-select",disabled:""},[...t[52]||(t[52]=[(0,i.Lk)("option",{value:"data-entry"},"Add data only",-1)])],512),[[a.u1,n.permissionPreset]]),t[54]||(t[54]=(0,i.Lk)("div",{class:"help"},"Adds the user with ability to submit data to this study; no editing.",-1))]),(0,i.Lk)("div",dy,[(0,i.Lk)("button",{class:"btn-primary",disabled:!n.selectedUserId||n.granting,onClick:t[9]||(t[9]=(...e)=>r.grantAccess&&r.grantAccess(...e))},(0,m.v_)(n.granting?"Granting…":"Grant Access"),9,uy)])])])):(0,i.Q3)("",!0),t[57]||(t[57]=(0,i.Lk)("div",{class:"subsection"},[(0,i.Lk)("h3",{class:"sub-title"},"Study Configurations"),(0,i.Lk)("p",{class:"muted"}," (Yet to Decide on this part) This section can include configuration options such as: edit windows for visits, allowed data entry roles, randomization settings, subject ID format, data export preferences, and notification settings. ")],-1))])):"viewdata"===n.activeTab?((0,i.uX)(),(0,i.CE)("div",cy,[...t[58]||(t[58]=[(0,i.Lk)("h2",{class:"panel-title center"},"View Data",-1),(0,i.Lk)("p",{class:"muted"},"Redirecting to the data dashboard…",-1)])])):"audit"===n.activeTab?((0,i.uX)(),(0,i.CE)("div",py,[(0,i.bF)(u,{"study-id":n.studyId},null,8,["study-id"])])):(0,i.Q3)("",!0)])])])}const hy={class:"audit-shell"},yy={class:"rail"},gy={class:"rail-group"},fy={key:0,class:"rail-group subjects"},vy={key:0,class:"rail-empty"},ky=["onClick"],by={class:"count-badge"},Ly={class:"content"},wy={class:"content-head"},Cy={class:"title-wrap"},Sy={key:0,class:"panel-title"},xy={key:1,class:"panel-title"},Dy={key:0},Fy={class:"tools"},Ay=["disabled"],My={key:0,class:"empty-state"},Ey={key:1,class:"empty-state"},Vy={key:2,class:"table-wrap"},Iy={class:"audit-table","aria-label":"Audit"},_y={class:"mono"},$y={class:"strong"},Xy={class:"user-cell"},jy={key:0,class:"meta",title:"Subject / Visit"},Uy={class:"wrap"},Ty=["onClick"],Ny={colspan:5,class:"raw-wrap"},Ry={class:"mini-json"};function Py(e,t,s,l,n,r){return(0,i.uX)(),(0,i.CE)("div",hy,[(0,i.Lk)("aside",yy,[(0,i.Lk)("div",gy,[t[5]||(t[5]=(0,i.Lk)("div",{class:"rail-title"},"Audit Views",-1)),(0,i.Lk)("button",{class:(0,m.C4)(["rail-item",{active:"study"===n.activeTab}]),onClick:t[0]||(t[0]=e=>n.activeTab="study")}," Study (System) ",2),(0,i.Lk)("button",{class:(0,m.C4)(["rail-item",{active:"subjects"===n.activeTab}]),onClick:t[1]||(t[1]=e=>r.activateSubjectsTab())}," Subjects ",2)]),"subjects"===n.activeTab?((0,i.uX)(),(0,i.CE)("div",fy,[t[6]||(t[6]=(0,i.Lk)("div",{class:"rail-title small"},"Subjects",-1)),n.subjectIds.length?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",vy,"No subjects found yet.")),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.subjectIds,e=>((0,i.uX)(),(0,i.CE)("button",{key:`sid-${e}`,class:(0,m.C4)(["rail-item",{active:String(n.activeSubject)===String(e)}]),onClick:t=>r.selectSubject(e)},[(0,i.eW)(" Subject "+(0,m.v_)(r.displaySubject(e))+" ",1),(0,i.Lk)("span",by,(0,m.v_)(n.subjectCounts[String(e)]||0),1)],10,ky))),128))])):(0,i.Q3)("",!0)]),(0,i.Lk)("main",Ly,[(0,i.Lk)("div",wy,[(0,i.Lk)("div",Cy,["study"===n.activeTab?((0,i.uX)(),(0,i.CE)("h2",Sy,"Study audit (system-level)")):((0,i.uX)(),(0,i.CE)("h2",xy,[t[7]||(t[7]=(0,i.eW)(" Subject audit",-1)),null!==n.activeSubject?((0,i.uX)(),(0,i.CE)("span",Dy," — Subject "+(0,m.v_)(r.displaySubject(n.activeSubject)),1)):(0,i.Q3)("",!0)]))]),(0,i.Lk)("div",Fy,[(0,i.bo)((0,i.Lk)("input",{class:"input search","onUpdate:modelValue":t[2]||(t[2]=e=>n.search=e),placeholder:"Search action / user / details…",onInput:t[3]||(t[3]=(...e)=>r.debouncedFilter&&r.debouncedFilter(...e))},null,544),[[a.Jo,n.search]]),(0,i.Lk)("button",{class:"btn-minimal",onClick:t[4]||(t[4]=(...e)=>r.refreshAll&&r.refreshAll(...e)),disabled:n.loading},"Refresh",8,Ay)])]),n.loading?((0,i.uX)(),(0,i.CE)("div",My,"Loading audit…")):r.visibleRows.length?((0,i.uX)(),(0,i.CE)("div",Vy,[(0,i.Lk)("table",Iy,[t[8]||(t[8]=(0,i.Lk)("thead",null,[(0,i.Lk)("tr",null,[(0,i.Lk)("th",{style:{width:"180px"}},"Timestamp (UTC)"),(0,i.Lk)("th",null,"Action"),(0,i.Lk)("th",{style:{width:"220px"}},"User"),(0,i.Lk)("th",null,"Details"),(0,i.Lk)("th",{style:{width:"80px"}})])],-1)),(0,i.Lk)("tbody",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.visibleRows,(e,t)=>((0,i.uX)(),(0,i.CE)("tr",{key:`row-${t}-${e.id||""}`},[(0,i.Lk)("td",_y,(0,m.v_)(r.fmtTs(e.timestamp)),1),(0,i.Lk)("td",$y,(0,m.v_)(e.action||"—"),1),(0,i.Lk)("td",Xy,[(0,i.Lk)("div",null,(0,m.v_)(r.userName(e.user_id)),1),"subjects"===n.activeTab?((0,i.uX)(),(0,i.CE)("div",jy," Subj: "+(0,m.v_)(r.resolvedSubject(e))+" · Visit: "+(0,m.v_)(r.resolvedVisit(e)),1)):(0,i.Q3)("",!0)]),(0,i.Lk)("td",Uy,(0,m.v_)(r.summaryText(e)),1),(0,i.Lk)("td",null,[(0,i.Lk)("button",{class:"link-btn",onClick:t=>r.toggleRaw(e)},(0,m.v_)(e.__showRaw?"hide":"view raw"),9,Ty)])]))),128)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.visibleRows,(e,t)=>(0,i.bo)(((0,i.uX)(),(0,i.CE)("tr",{key:`raw-${t}-${e.id||""}`},[(0,i.Lk)("td",Ny,[(0,i.Lk)("pre",Ry,(0,m.v_)(r.safeDetail(e.details)),1)])])),[[a.aG,e.__showRaw]])),128))])])])):((0,i.uX)(),(0,i.CE)("div",Ey,"No audit entries."))])])}var By={name:"StudyAuditLogs",props:{studyId:{type:[String,Number],required:!0}},data(){return{loading:!1,all:[],search:"",activeTab:"study",activeSubject:null,subjectIds:[],subjectCounts:{},nameCache:{},timerId:null}},computed:{token(){return this.$store.state.token},authHeaders(){return this.token?{Authorization:`Bearer ${this.token}`}:{}},visibleRows(){const e="study"===this.activeTab?this.studyRows():this.subjectRows();return this.applySearch(e,this.search)}},methods:{async refreshAll(){if(this.token){this.loading=!0;try{const{data:e}=await se.A.get(`/audit/studies/${this.studyId}/events`,{headers:this.authHeaders}),t=Array.isArray(e)?e:e?.items||[];this.all=t.map(this.normalizeRow),this.primeUsers(this.all.map(e=>e.user_id).filter(Boolean));const s={},a=new Set;for(const i of this.all){const e=this.getSubjectIdFromRow(i);if(0===e||e){const t=String(e);a.add(t),s[t]=(s[t]||0)+1}}this.subjectIds=Array.from(a).sort((e,t)=>Number(e)-Number(t)),this.subjectCounts=s,"subjects"===this.activeTab&&this.subjectIds.length&&null===this.activeSubject&&(this.activeSubject=this.subjectIds[0])}catch(e){console.warn("Audit fetch failed:",e?.response?.data||e.message),this.all=[],this.subjectIds=[],this.subjectCounts={}}finally{this.loading=!1}}},activateSubjectsTab(){this.activeTab="subjects",this.subjectIds.length&&null===this.activeSubject&&(this.activeSubject=this.subjectIds[0])},selectSubject(e){this.activeSubject=e},studyRows(){return this.all.filter(e=>{const t=this.getSubjectIdFromRow(e);return!(0===t||t)})},subjectRows(){const e=this.all.filter(e=>{const t=this.getSubjectIdFromRow(e);return 0===t||t});return null===this.activeSubject?e:e.filter(e=>String(this.getSubjectIdFromRow(e))===String(this.activeSubject))},normalizeRow(e){const t=e.user?.id??e.user_id??null;return{id:e.id,study_id:null!=e.study_id?Number(e.study_id):null,subject_id:null!=e.subject_id?Number(e.subject_id):null,user_id:null!=t?Number(t):null,action:e.action||"",details:e.details||{},timestamp:e.timestamp||e.ts||null,__showRaw:!1}},getSubjectIdFromRow(e){if(0===e.subject_id||e.subject_id)return e.subject_id;const t=e?.details?.subject_index;if(0===t||t)return Number(t);const s=e?.details?.participant_id||"",a=/^sub-(\d+)/i.exec(s);return a?Number(a[1]):null},resolvedSubject(e){const t=this.getSubjectIdFromRow(e);return 0===t||t?String(t):"—"},resolvedVisit(e){const t=e?.details?.visit_index;if(0===t||t)return String(t);const s=e?.details?.visit_name;return s?String(s):"—"},fmtTs(e){if(!e)return"—";try{const t=new Date(e);return new Date(t.getTime()-6e4*t.getTimezoneOffset()).toISOString().replace(/\.\d{3}Z$/,"Z")}catch{return String(e)}},displaySubject(e){return String(e)},summaryText(e){const t=(e.action||"").toLowerCase(),s=e.details||{};if("study_created"===t)return"Study created";if("study_edited"===t)return"Study edited";if("file_added"===t||"share_file_added"===t){const a=s.file_name||"file",i=Array.isArray(s.modalities)&&s.modalities.length?` · ${s.modalities.join(", ")}`:"",l=this.resolvedVisit(e),n="share_file_added"===t?"via share link":"added",r=this.resolvedSubject(e),o="—"!==r||"—"!==l?` (subj ${r}, visit ${l})`:"";return`File ${n}: ${a}${i}${o}`}if("entry_upserted"===t){const t=this.resolvedSubject(e),s=this.resolvedVisit(e);return`Data saved/edited (subj ${t}, visit ${s})`}if("share_entry_upserted"===t){const t=this.resolvedSubject(e),s=this.resolvedVisit(e);return`Data submitted via share link (subj ${t}, visit ${s})`}if("share_link_created"===t){const e=s.permission||"?",t=0===s.expires_in_days||s.expires_in_days?`${s.expires_in_days}d`:"—";return`Share link created (permission ${e}, expires ${t})`}if("access_granted"===t)return`Access granted to ${s.target_user_display||s.target_user_email||`User#${s.target_user_id}`}`;if("access_updated"===t)return`Access updated for ${s.target_user_display||s.target_user_email||`User#${s.target_user_id}`}`;if("access_revoked"===t)return`Access revoked for ${s.target_user_display||s.target_user_email||`User#${s.target_user_id}`}`;const a=Object.keys(s||{});if(!a.length)return"—";const i=[];for(const l of a.slice(0,3)){const e=s[l];["string","number","boolean"].includes(typeof e)&&i.push(`${l}: ${String(e)}`)}return i.join(" · ")},toggleRaw(e){e.__showRaw=!e.__showRaw,this.$forceUpdate?.()},safeDetail(e){try{const t=JSON.stringify(e||{},null,2);return t.length>2e3?t.slice(0,1997)+"…":t}catch{return"{}"}},debouncedFilter(){clearTimeout(this.timerId),this.timerId=setTimeout(()=>this.$forceUpdate(),150)},applySearch(e,t){const s=(t||"").toLowerCase();return s?e.filter(e=>{const t=[this.fmtTs(e.timestamp),e.action||"",this.userName(e.user_id),this.summaryText(e),this.resolvedSubject(e),this.resolvedVisit(e)].map(e=>(e||"").toString().toLowerCase());return t.some(e=>e.includes(s))}):e},userName(e){if(!e)return"—";const t=this.nameCache[e];return t||`User#${e}`},async primeUsers(e){const t=Array.from(new Set(e)).filter(Boolean),s=t.filter(e=>!this.nameCache[e]);for(const a of s.slice(0,25))try{const{data:e}=await se.A.get(`/users/${a}`,{headers:this.authHeaders}),t=e||{},s=[t?.profile?.first_name,t?.profile?.last_name].filter(Boolean).join(" ").trim(),i=t.name||t.full_name||s||t.username||t.email||`User#${a}`;this.$set?this.$set(this.nameCache,a,i):this.nameCache[a]=i}catch{this.$set?this.$set(this.nameCache,a,`User#${a}`):this.nameCache[a]=`User#${a}`}}},async mounted(){await this.refreshAll()}};const Oy=(0,o.A)(By,[["render",Py],["__scopeId","data-v-459c08d7"]]);var qy=Oy,Ky={name:"StudyView",components:{FieldFileUpload:vu,StudyAuditLogs:qy,TemplateDiffView:Tn},data(){return{studyId:this.$route.params.id,studyMeta:{id:null,study_name:"",study_description:"",created_by_id:null,created_by_display:"",created_by_email:"",created_at:"",updated_at:""},studyData:{},me:null,confirm:{visible:!1,target:null},activeTab:"meta",tabs:[{key:"meta",label:"Meta-data"},{key:"docs",label:"Documents"},{key:"team",label:"Settings"},{key:"viewdata",label:"View Data"},{key:"audit",label:"Audit logs"}],allFiles:[],attachTempValue:[],pendingFiles:[],uploading:!1,accessList:[],allUsers:[],selectedUserId:"",permissionPreset:"data-entry",granting:!1,revokeBusy:{},versionsLoading:!1,versions:[],versionSchemas:{},versionDiffs:{},canShowVersionDetails:!0}},computed:{groups(){return Array.isArray(this.studyData.groups)?this.studyData.groups:[]},visits(){return Array.isArray(this.studyData.visits)?this.studyData.visits:[]},subjects(){return Array.isArray(this.studyData.subjects)?this.studyData.subjects:[]},assignmentSize(){const e=this.studyData.assignments;if(!Array.isArray(e)||!e.length)return null;const t=e.length,s=Array.isArray(e[0])?e[0].length:0,a=s&&Array.isArray(e[0][0])?e[0][0].length:0;return{m:t,v:s,g:a}},studyKVEntries(){return this.objectEntriesFiltered(this.studyData.study)},studyLevelFiles(){const e=Array.isArray(this.allFiles)?this.allFiles:[];return e.filter(e=>null==e.subject_index&&null==e.visit_index&&null==e.group_index)},token(){return this.$store.state.token},myRoleRaw(){return this.me&&(this.me.profile?.role||this.me.role)||""},myRole(){return String(this.myRoleRaw).trim()},isAdmin(){return"administrator"===this.myRole.toLowerCase()},isPI(){const e=this.myRole.toLowerCase();return"principal investigator"===e||"pi"===e},isPIOrAdmin(){return this.isAdmin||this.isPI},isOwner(){const e=this.me?.id;return null!=e&&null!=this.studyMeta.created_by_id&&Number(e)===Number(this.studyMeta.created_by_id)},canEditStudy(){return this.isAdmin||this.isOwner},canManageAccess(){return this.isAdmin||this.isOwner},subjectAssignments(){const e=this.subjects||[];return e.map(e=>({subjectId:e?.id||"",groupName:e?.group||""}))},grantableUsers(){const e=new Set(this.accessList.map(e=>e.user_id));return null!=this.studyMeta.created_by_id&&e.add(Number(this.studyMeta.created_by_id)),(this.allUsers||[]).filter(t=>t&&null!=t.id&&!e.has(Number(t.id))).sort((e,t)=>this.userDisplay(e).localeCompare(this.userDisplay(t)))}},watch:{activeTab(e){"viewdata"===e&&this.goViewData(),"team"===e&&this.ensureAccessData()}},methods:{userDisplay(e){const t=[e.first_name||e.profile?.first_name,e.last_name||e.profile?.last_name].filter(Boolean).join(" ").trim();return e.name||e.full_name||t||e.username||e.email||`User#${e.id}`},prettyGrantRole(e){if(!e)return"Investigator";const t=String(e).toLowerCase();return t.includes("investigator")?"Investigator":t.includes("principal")||"pi"===t?"PI":t.includes("admin")?"Admin":e},makeDatasetFolder(e,t){const s=e=>String(e||"").replace(/[^A-Za-z0-9]/g,""),a=(t||`study${e}`).replace(/ /g,""),i=s(a).slice(0,48);return i?`study_${e}_${i}`:`study_${e}`},docRelativePath(e){const t=this.makeDatasetFolder(this.studyMeta.id,this.studyMeta.study_name),s=e?.file_name||"";return`bids_datasets/${t}/metadata/${s}`},docPathTooltip(e){return`Location on disk (relative to backend working directory): ${this.docRelativePath(e)}`},scrollToTop(){try{window.scrollTo({top:0,left:0,behavior:"auto"}),this.$el&&"number"===typeof this.$el.scrollTop&&(this.$el.scrollTop=0)}catch(e){console.warn("StudyView scrollToTop failed:",e)}},goBackToDashboard(){this.$router.push({name:"Dashboard",query:{openStudies:"true"}})},formatDateTime(e){return e?new Date(e).toLocaleString("en-GB",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):""},prettyBytes(e){if(0===e)return"0 B";if(!e&&0!==e)return"";const t=["B","KB","MB","GB","TB"],s=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,s)).toFixed(1)} ${t[s]}`},prettyLabel(e){return e?String(e).replace(/[_-]+/g," ").replace(/([a-z0-9])([A-Z])/g,"$1 $2").replace(/\s+/g," ").replace(/^./,e=>e.toUpperCase()):""},formatAny(e){if(null==e)return"—";if("boolean"===typeof e)return e?"Yes":"No";if(Array.isArray(e))return e.length?JSON.stringify(e):"—";if("object"===typeof e)return Object.keys(e).length?JSON.stringify(e):"—";const t=String(e);return t.trim().length?t:"—"},hasValue(e){return null!==e&&void 0!==e&&("string"===typeof e?e.trim().length>0:Array.isArray(e)?e.length>0:"object"!==typeof e||Object.keys(e).length>0)},objectEntriesFiltered(e){return Object.entries(e||{}).filter(([,e])=>this.hasValue(e))},async fetchMe(){const e=this.token;if(e)try{const{data:t}=await se.A.get("/users/me",{headers:{Authorization:`Bearer ${e}`}});this.me=t||null}catch(t){console.warn("Failed to fetch /users/me:",t?.response?.data||t.message)}},async fetchUserNameById(e){const t=this.token;if(!t||null==e)return null;try{const{data:s}=await se.A.get(`/users/${e}`,{headers:{Authorization:`Bearer ${t}`}}),a=s||{},i=[a?.profile?.first_name,a?.profile?.last_name].filter(Boolean).join(" ").trim();return a.name||a.full_name||i||a.username||a.email||null}catch{return null}},async fetchStudy(){const e=this.token;if(e)try{const t=await se.A.get(`/forms/studies/${this.studyId}`,{headers:{Authorization:`Bearer ${e}`}}),s=t.data?.content?.study_data||{},a=t.data?.metadata||{};let i=a.created_by_name||a.created_by_full_name||a.created_by_display||a.created_by_username||a.created_by_email||null;if(!i&&null!=a.created_by){const e=await this.fetchUserNameById(a.created_by);i=e||String(a.created_by)}this.studyMeta={id:a.id,study_name:a.study_name,study_description:a.study_description,created_by_id:a.created_by,created_by_display:i||"-",created_by_email:a.created_by_email||"",created_at:a.created_at,updated_at:a.updated_at},this.studyData=s||{}}catch(t){console.error("Failed to fetch study view:",t)}else this.$router.push("/login")},async fetchStudyFiles(){const e=this.token;if(e)try{const{data:t}=await se.A.get(`/forms/studies/${this.studyId}/files`,{headers:{Authorization:`Bearer ${e}`}});this.allFiles=Array.isArray(t)?t:[]}catch(t){console.warn("Failed to fetch study files:",t?.response?.data||t.message)}},async fetchVersionsAndDiffs(){const e=this.token;if(e){this.versionsLoading=!0,this.canShowVersionDetails=!0;try{const{data:s}=await se.A.get(`/forms/studies/${this.studyId}/versions`,{headers:{Authorization:`Bearer ${e}`}}),a=Array.isArray(s)?s:[];if(this.versions=[...a].sort((e,t)=>Number(e.version)-Number(t.version)),!this.versions.length)return this.versionSchemas={},void(this.versionDiffs={});const i={};for(const n of this.versions)try{const t=await se.A.get(`/forms/studies/${this.studyId}/template`,{params:{version:n.version},headers:{Authorization:`Bearer ${e}`}});i[n.version]=t.data?.schema||{}}catch(t){if(403===t?.response?.status){this.canShowVersionDetails=!1;break}console.warn(`Failed to fetch schema for v${n.version}:`,t?.response?.data||t.message)}if(this.versionSchemas=i,!this.canShowVersionDetails)return void(this.versionDiffs={});const l={};for(const e of this.versions){const t=Number(e.version);if(t<=1)continue;const s=this.versionSchemas[t-1],a=this.versionSchemas[t];if(s&&a){const e=$n(s,a);e.summary=Xn(e),l[t]=e}}this.versionDiffs=l}catch(t){console.error("fetchVersionsAndDiffs failed:",t?.response?.data||t.message),this.versions=[],this.versionSchemas={},this.versionDiffs={}}finally{this.versionsLoading=!1}}},async ensureAccessData(){await Promise.all([this.fetchAccessList(),this.fetchAllUsers()])},async fetchAccessList(){const e=this.token;if(e)try{const{data:t}=await se.A.get(`/forms/studies/${this.studyId}/access`,{headers:{Authorization:`Bearer ${e}`}}),s=Array.isArray(t)?t:t?.items||[];this.accessList=s.map(e=>({user_id:e.user_id,role:e.role||"Investigator",email:e.email||e.user_email||"",username:e.username||"",display_name:e.display_name||e.user_display||"",granted_by:e.created_by,granted_by_display:e.created_by_display||"",created_at:e.created_at,permissions:{view:!!(e.permissions?.view??1),add_data:!!(e.permissions?.add_data??1),edit_study:!!e.permissions?.edit_study}}))}catch(t){console.warn("fetchAccessList failed:",t?.response?.data||t.message),this.accessList=[]}},async fetchAllUsers(){const e=this.token;if(e)try{const{data:t}=await se.A.get("/users/admin/users",{headers:{Authorization:`Bearer ${e}`}}),s=Array.isArray(t)?t:t?.items||[];this.allUsers=s}catch(t){console.warn("fetchAllUsers failed:",t?.response?.data||t.message),this.allUsers=[]}},async grantAccess(){if(!this.selectedUserId)return;this.granting=!0;const e=this.token;try{const t={user_id:Number(this.selectedUserId),role:"Investigator",permissions:{view:!0,add_data:!0,edit_study:!1}};await se.A.post(`/forms/studies/${this.studyId}/access`,t,{headers:{Authorization:`Bearer ${e}`}}),this.selectedUserId="",await this.fetchAccessList()}catch(t){console.error("grantAccess failed:",t?.response?.data||t.message)}finally{this.granting=!1}},async revokeAccess(e){if(!e||null==e.user_id)return;const t=this.token;this.$set?this.$set(this.revokeBusy,e.user_id,!0):this.revokeBusy={...this.revokeBusy,[e.user_id]:!0};try{await se.A.delete(`/forms/studies/${this.studyId}/access/${e.user_id}`,{headers:{Authorization:`Bearer ${t}`}}),await this.fetchAccessList()}catch(s){console.error("revokeAccess failed:",s?.response?.data||s.message)}finally{const t={...this.revokeBusy};delete t[e.user_id],this.revokeBusy=t}},goViewData(){this.$router.push({name:"StudyDataDashboard",params:{id:this.studyId}})},async editStudy(){localStorage.removeItem("setStudyDetails"),localStorage.removeItem("scratchForms");const e=this.token;if(e)try{const t=await se.A.get(`/forms/studies/${this.studyId}`,{headers:{Authorization:`Bearer ${e}`}}),s=t.data.content?.study_data,a=t.data.metadata||{};if(!s)return;let i=Array.isArray(s.assignments)?s.assignments:[];if(!i.length&&s.selectedModels?.length){const e=s.selectedModels.length,t=s.visits?.length||0,a=s.groups?.length||0;i=Array.from({length:e},()=>Array.from({length:t},()=>Array.from({length:a},()=>!1)))}const l={id:a.id,name:a.study_name,description:a.study_description,created_at:a.created_at,updated_at:a.updated_at,created_by:a.created_by};if(this.$store.commit("setStudyDetails",{study_metadata:l,study:{id:a.id,...s.study},groups:s.groups||[],visits:s.visits||[],subjectCount:s.subjectCount||0,assignmentMethod:s.assignmentMethod||"random",subjects:s.subjects||[],assignments:i,forms:s.selectedModels?[{sections:s.selectedModels.map(e=>({title:e.title,fields:e.fields,source:"template"}))}]:[]}),s.selectedModels){const e=[{sections:s.selectedModels.map(e=>({title:e.title,fields:e.fields,source:"template"}))}];localStorage.setItem("scratchForms",JSON.stringify(e))}this.$router.push({name:"CreateStudy",params:{id:this.studyId}})}catch(t){console.error("Failed to load study details for edit:",t)}else this.$router.push("/login")},onAttachTempChange(e){this.attachTempValue=Array.isArray(e)?e:[]},onFilesSelected(e){const t=Array.isArray(e)?e:e?[e]:[];if(!t.length)return;const s=new Set(this.pendingFiles.map(e=>`${e.file.name}|${e.file.size}|${e.file.lastModified||""}`)),a=[];for(const i of t){const e=`${i.name}|${i.size}|${i.lastModified||""}`;s.has(e)||a.push({key:e,file:i,description:""})}a.length&&(this.pendingFiles=this.pendingFiles.concat(a))},removePending(e){e>=0&&e<this.pendingFiles.length&&this.pendingFiles.splice(e,1)},async saveStudyAttachments(){if(!this.pendingFiles.length)return;const e=this.token;if(e){this.uploading=!0;try{for(const t of this.pendingFiles){const s=new FormData;s.append("uploaded_file",t.file),s.append("description",t.description||""),s.append("storage_option","local"),s.append("modalities_json","[]"),await se.A.post(`/forms/studies/${this.studyId}/files`,s,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"multipart/form-data"}})}this.pendingFiles=[],this.attachTempValue=[],await this.fetchStudyFiles()}catch(t){console.error("Save attachments failed:",t?.response?.data||t.message)}finally{this.uploading=!1}}else this.$router.push("/login")},openRevokeDialog(e){this.confirm={visible:!0,target:e},this.$nextTick(()=>{try{const e=this.$el.querySelector(".modal");e&&e.focus()}catch(e){console.warn("openRevokeDialog: failed to focus modal",e)}})},cancelRevoke(){this.confirm={visible:!1,target:null}},async confirmRevoke(){const e=this.confirm.target;e&&(await this.revokeAccess(e),this.cancelRevoke())}},async mounted(){this.scrollToTop?.(),await this.fetchMe(),await this.fetchStudy(),await Promise.all([this.fetchStudyFiles(),this.fetchVersionsAndDiffs()])},beforeRouteEnter(e,t,s){s(e=>e.scrollToTop?.())},beforeRouteUpdate(e,t,s){this.studyId=e.params.id,this.scrollToTop?.(),Promise.resolve().then(()=>this.fetchStudy()).then(()=>Promise.all([this.fetchStudyFiles(),this.fetchVersionsAndDiffs()])).finally(()=>s())}};const Wy=(0,o.A)(Ky,[["render",my],["__scopeId","data-v-4ea2b374"]]);var zy=Wy;const Qy=[{path:"/",redirect:"/login"},{path:"/login",name:"Login",component:x},{path:"/register",name:"Registration",component:X},{path:"/dashboard",name:"Dashboard",component:ne,children:[{path:"user-info",name:"UserInfo",component:ut},{path:"create-study/:id?",name:"CreateStudy",component:tm,props:!0},{path:"analytics",name:"Analytics",component:ht}]},{path:"/dashboard/create-form-scratch",name:"CreateFormScratch",component:Lu},{path:"/studies/:id",name:"StudyDetail",component:cp},{path:"/settings",name:"StudySettings",component:rt},{path:"/shared/:token",name:"SharedForm",component:cp},{path:"/dashboard/studies/:id/view",name:"StudyView",component:zy,props:!0},{path:"/dashboard/study/:id/data",name:"StudyDataDashboard",component:()=>s.e(535).then(s.bind(s,8535)),meta:{requiresAuth:!0}},{path:"/dashboard/import-study",name:"ImportStudy",component:()=>s.e(442).then(s.bind(s,1442)),meta:{requiresAuth:!0}}],Gy=(0,p.aE)({history:(0,p.LA)(),routes:Qy});var Jy=Gy,Yy=s(406);const Hy=({NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_API_URL||"").trim(),Zy=Hy?Hy.replace(/\/+$/,""):"",eg=(0,Vi.y$)({state:{user:null,token:null,forms:[],currentForm:null,studyDetails:null},mutations:{setUser(e,t){e.user=t},setToken(e,t){e.token=t},clearAuth(e){e.user=null,e.token=null,e.forms=[],e.currentForm=null,e.studyDetails=null},setForms(e,t){e.forms=t},setCurrentForm(e,t){e.currentForm=t},setStudyDetails(e,t){e.studyDetails={...e.studyDetails,...t}},resetStudyDetails(e){e.studyDetails={}}},actions:{async login({commit:e},t){console.log("Attempting login with payload:",t);try{const s=await se.A.post(`${Zy}/users/login`,t);console.log("Login successful, API response:",s.data);const{access_token:a}=s.data;e("setToken",a),console.log("access token:",s.data.access_token),localStorage.setItem("access_token",s.data.access_token);const i=await se.A.get(`${Zy}/users/me`,{headers:{Authorization:`Bearer ${a}`}});return console.log("Fetched user data:",i.data),e("setUser",i.data),!0}catch(s){if(console.error("Login failed, error from API:",s.response?.data||s.message),403===s.response?.status)throw s;return!1}},async register(e,t){console.log("Registering user with payload:",t);try{return await se.A.post(`${Zy}/users/register`,t),console.log("Registration successful"),!0}catch(s){if(400===s.response?.status)throw console.error("Registration failed: Duplicate username or email."),new Error("Username or email already exists. Please choose another.");throw console.error("Unexpected registration error:",s.response?.data||s.message),new Error("An unexpected error occurred during registration.")}},async changePassword({state:e},t){console.log("Changing password:",t);try{const s=await se.A.post(`${Zy}/users/change-password`,{username:e.user.username,new_password:t.newPassword},{headers:{Authorization:`Bearer ${e.token}`}});return console.log("Password changed successfully:",s.data),!0}catch(s){return console.error("Error changing password:",s.response?.data||s.message),!1}},async fetchUserData({commit:e}){const t=localStorage.getItem("access_token");if(!t)return console.warn("No token found in localStorage. Cannot fetch user data."),!1;try{const s=await se.A.get(`${Zy}/users/me`,{headers:{Authorization:`Bearer ${t}`}});return console.log("Fetched user data:",s.data),e("setUser",s.data),!0}catch(s){return console.error("Failed to fetch user data:",s.response?.data||s.message),!1}},logout({commit:e}){console.log("Logging out..."),e("clearAuth"),localStorage.removeItem("access_token")},async fetchForms({commit:e,state:t}){try{const s=await se.A.get(`${Zy}/forms`,{headers:{Authorization:`Bearer ${t.token}`}});e("setForms",s.data)}catch(s){console.error("Error fetching forms:",s.response?.data||s.message)}},async fetchFormById({commit:e,state:t},s){try{const a=await se.A.get(`${Zy}/forms/${s}`,{headers:{Authorization:`Bearer ${t.token}`}});e("setCurrentForm",a.data)}catch(a){console.error("Error fetching form:",a.response?.data||a.message)}},async createForm({state:e},t){try{await se.A.post(`${Zy}/forms`,t,{headers:{Authorization:`Bearer ${e.token}`}})}catch(s){console.error("Error creating form:",s.response?.data||s.message)}},async updateForm({state:e},{id:t,form:s}){try{await se.A.put(`${Zy}/forms/${t}`,s,{headers:{Authorization:`Bearer ${e.token}`}})}catch(a){console.error("Error updating form:",a.response?.data||a.message)}},async deleteForm({state:e},t){try{await se.A.delete(`${Zy}/forms/${t}`,{headers:{Authorization:`Bearer ${e.token}`}})}catch(s){console.error("Error deleting form:",s.response?.data||s.message)}}},getters:{isAuthenticated:e=>!!e.token,getUser:e=>e.user,getForms:e=>e.forms,getCurrentForm:e=>e.currentForm,getStudyDetails:e=>e.studyDetails},plugins:[(0,Yy.A)({key:"myAppStudyDetails",paths:["studyDetails"],storage:window.localStorage})]});var tg=eg;function sg(e){if("string"!==typeof e)return"";let t=e.replace(/_/g," ").replace(/([a-z0-9])([A-Z])/g,"$1 $2").replace(/([A-Za-z])(\d)/g,"$1 $2").replace(/\s+/g," ").trim();return t=t.replace(/\b\w/g,e=>e.toUpperCase()),t}var ag={install(e){e.config.globalProperties.$formatLabel=sg,e.provide("formatLabel",sg)}},ig={install(e){e.component("BaseTextField",Hi),e.component("BaseTextarea",rl),e.component("BaseNumberField",gl),e.component("BaseDateField",xl),e.component("BaseSelectField",jl)}};(0,a.Ef)(u).use(Jy).use(tg).use(ag).use(ig).mount("#app")}},t={};function s(a){var i=t[a];if(void 0!==i)return i.exports;var l=t[a]={exports:{}};return e[a].call(l.exports,l,l.exports,s),l.exports}s.m=e,function(){var e=[];s.O=function(t,a,i,l){if(!a){var n=1/0;for(u=0;u<e.length;u++){a=e[u][0],i=e[u][1],l=e[u][2];for(var r=!0,o=0;o<a.length;o++)(!1&l||n>=l)&&Object.keys(s.O).every(function(e){return s.O[e](a[o])})?a.splice(o--,1):(r=!1,l<n&&(n=l));if(r){e.splice(u--,1);var d=i();void 0!==d&&(t=d)}}return t}l=l||0;for(var u=e.length;u>0&&e[u-1][2]>l;u--)e[u]=e[u-1];e[u]=[a,i,l]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.f={},s.e=function(e){return Promise.all(Object.keys(s.f).reduce(function(t,a){return s.f[a](e,t),t},[]))}}(),function(){s.u=function(e){return"js/"+e+"."+{442:"cb7663e9",535:"63d468b2"}[e]+".js"}}(),function(){s.miniCssF=function(e){return"css/"+e+"."+{442:"1d78b952",535:"67da4199"}[e]+".css"}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="ecrf_frontend:";s.l=function(a,i,l,n){if(e[a])e[a].push(i);else{var r,o;if(void 0!==l)for(var d=document.getElementsByTagName("script"),u=0;u<d.length;u++){var c=d[u];if(c.getAttribute("src")==a||c.getAttribute("data-webpack")==t+l){r=c;break}}r||(o=!0,r=document.createElement("script"),r.charset="utf-8",s.nc&&r.setAttribute("nonce",s.nc),r.setAttribute("data-webpack",t+l),r.src=a),e[a]=[i];var p=function(t,s){r.onerror=r.onload=null,clearTimeout(m);var i=e[a];if(delete e[a],r.parentNode&&r.parentNode.removeChild(r),i&&i.forEach(function(e){return e(s)}),t)return t(s)},m=setTimeout(p.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=p.bind(null,r.onerror),r.onload=p.bind(null,r.onload),o&&document.head.appendChild(r)}}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){s.p="/"}(),function(){if("undefined"!==typeof document){var e=function(e,t,a,i,l){var n=document.createElement("link");n.rel="stylesheet",n.type="text/css",s.nc&&(n.nonce=s.nc);var r=function(s){if(n.onerror=n.onload=null,"load"===s.type)i();else{var a=s&&s.type,r=s&&s.target&&s.target.href||t,o=new Error("Loading CSS chunk "+e+" failed.\n("+a+": "+r+")");o.name="ChunkLoadError",o.code="CSS_CHUNK_LOAD_FAILED",o.type=a,o.request=r,n.parentNode&&n.parentNode.removeChild(n),l(o)}};return n.onerror=n.onload=r,n.href=t,a?a.parentNode.insertBefore(n,a.nextSibling):document.head.appendChild(n),n},t=function(e,t){for(var s=document.getElementsByTagName("link"),a=0;a<s.length;a++){var i=s[a],l=i.getAttribute("data-href")||i.getAttribute("href");if("stylesheet"===i.rel&&(l===e||l===t))return i}var n=document.getElementsByTagName("style");for(a=0;a<n.length;a++){i=n[a],l=i.getAttribute("data-href");if(l===e||l===t)return i}},a=function(a){return new Promise(function(i,l){var n=s.miniCssF(a),r=s.p+n;if(t(n,r))return i();e(a,r,null,i,l)})},i={524:0};s.f.miniCss=function(e,t){var s={442:1,535:1};i[e]?t.push(i[e]):0!==i[e]&&s[e]&&t.push(i[e]=a(e).then(function(){i[e]=0},function(t){throw delete i[e],t}))}}}(),function(){var e={524:0};s.f.j=function(t,a){var i=s.o(e,t)?e[t]:void 0;if(0!==i)if(i)a.push(i[2]);else{var l=new Promise(function(s,a){i=e[t]=[s,a]});a.push(i[2]=l);var n=s.p+s.u(t),r=new Error,o=function(a){if(s.o(e,t)&&(i=e[t],0!==i&&(e[t]=void 0),i)){var l=a&&("load"===a.type?"missing":a.type),n=a&&a.target&&a.target.src;r.message="Loading chunk "+t+" failed.\n("+l+": "+n+")",r.name="ChunkLoadError",r.type=l,r.request=n,i[1](r)}};s.l(n,o,"chunk-"+t,t)}},s.O.j=function(t){return 0===e[t]};var t=function(t,a){var i,l,n=a[0],r=a[1],o=a[2],d=0;if(n.some(function(t){return 0!==e[t]})){for(i in r)s.o(r,i)&&(s.m[i]=r[i]);if(o)var u=o(s)}for(t&&t(a);d<n.length;d++)l=n[d],s.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return s.O(u)},a=self["webpackChunkecrf_frontend"]=self["webpackChunkecrf_frontend"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[504],function(){return s(6754)});a=s.O(a)})();
//# sourceMappingURL=app.d3846ff5.js.map